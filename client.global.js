var ReactGrabCursor=(function(exports){'use strict';var A=5e3,b="react-grab:agent-sessions",v=e=>{let t="",r="";for(let n of e.split(`
`))n.startsWith("event:")?t=n.slice(6).trim():n.startsWith("data:")&&(r=n.slice(5).trim());return {eventType:t,data:r}},T=async function*(e,t){let r=e.getReader(),n=new TextDecoder,o="",s=false,a=()=>{s=true,r.cancel().catch(()=>{});};t.addEventListener("abort",a);try{if(t.aborted)throw new DOMException("Aborted","AbortError");for(;;){let d=await r.read();if(s||t.aborted)throw new DOMException("Aborted","AbortError");let{done:i,value:l}=d;l&&(o+=n.decode(l,{stream:!0}));let c;for(;(c=o.indexOf(`

`))!==-1;){let{eventType:f,data:p}=v(o.slice(0,c));if(o=o.slice(c+2),f==="done")return;if(f==="error")throw new Error(p||"Agent error");p&&(yield p);}if(i)break}}finally{t.removeEventListener("abort",a);try{r.releaseLock();}catch{}}},m=e=>typeof e=="object"&&e!==null,S=(e,t,r=b)=>{let n=e.getItem(r);if(!n)throw new Error("No sessions to resume");let o;try{o=JSON.parse(n);}catch{throw new Error("Failed to parse stored sessions")}if(!m(o))throw new Error("Invalid stored sessions");let s=o[t];if(!m(s))throw new Error(`Session ${t} not found`);let a=s.context;if(!m(a))throw new Error(`Session ${t} is invalid`);let d=a.content,i=a.prompt;if(typeof d!="string"||typeof i!="string")throw new Error(`Session ${t} is invalid`);let l=a.options,c=a.sessionId;return {content:d,prompt:i,options:l,sessionId:typeof c=="string"?c:void 0}},h=async function*(e,t,r){let n=Date.now(),o=t.sessionId,s=e.pollIntervalMs??100,a=`${e.serverUrl}${e.agentPath??"/agent"}`,d=()=>{if(!o)return;let i=e.abortPath?.(o)??`/abort/${o}`;fetch(`${e.serverUrl}${i}`,{method:"POST"}).catch(()=>{});};r.addEventListener("abort",d);try{let i=await fetch(a,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t),signal:r});if(!i.ok)throw new Error(`Server error: ${i.status}`);if(!i.body)throw new Error("No response body");let l=T(i.body,r)[Symbol.asyncIterator](),c=!1,f=l.next(),p=null;for(;!c;){let C=await Promise.race([f.then(u=>({type:"status",iteratorResult:u})),new Promise(u=>setTimeout(()=>u({type:"timeout"}),s))]),g=(Date.now()-n)/1e3;if(C.type==="status"){let u=C.iteratorResult;c=u.done??!1,!c&&u.value&&(p=u.value,f=l.next());}p===e.completedStatus?yield `Completed in ${g.toFixed(1)}s`:p?yield `${p} ${g.toFixed(1)}s`:yield `Working\u2026 ${g.toFixed(1)}s`;}}finally{r.removeEventListener("abort",d);}},E=(e,t=A)=>{let r=null;return async()=>{let n=Date.now();if(r&&n-r.timestamp<t)return r.result;try{let o=await e();return r={result:o,timestamp:n},o}catch{return r={result:false,timestamp:n},false}}};var w="Completed successfully";var x="https://cursor-react-grab-server.xiechengqi.top",y=e=>typeof e=="object"&&e!==null&&"setAgent"in e,O=(e={})=>{let{serverUrl:t=x,getOptions:r}=e,n=s=>({...r?.()??{},...s??{}}),o=E(async()=>(await fetch(`${t}/health`,{method:"GET"})).ok,A);return {send:async function*(s,a){let d={...s,options:n(s.options)};yield*h({serverUrl:t,completedStatus:w},d,a);},resume:async function*(s,a,d){let i=S(d,s),l={content:i.content,prompt:i.prompt,options:i.options,sessionId:i.sessionId??s},c={...l,options:n(l.options)};yield "Resuming...",yield*h({serverUrl:t,completedStatus:w},c,a);},supportsResume:true,supportsFollowUp:true,checkConnection:o,abort:async s=>{try{await fetch(`${t}/abort/${s}`,{method:"POST"});}catch{}},undo:async()=>{try{await fetch(`${t}/undo`,{method:"POST"});}catch{}}}},_=async()=>{if(typeof window>"u")return;let e=O(),t=o=>{o.setAgent({provider:e,storage:sessionStorage});},r=window.__REACT_GRAB__;if(y(r)){t(r);return}window.addEventListener("react-grab:init",o=>{o instanceof CustomEvent&&y(o.detail)&&t(o.detail);},{once:true});let n=window.__REACT_GRAB__;y(n)&&t(n);};_();
exports.attachAgent=_;exports.createCursorAgentProvider=O;return exports;})({});