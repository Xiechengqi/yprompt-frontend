import{c as y,d as B,u as P,r as u,a as U,o as j,b as F,e as r,f as t,g as N,h as d,w as $,i as h,j as b,v as q,n as z,k as v,t as k,l as D,m as w,p as O,q as R,T,s as l,_ as Z}from"./index-CbQlXuR6.js";import{C as Y}from"./check-AFDIFzn_.js";/**
 * @license lucide-vue-next v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const W=y("circle-alert",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]);/**
 * @license lucide-vue-next v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const G=y("eye-off",[["path",{d:"M10.733 5.076a10.744 10.744 0 0 1 11.205 6.575 1 1 0 0 1 0 .696 10.747 10.747 0 0 1-1.444 2.49",key:"ct8e1f"}],["path",{d:"M14.084 14.158a3 3 0 0 1-4.242-4.242",key:"151rxh"}],["path",{d:"M17.479 17.499a10.75 10.75 0 0 1-15.417-5.151 1 1 0 0 1 0-.696 10.75 10.75 0 0 1 4.446-5.143",key:"13bj9a"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]]);/**
 * @license lucide-vue-next v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const H=y("eye",[["path",{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0",key:"1nclc0"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);/**
 * @license lucide-vue-next v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const J=y("loader-circle",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]]),K={class:"login-container"},Q={class:"login-card"},X={key:0,class:"loading-state"},ee={key:1,class:"login-content"},se={key:0,class:"login-section"},te={class:"form-group"},ae={class:"input-wrapper"},oe=["disabled"],le={key:0,class:"input-icon success"},re={key:0,class:"field-error"},ne={class:"form-group"},ie={class:"input-wrapper"},ue=["type","disabled"],de=["disabled"],ce={key:0,class:"field-error"},ve={class:"form-options"},pe={class:"checkbox-label"},me=["disabled"],fe={key:0,class:"error-message"},ye=["disabled"],ge={key:1},_e={key:2},he=B({__name:"LoginView",setup(be){const p=F(),g=P(),x=u({local_auth_enabled:!0}),o=u({username:"admin",password:"123123"}),C=u(!0),n=u(!1),c=u(""),m=u(!1),f=u(!1),a=u({}),L=s=>s?s.length<3?"用户名至少3个字符":s.length>20?"用户名不能超过20个字符":/^[a-zA-Z]/.test(s)?/^[a-zA-Z0-9_]+$/.test(s)?null:"用户名只能包含字母、数字和下划线":"用户名必须以字母开头":"请输入用户名",V=(s,e=!1)=>{if(!s)return"请输入密码";if(e){if(s.length<8)return"密码至少8个字符";if(!/[a-zA-Z]/.test(s))return"密码必须包含字母";if(!/[0-9]/.test(s))return"密码必须包含数字"}return null},_=()=>{a.value={};const s=L(o.value.username),e=V(o.value.password);return s&&(a.value.username=s),e&&(a.value.password=e),Object.keys(a.value).length===0},M=s=>{a.value[s]&&delete a.value[s]},S=U(()=>o.value.username.length>0&&o.value.password.length>0&&Object.keys(a.value).length===0),I=async()=>{try{const s=await g.getAuthConfig();s&&(x.value=s)}catch(s){console.error("获取认证配置失败:",s)}finally{C.value=!1}},A=()=>{f.value?localStorage.setItem("yprompt_remembered_username",o.value.username):localStorage.removeItem("yprompt_remembered_username")},E=async()=>{if(_()){c.value="",n.value=!0;try{if(await g.loginWithPassword(o.value.username.trim(),o.value.password)){A();const e=p.currentRoute.value.query.redirect;e&&e!=="/login"?p.push(e):p.push("/")}else c.value="用户名或密码错误"}catch(s){c.value="登录失败，请稍后重试",console.error("登录失败:",s)}finally{n.value=!1}}};return j(()=>{if(g.isLoggedIn){p.push("/");return}const s=localStorage.getItem("yprompt_remembered_username");s&&(o.value.username=s,f.value=!0),I()}),(s,e)=>(l(),r("div",K,[t("div",Q,[e[10]||(e[10]=N('<div class="login-header" data-v-c39906fe><div class="logo-wrapper" data-v-c39906fe><div class="logo-icon" data-v-c39906fe>YP</div></div><h1 class="login-title" data-v-c39906fe>YPrompt</h1><p class="login-subtitle" data-v-c39906fe>提示词管理系统</p></div>',1)),C.value?(l(),r("div",X,[...e[6]||(e[6]=[t("div",{class:"loading-spinner"},null,-1),t("p",{class:"loading-text"},"正在加载...",-1)])])):(l(),r("div",ee,[x.value.local_auth_enabled?(l(),r("div",se,[t("form",{onSubmit:$(E,["prevent"]),class:"login-form"},[t("div",te,[e[7]||(e[7]=t("label",{for:"username"},"用户名",-1)),t("div",ae,[b(t("input",{id:"username","onUpdate:modelValue":e[0]||(e[0]=i=>o.value.username=i),type:"text",class:z(["form-input",{"input-error":a.value.username}]),placeholder:"请输入用户名",disabled:n.value,autocomplete:"username",onBlur:_,onInput:e[1]||(e[1]=i=>M("username"))},null,42,oe),[[q,o.value.username]]),o.value.username&&!a.value.username?(l(),r("div",le,[h(v(Y),{size:18})])):d("",!0)]),a.value.username?(l(),r("div",re,k(a.value.username),1)):d("",!0)]),t("div",ne,[e[8]||(e[8]=t("label",{for:"password"},"密码",-1)),t("div",ie,[b(t("input",{id:"password","onUpdate:modelValue":e[2]||(e[2]=i=>o.value.password=i),type:m.value?"text":"password",class:z(["form-input",{"input-error":a.value.password}]),placeholder:"请输入密码",disabled:n.value,autocomplete:"current-password",onBlur:_,onInput:e[3]||(e[3]=i=>M("password"))},null,42,ue),[[D,o.value.password]]),t("button",{type:"button",class:"password-toggle",onClick:e[4]||(e[4]=i=>m.value=!m.value),disabled:n.value,tabindex:"-1"},[m.value?(l(),w(v(G),{key:1,size:18})):(l(),w(v(H),{key:0,size:18}))],8,de)]),a.value.password?(l(),r("div",ce,k(a.value.password),1)):d("",!0)]),t("div",ve,[t("label",pe,[b(t("input",{type:"checkbox","onUpdate:modelValue":e[5]||(e[5]=i=>f.value=i),class:"checkbox-input",disabled:n.value},null,8,me),[[O,f.value]]),e[9]||(e[9]=t("span",null,"记住我",-1))])]),h(T,{name:"fade"},{default:R(()=>[c.value?(l(),r("div",fe,[h(v(W),{size:16}),t("span",null,k(c.value),1)])):d("",!0)]),_:1}),t("button",{type:"submit",class:"btn btn-primary btn-block",disabled:n.value||!S.value},[n.value?(l(),w(v(J),{key:0,size:18,class:"spinning"})):d("",!0),n.value?(l(),r("span",ge,"登录中...")):(l(),r("span",_e,"登录"))],8,ye)],32)])):d("",!0)]))])]))}}),xe=Z(he,[["__scopeId","data-v-c39906fe"]]);export{xe as default};
