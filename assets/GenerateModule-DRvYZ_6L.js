var Ue=Object.defineProperty;var qe=(g,a,e)=>a in g?Ue(g,a,{enumerable:!0,configurable:!0,writable:!0,value:e}):g[a]=e;var be=(g,a,e)=>qe(g,typeof a!="symbol"?a+"":a,e);import{c as fe,x as Ge,r as R,u as Be,d as N,e as w,f as c,h as E,i as U,k as t,n as K,s as h,F as V,y as ee,t as L,X as ke,a as Q,z as Ce,g as Fe,m as B,A as H,j as we,B as Le,C as X,D as de,E as Pe,G as ue,o as ie,H as je,I as xe,w as ge,q as ae,J as pe,K as Oe,L as $e,M as He}from"./index-CbQlXuR6.js";import{savePrompt as Ke}from"./apiService-Dz_ZRgzF.js";import{R as Y,T as Qe,d as le,A as Ne,a as ne,u as _e,b as Xe,c as Ve,e as We,_ as Je,f as Ye,g as Ze,h as et,i as tt,j as nt,k as ot,C as Re}from"./ModelDialog.vue_vue_type_script_setup_true_lang-Ce9P3oop.js";import{P as st,C as he,c as J,a as me,b as Z,u as Se,d as se,e as De,T as rt,_ as it,f as at,g as ce,h as lt}from"./FinalTab.vue_vue_type_script_setup_true_lang-BrTpNWQM.js";import{c as Ie,_ as dt}from"./SavePromptDialog.vue_vue_type_script_setup_true_lang-sGOouhMw.js";import{C as Me}from"./check-AFDIFzn_.js";/**
 * @license lucide-vue-next v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ze=fe("chevron-up",[["path",{d:"m18 15-6-6-6 6",key:"153udz"}]]);/**
 * @license lucide-vue-next v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ut=fe("paperclip",[["path",{d:"m16 6-8.414 8.586a2 2 0 0 0 2.829 2.829l8.414-8.586a4 4 0 1 0-5.657-5.657l-8.379 8.551a6 6 0 1 0 8.485 8.485l8.379-8.551",key:"1miecu"}]]);/**
 * @license lucide-vue-next v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Te=fe("send",[["path",{d:"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z",key:"1ffxy3"}],["path",{d:"m21.854 2.147-10.94 10.939",key:"12cjpa"}]]);/**
 * @license lucide-vue-next v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pt=fe("upload",[["path",{d:"M12 3v12",key:"1x0j5s"}],["path",{d:"m17 8-5-5-5 5",key:"7q97r8"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}]]),W=Ge("prompt",()=>{const g=R(0),a=R(0),e=R([]),o=R(!1),s=R(!1),l=R(!1),n=R("zh"),i=R(!0),d=R(!1),u=R(null),v=R({taskDefinition:"",context:"",outputFormat:"",qualityCriteria:"",executionParams:""}),m=R({requirementReport:"",generatedPrompt:{zh:"",en:""},optimizedPrompt:{zh:"",en:""}}),f=[{id:"taskDefinition",title:"ä»»åŠ¡å®šä¹‰",description:"æ˜ç¡®AIåŠ©æ‰‹çš„æ ¸å¿ƒä»»åŠ¡å’Œä¸»è¦åŠŸèƒ½"},{id:"context",title:"ä½¿ç”¨åœºæ™¯",description:"äº†è§£AIçš„ä½¿ç”¨ç¯å¢ƒå’Œç›®æ ‡ç”¨æˆ·"},{id:"outputFormat",title:"è¾“å‡ºæ ¼å¼",description:"å®šä¹‰AIå›ç­”çš„ç»“æ„ã€æ ¼å¼å’Œé£æ ¼"},{id:"qualityCriteria",title:"è´¨é‡è¦æ±‚",description:"ç¡®å®šæˆåŠŸæ ‡å‡†å’Œè´¨é‡æœŸæœ›"},{id:"executionParams",title:"å·¥ä½œæ–¹å¼",description:"è®¾å®šAIçš„æ€è€ƒæ–¹å¼å’Œäº’åŠ¨é£æ ¼"},{id:"optimization",title:"æœ€ç»ˆç¡®è®¤",description:"ç¡®è®¤ä¿¡æ¯å®Œæ•´æ€§å¹¶ç”Ÿæˆæç¤ºè¯"}],C=(P,D,$,q)=>{const j={id:(q==null?void 0:q.id)||`msg_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,type:P,content:D,timestamp:new Date().toISOString(),isProgress:(q==null?void 0:q.isProgress)||!1,attachments:$&&$.length>0?$:[]};e.value.push(j),P==="user"&&a.value++};return{currentStep:g,currentStepUserMessages:a,chatMessages:e,isTyping:o,isGenerating:s,showPreview:l,currentLanguage:n,isAutoMode:i,isInitialized:d,currentExecutionStep:u,collectedData:v,promptData:m,steps:f,addMessage:C,addOrUpdateProgressMessage:(P,D="progress_message")=>{const $=e.value.findIndex(q=>q.id===D);$!==-1?(e.value[$].content=P,e.value[$].timestamp=new Date().toISOString()):C("ai",P,void 0,{id:D,isProgress:!0})},clearChat:()=>{e.value=[],g.value=0,a.value=0,l.value=!1,d.value=!1,u.value=null,v.value={taskDefinition:"",context:"",outputFormat:"",qualityCriteria:"",executionParams:""},m.value={requirementReport:"",generatedPrompt:{zh:"",en:""},optimizedPrompt:{zh:"",en:""}}},nextStep:()=>{g.value<f.length-1&&(g.value++,a.value=0)},updateCollectedData:(P,D)=>{if(P in v.value){const $=v.value[P];v.value[P]=$?$+`
`+D:D}},deleteMessage:P=>{const D=e.value.find($=>$.id===P);D&&(D.isDeleted=!0)},startEditMessage:P=>{const D=e.value.find($=>$.id===P);D&&(D.isEditing=!0,D.originalContent=D.content)},saveEditMessage:(P,D)=>{const $=e.value.find(q=>q.id===P);$&&($.content=D.trim(),$.isEditing=!1,$.originalContent=void 0,$.timestamp=new Date().toISOString())},cancelEditMessage:P=>{const D=e.value.find($=>$.id===P);D&&D.originalContent!==void 0&&(D.content=D.originalContent,D.isEditing=!1,D.originalContent=void 0)},updateMessage:(P,D)=>{const $=e.value.find(q=>q.id===P);$&&($.content=D,$.timestamp=new Date().toISOString())},getValidMessages:()=>e.value.filter(P=>!P.isDeleted&&!P.isProgress),clearProgressMessages:()=>{e.value=e.value.filter(P=>!P.isProgress)},saveToBackend:async(P,D,$,q="system")=>{if(!Be().isLoggedIn)return{success:!1,error:"è¯·å…ˆç™»å½•åå†ä¿å­˜æç¤ºè¯"};let G;const F=m.value.generatedPrompt;if(typeof F=="string"?G=F:"markdown"in F&&"xml"in F?G=F.markdown.zh||F.markdown.en||F.xml.zh||F.xml.en:G=F[n.value],!G||!G.trim())return{success:!1,error:"æ²¡æœ‰å¯ä¿å­˜çš„æç¤ºè¯"};try{const oe={title:P.trim(),description:D==null?void 0:D.trim(),requirement_report:m.value.requirementReport,thinking_points:m.value.thinkingPoints,initial_prompt:m.value.initialPrompt,advice:m.value.advice,final_prompt:G,language:n.value,format:"markdown",prompt_type:q,tags:$},_=await Ke(oe);return _.code===200&&_.data?{success:!0,promptId:_.data.id}:{success:!1,error:_.message||"ä¿å­˜å¤±è´¥"}}catch(oe){return{success:!1,error:oe.message||"ä¿å­˜å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•"}}}}}),ct={class:"p-4 border-b border-gray-200 flex-shrink-0"},gt={class:"flex justify-between items-center"},mt={class:"flex items-center space-x-2"},vt=["title"],ft={class:"flex items-center space-x-3"},ht={class:"flex items-center space-x-2"},yt=["title"],bt=N({__name:"ChatHeader",props:{isMobile:{type:Boolean},isExpanded:{type:Boolean},isStreamMode:{type:Boolean},modelTitle:{}},emits:["toggle-model-selector","toggle","toggle-stream","clear-chat"],setup(g){return(a,e)=>(h(),w("div",ct,[c("div",gt,[c("div",mt,[e[5]||(e[5]=c("h2",{class:"font-semibold text-gray-800"},"AIåŠ©æ‰‹å¯¹è¯",-1)),c("button",{onClick:e[0]||(e[0]=o=>a.$emit("toggle-model-selector")),class:"p-1 hover:bg-gray-100 rounded transition-colors",title:a.modelTitle},[...e[4]||(e[4]=[c("svg",{class:"w-4 h-4 text-gray-600 hover:text-gray-800",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[c("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M8 7h12m0 0l-4 4m4-4l-4-4m0 6H4m0 0l4 4m-4-4l4-4"})],-1)])],8,vt)]),c("div",ft,[a.isMobile&&a.isExpanded?(h(),w("button",{key:0,onClick:e[1]||(e[1]=o=>a.$emit("toggle")),class:"p-1 hover:bg-gray-100 rounded transition-colors",title:"æŠ˜å "},[U(t(ze),{class:"w-5 h-5 text-gray-500"})])):E("",!0),c("div",ht,[e[6]||(e[6]=c("span",{class:"text-sm text-gray-600"},"æµå¼:",-1)),c("button",{onClick:e[2]||(e[2]=o=>a.$emit("toggle-stream")),class:K(["relative inline-flex h-5 w-9 items-center rounded-full transition-colors focus:outline-none",a.isStreamMode?"bg-blue-500":"bg-gray-300"]),title:a.isStreamMode?"å…³é—­æµå¼æ¨¡å¼":"å¼€å¯æµå¼æ¨¡å¼"},[c("span",{class:K(["inline-block h-3 w-3 transform rounded-full bg-white transition-transform",a.isStreamMode?"translate-x-5":"translate-x-1"])},null,2)],10,yt)]),c("button",{onClick:e[3]||(e[3]=o=>a.$emit("clear-chat")),class:"flex items-center gap-1 px-3 py-1 text-sm text-gray-600 hover:text-red-600 hover:bg-red-50 rounded transition-colors",title:"é‡æ–°å¼€å§‹"},[U(t(Y),{class:"w-4 h-4"}),e[7]||(e[7]=c("span",null,"é‡æ–°å¼€å§‹",-1))])])])]))}}),xt={key:0,class:"px-4 pb-2 border-b border-gray-200 bg-gray-50"},wt={class:"py-2 space-y-2"},kt={class:"flex items-center justify-between"},Ct={class:"flex flex-col sm:flex-row gap-2"},St={class:"flex-1"},Mt=["value"],Pt=["value"],$t={class:"flex-1"},Rt=["value","disabled"],Dt=["value"],Tt={class:"text-xs text-gray-500"},Et={key:0},At={key:1},It={key:2},zt=N({__name:"ChatModelSelector",props:{show:{type:Boolean},chatProvider:{},chatModel:{},availableProviders:{},availableModels:{},modelDisplay:{}},emits:["update:chatProvider","update:chatModel","reset"],setup(g){return(a,e)=>a.show?(h(),w("div",xt,[c("div",wt,[c("div",kt,[e[3]||(e[3]=c("label",{class:"text-sm font-medium text-gray-700"},"AIåŠ©æ‰‹ä¸“ç”¨æ¨¡å‹",-1)),a.chatProvider?(h(),w("button",{key:0,onClick:e[0]||(e[0]=o=>a.$emit("reset")),class:"px-2 py-1 text-xs text-gray-600 hover:text-gray-800 hover:bg-gray-100 rounded transition-colors",title:"é‡ç½®ä¸ºå…¨å±€æ¨¡å‹"}," é‡ç½® ")):E("",!0)]),c("div",Ct,[c("div",St,[c("select",{value:a.chatProvider,onChange:e[1]||(e[1]=o=>a.$emit("update:chatProvider",o.target.value)),class:"w-full px-2 py-1.5 border border-gray-300 rounded text-sm focus:ring-2 focus:ring-blue-500 focus:border-transparent"},[e[4]||(e[4]=c("option",{value:""},"ä½¿ç”¨å…¨å±€æ¨¡å‹",-1)),(h(!0),w(V,null,ee(a.availableProviders,o=>(h(),w("option",{key:o.id,value:o.id},L(o.name),9,Pt))),128))],40,Mt)]),c("div",$t,[c("select",{value:a.chatModel,onChange:e[2]||(e[2]=o=>a.$emit("update:chatModel",o.target.value)),disabled:!a.chatProvider,class:"w-full px-2 py-1.5 border border-gray-300 rounded text-sm focus:ring-2 focus:ring-blue-500 focus:border-transparent disabled:opacity-50 disabled:bg-gray-100"},[e[5]||(e[5]=c("option",{value:""},"é€‰æ‹©æ¨¡å‹",-1)),(h(!0),w(V,null,ee(a.availableModels,o=>(h(),w("option",{key:o.id,value:o.id},L(o.name),9,Dt))),128))],40,Rt)])]),c("div",Tt,[a.chatProvider?a.chatModel?(h(),w("span",It,"å½“å‰: "+L(a.modelDisplay),1)):(h(),w("span",At,"è¯·é€‰æ‹©æ¨¡å‹")):(h(),w("span",Et,"å½“å‰: è·Ÿéšå…¨å±€æ¨¡å‹è®¾ç½®"))])])])):E("",!0)}}),Ut={key:0,class:"relative"},qt={class:"relative border border-blue-300 rounded-2xl overflow-hidden bg-white"},Gt={class:"relative"},Bt=["value"],Ft={key:1},Lt=["innerHTML"],jt=["innerHTML"],Ot={class:"text-xs text-gray-500 mb-1"},Ht={class:"flex gap-2 overflow-x-auto scrollbar-thin scrollbar-thumb-gray-300 scrollbar-track-gray-100 pb-1"},Kt={class:"flex items-center gap-2 min-w-0"},Qt={class:"flex-shrink-0"},Nt={key:0,class:"w-3 h-3 text-green-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},_t={key:1,class:"w-3 h-3 text-blue-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},Xt={key:2,class:"w-3 h-3 text-purple-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},Vt={key:3,class:"w-3 h-3 text-red-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},Wt={key:4,class:"w-3 h-3 text-gray-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},Jt={class:"min-w-0 flex-1"},Yt=["title"],Zt=["title","disabled"],en=["disabled"],tn=["disabled"],nn=N({__name:"ChatMessage",props:{message:{},messageIndex:{},editingContent:{},isDisabled:{type:Boolean}},emits:["start-edit","save-edit","cancel-edit","delete","copy","regenerate","resend","resend-user","edit-keydown","set-edit-ref","set-message-ref","update:editingContent"],setup(g){const a=o=>{try{const s=le(o,{breaks:!0,gfm:!0});return typeof s=="string"?s:String(s)}catch{return o}},e=o=>{try{if(/^#|^\*\*|^##|^\*|^-|\*\*.*\*\*|^1\.|```/.test(o)||o.includes("**")||o.includes("##")||o.includes("# ")||o.length>50){const l=le(o,{breaks:!0,gfm:!0});return typeof l=="string"?l:String(l)}else return o.replace(/\n/g,"<br>")}catch{try{const l=le(o,{breaks:!0,gfm:!0});return typeof l=="string"?l:String(l)}catch{return o.replace(/\n/g,"<br>")}}};return(o,s)=>(h(),w("div",{ref:l=>o.$emit("set-message-ref",{messageId:o.message.id,el:l}),class:K([o.message.type==="user"?"justify-end":"justify-start","flex group"])},[c("div",{class:K(["flex flex-col w-full",o.message.isEditing?"max-w-full sm:max-w-2xl":"max-w-xs lg:max-w-md"])},[c("div",{class:K([o.message.isEditing?"bg-transparent border-0 shadow-none p-0":o.message.type==="user"?"bg-blue-500 text-white px-4 py-3 rounded-lg":o.message.isProgress?"bg-blue-50 text-blue-800 border border-blue-200 px-4 py-3 rounded-lg":"bg-gray-100 text-gray-800 px-4 py-3 rounded-lg",o.message.isProgress&&"animate-pulse",!o.message.isEditing&&(o.message.type==="user"?"ml-auto":"mr-auto"),"transition-all duration-300 relative"])},[o.message.isEditing?(h(),w("div",Ut,[c("div",qt,[c("div",Gt,[c("textarea",{ref:l=>o.$emit("set-edit-ref",{messageId:o.message.id,el:l}),value:o.editingContent,onInput:s[0]||(s[0]=l=>o.$emit("update:editingContent",l.target.value)),class:"w-full p-4 border-0 resize-none focus:outline-none text-gray-800 bg-white min-h-[80px] max-h-[200px] overflow-y-auto text-base",onKeydown:s[1]||(s[1]=l=>o.$emit("edit-keydown",{event:l,messageId:o.message.id})),placeholder:"ç¼–è¾‘æ¶ˆæ¯å†…å®¹..."},null,40,Bt)])])])):(h(),w("div",Ft,[o.message.type==="ai"?(h(),w("div",{key:0,innerHTML:a(o.message.content),class:"prose prose-sm max-w-none prose-headings:text-gray-800 prose-p:text-gray-800 prose-li:text-gray-800 prose-strong:text-gray-800"},null,8,Lt)):(h(),w("div",{key:1,innerHTML:e(o.message.content),class:"text-white [&_h1]:text-xl [&_h1]:font-bold [&_h1]:text-white [&_h1]:mb-2 [&_h2]:text-lg [&_h2]:font-bold [&_h2]:text-white [&_h2]:mb-2 [&_h3]:text-base [&_h3]:font-bold [&_h3]:text-white [&_h3]:mb-1 [&_h4]:text-sm [&_h4]:font-bold [&_h4]:text-white [&_h5]:text-sm [&_h5]:font-bold [&_h5]:text-white [&_h6]:text-sm [&_h6]:font-bold [&_h6]:text-white [&_p]:text-white [&_p]:mb-2 [&_strong]:font-bold [&_strong]:text-white [&_b]:font-bold [&_b]:text-white [&_em]:italic [&_em]:text-white [&_i]:italic [&_i]:text-white [&_ul]:list-disc [&_ul]:list-inside [&_ul]:text-white [&_ul]:mb-2 [&_ol]:list-decimal [&_ol]:list-inside [&_ol]:text-white [&_ol]:mb-2 [&_li]:text-white [&_li]:mb-1 [&_code]:bg-blue-600 [&_code]:text-blue-100 [&_code]:px-1 [&_code]:rounded [&_code]:font-mono [&_pre]:bg-blue-600 [&_pre]:text-blue-100 [&_pre]:p-2 [&_pre]:rounded [&_pre]:overflow-x-auto [&_a]:text-blue-200 [&_a]:underline [&_blockquote]:border-l-2 [&_blockquote]:border-blue-300 [&_blockquote]:pl-2 [&_blockquote]:text-blue-100"},null,8,jt))]))],2),o.message.attachments&&o.message.attachments.length>0&&!o.message.isEditing?(h(),w("div",{key:0,class:K(["mt-2",o.message.type==="user"?"ml-auto max-w-xs lg:max-w-md":"mr-auto max-w-xs lg:max-w-md"])},[c("div",Ot,"é™„ä»¶ ("+L(o.message.attachments.length)+")",1),c("div",Ht,[(h(!0),w(V,null,ee(o.message.attachments,l=>(h(),w("div",{key:l.id,class:K(["flex-shrink-0 flex items-center gap-2 px-2 py-1.5 rounded-md text-xs border min-w-0",o.message.type==="user"?"border-blue-200 bg-blue-50":"border-gray-200 bg-gray-100"])},[c("div",Kt,[c("div",Qt,[l.type==="image"?(h(),w("svg",Nt,[...s[9]||(s[9]=[c("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"},null,-1)])])):l.type==="document"?(h(),w("svg",_t,[...s[10]||(s[10]=[c("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"},null,-1)])])):l.type==="audio"?(h(),w("svg",Xt,[...s[11]||(s[11]=[c("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 19V6l12-3v13M9 19c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zm12-3c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zM9 10l12-3"},null,-1)])])):l.type==="video"?(h(),w("svg",Vt,[...s[12]||(s[12]=[c("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z"},null,-1)])])):(h(),w("svg",Wt,[...s[13]||(s[13]=[c("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15.172 7l-6.586 6.586a2 2 0 102.828 2.828l6.414-6.586a4 4 0 00-5.656-5.656l-6.415 6.585a6 6 0 108.486 8.486L20.5 13"},null,-1)])]))]),c("div",Jt,[c("div",{class:K(["truncate max-w-20 font-medium text-xs",o.message.type==="user"?"text-blue-700":"text-gray-700"]),title:l.name},L(l.name),11,Yt),c("div",{class:K(["text-xs",o.message.type==="user"?"text-blue-500":"text-gray-500"])},L((l.size/1024).toFixed(1))+"KB ",3)])])],2))),128))])],2)):E("",!0),o.message.isProgress?E("",!0):(h(),w("div",{key:1,class:K(["flex space-x-1 mt-2 transition-opacity duration-200",[o.message.isEditing?"opacity-100 justify-end":"opacity-0 group-hover:opacity-100 "+(o.message.type==="user"?"justify-end":"justify-start")]])},[o.message.isEditing?(h(),w(V,{key:0},[c("button",{onClick:s[2]||(s[2]=l=>o.message.type==="user"?o.$emit("resend",o.message.id):o.$emit("save-edit",o.message.id)),class:"p-1.5 text-gray-500 hover:text-blue-600 transition-colors rounded-lg hover:bg-gray-100",title:o.message.type==="user"?"ä¿å­˜å¹¶é‡æ–°å‘é€":"ä¿å­˜ç¼–è¾‘",disabled:o.isDisabled},[U(t(Te),{class:"w-3.5 h-3.5"})],8,Zt),c("button",{onClick:s[3]||(s[3]=l=>o.$emit("cancel-edit",o.message.id)),class:"p-1.5 text-gray-500 hover:text-red-600 transition-colors rounded-lg hover:bg-gray-100",title:"å–æ¶ˆç¼–è¾‘"},[U(t(ke),{class:"w-3.5 h-3.5"})])],64)):(h(),w(V,{key:1},[o.message.type==="ai"?(h(),w("button",{key:0,onClick:s[4]||(s[4]=l=>o.$emit("regenerate",o.message.id)),class:"p-1.5 text-gray-500 hover:text-blue-600 transition-colors rounded-lg hover:bg-gray-100",title:"é‡æ–°ç”Ÿæˆå›å¤",disabled:o.isDisabled},[U(t(Y),{class:"w-3.5 h-3.5"})],8,en)):E("",!0),o.message.type==="user"?(h(),w("button",{key:1,onClick:s[5]||(s[5]=l=>o.$emit("resend-user",o.message.id)),class:"p-1.5 text-gray-500 hover:text-blue-600 transition-colors rounded-lg hover:bg-gray-100",title:"é‡æ–°å‘é€æ¶ˆæ¯",disabled:o.isDisabled},[U(t(Te),{class:"w-3.5 h-3.5"})],8,tn)):E("",!0),c("button",{onClick:s[6]||(s[6]=l=>o.$emit("start-edit",o.message.id)),class:"p-1.5 text-gray-500 hover:text-green-600 transition-colors rounded-lg hover:bg-gray-100",title:"ç¼–è¾‘æ¶ˆæ¯"},[U(t(st),{class:"w-3.5 h-3.5"})]),c("button",{onClick:s[7]||(s[7]=l=>o.$emit("delete",o.message.id)),class:"p-1.5 text-gray-500 hover:text-red-600 transition-colors rounded-lg hover:bg-gray-100",title:"åˆ é™¤æ¶ˆæ¯"},[U(t(Qe),{class:"w-3.5 h-3.5"})]),c("button",{onClick:s[8]||(s[8]=l=>o.$emit("copy",o.message.content)),class:"p-1.5 text-gray-500 hover:text-blue-600 transition-colors rounded-lg hover:bg-gray-100",title:"å¤åˆ¶æ¶ˆæ¯å†…å®¹"},[U(t(he),{class:"w-3.5 h-3.5"})])],64))],2))],2)],2))}}),on={key:0,class:"flex justify-start"},sn=N({__name:"ChatMessageList",props:{chatContainer:{},chatContainerMaxHeight:{},editingContent:{}},emits:["start-edit","save-edit","cancel-edit","delete","copy","regenerate","resend","resend-user","edit-keydown","set-edit-ref","set-message-ref"],setup(g){const a=g,e=W(),o=Q(()=>e.chatMessages.filter(i=>!i.isDeleted)),s=Q(()=>e.isTyping),l=Q(()=>e.isGenerating),n=i=>{a.chatContainer&&i&&(a.chatContainer.value=i)};return(i,d)=>(h(),w("div",{ref:n,class:"flex-1 overflow-y-auto p-4 space-y-4 min-h-0",style:Ce({maxHeight:i.chatContainerMaxHeight})},[(h(!0),w(V,null,ee(o.value,(u,v)=>(h(),B(nn,{key:u.id||v,message:u,"message-index":v,"editing-content":i.editingContent[u.id]||"","is-disabled":s.value||l.value,onStartEdit:d[0]||(d[0]=m=>i.$emit("start-edit",m)),onSaveEdit:d[1]||(d[1]=m=>i.$emit("save-edit",m)),onCancelEdit:d[2]||(d[2]=m=>i.$emit("cancel-edit",m)),onDelete:d[3]||(d[3]=m=>i.$emit("delete",m)),onCopy:d[4]||(d[4]=m=>i.$emit("copy",m)),onRegenerate:m=>i.$emit("regenerate",{messageId:m,messageIndex:v}),onResend:m=>i.$emit("resend",{messageId:m,messageIndex:v}),onResendUser:m=>i.$emit("resend-user",{messageId:m,messageIndex:v}),onEditKeydown:d[5]||(d[5]=m=>i.$emit("edit-keydown",m)),onSetEditRef:d[6]||(d[6]=m=>i.$emit("set-edit-ref",m)),onSetMessageRef:d[7]||(d[7]=m=>i.$emit("set-message-ref",m))},null,8,["message","message-index","editing-content","is-disabled","onRegenerate","onResend","onResendUser"]))),128)),s.value?(h(),w("div",on,[...d[8]||(d[8]=[Fe('<div class="bg-gray-100 text-gray-800 px-4 py-2 rounded-lg"><div class="flex space-x-1"><div class="w-2 h-2 bg-gray-400 rounded-full animate-bounce"></div><div class="w-2 h-2 bg-gray-400 rounded-full animate-bounce" style="animation-delay:0.1s;"></div><div class="w-2 h-2 bg-gray-400 rounded-full animate-bounce" style="animation-delay:0.2s;"></div></div></div>',1)])])):E("",!0)],4))}}),rn={class:"flex flex-wrap gap-2"},an=["onClick"],ln=N({__name:"ChatQuickReplies",props:{show:{type:Boolean},replies:{},quickRepliesContainer:{},inputContainerRef:{}},emits:["select"],setup(g){const a=g,e=R(),o=Q(()=>{if(!a.inputContainerRef)return{position:"absolute",bottom:"100%",left:"0",right:"0"};const s=a.inputContainerRef.getBoundingClientRect();return{position:"fixed",bottom:`${window.innerHeight-s.top}px`,left:`${s.left}px`,right:`${window.innerWidth-s.right}px`}});return H(e,s=>{a.quickRepliesContainer&&(a.quickRepliesContainer.value=s)}),(s,l)=>s.show?(h(),w("div",{key:0,ref_key:"containerRef",ref:e,class:"px-6 py-3 bg-gray-50 border-b border-gray-200 shadow-lg z-10",style:Ce(o.value)},[l[0]||(l[0]=c("div",{class:"text-xs text-gray-500 mb-2"},"å¿«é€Ÿå›å¤ï¼š",-1)),c("div",rn,[(h(!0),w(V,null,ee(s.replies,n=>(h(),w("button",{key:n,onClick:i=>s.$emit("select",n),class:"px-3 py-1 text-sm bg-white border border-gray-300 rounded-full hover:bg-gray-50 transition-colors"},L(n),9,an))),128))])],4)):E("",!0)}}),dn={ref:"inputContainer",class:"p-3 border-t border-gray-200 bg-white flex-shrink-0 relative z-20"},un={class:"flex flex-wrap gap-2"},pn=["onClick"],cn={key:1,class:"mb-3 p-3 bg-gray-50 rounded-lg"},gn={class:"flex items-center justify-between mb-2"},mn={class:"text-sm text-gray-600"},vn={class:"flex gap-2 overflow-x-auto scrollbar-thin scrollbar-thumb-gray-300 scrollbar-track-gray-100"},fn={class:"flex items-center gap-2 min-w-0"},hn={class:"flex-shrink-0"},yn={key:0,class:"w-4 h-4 text-green-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},bn={key:1,class:"w-4 h-4 text-blue-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},xn={key:2,class:"w-4 h-4 text-purple-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},wn={key:3,class:"w-4 h-4 text-red-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},kn={key:4,class:"w-4 h-4 text-gray-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},Cn={class:"min-w-0 flex-1"},Sn=["title"],Mn={class:"text-xs text-gray-500"},Pn=["onClick"],$n={class:"relative border border-gray-300 rounded-2xl focus-within:outline-none focus-within:border-gray-300 overflow-hidden",style:{height:"120px"}},Rn={class:"absolute top-0 left-0 right-0",style:{bottom:"48px"}},Dn=["value","placeholder","disabled"],Tn={class:"absolute bottom-0 left-0 right-0 h-12 flex justify-between items-center px-2 bg-transparent pointer-events-none"},En={class:"relative"},An={key:0,class:"absolute -top-1 -right-1 bg-blue-500 text-white text-xs rounded-full w-3 h-3 flex items-center justify-center",style:{"font-size":"9px"}},In=["disabled"],zn=N({__name:"ChatInputArea",props:{isMobile:{type:Boolean},isEditing:{type:Boolean},userInput:{},attachments:{},placeholder:{},isDisabled:{type:Boolean},textareaRef:{},inputContainer:{},showQuickReplies:{type:Boolean},quickReplies:{},quickRepliesContainer:{}},emits:["update:userInput","keydown","composition-start","composition-end","focus","send","file-select","remove-attachment","clear-attachments","quick-reply-select"],setup(g,{emit:a}){const e=g,o=a,s=R(),l=R();H(s,u=>{e.quickRepliesContainer&&(e.quickRepliesContainer.value=u)});const n=()=>{l.value&&l.value.click()},i=()=>{o("focus")},d=u=>{const v=u.target;if(document.activeElement!==v){const m=window.pageYOffset||document.documentElement.scrollTop,f=window.pageXOffset||document.documentElement.scrollLeft;setTimeout(()=>{window.scrollTo(f,m)},0)}};return(u,v)=>(h(),w("div",dn,[u.showQuickReplies?(h(),w("div",{key:0,ref_key:"quickRepliesRef",ref:s,class:"absolute bottom-full left-0 right-0 px-6 py-3 bg-gray-50 border-b border-gray-200 shadow-lg"},[v[7]||(v[7]=c("div",{class:"text-xs text-gray-500 mb-2"},"å¿«é€Ÿå›å¤ï¼š",-1)),c("div",un,[(h(!0),w(V,null,ee(u.quickReplies,m=>(h(),w("button",{key:m,onClick:f=>u.$emit("quick-reply-select",m),class:"px-3 py-1 text-sm bg-white border border-gray-300 rounded-full hover:bg-gray-50 transition-colors"},L(m),9,pn))),128))])],512)):E("",!0),c("input",{ref_key:"fileInputRef",ref:l,type:"file",multiple:"",accept:"image/*,video/*,audio/*,.pdf,.doc,.docx,.xls,.xlsx,.ppt,.pptx,.txt,.md,.csv,.json,.xml,.html,.css,.js,.ts,.py,.java,.c,.cpp,.yaml,.yml",onChange:v[0]||(v[0]=m=>u.$emit("file-select",m)),class:"hidden"},null,544),u.attachments.length>0?(h(),w("div",cn,[c("div",gn,[c("span",mn,"å·²é€‰æ‹© "+L(u.attachments.length)+" ä¸ªé™„ä»¶",1),c("button",{onClick:v[1]||(v[1]=m=>u.$emit("clear-attachments")),class:"text-xs text-red-500 hover:text-red-700"}," æ¸…ç©ºå…¨éƒ¨ ")]),c("div",vn,[(h(!0),w(V,null,ee(u.attachments,m=>(h(),w("div",{key:m.id,class:"flex-shrink-0 flex items-center gap-2 bg-white px-3 py-2 rounded-md border border-gray-200 min-w-0"},[c("div",fn,[c("div",hn,[m.type==="image"?(h(),w("svg",yn,[...v[8]||(v[8]=[c("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"},null,-1)])])):m.type==="document"?(h(),w("svg",bn,[...v[9]||(v[9]=[c("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"},null,-1)])])):m.type==="audio"?(h(),w("svg",xn,[...v[10]||(v[10]=[c("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 19V6l12-3v13M9 19c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zm12-3c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zM9 10l12-3"},null,-1)])])):m.type==="video"?(h(),w("svg",wn,[...v[11]||(v[11]=[c("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z"},null,-1)])])):(h(),w("svg",kn,[...v[12]||(v[12]=[c("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15.172 7l-6.586 6.586a2 2 0 102.828 2.828l6.414-6.586a4 4 0 00-5.656-5.656l-6.415 6.585a6 6 0 108.486 8.486L20.5 13"},null,-1)])]))]),c("div",Cn,[c("div",{class:"text-xs font-medium text-gray-700 truncate max-w-24",title:m.name},L(m.name),9,Sn),c("div",Mn,L((m.size/1024).toFixed(1))+"KB ",1)])]),c("button",{onClick:f=>u.$emit("remove-attachment",m.id),class:"flex-shrink-0 w-4 h-4 text-gray-400 hover:text-red-500 transition-colors",title:"ç§»é™¤é™„ä»¶"},[U(t(ke),{class:"w-3 h-3"})],8,Pn)]))),128))])])):E("",!0),we(c("div",$n,[c("div",Rn,[c("textarea",{ref:"textareaRef",value:u.userInput,onInput:v[2]||(v[2]=m=>u.$emit("update:userInput",m.target.value)),onKeydown:v[3]||(v[3]=m=>u.$emit("keydown",m)),onCompositionstart:v[4]||(v[4]=m=>u.$emit("composition-start")),onCompositionend:v[5]||(v[5]=m=>u.$emit("composition-end")),onFocus:i,onMousedown:d,placeholder:u.placeholder,disabled:u.isDisabled,class:"w-full h-full px-2 pt-3 pb-1 border-0 outline-none resize-none disabled:opacity-50 text-base overflow-y-auto bg-transparent",rows:"1"},null,40,Dn)]),c("div",Tn,[c("button",{onClick:n,class:"w-8 h-8 rounded-full text-gray-500 hover:bg-gray-100 hover:text-gray-700 transition-colors flex items-center justify-center pointer-events-auto",title:"æ”¯æŒæ‹–æ‹½ä¸Šä¼ å›¾ç‰‡ã€æ–‡æ¡£ã€éŸ³é¢‘ç­‰æ ¼å¼ï¼Œå•ä¸ªæ–‡ä»¶æœ€å¤§25MB"},[c("div",En,[U(t(ut),{class:"w-4 h-4"}),u.attachments.length>0?(h(),w("span",An,L(u.attachments.length),1)):E("",!0)])]),c("button",{onClick:v[6]||(v[6]=m=>u.$emit("send")),disabled:!u.userInput.trim()||u.isDisabled,class:"w-8 h-8 bg-blue-500 text-white rounded-full hover:bg-blue-600 disabled:opacity-50 disabled:cursor-not-allowed transition-colors flex items-center justify-center pointer-events-auto"},[U(t(Ne),{class:"w-4 h-4"})],8,In)])],512),[[Le,!u.isMobile||!u.isEditing]])],512))}});function Un(){const g=W(),a=R(),e=u=>{try{const v=le(u,{breaks:!0,gfm:!0});return typeof v=="string"?v:String(v)}catch{return u}},o=u=>{try{if(/^#|^\*\*|^##|^\*|^-|\*\*.*\*\*|^1\.|```/.test(u)||u.includes("**")||u.includes("##")||u.includes("# ")||u.length>50){const m=le(u,{breaks:!0,gfm:!0});return typeof m=="string"?m:String(m)}else return u.replace(/\n/g,"<br>")}catch{try{const m=le(u,{breaks:!0,gfm:!0});return typeof m=="string"?m:String(m)}catch{return u.replace(/\n/g,"<br>")}}},s=()=>{X(()=>{a.value&&(a.value.scrollTop=a.value.scrollHeight)})};let l=-1;return{chatContainer:a,renderMarkdown:e,renderUserMessage:o,scrollToBottom:s,startStreamingMessage:()=>(g.isTyping=!1,g.addMessage("ai","",void 0),l=g.chatMessages.length-1,l),updateStreamingMessage:u=>{l>=0&&l<g.chatMessages.length&&(g.chatMessages[l].content=u)},simulateTyping:async(u,v=!1)=>{if(v){const m=g.chatMessages.length;g.addMessage("ai","",void 0);for(let f=0;f<=u.length;f++)g.chatMessages[m].content=u.substring(0,f),await new Promise(C=>setTimeout(C,Math.random()*30+10))}else g.isTyping=!0,await new Promise(m=>setTimeout(m,100+Math.random()*100)),g.isTyping=!1,g.addMessage("ai",u,void 0)}}}function qn(){const g=R(""),a=R(),e=R(!1);return{userInput:g,textareaRef:a,isComposing:e,adjustTextareaHeight:()=>{},handleCompositionStart:()=>{e.value=!0},handleCompositionEnd:()=>{e.value=!1},handleKeydown:(d,u)=>{if(d.key==="Enter"){if(d.shiftKey)return;if(e.value)return;d.preventDefault(),u()}},clearInput:()=>{g.value="";const d=a.value;d&&(d.style.height="80px")}}}function Gn(){const g=de(),a=R([]),e=R(!1),o=R();return{currentAttachments:a,isGlobalDragging:e,fileInputRef:o,triggerFileSelect:()=>{o.value&&o.value.click()},handleFileSelect:async f=>{const C=f.target,k=Array.from(C.files||[]);if(k.length>0){try{const{processFiles:x}=await Pe(async()=>{const{processFiles:r}=await import("./fileUtils-CvcPFew1.js");return{processFiles:r}},[]),b=await x(k);b.attachments.length>0&&a.value.push(...b.attachments),b.errors.length>0&&b.errors.forEach(r=>g.error(r))}catch{g.error("æ–‡ä»¶å¤„ç†å¤±è´¥")}C.value=""}},removeAttachment:f=>{const C=a.value.findIndex(k=>k.id===f);C!==-1&&a.value.splice(C,1)},clearAttachments:()=>{a.value=[]},handleGlobalDragEnter:f=>{var C;if(f.preventDefault(),(C=f.dataTransfer)!=null&&C.items){for(let k=0;k<f.dataTransfer.items.length;k++)if(f.dataTransfer.items[k].kind==="file"){e.value=!0;break}}},handleGlobalDragOver:f=>{f.preventDefault(),e.value=!0},handleGlobalDragLeave:f=>{f.preventDefault();const k=f.currentTarget.getBoundingClientRect(),x=f.clientX,b=f.clientY;(x<k.left||x>k.right||b<k.top||b>k.bottom)&&(e.value=!1)},handleGlobalDrop:async f=>{var k;f.preventDefault(),e.value=!1;const C=Array.from(((k=f.dataTransfer)==null?void 0:k.files)||[]);if(C.length>0)try{const{processFiles:x}=await Pe(async()=>{const{processFiles:r}=await import("./fileUtils-CvcPFew1.js");return{processFiles:r}},[]),b=await x(C);b.attachments.length>0&&a.value.push(...b.attachments),b.errors.length>0&&b.errors.forEach(r=>g.error(r))}catch{g.error("æ–‡ä»¶å¤„ç†å¤±è´¥")}}}}function Bn(){const g=ue(),a=R(!1),e=R(""),o=R(""),s=R(!0),l=Q(()=>g.getAvailableProviders()),n=Q(()=>e.value?g.getAvailableModels(e.value):[]),i=()=>{o.value="";const k=n.value;k.length>0&&(o.value=k[0].id),d()},d=()=>{localStorage.setItem("yprompt_chat_provider",e.value),localStorage.setItem("yprompt_chat_model",o.value)},u=()=>{e.value="",o.value="",d(),a.value=!1},v=()=>{if(!e.value||!o.value)return"å…¨å±€æ¨¡å‹";const k=l.value.find(b=>b.id===e.value),x=n.value.find(b=>b.id===o.value);return`${k==null?void 0:k.name} - ${x==null?void 0:x.name}`},m=()=>{if(e.value&&o.value){const b=l.value.find(p=>p.id===e.value),r=n.value.find(p=>p.id===o.value);return{provider:b,model:r}}const k=g.getCurrentProvider(),x=g.getCurrentModel();return{provider:k,model:x}},f=()=>{s.value=!s.value,localStorage.setItem("yprompt_stream_mode",JSON.stringify(s.value))},C=()=>{const k=localStorage.getItem("yprompt_chat_provider"),x=localStorage.getItem("yprompt_chat_model");k&&(e.value=k),x&&(o.value=x);const b=localStorage.getItem("yprompt_stream_mode");if(b!==null)try{s.value=JSON.parse(b)}catch{s.value=!0}};return ie(()=>{C()}),{showModelSelector:a,chatProvider:e,chatModel:o,isStreamMode:s,availableChatProviders:l,availableChatModels:n,onChatProviderChange:i,saveChatModelSettings:d,resetChatModel:u,getChatModelDisplay:v,getCurrentChatModel:m,toggleStreamMode:f,loadSettings:C}}function Fn(g){const a=W(),e=R(!1),o=R(),s=Q(()=>{const u=a.chatMessages.length,v=["è¯·ä½¿ç”¨ç›¸å…³æœ€ä½³å®è·µçš„æ¨èå»ºè®®"];if(u>=6){const f=!!a.promptData.requirementReport?"é‡æ–°ç”Ÿæˆéœ€æ±‚æŠ¥å‘Š":"å¼ºåˆ¶ç”Ÿæˆéœ€æ±‚æŠ¥å‘Š";return[...v,f]}return v}),l=Q(()=>a.chatMessages.length>=2&&e.value),n=u=>["å¼ºåˆ¶ç”Ÿæˆéœ€æ±‚æŠ¥å‘Š","é‡æ–°ç”Ÿæˆéœ€æ±‚æŠ¥å‘Š"].some(m=>u.includes(m)),i=(u,v)=>{v(u),e.value=!1},d=u=>{var m,f;const v=u.target;(m=g.value)!=null&&m.contains(v)||(f=o.value)!=null&&f.contains(v)||(e.value=!1)};return ie(()=>{setTimeout(()=>{document.addEventListener("mousedown",d)},100)}),je(()=>{document.removeEventListener("mousedown",d)}),{showQuickReplies:e,quickReplies:s,quickRepliesContainer:o,shouldShowQuickReplies:l,checkForceGenerate:n,selectQuickReply:i}}function Ln(g){const a=W(),e=de(),o=R({}),s=R({}),l=R({}),n=Q(()=>Object.keys(o.value).length>0),i=(x,b)=>{b&&(s.value[x]=b)},d=x=>{x.el&&(l.value[x.messageId]=x.el)},u=x=>{const b=a.chatMessages.find(r=>r.id===x);b&&(o.value[x]=b.content,a.startEditMessage(x),X(()=>{const r=s.value[x];if(r){r.focus();const p=r.value.length;r.setSelectionRange(p,p)}}))},v=x=>{const b=o.value[x];b!==void 0&&b.trim()?(a.saveEditMessage(x,b),delete o.value[x],delete s.value[x]):e.warning("æ¶ˆæ¯å†…å®¹ä¸èƒ½ä¸ºç©º")},m=x=>{a.cancelEditMessage(x),delete o.value[x],delete s.value[x]};return{editingContent:o,editTextareaRefs:s,messageRefs:l,isEditing:n,setEditTextareaRef:i,setMessageRef:d,startEdit:u,saveEdit:v,cancelEdit:m,deleteMessage:x=>{confirm("ç¡®å®šè¦åˆ é™¤è¿™æ¡æ¶ˆæ¯å—ï¼Ÿåˆ é™¤åè¯¥æ¶ˆæ¯å°†ä¸ä¼šåœ¨åç»­çš„AIå¯¹è¯ä¸­è¢«è€ƒè™‘ã€‚")&&(a.deleteMessage(x),e.success("æ¶ˆæ¯å·²åˆ é™¤"))},copyMessage:async x=>{try{await Ie(x),e.success("å·²å¤åˆ¶åˆ°å‰ªè´´æ¿")}catch{const r=document.createElement("textarea");r.value=x,document.body.appendChild(r),r.select();try{document.execCommand("copy"),e.success("å·²å¤åˆ¶åˆ°å‰ªè´´æ¿")}catch{e.error("å¤åˆ¶å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨é€‰æ‹©å¤åˆ¶")}document.body.removeChild(r)}},handleEditKeydown:(x,b)=>{x.key==="Enter"&&x.ctrlKey?(x.preventDefault(),v(b)):x.key==="Escape"&&(x.preventDefault(),m(b))}}}const re=class re{constructor(){be(this,"aiService");this.aiService=ne.getInstance()}getStreamMode(){try{const a=localStorage.getItem("yprompt_stream_mode");return a?JSON.parse(a):!0}catch{return!0}}static getInstance(){return re.instance||(re.instance=new re),re.instance}async generateSimpleResponse(a,e,o,s,l=!1){const n=this.buildSimpleConversationMessages(a,e),i=await this.aiService.callAI(n,o,s,l);if(!i||i.trim()==="")throw new Error("AI APIè¿”å›äº†ç©ºå“åº”");return i}buildSimpleConversationMessages(a,e){const o={role:"system",content:xe.getUserGuidedPromptRules()},s=e.map(n=>({role:n.type==="user"?"user":"assistant",content:n.content,attachments:n.attachments||[]})),l=[o,...s];return a.trim()&&l.push({role:"user",content:a}),l}getStepInfo(a){const e=[{id:"taskDefinition",title:"ä»»åŠ¡å®šä¹‰",description:"æ˜ç¡®AIåŠ©æ‰‹çš„æ ¸å¿ƒä»»åŠ¡å’Œä¸»è¦åŠŸèƒ½",focus:"é‡ç‚¹äº†è§£ç”¨æˆ·å¸Œæœ›AIå®Œæˆä»€ä¹ˆæ ·çš„å·¥ä½œ"},{id:"context",title:"ä½¿ç”¨åœºæ™¯",description:"äº†è§£AIçš„ä½¿ç”¨ç¯å¢ƒå’Œç›®æ ‡ç”¨æˆ·",focus:"é‡ç‚¹äº†è§£åœ¨ä»€ä¹ˆæƒ…å†µä¸‹ä½¿ç”¨ã€é¢å‘ä»€ä¹ˆæ ·çš„ç”¨æˆ·"},{id:"outputFormat",title:"è¾“å‡ºæ ¼å¼",description:"å®šä¹‰AIå›ç­”çš„ç»“æ„ã€æ ¼å¼å’Œé£æ ¼",focus:"é‡ç‚¹äº†è§£å¸Œæœ›AIå¦‚ä½•ç»„ç»‡å’Œå‘ˆç°ç­”æ¡ˆ"},{id:"qualityCriteria",title:"è´¨é‡è¦æ±‚",description:"ç¡®å®šæˆåŠŸæ ‡å‡†å’Œè´¨é‡æœŸæœ›",focus:"é‡ç‚¹äº†è§£å¯¹å‡†ç¡®æ€§ã€å®Œæ•´æ€§ç­‰æ–¹é¢çš„è¦æ±‚"},{id:"executionParams",title:"å·¥ä½œæ–¹å¼",description:"è®¾å®šAIçš„æ€è€ƒæ–¹å¼å’Œäº’åŠ¨é£æ ¼",focus:"é‡ç‚¹äº†è§£å¸Œæœ›AIé‡‡ç”¨ä»€ä¹ˆæ ·çš„å·¥ä½œæ–¹å¼å’Œè¯­è°ƒ"},{id:"optimization",title:"æœ€ç»ˆç¡®è®¤",description:"ç¡®è®¤ä¿¡æ¯å®Œæ•´æ€§å¹¶ç”Ÿæˆæç¤ºè¯",focus:"æ±‡æ€»æ‰€æœ‰ä¿¡æ¯å¹¶ç”Ÿæˆæœ€ç»ˆæç¤ºè¯"}];return e.find(o=>o.id===a)||e[0]}async getInitialQuestion(a,e,o,s=!1){if(!e||!o)throw new Error("éœ€è¦é…ç½®AIæä¾›å•†å’Œæ¨¡å‹");return await this.generateInitialQuestionWithAI(a,e,o,s)}async generateInitialQuestionWithAI(a,e,o,s=!1){const l=this.getStepInfo(a),n={role:"system",content:xe.getUserGuidedPromptRules()},i={role:"user",content:`è¯·ä¸º"${l.title}"æ­¥éª¤ç”Ÿæˆä¸€ä¸ªåˆé€‚çš„å¼€åœºé—®é¢˜ã€‚è¿™ä¸ªæ­¥éª¤çš„ç›®æ ‡æ˜¯ï¼š${l.description}`};return await this.aiService.callAI([n,i],e,o,s)}async generateRequirementReportFromConversation(a,e,o,s){if(!e||!o)throw new Error("éœ€è¦é…ç½®AIæä¾›å•†å’Œæ¨¡å‹");return await this.generateReportFromConversationWithAI(a,e,o,s)}async generateReportFromConversationWithAI(a,e,o,s){const l={role:"system",content:xe.getRequirementReportRules()},i={role:"user",content:`åŸºäºä»¥ä¸‹å¯¹è¯å†å²ç”Ÿæˆéœ€æ±‚æ€»ç»“æŠ¥å‘Šï¼š

**å¯¹è¯å†å²ï¼š**
${a.map(v=>{let m=`${v.type==="user"?"User":"AI"}: ${v.content}`;if(v.attachments&&v.attachments.length>0){const f=v.attachments.map(C=>`[é™„ä»¶: ${C.name} (${C.type}, ${C.size} bytes)]`).join(", ");m+=`
é™„ä»¶: ${f}`}return m}).join(`

`)}

è¯·ç”Ÿæˆå®Œæ•´çš„éœ€æ±‚æ€»ç»“æŠ¥å‘Šï¼Œç¡®ä¿æ‰€æœ‰5ä¸ªéƒ¨åˆ†éƒ½æœ‰å…·ä½“å†…å®¹ã€‚`},d=this.getStreamMode();s&&d&&this.aiService.setStreamUpdateCallback(v=>{s(v)});const u=await this.aiService.callAI([l,i],e,o,d);return s&&d&&this.aiService.clearStreamUpdateCallback(),u}};be(re,"instance");let ve=re;const jn={welcomeMessage:"æ‚¨å¥½ï¼æˆ‘æ˜¯æç¤ºè¯å·¥ç¨‹ä¸“å®¶ï¼Œå°†é€šè¿‡å‡ ä¸ªé—®é¢˜å¸®æ‚¨æ„å»ºä¸€ä¸ªé«˜è´¨é‡çš„AIæç¤ºè¯ã€‚è¯·å…ˆå‘Šè¯‰æˆ‘ï¼šæ‚¨å¸Œæœ›ç”¨AIæ¥è§£å†³ä»€ä¹ˆé—®é¢˜æˆ–å®Œæˆä»€ä¹ˆä»»åŠ¡ï¼Ÿ",quickReplies:["è¯·ä½¿ç”¨ç›¸å…³æœ€ä½³å®è·µçš„æ¨èå»ºè®®","å¼ºåˆ¶ç”Ÿæˆéœ€æ±‚æŠ¥å‘Š"],maxConversationTurns:5,typingDelay:50};function On(g){return{...jn,...g}}function Hn(g,a,e,o,s){const l=On(),n=W(),i=ue(),d=de(),u=ve.getInstance(),v=Q(()=>{let r=345,p=0;a.showModelSelector.value&&(typeof window<"u"&&window.innerWidth>=640?p=110:p=120);let y=0;return o.currentAttachments.value.length>0&&(y=115),`calc(100vh - ${r+p+y}px)`});H(()=>n.chatMessages.length,g.scrollToBottom),H(()=>n.isTyping,g.scrollToBottom);const m=async()=>{n.chatMessages.length===0&&!n.isInitialized&&(n.isInitialized=!0,await g.simulateTyping(l.welcomeMessage,!1))},f=()=>{n.clearChat(),s.showQuickReplies.value=!1,o.clearAttachments(),setTimeout(async()=>{await g.simulateTyping(l.welcomeMessage,!1),n.isInitialized=!0},500)},C=async r=>{if(!r.trim()){o.currentAttachments.value.length>0&&d.warning("è¯·è¾“å…¥æ¶ˆæ¯å†…å®¹ï¼Œä¸èƒ½åªå‘é€é™„ä»¶");return}const{provider:p,model:y}=a.getCurrentChatModel();if(!p||!y){d.warning("è¯·å…ˆåœ¨å³ä¸Šè§’è®¾ç½®ä¸­é…ç½®AIæ¨¡å‹å’ŒAPIå¯†é’¥");return}n.clearProgressMessages();const M=r,I=[...o.currentAttachments.value],A=s.checkForceGenerate(M);if(n.addMessage("user",M,I),e.clearInput(),o.clearAttachments(),s.showQuickReplies.value=!1,A){await g.simulateTyping("å¥½çš„ï¼Œæˆ‘å°†ç«‹å³ä¸ºæ‚¨ç”Ÿæˆéœ€æ±‚æŠ¥å‘Šã€‚",!1),setTimeout(async()=>{const S=i.getCurrentProvider(),T=i.getCurrentModel();S&&T&&await k(S,T.id)},800);return}n.isTyping=!0;try{const S=a.isStreamMode.value;if(S){const T=ne.getInstance();let z="",P=-1;T.setStreamUpdateCallback(G=>{P===-1&&(P=g.startStreamingMessage()),z+=G;const F=J(z);g.updateStreamingMessage(F),g.scrollToBottom()});const $=n.getValidMessages().map(G=>({type:G.type,content:G.content,attachments:G.attachments||[]})),q=await u.generateSimpleResponse("",$,p,y.id,S);if(T.clearStreamUpdateCallback(),S&&P===-1){P=g.startStreamingMessage();const G=J(q);g.updateStreamingMessage(G)}else if(S&&z.trim()===""){const G=J(q);g.updateStreamingMessage(G)}(me(q)||q.includes("åŸºäºæˆ‘ä»¬çš„å¯¹è¯ï¼Œæˆ‘ç°åœ¨ä¸ºæ‚¨ç”Ÿæˆéœ€æ±‚æŠ¥å‘Šï¼š"))&&setTimeout(async()=>{const G=i.getCurrentProvider(),F=i.getCurrentModel();G&&F&&await k(G,F.id)},800)}else{const z=n.getValidMessages().map($=>({type:$.type,content:$.content,attachments:$.attachments||[]})),P=await u.generateSimpleResponse("",z,p,y.id,S);if(me(P)||P.includes("åŸºäºæˆ‘ä»¬çš„å¯¹è¯ï¼Œæˆ‘ç°åœ¨ä¸ºæ‚¨ç”Ÿæˆéœ€æ±‚æŠ¥å‘Šï¼š")){const $=J(P);await g.simulateTyping($,!1),setTimeout(async()=>{const q=i.getCurrentProvider(),j=i.getCurrentModel();q&&j&&await k(q,j.id)},800)}else{const $=J(P);await g.simulateTyping($,!1)}}}catch(S){n.isTyping=!1,n.isGenerating=!1;const T=S instanceof Error?S.message:String(S);d.error(`å‘ç”Ÿé”™è¯¯: ${T}`),a.isStreamMode.value&&ne.getInstance().clearStreamUpdateCallback()}},k=async(r,p)=>{try{n.clearProgressMessages();const M=n.getValidMessages().map(S=>({type:S.type,content:S.content,attachments:S.attachments||[]}));n.isGenerating=!0,n.currentExecutionStep="report",n.addOrUpdateProgressMessage("ğŸ”„ æ­£åœ¨åŸºäºå¯¹è¯ç”Ÿæˆéœ€æ±‚æŠ¥å‘Š...","progress"),n.promptData.requirementReport="";const I=S=>{n.promptData.requirementReport+=S},A=await u.generateRequirementReportFromConversation(M,r,p,i.streamMode?I:void 0);if(i.streamMode||(n.promptData.requirementReport=A),n.showPreview=!0,n.isAutoMode){n.addOrUpdateProgressMessage("âœ… éœ€æ±‚æŠ¥å‘Šå·²ç”Ÿæˆï¼æ­£åœ¨è‡ªåŠ¨æ‰§è¡Œå®Œæ•´çš„æç¤ºè¯ç”Ÿæˆæµç¨‹...","progress");const S=Z.getInstance();n.currentExecutionStep="thinking",n.addOrUpdateProgressMessage("ğŸ”„ æ­¥éª¤ 1/4: æ­£åœ¨åˆ†æéœ€æ±‚å¹¶ç”Ÿæˆå…³é”®æŒ‡ä»¤...","progress");let T="";const z=_=>{T+=_;const O=T.split(`
`).map(te=>te.replace(/^[*-]\s*/,"").trim()).filter(Boolean);O.length>0&&(n.promptData.thinkingPoints=O)},P=await S.getSystemPromptThinkingPoints(n.promptData.requirementReport||A,p,"zh",[],r,i.streamMode?z:void 0);i.streamMode||(n.promptData.thinkingPoints=P),n.currentExecutionStep="initial",n.addOrUpdateProgressMessage("ğŸ”„ æ­¥éª¤ 2/4: æ­£åœ¨åŸºäºå…³é”®æŒ‡ä»¤ç”Ÿæˆåˆå§‹æç¤ºè¯...","progress"),n.promptData.initialPrompt="";const D=_=>{n.promptData.initialPrompt+=_},$=await S.generateSystemPrompt(n.promptData.requirementReport||A,p,"zh",[],n.promptData.thinkingPoints||P,r,i.streamMode?D:void 0);i.streamMode||(n.promptData.initialPrompt=$),n.currentExecutionStep="advice",n.addOrUpdateProgressMessage("ğŸ”„ æ­¥éª¤ 3/4: æ­£åœ¨åˆ†ææç¤ºè¯å¹¶ç”Ÿæˆä¼˜åŒ–å»ºè®®...","progress");let q="";const j=_=>{q+=_;const O=q.split(`
`).map(te=>te.replace(/^[*-]\s*/,"").trim()).filter(Boolean);O.length>0&&(n.promptData.advice=O)},G=await S.getOptimizationAdvice(n.promptData.initialPrompt||$,"system",p,"zh",[],r,i.streamMode?j:void 0);i.streamMode||(n.promptData.advice=G),n.currentExecutionStep="final",n.addOrUpdateProgressMessage("ğŸ”„ æ­¥éª¤ 4/4: æ­£åœ¨åº”ç”¨ä¼˜åŒ–å»ºè®®ï¼Œç”Ÿæˆæœ€ç»ˆæç¤ºè¯...","progress"),n.promptData.generatedPrompt="";const F=_=>{n.promptData.generatedPrompt+=_},oe=await S.applyOptimizationAdvice(n.promptData.initialPrompt||$,n.promptData.advice||G,"system",p,"zh",[],r,i.streamMode?F:void 0);i.streamMode||(n.promptData.generatedPrompt=oe),n.addOrUpdateProgressMessage("âœ… å·²ä¸ºæ‚¨ç”Ÿæˆé«˜è´¨é‡çš„AIæç¤ºè¯ï¼å³ä¾§å¯æŸ¥çœ‹å®Œæ•´çš„ç”Ÿæˆè¿‡ç¨‹å’Œæœ€ç»ˆç»“æœã€‚","progress")}else n.addOrUpdateProgressMessage("âœ… éœ€æ±‚æŠ¥å‘Šå·²ç”Ÿæˆï¼è¯·åœ¨å³ä¾§é¢„è§ˆé¢æ¿ä¸­æŸ¥çœ‹ï¼Œæ‚¨å¯ä»¥æ‰‹åŠ¨æ‰§è¡Œæ¯ä¸ªæ­¥éª¤ã€‚","progress");n.isGenerating=!1,n.currentExecutionStep=null}catch(y){n.isGenerating=!1,n.currentExecutionStep=null;const M=y instanceof Error?y.message:String(y);d.error(`æç¤ºè¯ç”Ÿæˆå¤±è´¥: ${M}ã€‚è¯·æ£€æŸ¥ç½‘ç»œè¿æ¥å’ŒAPIé…ç½®åé‡è¯•`)}};return{chatContainerMaxHeight:v,initializeChat:m,clearChat:f,sendMessage:C,generatePrompt:k,regenerateMessage:async(r,p,y,M)=>{const I=n.chatMessages.find(A=>A.id===r);if(!(!I||I.type!=="ai")){if(!y||!M){d.warning("è¯·å…ˆåœ¨å³ä¸Šè§’è®¾ç½®ä¸­é…ç½®AIæ¨¡å‹å’ŒAPIå¯†é’¥");return}try{n.clearProgressMessages();const S=n.getValidMessages().slice(0,p).map(T=>({type:T.type,content:T.content,attachments:T.attachments||[]}));if(n.isTyping=!0,a.isStreamMode.value){const T=ne.getInstance();let z="";T.setStreamUpdateCallback($=>{z+=$;const q=J(z);n.updateMessage(r,q),g.scrollToBottom()});const P=await u.generateSimpleResponse("",S,y,M.id,!0);T.clearStreamUpdateCallback();const D=J(P);n.updateMessage(r,D)}else{const T=await u.generateSimpleResponse("",S,y,M.id,!1),z=J(T);n.updateMessage(r,z)}n.isTyping=!1,d.success("æ¶ˆæ¯å·²é‡æ–°ç”Ÿæˆ")}catch(A){n.isTyping=!1;const S=A instanceof Error?A.message:String(A);d.error(`é‡æ–°ç”Ÿæˆå¤±è´¥: ${S}`),a.isStreamMode.value&&ne.getInstance().clearStreamUpdateCallback()}}},resendUserMessage:async(r,p,y,M)=>{const I=n.chatMessages.find(A=>A.id===r);if(!(!I||I.type!=="user")){if(!y||!M){d.warning("è¯·å…ˆåœ¨å³ä¸Šè§’è®¾ç½®ä¸­é…ç½®AIæ¨¡å‹å’ŒAPIå¯†é’¥");return}try{if(n.clearProgressMessages(),p!==-1)for(let S=p+1;S<n.chatMessages.length;S++){const T=n.chatMessages[S];T&&!T.isProgress&&n.deleteMessage(T.id)}n.isTyping=!0;const A=a.isStreamMode.value;if(A){const S=ne.getInstance();let T="",z=-1;S.setStreamUpdateCallback(j=>{z===-1&&(z=g.startStreamingMessage()),T+=j;const G=J(T);g.updateStreamingMessage(G),g.scrollToBottom()});const D=n.getValidMessages().map(j=>({type:j.type,content:j.content,attachments:j.attachments||[]})),$=await u.generateSimpleResponse("",D,y,M.id,A);S.clearStreamUpdateCallback(),(me($)||$.includes("åŸºäºæˆ‘ä»¬çš„å¯¹è¯ï¼Œæˆ‘ç°åœ¨ä¸ºæ‚¨ç”Ÿæˆéœ€æ±‚æŠ¥å‘Šï¼š"))&&setTimeout(async()=>{const j=i.getCurrentProvider(),G=i.getCurrentModel();j&&G&&await k(j,G.id)},800)}else{const T=n.getValidMessages().map(D=>({type:D.type,content:D.content,attachments:D.attachments||[]})),z=await u.generateSimpleResponse("",T,y,M.id,A);if(me(z)||z.includes("åŸºäºæˆ‘ä»¬çš„å¯¹è¯ï¼Œæˆ‘ç°åœ¨ä¸ºæ‚¨ç”Ÿæˆéœ€æ±‚æŠ¥å‘Šï¼š")){const D=J(z);await g.simulateTyping(D,!1),setTimeout(async()=>{const $=i.getCurrentProvider(),q=i.getCurrentModel();$&&q&&await k($,q.id)},800)}else{const D=J(z);await g.simulateTyping(D,!1)}}}catch(A){n.isTyping=!1,n.isGenerating=!1;const S=A instanceof Error?A.message:String(A);d.error(`é‡æ–°å‘é€å¤±è´¥: ${S}`),a.isStreamMode.value&&ne.getInstance().clearStreamUpdateCallback()}}}}}const Kn={key:0,class:"absolute inset-0 bg-blue-50 bg-opacity-90 flex items-center justify-center z-50 border-2 border-dashed border-blue-400 rounded-lg"},Qn={class:"text-center"},Ee=N({__name:"ChatInterface",props:{isMobile:{type:Boolean},isExpanded:{type:Boolean}},emits:["toggle"],setup(g){const a=g,e=W(),o=R(),s=Un(),l=qn(),n=Gn(),i=Bn(),d=Fn(o),u=Ln(s.chatContainer),v=Hn(s,{...i,showModelSelector:i.showModelSelector},l,n,d),m=r=>{l.handleKeydown(r,f)},f=()=>{v.sendMessage(l.userInput.value)},C=r=>{d.selectQuickReply(r,p=>{l.userInput.value=p,f()})},k=r=>{const{provider:p,model:y}=i.getCurrentChatModel();v.regenerateMessage(r.messageId,r.messageIndex,p,y)},x=r=>{const p=e.chatMessages.find(y=>y.id===r.messageId);if(p&&p.type==="user"){u.saveEdit(r.messageId);const{provider:y,model:M}=i.getCurrentChatModel();v.resendUserMessage(r.messageId,r.messageIndex,y,M)}},b=r=>{const{provider:p,model:y}=i.getCurrentChatModel();v.resendUserMessage(r.messageId,r.messageIndex,p,y)};return ie(()=>{v.initializeChat()}),(r,p)=>(h(),w("div",{class:"bg-white rounded-lg shadow-sm flex flex-col h-full max-h-full overflow-hidden relative",onDragover:p[7]||(p[7]=ge((...y)=>t(n).handleGlobalDragOver&&t(n).handleGlobalDragOver(...y),["prevent"])),onDragenter:p[8]||(p[8]=ge((...y)=>t(n).handleGlobalDragEnter&&t(n).handleGlobalDragEnter(...y),["prevent"])),onDragleave:p[9]||(p[9]=ge((...y)=>t(n).handleGlobalDragLeave&&t(n).handleGlobalDragLeave(...y),["prevent"])),onDrop:p[10]||(p[10]=ge((...y)=>t(n).handleGlobalDrop&&t(n).handleGlobalDrop(...y),["prevent"]))},[U(bt,{"is-mobile":a.isMobile,"is-expanded":a.isExpanded,"is-stream-mode":t(i).isStreamMode.value,"model-title":t(i).chatModel.value?`å½“å‰æ¨¡å‹: ${t(i).getChatModelDisplay()}`:"é€‰æ‹©AIåŠ©æ‰‹ä¸“ç”¨æ¨¡å‹",onToggleModelSelector:p[0]||(p[0]=y=>t(i).showModelSelector.value=!t(i).showModelSelector.value),onToggle:p[1]||(p[1]=y=>r.$emit("toggle")),onToggleStream:t(i).toggleStreamMode,onClearChat:t(v).clearChat},null,8,["is-mobile","is-expanded","is-stream-mode","model-title","onToggleStream","onClearChat"]),U(zt,{show:t(i).showModelSelector.value,"chat-provider":t(i).chatProvider.value,"onUpdate:chatProvider":[p[2]||(p[2]=y=>t(i).chatProvider.value=y),t(i).onChatProviderChange],"chat-model":t(i).chatModel.value,"onUpdate:chatModel":[p[3]||(p[3]=y=>t(i).chatModel.value=y),t(i).saveChatModelSettings],"available-providers":t(i).availableChatProviders.value,"available-models":t(i).availableChatModels.value,"model-display":t(i).getChatModelDisplay(),onReset:t(i).resetChatModel},null,8,["show","chat-provider","chat-model","available-providers","available-models","model-display","onUpdate:chatProvider","onUpdate:chatModel","onReset"]),U(sn,{"chat-container":t(s).chatContainer,"chat-container-max-height":t(v).chatContainerMaxHeight.value,"editing-content":t(u).editingContent.value,onStartEdit:t(u).startEdit,onSaveEdit:t(u).saveEdit,onCancelEdit:t(u).cancelEdit,onDelete:t(u).deleteMessage,onCopy:t(u).copyMessage,onRegenerate:k,onResend:x,onResendUser:b,onEditKeydown:t(u).handleEditKeydown,onSetEditRef:p[4]||(p[4]=y=>t(u).setEditTextareaRef(y.messageId,y.el)),onSetMessageRef:t(u).setMessageRef},null,8,["chat-container","chat-container-max-height","editing-content","onStartEdit","onSaveEdit","onCancelEdit","onDelete","onCopy","onEditKeydown","onSetMessageRef"]),U(ln,{show:t(d).shouldShowQuickReplies.value,replies:t(d).quickReplies.value,"quick-replies-container":t(d).quickRepliesContainer,"input-container-ref":o.value,onSelect:C},null,8,["show","replies","quick-replies-container","input-container-ref"]),U(zn,{"is-mobile":a.isMobile,"is-editing":t(u).isEditing.value,"user-input":t(l).userInput.value,"onUpdate:userInput":p[5]||(p[5]=y=>t(l).userInput.value=y),attachments:t(n).currentAttachments.value,placeholder:t(d).shouldShowQuickReplies.value?"è¾“å…¥æˆ–ç‚¹å‡»ä¸Šæ–¹å¿«é€Ÿå›å¤...":"Shift+Enteræ¢è¡Œ","is-disabled":t(e).isTyping||t(e).isGenerating,"textarea-ref":t(l).textareaRef.value,"input-container":o.value,"show-quick-replies":t(d).shouldShowQuickReplies.value,"quick-replies":t(d).quickReplies.value,"quick-replies-container":t(d).quickRepliesContainer,onKeydown:m,onCompositionStart:t(l).handleCompositionStart,onCompositionEnd:t(l).handleCompositionEnd,onFocus:p[6]||(p[6]=y=>t(d).showQuickReplies.value=!0),onSend:f,onFileSelect:t(n).handleFileSelect,onRemoveAttachment:t(n).removeAttachment,onClearAttachments:t(n).clearAttachments,onQuickReplySelect:C},null,8,["is-mobile","is-editing","user-input","attachments","placeholder","is-disabled","textarea-ref","input-container","show-quick-replies","quick-replies","quick-replies-container","onCompositionStart","onCompositionEnd","onFileSelect","onRemoveAttachment","onClearAttachments"]),t(n).isGlobalDragging.value?(h(),w("div",Kn,[c("div",Qn,[U(t(pt),{class:"w-12 h-12 mx-auto mb-4 text-blue-500"}),p[11]||(p[11]=c("div",{class:"text-lg font-medium text-blue-700 mb-2"}," é‡Šæ”¾æ–‡ä»¶ä»¥ä¸Šä¼  ",-1)),p[12]||(p[12]=c("div",{class:"text-sm text-blue-600"}," æ”¯æŒå›¾ç‰‡ã€æ–‡æ¡£ã€éŸ³é¢‘ç­‰æ ¼å¼ ",-1))])])):E("",!0)],32))}}),Nn={class:"p-4 border-b border-gray-200 flex items-center justify-between"},_n={class:"flex items-center space-x-3"},Xn={key:0,class:"flex items-center px-2 py-1 bg-blue-50 text-blue-700 rounded-full text-xs border border-blue-200"},Vn={class:"flex items-center space-x-3"},Wn={class:"flex items-center space-x-2"},Jn={class:"flex items-center cursor-pointer"},Yn=["checked"],Zn={class:"text-sm text-gray-600"},eo=N({__name:"PreviewHeader",props:{isMobile:{type:Boolean},isExpanded:{type:Boolean},isAutoMode:{type:Boolean},currentExecutionStep:{},isGenerating:{type:Boolean}},emits:["toggle","update:isAutoMode"],setup(g){const a=e=>({report:"ç”Ÿæˆéœ€æ±‚æŠ¥å‘Š",thinking:"ç”Ÿæˆå…³é”®æŒ‡ä»¤",initial:"ç”Ÿæˆåˆå§‹æç¤ºè¯",advice:"ç”Ÿæˆä¼˜åŒ–å»ºè®®",final:"ç”Ÿæˆæœ€ç»ˆæç¤ºè¯"})[e]||e;return(e,o)=>(h(),w("div",Nn,[c("div",_n,[o[2]||(o[2]=c("h2",{class:"font-semibold text-gray-800"},"ç”Ÿæˆé¢„è§ˆ",-1)),e.currentExecutionStep||e.isGenerating&&!e.currentExecutionStep?(h(),w("div",Xn,[U(t(Y),{class:"w-3 h-3 animate-spin mr-1"}),c("span",null,L(e.currentExecutionStep?a(e.currentExecutionStep):"ç”Ÿæˆéœ€æ±‚æŠ¥å‘Š"),1)])):E("",!0)]),c("div",Vn,[e.isMobile&&e.isExpanded?(h(),w("button",{key:0,onClick:o[0]||(o[0]=s=>e.$emit("toggle")),class:"p-1 hover:bg-gray-100 rounded transition-colors",title:"æŠ˜å "},[U(t(ze),{class:"w-5 h-5 text-gray-500"})])):E("",!0),c("div",Wn,[c("label",Jn,[c("input",{checked:e.isAutoMode,onChange:o[1]||(o[1]=s=>e.$emit("update:isAutoMode",s.target.checked)),type:"checkbox",class:"sr-only peer"},null,40,Yn),c("span",Zn,L(e.isAutoMode?"è‡ªåŠ¨ï¼š":"æ‰‹åŠ¨ï¼š"),1),o[3]||(o[3]=c("div",{class:"relative w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600"},null,-1))])])])]))}}),to={class:"p-6 text-center"},no=N({__name:"LoadingState",setup(g){return(a,e)=>(h(),w("div",to,[U(t(Y),{class:"w-8 h-8 text-blue-500 animate-spin mx-auto mb-3"}),e[0]||(e[0]=c("p",{class:"text-gray-600"},"æ­£åœ¨ç”Ÿæˆæç¤ºè¯...",-1))]))}}),oo={class:"border rounded-lg overflow-hidden flex flex-col flex-1"},so={class:"bg-orange-50 px-3 py-2 text-sm font-medium text-orange-700 flex items-center justify-between flex-shrink-0"},ro={class:"flex items-center space-x-2"},io=["disabled"],ao={class:"p-3 bg-white flex-1 flex flex-col overflow-hidden"},lo=["value","placeholder"],uo={class:"mt-4 flex justify-end flex-shrink-0"},po={key:0},co=["disabled"],go={key:1},mo=["disabled"],vo=N({__name:"ReportTab",props:{requirementReport:{},hasConversationData:{type:Boolean},isAutoMode:{type:Boolean},isExecuting:{type:Boolean},isGenerating:{type:Boolean},currentExecutionStep:{},isCopied:{type:Boolean}},emits:["update:requirementReport","regenerate","copy","execute-full","execute-thinking","scroll-mounted"],setup(g,{emit:a}){const e=g,o=a,s=R(),{setScrollContainer:l}=Se(()=>e.requirementReport,()=>e.isGenerating);return ie(()=>{s.value&&(l(s.value),o("scroll-mounted",s.value))}),(n,i)=>(h(),w("div",oo,[c("div",so,[i[5]||(i[5]=c("span",null,"éœ€æ±‚æè¿°",-1)),c("div",ro,[c("button",{onClick:i[0]||(i[0]=d=>n.$emit("regenerate")),disabled:n.isExecuting||n.isGenerating,class:"text-orange-500 hover:text-orange-600 disabled:opacity-50 disabled:cursor-not-allowed",title:"é‡æ–°ç”Ÿæˆéœ€æ±‚æè¿°"},[U(t(Y),{class:K(["w-4 h-4",n.isExecuting&&n.currentExecutionStep==="report"&&"animate-spin"])},null,8,["class"])],8,io),c("button",{onClick:i[1]||(i[1]=d=>n.$emit("copy")),class:"text-orange-500 hover:text-orange-600",title:"å¤åˆ¶åˆ°å‰ªè´´æ¿"},[n.isCopied?(h(),B(t(Me),{key:0,class:"w-4 h-4"})):(h(),B(t(he),{key:1,class:"w-4 h-4"}))])])]),c("div",ao,[c("textarea",{ref_key:"textareaRef",ref:s,value:n.requirementReport,onInput:i[2]||(i[2]=d=>n.$emit("update:requirementReport",d.target.value)),placeholder:n.hasConversationData?"åŸºäºå¯¹è¯ç”Ÿæˆçš„éœ€æ±‚æè¿°...":"è¯·ç›´æ¥æè¿°æ‚¨çš„éœ€æ±‚ï¼Œä¾‹å¦‚ï¼šæˆ‘éœ€è¦ä¸€ä¸ªä¸“ä¸šçš„ä»£ç å®¡æŸ¥åŠ©æ‰‹ï¼Œèƒ½å¤Ÿåˆ†æä»£ç è´¨é‡ã€å‘ç°æ½œåœ¨é—®é¢˜å¹¶æä¾›æ”¹è¿›å»ºè®®...",class:"w-full flex-1 px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:border-gray-300 focus:ring-0 resize-none"},null,40,lo),c("div",uo,[n.isAutoMode?(h(),w("div",po,[c("button",{onClick:i[3]||(i[3]=d=>n.$emit("execute-full")),disabled:!n.requirementReport.trim()||n.isExecuting||n.isGenerating,class:"px-4 py-2 bg-green-500 text-white rounded hover:bg-green-600 disabled:opacity-50 disabled:cursor-not-allowed transition-colors flex items-center space-x-2"},[n.isExecuting||n.isGenerating?(h(),B(t(Y),{key:0,class:"w-4 h-4 animate-spin"})):E("",!0),c("span",null,L(n.isExecuting||n.isGenerating?"è‡ªåŠ¨ç”Ÿæˆä¸­...":"è‡ªåŠ¨ç”Ÿæˆæç¤ºè¯"),1)],8,co)])):E("",!0),n.isAutoMode?E("",!0):(h(),w("div",go,[c("button",{onClick:i[4]||(i[4]=d=>n.$emit("execute-thinking")),disabled:!n.requirementReport.trim()||n.isExecuting,class:"px-4 py-2 bg-orange-500 text-white rounded hover:bg-orange-600 disabled:opacity-50 disabled:cursor-not-allowed transition-colors flex items-center space-x-2"},[n.isExecuting&&n.currentExecutionStep==="thinking"?(h(),B(t(Y),{key:0,class:"w-4 h-4 animate-spin"})):E("",!0),c("span",null,L(n.isExecuting&&n.currentExecutionStep==="thinking"?"æ‰§è¡Œä¸­...":"ç”Ÿæˆå…³é”®æŒ‡ä»¤"),1)],8,mo)]))])])]))}}),fo={class:"border rounded-lg overflow-hidden flex flex-col flex-1 min-h-0"},ho={class:"bg-purple-50 px-3 py-2 text-sm font-medium text-purple-700 flex items-center justify-between flex-shrink-0"},yo={class:"flex items-center space-x-2"},bo=["disabled"],xo=["value","onInput"],wo=["onClick"],ko={class:"p-3 pt-4 flex justify-between flex-shrink-0 border-t border-gray-100 bg-white"},Co={key:0},So=["disabled"],Mo=N({__name:"ThinkingTab",props:{thinkingPoints:{},isMobile:{type:Boolean},isAutoMode:{type:Boolean},isExecuting:{type:Boolean},isGenerating:{type:Boolean},currentExecutionStep:{},isCopied:{type:Boolean}},emits:["regenerate","copy","add-point","remove-point","update-point","execute-initial","scroll-mounted"],setup(g,{emit:a}){const e=g,o=a,s=R(),{setScrollContainer:l}=Se(()=>e.thinkingPoints,()=>e.isGenerating);return ie(()=>{s.value&&(l(s.value),o("scroll-mounted",s.value))}),(n,i)=>(h(),w("div",fo,[c("div",ho,[i[5]||(i[5]=c("span",null,"å…³é”®æŒ‡ä»¤",-1)),c("div",yo,[c("button",{onClick:i[0]||(i[0]=d=>n.$emit("regenerate")),disabled:n.isExecuting||n.isGenerating,class:"text-purple-500 hover:text-purple-600 disabled:opacity-50 disabled:cursor-not-allowed",title:"é‡æ–°ç”Ÿæˆå…³é”®æŒ‡ä»¤"},[U(t(Y),{class:K(["w-4 h-4",n.isExecuting&&n.currentExecutionStep==="thinking"&&"animate-spin"])},null,8,["class"])],8,bo),c("button",{onClick:i[1]||(i[1]=d=>n.$emit("copy")),class:"text-purple-500 hover:text-purple-600",title:"å¤åˆ¶åˆ°å‰ªè´´æ¿"},[n.isCopied?(h(),B(t(Me),{key:0,class:"w-4 h-4"})):(h(),B(t(he),{key:1,class:"w-4 h-4"}))])])]),c("div",{class:K(["bg-white flex flex-col",n.isMobile?"flex-1 min-h-0":"p-3 flex-1"])},[c("div",{ref_key:"scrollContainer",ref:s,class:K(["space-y-2 overflow-y-auto flex-1",n.isMobile?"p-3":""]),style:Ce(n.isMobile?"":"max-height: calc(100vh - 400px);")},[(h(!0),w(V,null,ee(n.thinkingPoints,(d,u)=>(h(),w("div",{key:u,class:"flex items-start"},[i[6]||(i[6]=c("span",{class:"text-purple-500 mr-2 mt-2"},"â€¢",-1)),c("input",{value:d,onInput:v=>n.$emit("update-point",u,v.target.value),onFocus:i[2]||(i[2]=v=>v.target.setSelectionRange(v.target.value.length,v.target.value.length)),class:"flex-1 px-3 py-1 border border-gray-300 rounded focus:ring-2 focus:ring-purple-500 focus:border-transparent"},null,40,xo),c("button",{onClick:v=>n.$emit("remove-point",u),class:"ml-2 px-2 py-1 text-red-500 hover:text-red-700 text-sm",title:"åˆ é™¤è¿™æ¡æŒ‡ä»¤"}," Ã— ",8,wo)]))),128))],6),c("div",ko,[c("button",{onClick:i[3]||(i[3]=d=>n.$emit("add-point")),class:"px-3 py-1 text-purple-600 hover:text-purple-800 text-sm"}," + æ·»åŠ æŒ‡ä»¤ "),n.isAutoMode?E("",!0):(h(),w("div",Co,[c("button",{onClick:i[4]||(i[4]=d=>n.$emit("execute-initial")),disabled:!n.thinkingPoints||n.thinkingPoints.length===0||n.isExecuting,class:"px-4 py-2 bg-purple-500 text-white rounded hover:bg-purple-600 disabled:opacity-50 disabled:cursor-not-allowed transition-colors flex items-center space-x-2"},[n.isExecuting&&n.currentExecutionStep==="initial"?(h(),B(t(Y),{key:0,class:"w-4 h-4 animate-spin"})):E("",!0),c("span",null,L(n.isExecuting&&n.currentExecutionStep==="initial"?"æ‰§è¡Œä¸­...":"ç”Ÿæˆåˆå§‹æç¤ºè¯"),1)],8,So)]))])],2)]))}}),Po={class:"border rounded-lg overflow-hidden flex flex-col flex-1"},$o={class:"bg-green-50 px-3 py-2 text-sm font-medium text-green-700 flex items-center justify-between flex-shrink-0"},Ro={class:"flex items-center space-x-2"},Do=["disabled"],To={class:"p-3 bg-white flex-1 flex flex-col overflow-hidden"},Eo=["value"],Ao={key:0,class:"mt-4 flex justify-end flex-shrink-0"},Io=["disabled"],zo=N({__name:"InitialTab",props:{initialPrompt:{},isAutoMode:{type:Boolean},isExecuting:{type:Boolean},isGenerating:{type:Boolean},currentExecutionStep:{},isCopied:{type:Boolean}},emits:["update:initialPrompt","regenerate","copy","execute-advice","scroll-mounted"],setup(g,{emit:a}){const e=g,o=a,s=R(),{setScrollContainer:l}=Se(()=>e.initialPrompt,()=>e.isGenerating);return ie(()=>{s.value&&(l(s.value),o("scroll-mounted",s.value))}),(n,i)=>(h(),w("div",Po,[c("div",$o,[i[4]||(i[4]=c("span",null,"åˆå§‹æç¤ºè¯",-1)),c("div",Ro,[c("button",{onClick:i[0]||(i[0]=d=>n.$emit("regenerate")),disabled:n.isExecuting||n.isGenerating,class:"text-green-500 hover:text-green-600 disabled:opacity-50 disabled:cursor-not-allowed",title:"é‡æ–°ç”Ÿæˆåˆå§‹æç¤ºè¯"},[U(t(Y),{class:K(["w-4 h-4",n.isExecuting&&n.currentExecutionStep==="initial"&&"animate-spin"])},null,8,["class"])],8,Do),c("button",{onClick:i[1]||(i[1]=d=>n.$emit("copy")),class:"text-green-500 hover:text-green-600",title:"å¤åˆ¶åˆ°å‰ªè´´æ¿"},[n.isCopied?(h(),B(t(Me),{key:0,class:"w-4 h-4"})):(h(),B(t(he),{key:1,class:"w-4 h-4"}))])])]),c("div",To,[c("textarea",{ref_key:"textareaRef",ref:s,value:n.initialPrompt,onInput:i[2]||(i[2]=d=>n.$emit("update:initialPrompt",d.target.value)),class:"w-full flex-1 px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent resize-none"},null,40,Eo),n.isAutoMode?E("",!0):(h(),w("div",Ao,[c("button",{onClick:i[3]||(i[3]=d=>n.$emit("execute-advice")),disabled:!n.initialPrompt||n.isExecuting,class:"px-4 py-2 bg-green-500 text-white rounded hover:bg-green-600 disabled:opacity-50 disabled:cursor-not-allowed transition-colors flex items-center space-x-2"},[n.isExecuting&&n.currentExecutionStep==="advice"?(h(),B(t(Y),{key:0,class:"w-4 h-4 animate-spin"})):E("",!0),c("span",null,L(n.isExecuting&&n.currentExecutionStep==="advice"?"æ‰§è¡Œä¸­...":"ç”Ÿæˆä¼˜åŒ–å»ºè®®"),1)],8,Io)]))])]))}});function Uo(){const g=R("report"),a=R(new Set),e=R({}),o=d=>{e.value={...e.value,...d}},s=d=>{a.value.delete(d)},l=d=>{const v={report:e.value.reportTab,thinking:e.value.thinkingTab,initial:e.value.initialTab,advice:e.value.adviceTab,zh:e.value.zhTab}[d],m=e.value.tabContainer;if(v&&m){const f=m.getBoundingClientRect(),C=v.getBoundingClientRect(),k=C.left-f.left+m.scrollLeft,x=k+C.width,b=f.width,r=m.scrollLeft,p=r+b;k<r?m.scrollTo({left:k-20,behavior:"smooth"}):x>p&&m.scrollTo({left:k-b+C.width+20,behavior:"smooth"})}};return{activeTab:g,newContentTabs:a,setTabRefs:o,markTabAsViewed:s,scrollToActiveTab:l,switchToTabWithScroll:d=>{g.value=d,X(()=>{l(d)})},handleTabChange:d=>{g.value=d,s(d),X(()=>{l(d)})}}}function qo(g,a){const e=W(),o=ue(),s=de(),l=R(!1),n=R(null);return{isExecuting:l,executeFullWorkflow:async()=>{if(!e.promptData.requirementReport.trim()){s.warning("è¯·å…ˆè¾“å…¥éœ€æ±‚æè¿°");return}try{l.value=!0,n.value=new AbortController;const r=o.getCurrentProvider(),p=o.getCurrentModel();if(!r||!p){s.error("è¯·å…ˆé…ç½®AIæ¨¡å‹");return}const y=Z.getInstance(),M=e.promptData.requirementReport;e.currentExecutionStep="thinking";let I="",A=!1;const S=O=>{I+=O,!A&&O.trim()&&(A=!0,e.promptData.thinkingPoints=["æ­£åœ¨ç”Ÿæˆ..."],g("thinking"));const te=I.split(`
`).map(ye=>ye.replace(/^[*-]\s*/,"").trim()).filter(Boolean);te.length>0&&(e.promptData.thinkingPoints=te,a())},T=await y.getSystemPromptThinkingPoints(M,p.id,"zh",[],r,S);e.promptData.thinkingPoints=T,e.currentExecutionStep="initial";let z=!1;const P=O=>{!z&&O.trim()&&(z=!0,e.promptData.initialPrompt="æ­£åœ¨ç”Ÿæˆ...",g("initial")),z&&(e.promptData.initialPrompt==="æ­£åœ¨ç”Ÿæˆ..."?e.promptData.initialPrompt=O:e.promptData.initialPrompt+=O,a())},D=await y.generateSystemPrompt(M,p.id,"zh",[],T,r,P);e.promptData.initialPrompt=D,e.currentExecutionStep="advice";let $="",q=!1;const j=O=>{$+=O,!q&&O.trim()&&(q=!0,e.promptData.advice=["æ­£åœ¨ç”Ÿæˆ..."],g("advice"));const te=$.split(`
`).map(ye=>ye.replace(/^[*-]\s*/,"").trim()).filter(Boolean);te.length>0&&(e.promptData.advice=te,a())},G=await y.getOptimizationAdvice(D,"system",p.id,"zh",[],r,j);e.promptData.advice=G,e.currentExecutionStep="final";let F=!1;const oe=O=>{!F&&O.trim()&&(F=!0,e.promptData.generatedPrompt="æ­£åœ¨ç”Ÿæˆ...",g("zh")),F&&(e.promptData.generatedPrompt==="æ­£åœ¨ç”Ÿæˆ..."?e.promptData.generatedPrompt=O:e.promptData.generatedPrompt+=O,a())},_=await y.applyOptimizationAdvice(D,G,"system",p.id,"zh",[],r,oe);e.promptData.generatedPrompt=se(_),g("zh")}catch{s.error("è‡ªåŠ¨ç”Ÿæˆæç¤ºè¯å¤±è´¥ï¼Œè¯·é‡è¯•")}finally{l.value=!1,e.currentExecutionStep=null,n.value=null}},executeThinkingPoints:async()=>{if(!e.promptData.requirementReport.trim()){s.warning("è¯·å…ˆè¾“å…¥éœ€æ±‚æŠ¥å‘Š");return}try{l.value=!0,n.value=new AbortController,e.currentExecutionStep="thinking";const r=o.getCurrentProvider(),p=o.getCurrentModel();if(!r||!p){s.error("è¯·å…ˆé…ç½®AIæ¨¡å‹");return}const y=Z.getInstance();let M="",I=!1;const A=T=>{M+=T,!I&&T.trim()&&(I=!0,e.promptData.thinkingPoints=["æ­£åœ¨ç”Ÿæˆ..."],g("thinking"));const z=M.split(`
`).map(P=>P.replace(/^[*-]\s*/,"").trim()).filter(Boolean);z.length>0&&(e.promptData.thinkingPoints=z,a())},S=await y.getSystemPromptThinkingPoints(e.promptData.requirementReport,p.id,"zh",[],r,A);e.promptData.thinkingPoints=S}catch{s.error("ç”Ÿæˆå…³é”®æŒ‡ä»¤å¤±è´¥ï¼Œè¯·é‡è¯•")}finally{l.value=!1,e.currentExecutionStep=null,n.value=null}},executeInitialPrompt:async()=>{if(!e.promptData.thinkingPoints||e.promptData.thinkingPoints.length===0){s.warning("è¯·å…ˆç”Ÿæˆå…³é”®æŒ‡ä»¤");return}try{l.value=!0,n.value=new AbortController,e.currentExecutionStep="initial";const r=o.getCurrentProvider(),p=o.getCurrentModel();if(!r||!p){s.error("è¯·å…ˆé…ç½®AIæ¨¡å‹");return}const y=Z.getInstance();let M=!1;const I=S=>{!M&&S.trim()&&(M=!0,e.promptData.initialPrompt="æ­£åœ¨ç”Ÿæˆ...",g("initial")),M&&(e.promptData.initialPrompt==="æ­£åœ¨ç”Ÿæˆ..."?e.promptData.initialPrompt=S:e.promptData.initialPrompt+=S)},A=await y.generateSystemPrompt(e.promptData.requirementReport,p.id,"zh",[],e.promptData.thinkingPoints,r,I);e.promptData.initialPrompt=se(A)}catch{s.error("ç”Ÿæˆåˆå§‹æç¤ºè¯å¤±è´¥ï¼Œè¯·é‡è¯•")}finally{l.value=!1,e.currentExecutionStep=null,n.value=null}},executeAdvice:async()=>{if(!e.promptData.initialPrompt){s.error("è¯·å…ˆç”Ÿæˆåˆå§‹æç¤ºè¯");return}try{l.value=!0,n.value=new AbortController,e.currentExecutionStep="advice";const r=o.getCurrentProvider(),p=o.getCurrentModel();if(!r||!p){s.error("è¯·å…ˆé…ç½®AIæ¨¡å‹");return}const y=Z.getInstance();let M="",I=!1;const A=T=>{M+=T,!I&&T.trim()&&(I=!0,e.promptData.advice=["æ­£åœ¨ç”Ÿæˆ..."],g("advice"));const z=M.split(`
`).map(P=>P.replace(/^[*-]\s*/,"").trim()).filter(Boolean);z.length>0&&(e.promptData.advice=z)},S=await y.getOptimizationAdvice(e.promptData.initialPrompt,"system",p.id,"zh",[],r,A);e.promptData.advice=S}catch{s.error("ç”Ÿæˆä¼˜åŒ–å»ºè®®å¤±è´¥ï¼Œè¯·é‡è¯•")}finally{l.value=!1,e.currentExecutionStep=null,n.value=null}},executeFinalPrompt:async()=>{if(!e.promptData.initialPrompt||!e.promptData.advice){s.error("è¯·å…ˆå®Œæˆå‰é¢çš„æ­¥éª¤");return}try{l.value=!0,n.value=new AbortController,e.currentExecutionStep="final";const r=o.getCurrentProvider(),p=o.getCurrentModel();if(!r||!p){s.error("è¯·å…ˆé…ç½®AIæ¨¡å‹");return}const y=Z.getInstance();let M=!1;const I=S=>{!M&&S.trim()&&(M=!0,e.promptData.generatedPrompt="æ­£åœ¨ç”Ÿæˆ...",g("zh")),M&&(e.promptData.generatedPrompt==="æ­£åœ¨ç”Ÿæˆ..."?e.promptData.generatedPrompt=S:e.promptData.generatedPrompt+=S)},A=await y.applyOptimizationAdvice(e.promptData.initialPrompt,e.promptData.advice,"system",p.id,"zh",[],r,I);e.promptData.generatedPrompt=se(A)}catch{s.error("ç”Ÿæˆæœ€ç»ˆæç¤ºè¯å¤±è´¥ï¼Œè¯·é‡è¯•")}finally{l.value=!1,e.currentExecutionStep=null,n.value=null}},regenerateRequirementReport:async()=>{if(!(e.chatMessages&&e.chatMessages.length>0)){s.warning("éœ€è¦å…ˆä¸AIåŠ©æ‰‹å¯¹è¯æ‰èƒ½é‡æ–°ç”Ÿæˆéœ€æ±‚æè¿°");return}try{l.value=!0,e.currentExecutionStep="report";const p=o.getCurrentProvider(),y=o.getCurrentModel();if(!p||!y){s.error("è¯·å…ˆé…ç½®AIæ¨¡å‹");return}const M=ve.getInstance(),A=e.getValidMessages().map(P=>({type:P.type,content:P.content}));let S="";const T=P=>{S+=P,e.promptData.requirementReport=S,a()},z=await M.generateRequirementReportFromConversation(A,p,y.id,T);e.promptData.requirementReport=z,s.success("éœ€æ±‚æè¿°å·²é‡æ–°ç”Ÿæˆ")}catch{s.error("é‡æ–°ç”Ÿæˆéœ€æ±‚æè¿°å¤±è´¥ï¼Œè¯·é‡è¯•")}finally{l.value=!1,e.currentExecutionStep=null,n.value=null}},regenerateThinkingPoints:async()=>{if(!e.promptData.requirementReport.trim()){s.warning("è¯·å…ˆè¾“å…¥éœ€æ±‚æè¿°");return}try{l.value=!0,n.value=new AbortController,e.currentExecutionStep="thinking";const r=o.getCurrentProvider(),p=o.getCurrentModel();if(!r||!p){s.error("è¯·å…ˆé…ç½®AIæ¨¡å‹");return}const y=Z.getInstance();let M="",I=!1;const A=T=>{M+=T,!I&&T.trim()&&(I=!0,e.promptData.thinkingPoints=["æ­£åœ¨ç”Ÿæˆ..."],g("thinking"));const z=M.split(`
`).map(P=>P.replace(/^[*-]\s*/,"").trim()).filter(Boolean);z.length>0&&(e.promptData.thinkingPoints=z,a())},S=await y.getSystemPromptThinkingPoints(e.promptData.requirementReport,p.id,"zh",[],r,A);e.promptData.thinkingPoints=S,s.success("å…³é”®æŒ‡ä»¤å·²é‡æ–°ç”Ÿæˆ")}catch{s.error("é‡æ–°ç”Ÿæˆå…³é”®æŒ‡ä»¤å¤±è´¥ï¼Œè¯·é‡è¯•")}finally{l.value=!1,e.currentExecutionStep=null,n.value=null}},regenerateInitialPrompt:async()=>{if(!e.promptData.thinkingPoints||e.promptData.thinkingPoints.length===0){s.warning("è¯·å…ˆç”Ÿæˆå…³é”®æŒ‡ä»¤");return}try{l.value=!0,n.value=new AbortController,e.currentExecutionStep="initial";const r=o.getCurrentProvider(),p=o.getCurrentModel();if(!r||!p){s.error("è¯·å…ˆé…ç½®AIæ¨¡å‹");return}const y=Z.getInstance();let M=!1;const I=S=>{!M&&S.trim()&&(M=!0,e.promptData.initialPrompt="æ­£åœ¨ç”Ÿæˆ...",g("initial")),M&&(e.promptData.initialPrompt==="æ­£åœ¨ç”Ÿæˆ..."?e.promptData.initialPrompt=S:e.promptData.initialPrompt+=S,a())},A=await y.generateSystemPrompt(e.promptData.requirementReport,p.id,"zh",[],e.promptData.thinkingPoints,r,I);e.promptData.initialPrompt=se(A),s.success("åˆå§‹æç¤ºè¯å·²é‡æ–°ç”Ÿæˆ")}catch{s.error("é‡æ–°ç”Ÿæˆåˆå§‹æç¤ºè¯å¤±è´¥ï¼Œè¯·é‡è¯•")}finally{l.value=!1,e.currentExecutionStep=null,n.value=null}},regenerateAdvice:async()=>{if(!e.promptData.initialPrompt){s.error("è¯·å…ˆç”Ÿæˆåˆå§‹æç¤ºè¯");return}try{l.value=!0,n.value=new AbortController,e.currentExecutionStep="advice";const r=o.getCurrentProvider(),p=o.getCurrentModel();if(!r||!p){s.error("è¯·å…ˆé…ç½®AIæ¨¡å‹");return}const y=Z.getInstance();let M="",I=!1;const A=T=>{M+=T,!I&&T.trim()&&(I=!0,e.promptData.advice=["æ­£åœ¨ç”Ÿæˆ..."],g("advice"));const z=M.split(`
`).map(P=>P.replace(/^[*-]\s*/,"").trim()).filter(Boolean);z.length>0&&(e.promptData.advice=z,a())},S=await y.getOptimizationAdvice(e.promptData.initialPrompt,"system",p.id,"zh",[],r,A);e.promptData.advice=S,s.success("ä¼˜åŒ–å»ºè®®å·²é‡æ–°ç”Ÿæˆ")}catch{s.error("é‡æ–°ç”Ÿæˆä¼˜åŒ–å»ºè®®å¤±è´¥ï¼Œè¯·é‡è¯•")}finally{l.value=!1,e.currentExecutionStep=null,n.value=null}},regenerateFinalPrompt:async()=>{if(!e.promptData.initialPrompt||!e.promptData.advice){s.error("è¯·å…ˆå®Œæˆå‰é¢çš„æ­¥éª¤");return}try{l.value=!0,n.value=new AbortController,e.currentExecutionStep="final";const r=o.getCurrentProvider(),p=o.getCurrentModel();if(!r||!p){s.error("è¯·å…ˆé…ç½®AIæ¨¡å‹");return}const y=Z.getInstance();let M=!1;const I=S=>{!M&&S.trim()&&(M=!0,e.promptData.generatedPrompt="æ­£åœ¨ç”Ÿæˆ...",g("zh")),M&&(e.promptData.generatedPrompt==="æ­£åœ¨ç”Ÿæˆ..."?e.promptData.generatedPrompt=S:e.promptData.generatedPrompt+=S,a())},A=await y.applyOptimizationAdvice(e.promptData.initialPrompt,e.promptData.advice,"system",p.id,"zh",[],r,I);e.promptData.generatedPrompt=se(A),s.success("æœ€ç»ˆæç¤ºè¯å·²é‡æ–°ç”Ÿæˆ")}catch{s.error("é‡æ–°ç”Ÿæˆæœ€ç»ˆæç¤ºè¯å¤±è´¥ï¼Œè¯·é‡è¯•")}finally{l.value=!1,e.currentExecutionStep=null,n.value=null}}}}function Go(){const g=W(),a=ue(),e=de(),o=ne.getInstance(),s=R(!1),l=R(!1),n=R("markdown"),i=R("zh"),d=Q({get:()=>{const m=g.promptData.generatedPrompt;if(typeof m=="string")return m;if("markdown"in m&&"xml"in m){const f=n.value;return i.value==="zh"?m[f].zh:m[f].en}return i.value==="zh"?m.zh:m.en},set:m=>{const f=g.promptData.generatedPrompt;if(typeof f=="string"){g.promptData.generatedPrompt=m;return}if("markdown"in f&&"xml"in f){const C=n.value;i.value==="zh"?f[C].zh=m:f[C].en=m;return}i.value==="zh"?f.zh=m:f.en=m}});return{isConvertingFormat:s,isConvertingLanguage:l,formatState:n,languageState:i,currentGeneratedPrompt:d,toggleFormat:async()=>{if(!d.value||s.value||l.value)return;const m=n.value==="markdown"?"xml":"markdown",f=g.promptData.generatedPrompt;if(typeof f!="string"&&"markdown"in f&&"xml"in f&&(i.value==="zh"?f[m].zh:f[m].en)){n.value=m,e.success(`å·²åˆ‡æ¢ä¸º${m==="xml"?"XML":"Markdown"}æ ¼å¼`);return}const C=a.getCurrentProvider(),k=a.getCurrentModel();if(!C||!k){e.error("è¯·å…ˆé…ç½®AIæ¨¡å‹");return}try{s.value=!0;const x=n.value==="markdown"?"XML":"Markdown",b=n.value==="markdown"?"Markdown":"XML",r=De(d.value),p=[{role:"system",content:`ä½ æ˜¯ä¸€ä¸ªä¸“ä¸šçš„æç¤ºè¯æ ¼å¼è½¬æ¢åŠ©æ‰‹ã€‚ä½ çš„ä»»åŠ¡æ˜¯å°†æç¤ºè¯ä»${b}æ ¼å¼è½¬æ¢ä¸º${x}æ ¼å¼ï¼Œä¿æŒå†…å®¹å®Œå…¨ä¸€è‡´ï¼Œåªæ”¹å˜æ ¼å¼æ ·å¼ã€‚

**é‡è¦è§„åˆ™**ï¼š
1. **ç»å¯¹ä¸èƒ½æ·»åŠ ã€åˆ é™¤æˆ–ä¿®æ”¹ä»»ä½•å®è´¨æ€§å†…å®¹**
2. **åªèƒ½æ”¹å˜æ ¼å¼æ ‡è®°ï¼ˆå¦‚ Markdown çš„ # æ ‡é¢˜æ”¹ä¸º XML çš„ <section> æ ‡ç­¾ï¼‰**
3. **å¿…é¡»ä¿ç•™åŸæ–‡çš„æ‰€æœ‰ä¿¡æ¯å’Œè¯­ä¹‰**
4. **ä¸è¦æ·»åŠ ä»»ä½•è§£é‡Šã€è¯´æ˜æˆ–é¢å¤–çš„æ–‡å­—**
5. **ç›´æ¥è¾“å‡ºè½¬æ¢åçš„ç»“æœï¼Œä¸è¦åŒ…å«ä»»ä½•å‰è¨€æˆ–åè®°**

${x==="XML"?"ä½¿ç”¨ <prompt>, <section>, <rule>, <example> ç­‰ XML æ ‡ç­¾ç»„ç»‡å†…å®¹ã€‚":"ä½¿ç”¨ Markdown è¯­æ³•ï¼š# æ ‡é¢˜ï¼Œ- åˆ—è¡¨ï¼Œ**ç²—ä½“** ç­‰ç»„ç»‡å†…å®¹ã€‚"}`},{role:"user",content:`è¯·å°†ä»¥ä¸‹æç¤ºè¯ä»${b}æ ¼å¼è½¬æ¢ä¸º${x}æ ¼å¼ï¼š

${r}`}],y=await o.callAI(p,C,k.id,!1);if(y&&y.trim()){const M=se(y);if(typeof f=="string"){const I=i.value;g.promptData.generatedPrompt={markdown:{zh:n.value==="markdown"&&I==="zh"?f:"",en:n.value==="markdown"&&I==="en"?f:""},xml:{zh:n.value==="xml"&&I==="zh"?f:"",en:n.value==="xml"&&I==="en"?f:""}},i.value==="zh"?g.promptData.generatedPrompt[m].zh=M:g.promptData.generatedPrompt[m].en=M}else"markdown"in f?i.value==="zh"?f[m].zh=M:f[m].en=M:(g.promptData.generatedPrompt={markdown:{zh:n.value==="markdown"?f.zh:"",en:n.value==="markdown"?f.en:""},xml:{zh:n.value==="xml"?f.zh:"",en:n.value==="xml"?f.en:""}},i.value==="zh"?g.promptData.generatedPrompt[m].zh=M:g.promptData.generatedPrompt[m].en=M);n.value=m,e.success(`å·²è½¬æ¢ä¸º${x}æ ¼å¼`)}else e.error("æ ¼å¼è½¬æ¢å¤±è´¥ï¼šè¿”å›å†…å®¹ä¸ºç©º")}catch{e.error("æ ¼å¼è½¬æ¢å¤±è´¥ï¼Œè¯·é‡è¯•")}finally{s.value=!1}},toggleLanguage:async()=>{if(!d.value||s.value||l.value)return;const m=i.value==="zh"?"en":"zh",f=g.promptData.generatedPrompt;if(typeof f!="string"&&"markdown"in f&&"xml"in f&&f[n.value][m]){i.value=m,e.success(`å·²åˆ‡æ¢ä¸º${m==="zh"?"ä¸­æ–‡":"è‹±æ–‡"}ç‰ˆæœ¬`);return}if(typeof f!="string"&&!("markdown"in f)){if(m==="zh"&&f.zh){i.value="zh",e.success("å·²åˆ‡æ¢ä¸ºä¸­æ–‡ç‰ˆæœ¬");return}if(m==="en"&&f.en){i.value="en",e.success("å·²åˆ‡æ¢ä¸ºè‹±æ–‡ç‰ˆæœ¬");return}}const C=a.getCurrentProvider(),k=a.getCurrentModel();if(!C||!k){e.error("è¯·å…ˆé…ç½®AIæ¨¡å‹");return}try{l.value=!0;const x=m==="zh"?"ä¸­æ–‡":"è‹±æ–‡",b=De(d.value),r=[{role:"system",content:`ä½ æ˜¯ä¸€ä¸ªä¸“ä¸šçš„AIæç¤ºè¯ç¿»è¯‘åŠ©æ‰‹ã€‚ä½ çš„ä»»åŠ¡æ˜¯å°†æç¤ºè¯ç¿»è¯‘ä¸º${x}ï¼ŒåŒæ—¶ä¿æŒæç¤ºè¯çš„ä¸“ä¸šæ€§ã€å‡†ç¡®æ€§å’Œå®Œæ•´æ€§ã€‚

**é‡è¦è§„åˆ™**ï¼š
1. **å¿…é¡»ä¿ç•™æ‰€æœ‰åŸæœ‰çš„æ ¼å¼æ ‡è®°**ï¼ˆå¦‚ Markdown çš„ #ã€- æˆ– XML çš„æ ‡ç­¾ï¼‰
2. **ç¿»è¯‘å¿…é¡»å‡†ç¡®ä¼ è¾¾åŸæ„**ï¼Œç‰¹åˆ«æ˜¯æŠ€æœ¯æœ¯è¯­å’ŒæŒ‡ä»¤
3. **ä¿æŒæç¤ºè¯çš„ä¸“ä¸šè¯­æ°”å’Œç»“æ„**
4. **ä¸è¦æ·»åŠ ä»»ä½•é¢å¤–çš„è§£é‡Šæˆ–è¯´æ˜**
5. **ç›´æ¥è¾“å‡ºç¿»è¯‘ç»“æœï¼Œä¸è¦åŒ…å«ä»»ä½•å‰è¨€æˆ–åè®°**
6. **å¯¹äºä¸“æœ‰åè¯ã€æŠ€æœ¯æœ¯è¯­ï¼Œè¦ä½¿ç”¨è¡Œä¸šæ ‡å‡†è¯‘æ³•**`},{role:"user",content:`è¯·å°†ä»¥ä¸‹AIæç¤ºè¯ç¿»è¯‘ä¸º${x}ï¼š

${b}`}],p=await o.callAI(r,C,k.id,!1);if(p&&p.trim()){const y=se(p);if(typeof f=="string"){const M=i.value;g.promptData.generatedPrompt={markdown:{zh:n.value==="markdown"&&M==="zh"?f:n.value==="markdown"&&m==="zh"?y:"",en:n.value==="markdown"&&M==="en"?f:n.value==="markdown"&&m==="en"?y:""},xml:{zh:n.value==="xml"&&M==="zh"?f:n.value==="xml"&&m==="zh"?y:"",en:n.value==="xml"&&M==="en"?f:n.value==="xml"&&m==="en"?y:""}}}else"markdown"in f?f[n.value][m]=y:g.promptData.generatedPrompt={markdown:{zh:n.value==="markdown"?f.zh||(m==="zh"?y:""):"",en:n.value==="markdown"?f.en||(m==="en"?y:""):""},xml:{zh:n.value==="xml"?f.zh||(m==="zh"?y:""):"",en:n.value==="xml"?f.en||(m==="en"?y:""):""}};i.value=m,e.success(`å·²ç¿»è¯‘ä¸º${x}ç‰ˆæœ¬`)}else e.error("è¯­è¨€è½¬æ¢å¤±è´¥ï¼šè¿”å›å†…å®¹ä¸ºç©º")}catch{e.error("è¯­è¨€è½¬æ¢å¤±è´¥ï¼Œè¯·é‡è¯•")}finally{l.value=!1}}}}function Bo(){const g=R({}),a=d=>{g.value=d},e=()=>{X(()=>{[g.value.reportScrollContainer,g.value.thinkingScrollContainer,g.value.initialScrollContainer,g.value.adviceScrollContainer,g.value.finalScrollContainer].forEach(u=>{u&&(u.scrollTop=u.scrollHeight)})})},o=d=>{X(()=>{const u=g.value[d];u&&(u.scrollTop=u.scrollHeight)})},s=d=>{X(()=>{const u=g.value[d];u&&(u.scrollTop=0)})},l=d=>{X(()=>{const u=g.value[d];u&&u.scrollTo({top:u.scrollHeight,behavior:"smooth"})})},n=d=>{const u=g.value[d];return u?Math.abs(u.scrollHeight-u.scrollTop-u.clientHeight)<5:!1};return{setScrollContainerRefs:a,scrollToBottomOfContent:e,scrollContainerToBottom:o,scrollContainerToTop:s,smoothScrollToBottom:l,isScrolledToBottom:n,autoScrollIfAtBottom:d=>{n(d)&&o(d)}}}function Fo(){const g=de(),a=R({report:!1,thinking:!1,initial:!1,advice:!1,final:!1});return{copyStatus:a,copyToClipboard:async(o,s)=>{if(!o||o.trim()===""){g.warning("å†…å®¹ä¸ºç©ºï¼Œæ— æ³•å¤åˆ¶");return}try{await Ie(o),a.value[s]=!0,g.success("å·²å¤åˆ¶åˆ°å‰ªè´´æ¿"),setTimeout(()=>{a.value[s]=!1},2e3)}catch{g.error("å¤åˆ¶å¤±è´¥ï¼Œè¯·é‡è¯•")}}}}function Lo(){const g=W();return{addThinkingPoint:()=>{g.promptData.thinkingPoints||(g.promptData.thinkingPoints=[]),g.promptData.thinkingPoints.push("")},removeThinkingPoint:l=>{g.promptData.thinkingPoints&&l>=0&&l<g.promptData.thinkingPoints.length&&g.promptData.thinkingPoints.splice(l,1)},addAdviceItem:()=>{g.promptData.advice||(g.promptData.advice=[]),g.promptData.advice.push("")},removeAdviceItem:l=>{g.promptData.advice&&l>=0&&l<g.promptData.advice.length&&g.promptData.advice.splice(l,1)}}}function jo(){const g=W(),a=Q(()=>!0),e=Q(()=>g.chatMessages&&g.chatMessages.length>0);return{hasAnyContent:a,hasConversationData:e,getStepDisplayName:s=>({report:"ç”Ÿæˆéœ€æ±‚æŠ¥å‘Š",thinking:"æå–å…³é”®æŒ‡ä»¤",initial:"ç”Ÿæˆåˆå§‹æç¤ºè¯",advice:"åˆ†æä¼˜åŒ–å»ºè®®",final:"åˆæˆæœ€ç»ˆæç¤ºè¯"})[s]||"ç”Ÿæˆ"}}const Oo={class:"bg-white rounded-lg shadow-sm flex flex-col h-full"},Ho={key:1,class:"flex-1 flex flex-col overflow-hidden p-4"},Ae=N({__name:"PreviewPanel",props:{isMobile:{type:Boolean},isExpanded:{type:Boolean}},emits:["toggle"],setup(g){const a=g,e=W(),o="",s=R(!1),l=R(!1),n=R(""),i=Uo(),d=Bo(),u=Go(),v=Fo(),m=Lo(),f=jo(),C=qo(i.switchToTabWithScroll,d.scrollToBottomOfContent),k=()=>{let b;const r=e.promptData.generatedPrompt;if(typeof r=="string"?b=r:"markdown"in r&&"xml"in r?b=r.markdown.zh||r.markdown.en||r.xml.zh||r.xml.en:b=r.zh||r.en,!b||!b.trim()){alert("æ²¡æœ‰å¯ä¿å­˜çš„æç¤ºè¯å†…å®¹");return}n.value=b,l.value=!0},x=async b=>{try{s.value=!0;const r=localStorage.getItem("yprompt_token");if(!r)throw new Error("è¯·å…ˆç™»å½•");const p={title:b.title,description:b.description,final_prompt:n.value,language:"zh",format:"markdown",prompt_type:b.promptType,tags:b.tags,is_public:b.isPublic?1:0},y=await fetch(`${o}/api/prompts/`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${r}`},body:JSON.stringify(p)});if(!y.ok){const I=await y.text();throw new Error(`HTTP ${y.status}: ${I}`)}const M=await y.json();if(M.code===200)alert("æç¤ºè¯ä¿å­˜æˆåŠŸï¼"),l.value=!1;else throw new Error(M.message||"ä¿å­˜å¤±è´¥")}catch(r){console.error("ä¿å­˜æç¤ºè¯å¤±è´¥:",r),alert(`ä¿å­˜å¤±è´¥: ${r.message}`)}finally{s.value=!1}};return H(()=>e.chatMessages.length,b=>{b===0&&(i.switchToTabWithScroll("report"),i.newContentTabs.value.clear())}),H(()=>e.promptData.requirementReport,b=>{b&&b.trim().length>0&&(i.newContentTabs.value.add("report"),i.switchToTabWithScroll("report"))}),H(()=>e.promptData.thinkingPoints,b=>{b&&b.length>0&&(i.newContentTabs.value.add("thinking"),i.switchToTabWithScroll("thinking"))}),H(()=>e.promptData.initialPrompt,b=>{b&&b.trim().length>0&&(i.newContentTabs.value.add("initial"),i.switchToTabWithScroll("initial"))}),H(()=>e.promptData.advice,b=>{b&&b.length>0&&(i.newContentTabs.value.add("advice"),i.switchToTabWithScroll("advice"))}),H(()=>e.promptData.generatedPrompt,b=>{if(b){let r=!1;typeof b=="string"?r=b.trim().length>0:"markdown"in b&&"xml"in b?r=!!(b.markdown.zh&&b.markdown.zh.trim().length>0||b.markdown.en&&b.markdown.en.trim().length>0||b.xml.zh&&b.xml.zh.trim().length>0||b.xml.en&&b.xml.en.trim().length>0):typeof b=="object"&&(r=!!(b.zh&&b.zh.trim().length>0||b.en&&b.en.trim().length>0)),r&&(i.newContentTabs.value.add("zh"),i.switchToTabWithScroll("zh"))}}),H(()=>e.promptData.requirementReport,()=>{e.isGenerating&&i.activeTab.value==="report"&&X(()=>{d.scrollContainerToBottom("reportScrollContainer")})},{flush:"post"}),H(()=>e.promptData.thinkingPoints,()=>{e.isGenerating&&i.activeTab.value==="thinking"&&X(()=>{d.scrollContainerToBottom("thinkingScrollContainer")})},{flush:"post"}),H(()=>e.promptData.initialPrompt,()=>{e.isGenerating&&i.activeTab.value==="initial"&&X(()=>{d.scrollContainerToBottom("initialScrollContainer")})},{flush:"post"}),H(()=>e.promptData.advice,()=>{e.isGenerating&&i.activeTab.value==="advice"&&X(()=>{d.scrollContainerToBottom("adviceScrollContainer")})},{flush:"post"}),H(()=>e.promptData.generatedPrompt,()=>{e.isGenerating&&i.activeTab.value==="zh"&&X(()=>{d.scrollContainerToBottom("finalScrollContainer")})},{flush:"post"}),(b,r)=>(h(),w("div",Oo,[U(eo,{"is-mobile":a.isMobile,"is-expanded":a.isExpanded,"is-auto-mode":t(e).isAutoMode,"current-execution-step":t(e).currentExecutionStep,"is-generating":t(e).isGenerating,onToggle:r[0]||(r[0]=p=>b.$emit("toggle")),"onUpdate:isAutoMode":r[1]||(r[1]=p=>t(e).isAutoMode=p)},null,8,["is-mobile","is-expanded","is-auto-mode","current-execution-step","is-generating"]),t(e).isGenerating&&!t(f).hasAnyContent.value?(h(),B(no,{key:0})):E("",!0),t(f).hasAnyContent.value?(h(),w("div",Ho,[U(rt,{"is-generating":t(e).isGenerating,onMounted:r[12]||(r[12]=p=>t(i).setTabRefs({tabContainer:p}))},{default:ae(()=>[U(ce,{"is-active":t(i).activeTab.value==="report","active-class":"bg-orange-500 text-white",onClick:r[2]||(r[2]=p=>t(i).handleTabChange("report")),onMounted:r[3]||(r[3]=p=>t(i).setTabRefs({reportTab:p}))},{default:ae(()=>[...r[29]||(r[29]=[pe(" éœ€æ±‚æè¿° ",-1)])]),_:1},8,["is-active"]),t(e).promptData.thinkingPoints?(h(),B(ce,{key:0,"is-active":t(i).activeTab.value==="thinking","active-class":"bg-purple-500 text-white",onClick:r[4]||(r[4]=p=>t(i).handleTabChange("thinking")),onMounted:r[5]||(r[5]=p=>t(i).setTabRefs({thinkingTab:p}))},{default:ae(()=>[...r[30]||(r[30]=[pe(" å…³é”®æŒ‡ä»¤ ",-1)])]),_:1},8,["is-active"])):E("",!0),t(e).promptData.initialPrompt?(h(),B(ce,{key:1,"is-active":t(i).activeTab.value==="initial","active-class":"bg-green-500 text-white",onClick:r[6]||(r[6]=p=>t(i).handleTabChange("initial")),onMounted:r[7]||(r[7]=p=>t(i).setTabRefs({initialTab:p}))},{default:ae(()=>[...r[31]||(r[31]=[pe(" åˆå§‹æç¤ºè¯ ",-1)])]),_:1},8,["is-active"])):E("",!0),t(e).promptData.advice?(h(),B(ce,{key:2,"is-active":t(i).activeTab.value==="advice","active-class":"bg-yellow-500 text-white",onClick:r[8]||(r[8]=p=>t(i).handleTabChange("advice")),onMounted:r[9]||(r[9]=p=>t(i).setTabRefs({adviceTab:p}))},{default:ae(()=>[...r[32]||(r[32]=[pe(" ä¼˜åŒ–å»ºè®® ",-1)])]),_:1},8,["is-active"])):E("",!0),t(u).currentGeneratedPrompt.value?(h(),B(ce,{key:3,"is-active":t(i).activeTab.value==="zh","active-class":"bg-blue-500 text-white",onClick:r[10]||(r[10]=p=>t(i).handleTabChange("zh")),onMounted:r[11]||(r[11]=p=>t(i).setTabRefs({zhTab:p}))},{default:ae(()=>[...r[33]||(r[33]=[pe(" æœ€ç»ˆæç¤ºè¯ ",-1)])]),_:1},8,["is-active"])):E("",!0)]),_:1},8,["is-generating"]),t(i).activeTab.value==="report"?(h(),B(vo,{key:0,"requirement-report":t(e).promptData.requirementReport,"onUpdate:requirementReport":r[13]||(r[13]=p=>t(e).promptData.requirementReport=p),"has-conversation-data":t(f).hasConversationData.value,"is-auto-mode":t(e).isAutoMode,"is-executing":t(C).isExecuting.value,"is-generating":t(e).isGenerating,"current-execution-step":t(e).currentExecutionStep,"is-copied":t(v).copyStatus.value.report,onRegenerate:t(C).regenerateRequirementReport,onCopy:r[14]||(r[14]=p=>t(v).copyToClipboard(t(e).promptData.requirementReport,"report")),onExecuteFull:t(C).executeFullWorkflow,onExecuteThinking:t(C).executeThinkingPoints,onScrollMounted:r[15]||(r[15]=p=>t(d).setScrollContainerRefs({reportScrollContainer:p}))},null,8,["requirement-report","has-conversation-data","is-auto-mode","is-executing","is-generating","current-execution-step","is-copied","onRegenerate","onExecuteFull","onExecuteThinking"])):E("",!0),t(i).activeTab.value==="thinking"?(h(),B(Mo,{key:1,"thinking-points":t(e).promptData.thinkingPoints||[],"is-mobile":a.isMobile,"is-auto-mode":t(e).isAutoMode,"is-executing":t(C).isExecuting.value,"is-generating":t(e).isGenerating,"current-execution-step":t(e).currentExecutionStep,"is-copied":t(v).copyStatus.value.thinking,onRegenerate:t(C).regenerateThinkingPoints,onCopy:r[16]||(r[16]=p=>{var y;return t(v).copyToClipboard(((y=t(e).promptData.thinkingPoints)==null?void 0:y.join(`
`))||"","thinking")}),onAddPoint:t(m).addThinkingPoint,onRemovePoint:t(m).removeThinkingPoint,onUpdatePoint:r[17]||(r[17]=(p,y)=>{t(e).promptData.thinkingPoints&&(t(e).promptData.thinkingPoints[p]=y)}),onExecuteInitial:t(C).executeInitialPrompt,onScrollMounted:r[18]||(r[18]=p=>t(d).setScrollContainerRefs({thinkingScrollContainer:p}))},null,8,["thinking-points","is-mobile","is-auto-mode","is-executing","is-generating","current-execution-step","is-copied","onRegenerate","onAddPoint","onRemovePoint","onExecuteInitial"])):E("",!0),t(i).activeTab.value==="initial"?(h(),B(zo,{key:2,"initial-prompt":t(e).promptData.initialPrompt,"onUpdate:initialPrompt":r[19]||(r[19]=p=>t(e).promptData.initialPrompt=p),"is-auto-mode":t(e).isAutoMode,"is-executing":t(C).isExecuting.value,"is-generating":t(e).isGenerating,"current-execution-step":t(e).currentExecutionStep,"is-copied":t(v).copyStatus.value.initial,onRegenerate:t(C).regenerateInitialPrompt,onCopy:r[20]||(r[20]=p=>t(v).copyToClipboard(t(e).promptData.initialPrompt||"","initial")),onExecuteAdvice:t(C).executeAdvice,onScrollMounted:r[21]||(r[21]=p=>t(d).setScrollContainerRefs({initialScrollContainer:p}))},null,8,["initial-prompt","is-auto-mode","is-executing","is-generating","current-execution-step","is-copied","onRegenerate","onExecuteAdvice"])):E("",!0),t(i).activeTab.value==="advice"?(h(),B(it,{key:3,advice:t(e).promptData.advice||[],"is-mobile":a.isMobile,"is-auto-mode":t(e).isAutoMode,"is-executing":t(C).isExecuting.value,"is-generating":t(e).isGenerating,"current-execution-step":t(e).currentExecutionStep,"is-copied":t(v).copyStatus.value.advice,onRegenerate:t(C).regenerateAdvice,onCopy:r[22]||(r[22]=p=>{var y;return t(v).copyToClipboard(((y=t(e).promptData.advice)==null?void 0:y.join(`
`))||"","advice")}),onAddItem:t(m).addAdviceItem,onRemoveItem:t(m).removeAdviceItem,onUpdateItem:r[23]||(r[23]=(p,y)=>{t(e).promptData.advice&&(t(e).promptData.advice[p]=y)}),onExecuteFinal:t(C).executeFinalPrompt,onScrollMounted:r[24]||(r[24]=p=>t(d).setScrollContainerRefs({adviceScrollContainer:p}))},null,8,["advice","is-mobile","is-auto-mode","is-executing","is-generating","current-execution-step","is-copied","onRegenerate","onAddItem","onRemoveItem","onExecuteFinal"])):E("",!0),t(i).activeTab.value==="zh"?(h(),B(at,{key:4,"generated-prompt":t(u).currentGeneratedPrompt.value,"onUpdate:generatedPrompt":r[25]||(r[25]=p=>t(u).currentGeneratedPrompt.value=p),"is-executing":t(C).isExecuting.value,"is-generating":t(e).isGenerating,"current-execution-step":t(e).currentExecutionStep,"is-copied":t(v).copyStatus.value.final,"is-converting-format":t(u).isConvertingFormat.value,"is-converting-language":t(u).isConvertingLanguage.value,"is-saving":s.value,"format-state":t(u).formatState.value,"language-state":t(u).languageState.value,onRegenerate:t(C).regenerateFinalPrompt,onCopy:r[26]||(r[26]=p=>t(v).copyToClipboard(t(u).currentGeneratedPrompt.value,"final")),onToggleFormat:t(u).toggleFormat,onToggleLanguage:t(u).toggleLanguage,onSavePrompt:k,onScrollMounted:r[27]||(r[27]=p=>t(d).setScrollContainerRefs({finalScrollContainer:p}))},null,8,["generated-prompt","is-executing","is-generating","current-execution-step","is-copied","is-converting-format","is-converting-language","is-saving","format-state","language-state","onRegenerate","onToggleFormat","onToggleLanguage"])):E("",!0)])):E("",!0),!t(f).hasAnyContent.value&&!t(e).isGenerating?(h(),B(lt,{key:2})):E("",!0),U(dt,{"is-open":l.value,"prompt-content":n.value,"is-saving":s.value,onSave:x,onCancel:r[28]||(r[28]=p=>l.value=!1)},null,8,["is-open","prompt-content","is-saving"])]))}}),Ko={key:0,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4"},Qo={class:"bg-white rounded-lg max-w-4xl w-full h-[90vh] flex flex-col overflow-hidden"},No={class:"flex items-center justify-between p-6 border-b flex-shrink-0"},_o={class:"flex items-center space-x-4"},Xo={class:"flex space-x-1"},Vo={class:"flex-1 overflow-y-auto p-6"},Wo={class:"flex justify-end space-x-3 p-4 border-t bg-gray-50 flex-shrink-0"},Jo=N({__name:"GenerateSettingsModal",setup(g){const a=ue(),e=R("providers"),o=_e(),s=Xe(),l=Ve(),n=We();return(i,d)=>(h(),w(V,null,[U(Je,{onOpen:d[0]||(d[0]=u=>t(a).showSettings=!0)}),t(a).showSettings?(h(),w("div",Ko,[c("div",Qo,[c("div",No,[c("div",_o,[d[16]||(d[16]=c("h2",{class:"text-xl font-semibold"},"è®¾ç½®",-1)),c("div",Xo,[c("button",{onClick:d[1]||(d[1]=u=>e.value="providers"),class:K(["px-3 py-1 rounded text-sm font-medium transition-colors",e.value==="providers"?"bg-blue-100 text-blue-700":"text-gray-600 hover:text-gray-800"])}," AIæ¨¡å‹ ",2),c("button",{onClick:d[2]||(d[2]=u=>e.value="params"),class:K(["px-3 py-1 rounded text-sm font-medium transition-colors",e.value==="params"?"bg-blue-100 text-blue-700":"text-gray-600 hover:text-gray-800"])}," æ¨¡å‹å‚æ•° ",2),c("button",{onClick:d[3]||(d[3]=u=>e.value="prompts"),class:K(["px-3 py-1 rounded text-sm font-medium transition-colors",e.value==="prompts"?"bg-blue-100 text-blue-700":"text-gray-600 hover:text-gray-800"])}," æç¤ºè¯è§„åˆ™ ",2)])]),c("button",{onClick:d[4]||(d[4]=u=>t(a).showSettings=!1),class:"p-1 hover:bg-gray-100 rounded"},[U(t(ke),{class:"w-5 h-5"})])]),c("div",Vo,[e.value==="providers"?(h(),B(Ye,{key:0,providers:t(a).providers,"batch-testing-states":t(o).batchTestingStates.value,"testing-provider":t(o).testingProvider.value,onShowAddProviderType:d[5]||(d[5]=u=>t(l).showAddProviderTypeDialog.value=!0),onEditProvider:t(l).editProvider,onDeleteProvider:t(l).deleteProvider,onBatchTest:t(o).batchTestModels,onShowAddModel:t(s).showAddModel,onEditModel:t(s).editModel,onDeleteModel:t(s).deleteModel,onTestModel:t(o).handleModelTestClick,onSave:t(a).saveSettings,"get-default-base-url":t(l).getDefaultBaseUrl,"get-test-button-title":t(o).getTestButtonTitle,"get-batch-test-button-title":t(o).getBatchTestButtonTitle,"get-api-type-color":t(s).getApiTypeColor,"get-api-type-label":t(s).getApiTypeLabel},null,8,["providers","batch-testing-states","testing-provider","onEditProvider","onDeleteProvider","onBatchTest","onShowAddModel","onEditModel","onDeleteModel","onTestModel","onSave","get-default-base-url","get-test-button-title","get-batch-test-button-title","get-api-type-color","get-api-type-label"])):E("",!0),e.value==="params"?(h(),B(Ze,{key:1})):E("",!0),e.value==="prompts"?(h(),B(et,{key:2,onResetSystem:t(n).resetSystemPromptRules,onResetUser:t(n).resetUserPromptRules,onResetRequirement:t(n).resetRequirementReportRules,onResetQualityAnalysisSystem:t(n).resetQualityAnalysisSystemPrompt,onResetThinking:t(n).resetThinkingPointsExtractionPrompt,onResetGeneration:t(n).resetSystemPromptGenerationPrompt,onResetAdvice:t(n).resetOptimizationAdvicePrompt,onResetApplication:t(n).resetOptimizationApplicationPrompt,onToggleSlimRules:t(n).handleSlimRulesToggle,onResetUserPromptQualityAnalysis:t(n).resetUserPromptQualityAnalysis,onResetUserPromptQuickOptimization:t(n).resetUserPromptQuickOptimization},null,8,["onResetSystem","onResetUser","onResetRequirement","onResetQualityAnalysisSystem","onResetThinking","onResetGeneration","onResetAdvice","onResetApplication","onToggleSlimRules","onResetUserPromptQualityAnalysis","onResetUserPromptQuickOptimization"])):E("",!0)]),c("div",Wo,[c("button",{onClick:d[6]||(d[6]=u=>t(a).showSettings=!1),class:"px-4 py-2 text-gray-600 border border-gray-300 rounded-md hover:bg-gray-50 transition-colors"}," å–æ¶ˆ "),c("button",{onClick:d[7]||(d[7]=(...u)=>t(n).saveAndClose&&t(n).saveAndClose(...u)),class:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition-colors"}," ä¿å­˜è®¾ç½® ")])])])):E("",!0),t(l).showAddProviderTypeDialog.value?(h(),B(tt,{key:1,onSelect:t(l).selectProviderType,onClose:d[8]||(d[8]=u=>t(l).showAddProviderTypeDialog.value=!1)},null,8,["onSelect"])):E("",!0),t(l).showAddProvider.value?(h(),B(nt,{key:2,editing:!!t(l).editingProvider.value,"provider-type":t(l).selectedProviderType.value,name:t(l).newProvider.value.name,"onUpdate:name":d[9]||(d[9]=u=>t(l).newProvider.value.name=u),"base-url":t(l).newProvider.value.baseUrl,"onUpdate:baseUrl":d[10]||(d[10]=u=>t(l).newProvider.value.baseUrl=u),"api-key":t(l).newProvider.value.apiKey,"onUpdate:apiKey":d[11]||(d[11]=u=>t(l).newProvider.value.apiKey=u),"get-default-base-url":t(l).getDefaultBaseUrl,"get-provider-template":t(l).getProviderTemplate,onSave:t(l).saveProvider,onClose:t(l).closeProviderDialog},null,8,["editing","provider-type","name","base-url","api-key","get-default-base-url","get-provider-template","onSave","onClose"])):E("",!0),t(s).showAddModelDialog.value?(h(),B(ot,{key:3,editing:!!t(s).editingModel.value,provider:t(s).getProviderForModel(t(s).addingModelToProvider.value),name:t(s).newModel.value.name,"onUpdate:name":d[12]||(d[12]=u=>t(s).newModel.value.name=u),id:t(s).newModel.value.id,"onUpdate:id":d[13]||(d[13]=u=>t(s).newModel.value.id=u),"api-type":t(s).newModel.value.apiType,"onUpdate:apiType":d[14]||(d[14]=u=>t(s).newModel.value.apiType=u),"search-keyword":t(s).modelSearchKeyword.value,"onUpdate:searchKeyword":d[15]||(d[15]=u=>t(s).modelSearchKeyword.value=u),"available-models":t(s).getCurrentProviderModels.value,loading:t(s).loadingModels.value,error:t(s).modelFetchError.value,onFetchModels:t(s).fetchAvailableModels,onSelectModel:t(s).selectModel,onSave:t(s).addCustomModel,onClose:t(s).closeAddModelDialog},null,8,["editing","provider","name","id","api-type","search-keyword","available-models","loading","error","onFetchModels","onSelectModel","onSave","onClose"])):E("",!0)],64))}}),Yo={class:"h-full flex flex-col overflow-hidden p-2"},Zo={class:"w-full flex flex-col flex-1 overflow-hidden"},es={class:"bg-white rounded-lg shadow-sm p-4 mb-4 flex-shrink-0"},ts={class:"flex flex-col lg:flex-row lg:items-center lg:justify-between gap-4"},ns={class:"flex items-center gap-2 flex-shrink-0 flex-wrap sm:flex-nowrap"},os=["value"],ss=["disabled"],rs=["value"],is={key:0,class:"grid grid-cols-2 gap-4 flex-1 min-h-0 overflow-hidden"},as={class:"flex flex-col"},ls={class:"flex flex-col"},ds={key:1,class:"flex flex-col flex-1 min-h-0 overflow-hidden"},us={key:1,class:"flex flex-col flex-1 min-h-0 mb-2"},ps={key:2,class:"flex flex-col flex-1 min-h-0 mb-2"},bs=N({__name:"GenerateModule",setup(g){const a=ue(),e=W(),o=Oe(),s=R(!0),l=R(!1),n=R("disconnected"),i=Q(()=>a.getAvailableProviders()),d=Q(()=>a.selectedProvider?a.getAvailableModels(a.selectedProvider):[]),u=()=>{a.selectedModel="";const C=d.value;C.length>0&&(a.selectedModel=C[0].id),a.saveSettings(),v()},v=()=>{const C=a.getCurrentProvider(),k=a.getCurrentModel();if(!C||!k||!C.apiKey){n.value="disconnected";return}n.value="connected"};H(()=>[a.selectedProvider,a.selectedModel],v);const m=()=>{o.isMobile&&(s.value?(s.value=!1,l.value=!0):(s.value=!0,l.value=!1))},f=()=>{o.isMobile&&(l.value?(l.value=!1,s.value=!0):(l.value=!0,s.value=!1))};return H(()=>e.isGenerating,C=>{o.isMobile&&C&&(s.value=!1,l.value=!0)}),H(()=>e.promptData.requirementReport,C=>{o.isMobile&&C&&C.trim().length>0&&(s.value=!1,l.value=!0)}),ie(()=>{a.loadSettings(),i.value.length>0?v():setTimeout(()=>{a.showSettings=!0},1e3)}),(C,k)=>(h(),w("div",Yo,[U(Jo),c("div",Zo,[c("div",es,[c("div",ts,[k[6]||(k[6]=c("div",{class:"min-w-0"},[c("h1",{class:"text-xl lg:text-2xl font-bold text-gray-800 mb-1"},"æ™ºèƒ½æç¤ºè¯åˆ›å»º"),c("p",{class:"text-sm lg:text-base text-gray-600"},"AIå¼•å¯¼å¼å¯¹è¯ï¼Œå¸®æ‚¨æ„å»ºä¸“ä¸šçš„æç¤ºè¯")],-1)),c("div",ns,[k[5]||(k[5]=c("label",{class:"text-sm font-medium text-gray-700 whitespace-nowrap"},"AIæ¨¡å‹:",-1)),we(c("select",{"onUpdate:modelValue":k[0]||(k[0]=x=>t(a).selectedProvider=x),onChange:u,class:"px-3 py-1 border border-gray-300 rounded-md text-sm focus:ring-2 focus:ring-blue-500 min-w-0 flex-1 sm:flex-none"},[k[3]||(k[3]=c("option",{value:""},"é€‰æ‹©æä¾›å•†",-1)),(h(!0),w(V,null,ee(i.value,x=>(h(),w("option",{key:x.id,value:x.id},L(x.name),9,os))),128))],544),[[$e,t(a).selectedProvider]]),we(c("select",{"onUpdate:modelValue":k[1]||(k[1]=x=>t(a).selectedModel=x),onChange:k[2]||(k[2]=(...x)=>t(a).saveSettings&&t(a).saveSettings(...x)),disabled:!t(a).selectedProvider,class:"px-3 py-1 border border-gray-300 rounded-md text-sm focus:ring-2 focus:ring-blue-500 disabled:opacity-50 min-w-0 flex-1 sm:flex-none"},[k[4]||(k[4]=c("option",{value:""},"é€‰æ‹©æ¨¡å‹",-1)),(h(!0),w(V,null,ee(d.value,x=>(h(),w("option",{key:x.id,value:x.id},L(x.name),9,rs))),128))],40,ss),[[$e,t(a).selectedModel]])])])]),t(o).isMobile?(h(),w("div",ds,[s.value?E("",!0):(h(),w("div",{key:0,onClick:m,class:"bg-white rounded-lg shadow-sm p-3 flex items-center justify-between cursor-pointer hover:bg-gray-50 transition-colors flex-shrink-0 mb-2"},[k[7]||(k[7]=c("h3",{class:"font-semibold text-gray-800"},"AIåŠ©æ‰‹å¯¹è¯",-1)),U(t(Re),{class:"w-5 h-5 text-gray-500"})])),s.value?(h(),w("div",us,[U(Ee,{"is-mobile":t(o).isMobile,"is-expanded":s.value,onToggle:m},null,8,["is-mobile","is-expanded"])])):E("",!0),l.value?(h(),w("div",ps,[U(Ae,{"is-mobile":t(o).isMobile,"is-expanded":l.value,onToggle:f},null,8,["is-mobile","is-expanded"])])):E("",!0),l.value?E("",!0):(h(),w("div",{key:3,onClick:f,class:"bg-white rounded-lg shadow-sm p-3 flex items-center justify-between cursor-pointer hover:bg-gray-50 transition-colors flex-shrink-0"},[k[8]||(k[8]=c("h3",{class:"font-semibold text-gray-800"},"ç”Ÿæˆé¢„è§ˆ",-1)),U(t(Re),{class:"w-5 h-5 text-gray-500"})]))])):(h(),w("div",is,[c("div",as,[U(Ee)]),c("div",ls,[U(Ae)])]))]),U(He)]))}});export{bs as default};
