import{c as y,d as P,u as U,a as z,r as u,o as $,b as j,e as r,f as t,g as f,h as d,w as F,i as h,v as q,n as L,j as p,t as k,k as N,l as w,m as O,p as R,T,q as G,s as l,G as Y,_ as Z}from"./index-FUvL6nQC.js";import{C as W}from"./check-mMMgFnhj.js";/**
 * @license lucide-vue-next v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const H=y("circle-alert",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]);/**
 * @license lucide-vue-next v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const J=y("eye-off",[["path",{d:"M10.733 5.076a10.744 10.744 0 0 1 11.205 6.575 1 1 0 0 1 0 .696 10.747 10.747 0 0 1-1.444 2.49",key:"ct8e1f"}],["path",{d:"M14.084 14.158a3 3 0 0 1-4.242-4.242",key:"151rxh"}],["path",{d:"M17.479 17.499a10.75 10.75 0 0 1-15.417-5.151 1 1 0 0 1 0-.696 10.75 10.75 0 0 1 4.446-5.143",key:"13bj9a"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]]);/**
 * @license lucide-vue-next v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const K=y("eye",[["path",{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0",key:"1nclc0"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);/**
 * @license lucide-vue-next v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Q=y("loader-circle",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]]),X={class:"login-container"},ee={class:"absolute top-2 right-2 z-50"},se={class:"login-card"},te={class:"login-header"},ae={key:0,class:"debug-badge"},oe={key:0,class:"loading-state"},le={key:1,class:"login-content"},re={key:0,class:"login-section"},ne={class:"form-group"},ie={class:"input-wrapper"},ue=["disabled"],de={key:0,class:"input-icon success"},ce={key:0,class:"field-error"},pe={class:"form-group"},ve={class:"input-wrapper"},me=["type","disabled"],ge=["disabled"],fe={key:0,class:"field-error"},ye={class:"form-options"},_e={class:"checkbox-label"},be=["disabled"],he={key:0,class:"error-message"},ke=["disabled"],we={key:1},xe={key:2},Me=P({__name:"LoginView",setup(Ce){const v=j(),_=U(),I=z(()=>G()),x=u({local_auth_enabled:!0}),a=u({username:"",password:""}),M=u(!0),n=u(!1),c=u(""),m=u(!1),g=u(!1),o=u({}),V=s=>s?s.length<3?"ç”¨æˆ·åè‡³å°‘3ä¸ªå­—ç¬¦":s.length>20?"ç”¨æˆ·åä¸èƒ½è¶…è¿‡20ä¸ªå­—ç¬¦":/^[a-zA-Z]/.test(s)?/^[a-zA-Z0-9_]+$/.test(s)?null:"ç”¨æˆ·ååªèƒ½åŒ…å«å­—æ¯ã€æ•°å­—å’Œä¸‹åˆ’çº¿":"ç”¨æˆ·åå¿…é¡»ä»¥å­—æ¯å¼€å¤´":"è¯·è¾“å…¥ç”¨æˆ·å",E=s=>s?null:"è¯·è¾“å…¥å¯†ç ",b=()=>{o.value={};const s=V(a.value.username),e=E(a.value.password);return s&&(o.value.username=s),e&&(o.value.password=e),Object.keys(o.value).length===0},C=s=>{o.value[s]&&delete o.value[s]},S=z(()=>a.value.username.length>0&&a.value.password.length>0&&Object.keys(o.value).length===0),A=async()=>{try{const s=await _.getAuthConfig();s&&(x.value=s,!a.value.username&&s.login_username&&(a.value.username=s.login_username))}catch(s){console.error("èŽ·å–è®¤è¯é…ç½®å¤±è´¥:",s)}finally{M.value=!1}},B=()=>{g.value?localStorage.setItem("yprompt_remembered_username",a.value.username):localStorage.removeItem("yprompt_remembered_username")},D=async()=>{if(b()){c.value="",n.value=!0;try{const s=await _.loginWithPassword(a.value.username.trim(),a.value.password);if(s.success){B();const e=v.currentRoute.value.query.redirect;e&&e!=="/login"?v.push(e):v.push("/")}else c.value=s.message||"ç”¨æˆ·åæˆ–å¯†ç é”™è¯¯"}catch(s){c.value=s instanceof Error?s.message:"ç™»å½•å¤±è´¥ï¼Œè¯·ç¨åŽé‡è¯•",console.error("ç™»å½•å¤±è´¥:",s)}finally{n.value=!1}}};return $(()=>{if(_.isLoggedIn){v.push("/");return}const s=localStorage.getItem("yprompt_remembered_username");s&&(a.value.username=s,g.value=!0),A()}),(s,e)=>(l(),r("div",X,[t("div",ee,[f(Y)]),t("div",se,[t("div",te,[e[7]||(e[7]=t("div",{class:"logo-wrapper"},[t("div",{class:"logo-icon"},"YP")],-1)),e[8]||(e[8]=t("h1",{class:"login-title"},"YPrompt",-1)),e[9]||(e[9]=t("p",{class:"login-subtitle"},"æç¤ºè¯ç®¡ç†ç³»ç»Ÿ",-1)),I.value?(l(),r("div",ae,[...e[6]||(e[6]=[t("span",{class:"debug-icon"},"ðŸ›",-1),t("span",null,"Debug æ¨¡å¼ï¼ˆMock APIï¼‰",-1)])])):d("",!0)]),M.value?(l(),r("div",oe,[...e[10]||(e[10]=[t("div",{class:"loading-spinner"},null,-1),t("p",{class:"loading-text"},"æ­£åœ¨åŠ è½½...",-1)])])):(l(),r("div",le,[x.value.local_auth_enabled?(l(),r("div",re,[t("form",{onSubmit:F(D,["prevent"]),class:"login-form"},[t("div",ne,[e[11]||(e[11]=t("label",{for:"username"},"ç”¨æˆ·å",-1)),t("div",ie,[h(t("input",{id:"username","onUpdate:modelValue":e[0]||(e[0]=i=>a.value.username=i),type:"text",class:L(["form-input",{"input-error":o.value.username}]),placeholder:"è¯·è¾“å…¥ç”¨æˆ·å",disabled:n.value,autocomplete:"username",onBlur:b,onInput:e[1]||(e[1]=i=>C("username"))},null,42,ue),[[q,a.value.username]]),a.value.username&&!o.value.username?(l(),r("div",de,[f(p(W),{size:18})])):d("",!0)]),o.value.username?(l(),r("div",ce,k(o.value.username),1)):d("",!0)]),t("div",pe,[e[12]||(e[12]=t("label",{for:"password"},"å¯†ç ",-1)),t("div",ve,[h(t("input",{id:"password","onUpdate:modelValue":e[2]||(e[2]=i=>a.value.password=i),type:m.value?"text":"password",class:L(["form-input",{"input-error":o.value.password}]),placeholder:"è¯·è¾“å…¥å¯†ç ",disabled:n.value,autocomplete:"current-password",onBlur:b,onInput:e[3]||(e[3]=i=>C("password"))},null,42,me),[[N,a.value.password]]),t("button",{type:"button",class:"password-toggle",onClick:e[4]||(e[4]=i=>m.value=!m.value),disabled:n.value,tabindex:"-1"},[m.value?(l(),w(p(J),{key:1,size:18})):(l(),w(p(K),{key:0,size:18}))],8,ge)]),o.value.password?(l(),r("div",fe,k(o.value.password),1)):d("",!0)]),t("div",ye,[t("label",_e,[h(t("input",{type:"checkbox","onUpdate:modelValue":e[5]||(e[5]=i=>g.value=i),class:"checkbox-input",disabled:n.value},null,8,be),[[O,g.value]]),e[13]||(e[13]=t("span",null,"è®°ä½æˆ‘",-1))])]),f(T,{name:"fade"},{default:R(()=>[c.value?(l(),r("div",he,[f(p(H),{size:16}),t("span",null,k(c.value),1)])):d("",!0)]),_:1}),t("button",{type:"submit",class:"btn btn-primary btn-block",disabled:n.value||!S.value},[n.value?(l(),w(p(Q),{key:0,size:18,class:"spinning"})):d("",!0),n.value?(l(),r("span",we,"ç™»å½•ä¸­...")):(l(),r("span",xe,"ç™»å½•"))],8,ke)],32)])):d("",!0)]))])]))}}),Ie=Z(Me,[["__scopeId","data-v-ef30096a"]]);export{Ie as default};
