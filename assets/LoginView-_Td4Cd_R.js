import{d as P,u as z,c as h,r,o as A,a as B,b as l,e as s,f as c,w as F,g as k,h as C,v as j,n as N,i as b,j as g,t as x,k as O,l as R,T as U,m as $,p as a,E as q,q as T,C as Y,L as W,_ as G}from"./index-CPHoan2D.js";const H={class:"login-container"},J={class:"login-card"},K={class:"login-header"},Q={key:0,class:"debug-badge"},X={key:0,class:"loading-state"},Z={key:1,class:"login-content"},ee={key:0,class:"login-section"},se={class:"form-group"},oe={class:"input-wrapper"},ae=["type","disabled"],te=["disabled"],le={key:0,class:"field-error"},ne={class:"form-options"},re={class:"checkbox-label"},ie=["disabled"],de={key:0,class:"error-message"},ue=["disabled"],ce={key:1},pe={key:2},ve=P({__name:"LoginView",setup(ge){const p=B(),m=z(),L=h(()=>$()),_=r({local_auth_enabled:!0}),i=r({password:""}),y=r(!0),n=r(!1),d=r(""),v=r(!1),f=r(!1),t=r({}),M=o=>o?null:"è¯·è¾“å…¥å¯†ç ",w=()=>{t.value={};const o=M(i.value.password);return o&&(t.value.password=o),Object.keys(t.value).length===0},E=o=>{t.value[o]&&delete t.value[o]},V=h(()=>i.value.password.length>0&&Object.keys(t.value).length===0),S=async()=>{try{const o=await m.getAuthConfig();o&&(_.value=o)}catch(o){console.error("èŽ·å–è®¤è¯é…ç½®å¤±è´¥:",o)}finally{y.value=!1}},D=()=>{f.value?localStorage.setItem("yprompt_remembered_username","admin"):localStorage.removeItem("yprompt_remembered_username")},I=async()=>{if(w()){d.value="",n.value=!0;try{const o=await m.loginWithPassword("admin",i.value.password);if(o.success){D();const e=p.currentRoute.value.query.redirect;e&&e!=="/login"?p.push(e):p.push("/")}else d.value=o.message||"å¯†ç é”™è¯¯"}catch(o){d.value=o instanceof Error?o.message:"ç™»å½•å¤±è´¥ï¼Œè¯·ç¨åŽé‡è¯•",console.error("ç™»å½•å¤±è´¥:",o)}finally{n.value=!1}}};return A(()=>{if(m.isLoggedIn){p.push("/");return}S()}),(o,e)=>(a(),l("div",H,[s("div",J,[s("div",K,[e[5]||(e[5]=s("div",{class:"logo-wrapper"},[s("div",{class:"logo-icon"},"YP")],-1)),e[6]||(e[6]=s("h1",{class:"login-title"},"YPrompt",-1)),e[7]||(e[7]=s("p",{class:"login-subtitle"},"æç¤ºè¯ç®¡ç†ç³»ç»Ÿ",-1)),L.value?(a(),l("div",Q,[...e[4]||(e[4]=[s("span",{class:"debug-icon"},"ðŸ›",-1),s("span",null,"Debug æ¨¡å¼ï¼ˆMock APIï¼‰",-1)])])):c("",!0)]),y.value?(a(),l("div",X,[...e[8]||(e[8]=[s("div",{class:"loading-spinner"},null,-1),s("p",{class:"loading-text"},"æ­£åœ¨åŠ è½½...",-1)])])):(a(),l("div",Z,[_.value.local_auth_enabled?(a(),l("div",ee,[s("form",{onSubmit:F(I,["prevent"]),class:"login-form"},[e[11]||(e[11]=s("div",{class:"form-group"},[s("label",null,"ç”¨æˆ·å"),s("div",{class:"form-input readonly-input",style:{background:"#f7fafc",color:"#4a5568"}}," admin ")],-1)),s("div",se,[e[9]||(e[9]=s("label",{for:"password"},"å¯†ç ",-1)),s("div",oe,[C(s("input",{id:"password","onUpdate:modelValue":e[0]||(e[0]=u=>i.value.password=u),type:v.value?"text":"password",class:N(["form-input",{"input-error":t.value.password}]),placeholder:"è¯·è¾“å…¥å¯†ç ",disabled:n.value,autocomplete:"current-password",onBlur:w,onInput:e[1]||(e[1]=u=>E("password"))},null,42,ae),[[j,i.value.password]]),s("button",{type:"button",class:"password-toggle",onClick:e[2]||(e[2]=u=>v.value=!v.value),disabled:n.value,tabindex:"-1"},[v.value?(a(),b(g(T),{key:1,size:18})):(a(),b(g(q),{key:0,size:18}))],8,te)]),t.value.password?(a(),l("div",le,x(t.value.password),1)):c("",!0)]),s("div",ne,[s("label",re,[C(s("input",{type:"checkbox","onUpdate:modelValue":e[3]||(e[3]=u=>f.value=u),class:"checkbox-input",disabled:n.value},null,8,ie),[[O,f.value]]),e[10]||(e[10]=s("span",null,"è®°ä½æˆ‘",-1))])]),k(U,{name:"fade"},{default:R(()=>[d.value?(a(),l("div",de,[k(g(Y),{size:16}),s("span",null,x(d.value),1)])):c("",!0)]),_:1}),s("button",{type:"submit",class:"btn btn-primary btn-block",disabled:n.value||!V.value},[n.value?(a(),b(g(W),{key:0,size:18,class:"spinning"})):c("",!0),n.value?(a(),l("span",ce,"ç™»å½•ä¸­...")):(a(),l("span",pe,"ç™»å½•"))],8,ue)],32)])):c("",!0)]))])]))}}),fe=G(ve,[["__scopeId","data-v-4111cd14"]]);export{fe as default};
