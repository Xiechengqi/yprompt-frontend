import{c as M,d as Q,u as ee,r as v,a as O,o as se,b as ae,e as l,f as a,g as te,h as p,i as f,w as _,j as g,v as R,n as V,k as m,t as y,l as T,m as b,p as le,q as S,T as B,s as oe,x as t,X as re,_ as ne}from"./index-C-CmDlYV.js";import{C as q}from"./check-HQzGE7OJ.js";/**
 * @license lucide-vue-next v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const D=M("circle-alert",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]);/**
 * @license lucide-vue-next v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Z=M("eye-off",[["path",{d:"M10.733 5.076a10.744 10.744 0 0 1 11.205 6.575 1 1 0 0 1 0 .696 10.747 10.747 0 0 1-1.444 2.49",key:"ct8e1f"}],["path",{d:"M14.084 14.158a3 3 0 0 1-4.242-4.242",key:"151rxh"}],["path",{d:"M17.479 17.499a10.75 10.75 0 0 1-15.417-5.151 1 1 0 0 1 0-.696 10.75 10.75 0 0 1 4.446-5.143",key:"13bj9a"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]]);/**
 * @license lucide-vue-next v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Y=M("eye",[["path",{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0",key:"1nclc0"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);/**
 * @license lucide-vue-next v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const W=M("loader-circle",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]]),ue={class:"login-container"},ie={class:"login-card"},de={key:0,class:"loading-state"},ve={key:1,class:"login-content"},ce={key:0,class:"login-section"},pe={class:"form-group"},me={class:"input-wrapper"},fe=["disabled"],ge={key:0,class:"input-icon success"},ye={key:0,class:"field-error"},be={class:"form-group"},_e={class:"input-wrapper"},ke=["type","disabled"],we=["disabled"],he={key:0,class:"field-error"},xe={class:"form-options"},Ce={class:"checkbox-label"},ze=["disabled"],Ve={key:0,class:"error-message"},Me=["disabled"],Ee={key:1},Ie={key:2},Le={key:0,class:"register-link"},Re={class:"modal-header"},Se={class:"form-group"},Be={class:"input-wrapper"},Ue=["disabled"],$e={key:0,class:"input-icon success"},Ae={key:0,class:"field-error"},Fe={key:1,class:"field-hint"},je={class:"form-group"},Pe={class:"input-wrapper"},Ne=["type","disabled"],Oe=["disabled"],Te={key:0,class:"field-error"},qe={key:1,class:"field-hint"},De={class:"form-group"},Ze=["disabled"],Ye={key:0,class:"error-message"},We=["disabled"],Xe={key:1},Ge={key:2},He=Q({__name:"LoginView",setup(Je){const k=ae(),w=ee(),E=v({local_auth_enabled:!0,registration_enabled:!0}),u=v({username:"",password:""}),n=v({username:"",password:"",name:""}),U=v(!0),o=v(!1),c=v(""),h=v(!1),x=v(!1),C=v(!1),z=v(!1),d=v({}),i=v({}),$=s=>s?s.length<3?"用户名至少3个字符":s.length>20?"用户名不能超过20个字符":/^[a-zA-Z]/.test(s)?/^[a-zA-Z0-9_]+$/.test(s)?null:"用户名只能包含字母、数字和下划线":"用户名必须以字母开头":"请输入用户名",A=(s,e=!1)=>{if(!s)return"请输入密码";if(e){if(s.length<8)return"密码至少8个字符";if(!/[a-zA-Z]/.test(s))return"密码必须包含字母";if(!/[0-9]/.test(s))return"密码必须包含数字"}return null},I=()=>{d.value={};const s=$(u.value.username),e=A(u.value.password);return s&&(d.value.username=s),e&&(d.value.password=e),Object.keys(d.value).length===0},L=()=>{i.value={};const s=$(n.value.username),e=A(n.value.password,!0);return s&&(i.value.username=s),e&&(i.value.password=e),Object.keys(i.value).length===0},F=s=>{d.value[s]&&delete d.value[s]},j=s=>{i.value[s]&&delete i.value[s]},X=O(()=>u.value.username.length>0&&u.value.password.length>0&&Object.keys(d.value).length===0),G=O(()=>n.value.username.length>0&&n.value.password.length>0&&Object.keys(i.value).length===0),H=async()=>{try{const s=await w.getAuthConfig();s&&(E.value=s)}catch(s){console.error("获取认证配置失败:",s)}finally{U.value=!1}},J=()=>{z.value?localStorage.setItem("yprompt_remembered_username",u.value.username):localStorage.removeItem("yprompt_remembered_username")},P=async()=>{if(I()){c.value="",o.value=!0;try{if(await w.loginWithPassword(u.value.username.trim(),u.value.password)){J();const e=k.currentRoute.value.query.redirect;e&&e!=="/login"?k.push(e):k.push("/")}else c.value="用户名或密码错误"}catch(s){c.value="登录失败，请稍后重试",console.error("登录失败:",s)}finally{o.value=!1}}},K=async()=>{if(L()){c.value="",o.value=!0;try{const s=await w.register(n.value.username.trim(),n.value.password,n.value.name.trim()||void 0);s.success?(u.value.username=n.value.username.trim(),u.value.password=n.value.password,h.value=!1,await P()):c.value=s.error||"注册失败，请检查输入信息"}catch(s){c.value="注册失败，请检查输入信息",console.error("注册失败:",s)}finally{o.value=!1}}},N=()=>{h.value=!1,c.value="",n.value={username:"",password:"",name:""},i.value={}};return se(()=>{if(w.isLoggedIn){k.push("/");return}const s=localStorage.getItem("yprompt_remembered_username");s&&(u.value.username=s,z.value=!0),H()}),(s,e)=>(t(),l("div",ue,[a("div",ie,[e[23]||(e[23]=te('<div class="login-header" data-v-1ed00969><div class="logo-wrapper" data-v-1ed00969><div class="logo-icon" data-v-1ed00969>YP</div></div><h1 class="login-title" data-v-1ed00969>YPrompt</h1><p class="login-subtitle" data-v-1ed00969>提示词管理系统</p></div>',1)),U.value?(t(),l("div",de,[...e[14]||(e[14]=[a("div",{class:"loading-spinner"},null,-1),a("p",{class:"loading-text"},"正在加载...",-1)])])):(t(),l("div",ve,[E.value.local_auth_enabled?(t(),l("div",ce,[a("form",{onSubmit:_(P,["prevent"]),class:"login-form"},[a("div",pe,[e[15]||(e[15]=a("label",{for:"username"},"用户名",-1)),a("div",me,[g(a("input",{id:"username","onUpdate:modelValue":e[0]||(e[0]=r=>u.value.username=r),type:"text",class:V(["form-input",{"input-error":d.value.username}]),placeholder:"请输入用户名",disabled:o.value,autocomplete:"username",onBlur:I,onInput:e[1]||(e[1]=r=>F("username"))},null,42,fe),[[R,u.value.username]]),u.value.username&&!d.value.username?(t(),l("div",ge,[f(m(q),{size:18})])):p("",!0)]),d.value.username?(t(),l("div",ye,y(d.value.username),1)):p("",!0)]),a("div",be,[e[16]||(e[16]=a("label",{for:"password"},"密码",-1)),a("div",_e,[g(a("input",{id:"password","onUpdate:modelValue":e[2]||(e[2]=r=>u.value.password=r),type:x.value?"text":"password",class:V(["form-input",{"input-error":d.value.password}]),placeholder:"请输入密码",disabled:o.value,autocomplete:"current-password",onBlur:I,onInput:e[3]||(e[3]=r=>F("password"))},null,42,ke),[[T,u.value.password]]),a("button",{type:"button",class:"password-toggle",onClick:e[4]||(e[4]=r=>x.value=!x.value),disabled:o.value,tabindex:"-1"},[x.value?(t(),b(m(Z),{key:1,size:18})):(t(),b(m(Y),{key:0,size:18}))],8,we)]),d.value.password?(t(),l("div",he,y(d.value.password),1)):p("",!0)]),a("div",xe,[a("label",Ce,[g(a("input",{type:"checkbox","onUpdate:modelValue":e[5]||(e[5]=r=>z.value=r),class:"checkbox-input",disabled:o.value},null,8,ze),[[le,z.value]]),e[17]||(e[17]=a("span",null,"记住我",-1))])]),f(B,{name:"fade"},{default:S(()=>[c.value?(t(),l("div",Ve,[f(m(D),{size:16}),a("span",null,y(c.value),1)])):p("",!0)]),_:1}),a("button",{type:"submit",class:"btn btn-primary btn-block",disabled:o.value||!X.value},[o.value?(t(),b(m(W),{key:0,size:18,class:"spinning"})):p("",!0),o.value?(t(),l("span",Ee,"登录中...")):(t(),l("span",Ie,"登录"))],8,Me),E.value.registration_enabled?(t(),l("div",Le,[e[18]||(e[18]=oe(" 还没有账号？ ",-1)),a("a",{onClick:e[6]||(e[6]=_(r=>h.value=!0,["prevent"])),href:"#",class:"register-btn"},"立即注册")])):p("",!0)],32)])):p("",!0),f(B,{name:"modal"},{default:S(()=>[h.value?(t(),l("div",{key:0,class:"modal-overlay",onClick:_(N,["self"])},[a("div",{class:"modal-content",onClick:e[13]||(e[13]=_(()=>{},["stop"]))},[a("div",Re,[e[19]||(e[19]=a("h2",null,"注册新账号",-1)),a("button",{onClick:N,class:"modal-close","aria-label":"关闭"},[f(m(re),{size:20})])]),a("form",{onSubmit:_(K,["prevent"]),class:"register-form"},[a("div",Se,[e[20]||(e[20]=a("label",{for:"reg-username"},"用户名",-1)),a("div",Be,[g(a("input",{id:"reg-username","onUpdate:modelValue":e[7]||(e[7]=r=>n.value.username=r),type:"text",class:V(["form-input",{"input-error":i.value.username}]),placeholder:"3-20个字符，字母开头",disabled:o.value,autocomplete:"username",onBlur:L,onInput:e[8]||(e[8]=r=>j("username"))},null,42,Ue),[[R,n.value.username]]),n.value.username&&!i.value.username?(t(),l("div",$e,[f(m(q),{size:18})])):p("",!0)]),i.value.username?(t(),l("div",Ae,y(i.value.username),1)):(t(),l("div",Fe,"3-20个字符，字母开头，可包含字母、数字、下划线"))]),a("div",je,[e[21]||(e[21]=a("label",{for:"reg-password"},"密码",-1)),a("div",Pe,[g(a("input",{id:"reg-password","onUpdate:modelValue":e[9]||(e[9]=r=>n.value.password=r),type:C.value?"text":"password",class:V(["form-input",{"input-error":i.value.password}]),placeholder:"至少8个字符，包含字母和数字",disabled:o.value,autocomplete:"new-password",onBlur:L,onInput:e[10]||(e[10]=r=>j("password"))},null,42,Ne),[[T,n.value.password]]),a("button",{type:"button",class:"password-toggle",onClick:e[11]||(e[11]=r=>C.value=!C.value),disabled:o.value,tabindex:"-1"},[C.value?(t(),b(m(Z),{key:1,size:18})):(t(),b(m(Y),{key:0,size:18}))],8,Oe)]),i.value.password?(t(),l("div",Te,y(i.value.password),1)):(t(),l("div",qe,"至少8个字符，包含字母和数字"))]),a("div",De,[e[22]||(e[22]=a("label",{for:"reg-name"},"显示名称（可选）",-1)),g(a("input",{id:"reg-name","onUpdate:modelValue":e[12]||(e[12]=r=>n.value.name=r),type:"text",class:"form-input",placeholder:"留空则使用用户名",disabled:o.value,autocomplete:"name"},null,8,Ze),[[R,n.value.name]])]),f(B,{name:"fade"},{default:S(()=>[c.value?(t(),l("div",Ye,[f(m(D),{size:16}),a("span",null,y(c.value),1)])):p("",!0)]),_:1}),a("button",{type:"submit",class:"btn btn-primary btn-block",disabled:o.value||!G.value},[o.value?(t(),b(m(W),{key:0,size:18,class:"spinning"})):p("",!0),o.value?(t(),l("span",Xe,"注册中...")):(t(),l("span",Ge,"注册"))],8,We)],32)])])):p("",!0)]),_:1})]))])]))}}),es=ne(He,[["__scopeId","data-v-1ed00969"]]);export{es as default};
