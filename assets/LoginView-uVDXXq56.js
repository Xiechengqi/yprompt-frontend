import{c as g,d as B,u as P,r as u,a as U,o as j,b as F,e as l,f as a,g as N,h as d,w as $,i as b,j as h,v as q,n as z,k as v,t as k,l as D,m as w,p as O,q as R,T,s as r,_ as Y}from"./index-BqlgnoXa.js";import{C as Z}from"./check-dWvogUsp.js";/**
 * @license lucide-vue-next v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const W=g("circle-alert",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]);/**
 * @license lucide-vue-next v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const G=g("eye-off",[["path",{d:"M10.733 5.076a10.744 10.744 0 0 1 11.205 6.575 1 1 0 0 1 0 .696 10.747 10.747 0 0 1-1.444 2.49",key:"ct8e1f"}],["path",{d:"M14.084 14.158a3 3 0 0 1-4.242-4.242",key:"151rxh"}],["path",{d:"M17.479 17.499a10.75 10.75 0 0 1-15.417-5.151 1 1 0 0 1 0-.696 10.75 10.75 0 0 1 4.446-5.143",key:"13bj9a"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]]);/**
 * @license lucide-vue-next v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const H=g("eye",[["path",{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0",key:"1nclc0"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);/**
 * @license lucide-vue-next v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const J=g("loader-circle",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]]),K={class:"login-container"},Q={class:"login-card"},X={key:0,class:"loading-state"},ee={key:1,class:"login-content"},se={key:0,class:"login-section"},ae={class:"form-group"},te={class:"input-wrapper"},oe=["disabled"],re={key:0,class:"input-icon success"},le={key:0,class:"field-error"},ne={class:"form-group"},ie={class:"input-wrapper"},ue=["type","disabled"],de=["disabled"],ce={key:0,class:"field-error"},ve={class:"form-options"},pe={class:"checkbox-label"},me=["disabled"],fe={key:0,class:"error-message"},ge=["disabled"],ye={key:1},_e={key:2},be=B({__name:"LoginView",setup(he){const p=F(),y=P(),x=u({local_auth_enabled:!0}),t=u({username:"",password:""}),C=u(!0),n=u(!1),c=u(""),m=u(!1),f=u(!1),o=u({}),L=e=>e?e.length<3?"用户名至少3个字符":e.length>20?"用户名不能超过20个字符":/^[a-zA-Z]/.test(e)?/^[a-zA-Z0-9_]+$/.test(e)?null:"用户名只能包含字母、数字和下划线":"用户名必须以字母开头":"请输入用户名",V=e=>e?null:"请输入密码",_=()=>{o.value={};const e=L(t.value.username),s=V(t.value.password);return e&&(o.value.username=e),s&&(o.value.password=s),Object.keys(o.value).length===0},M=e=>{o.value[e]&&delete o.value[e]},S=U(()=>t.value.username.length>0&&t.value.password.length>0&&Object.keys(o.value).length===0),E=async()=>{try{const e=await y.getAuthConfig();e&&(x.value=e,!t.value.username&&e.login_username&&(t.value.username=e.login_username))}catch(e){console.error("获取认证配置失败:",e)}finally{C.value=!1}},I=()=>{f.value?localStorage.setItem("yprompt_remembered_username",t.value.username):localStorage.removeItem("yprompt_remembered_username")},A=async()=>{if(_()){c.value="",n.value=!0;try{const e=await y.loginWithPassword(t.value.username.trim(),t.value.password);if(e.success){I();const s=p.currentRoute.value.query.redirect;s&&s!=="/login"?p.push(s):p.push("/")}else c.value=e.message||"用户名或密码错误"}catch(e){c.value=e instanceof Error?e.message:"登录失败，请稍后重试",console.error("登录失败:",e)}finally{n.value=!1}}};return j(()=>{if(y.isLoggedIn){p.push("/");return}const e=localStorage.getItem("yprompt_remembered_username");e&&(t.value.username=e,f.value=!0),E()}),(e,s)=>(r(),l("div",K,[a("div",Q,[s[10]||(s[10]=N('<div class="login-header" data-v-4e6c2be9><div class="logo-wrapper" data-v-4e6c2be9><div class="logo-icon" data-v-4e6c2be9>YP</div></div><h1 class="login-title" data-v-4e6c2be9>YPrompt</h1><p class="login-subtitle" data-v-4e6c2be9>提示词管理系统</p></div>',1)),C.value?(r(),l("div",X,[...s[6]||(s[6]=[a("div",{class:"loading-spinner"},null,-1),a("p",{class:"loading-text"},"正在加载...",-1)])])):(r(),l("div",ee,[x.value.local_auth_enabled?(r(),l("div",se,[a("form",{onSubmit:$(A,["prevent"]),class:"login-form"},[a("div",ae,[s[7]||(s[7]=a("label",{for:"username"},"用户名",-1)),a("div",te,[h(a("input",{id:"username","onUpdate:modelValue":s[0]||(s[0]=i=>t.value.username=i),type:"text",class:z(["form-input",{"input-error":o.value.username}]),placeholder:"请输入用户名",disabled:n.value,autocomplete:"username",onBlur:_,onInput:s[1]||(s[1]=i=>M("username"))},null,42,oe),[[q,t.value.username]]),t.value.username&&!o.value.username?(r(),l("div",re,[b(v(Z),{size:18})])):d("",!0)]),o.value.username?(r(),l("div",le,k(o.value.username),1)):d("",!0)]),a("div",ne,[s[8]||(s[8]=a("label",{for:"password"},"密码",-1)),a("div",ie,[h(a("input",{id:"password","onUpdate:modelValue":s[2]||(s[2]=i=>t.value.password=i),type:m.value?"text":"password",class:z(["form-input",{"input-error":o.value.password}]),placeholder:"请输入密码",disabled:n.value,autocomplete:"current-password",onBlur:_,onInput:s[3]||(s[3]=i=>M("password"))},null,42,ue),[[D,t.value.password]]),a("button",{type:"button",class:"password-toggle",onClick:s[4]||(s[4]=i=>m.value=!m.value),disabled:n.value,tabindex:"-1"},[m.value?(r(),w(v(G),{key:1,size:18})):(r(),w(v(H),{key:0,size:18}))],8,de)]),o.value.password?(r(),l("div",ce,k(o.value.password),1)):d("",!0)]),a("div",ve,[a("label",pe,[h(a("input",{type:"checkbox","onUpdate:modelValue":s[5]||(s[5]=i=>f.value=i),class:"checkbox-input",disabled:n.value},null,8,me),[[O,f.value]]),s[9]||(s[9]=a("span",null,"记住我",-1))])]),b(T,{name:"fade"},{default:R(()=>[c.value?(r(),l("div",fe,[b(v(W),{size:16}),a("span",null,k(c.value),1)])):d("",!0)]),_:1}),a("button",{type:"submit",class:"btn btn-primary btn-block",disabled:n.value||!S.value},[n.value?(r(),w(v(J),{key:0,size:18,class:"spinning"})):d("",!0),n.value?(r(),l("span",ye,"登录中...")):(r(),l("span",_e,"登录"))],8,ge)],32)])):d("",!0)]))])]))}}),xe=Y(be,[["__scopeId","data-v-4e6c2be9"]]);export{xe as default};
