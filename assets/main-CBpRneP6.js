const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-_sMxyxIe.js","assets/transform-BZZG3glE.js","assets/linear-BL00OF_N.js","assets/init-Dmth1JHB.js","assets/ordinal-BXh_4XLC.js","assets/time-CTX6g4Ii.js","assets/band-CYfaFsiZ.js","assets/xml-B6ZHh69S.js","assets/path-BQ_ciiJK.js","assets/Tableau10-De_EHWtW.js","assets/selectAll-Bs2-vjWA.js","assets/arc-DDD9nQCo.js","assets/array-DEnAxiAM.js","assets/line-BMUh4KYF.js","assets/pie-DtENPbDd.js","assets/mermaid.core-Cuwf8kxx.js"])))=>i.map(i=>d[i]);
var ak=Object.defineProperty;var lk=(e,t,r)=>t in e?ak(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r;var Ue=(e,t,r)=>lk(e,typeof t!="symbol"?t+"":t,r);function ck(e,t){for(var r=0;r<t.length;r++){const n=t[r];if(typeof n!="string"&&!Array.isArray(n)){for(const o in n)if(o!=="default"&&!(o in e)){const i=Object.getOwnPropertyDescriptor(n,o);i&&Object.defineProperty(e,o,i.get?i:{enumerable:!0,get:()=>n[o]})}}}return Object.freeze(Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}))}(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))n(o);new MutationObserver(o=>{for(const i of o)if(i.type==="childList")for(const l of i.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&n(l)}).observe(document,{childList:!0,subtree:!0});function r(o){const i={};return o.integrity&&(i.integrity=o.integrity),o.referrerPolicy&&(i.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?i.credentials="include":o.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function n(o){if(o.ep)return;o.ep=!0;const i=r(o);fetch(o.href,i)}})();(function(e){var t=(a,p)=>a===p,r=Symbol("solid-track"),n={equals:t},o=fe,i=1,l=2,c={owned:null,cleanups:null,context:null,owner:null},u={},d=null,g=null,x=null,y=null,S=null,T=null,I=0;function b(a,p){let m=y,f=d,j=a.length===0,k=p===void 0?f:p,M=j?c:{owned:null,cleanups:null,context:k?k.context:null,owner:k},_=j?a:()=>a(()=>L(()=>K(M)));d=M,y=null;try{return ze(_,!0)}finally{y=m,d=f}}function h(a,p){p=p?Object.assign({},n,p):n;let m={value:a,observers:null,observerSlots:null,comparator:p.equals||void 0},f=j=>(typeof j=="function"&&(j=j(m.value)),W(m,j));return[oe.bind(m),f]}function v(a,p,m){let f=ne(a,p,!0,i);U(f)}function C(a,p,m){let f=ne(a,p,!1,i);U(f)}function A(a,p,m){o=He;let f=ne(a,p,!1,i);f.user=!0,T?T.push(f):U(f)}function P(a,p,m){m=m?Object.assign({},n,m):n;let f=ne(a,p,!0,0);return f.observers=null,f.observerSlots=null,f.comparator=m.equals||void 0,U(f),oe.bind(f)}function N(a){return a&&typeof a=="object"&&"then"in a}function z(a,p,m){let f,j,k;typeof p=="function"?(f=a,j=p,k={}):(f=!0,j=a,k=p||{});let M=null,_=u,$=!1,B="initialValue"in k,Z=typeof f=="function"&&P(f),X=new Set,[pe,ve]=(k.storage||h)(k.initialValue),[be,Te]=h(void 0),[se,le]=h(void 0,{equals:!1}),[ie,we]=h(B?"ready":"unresolved");function Pe(Ge,Me,ae,ee){return M===Ge&&(M=null,ee!==void 0&&(B=!0),(Ge===_||Me===_)&&k.onHydrated&&queueMicrotask(()=>k.onHydrated(ee,{value:Me})),_=u,Ee(Me,ae)),Me}function Ee(Ge,Me){ze(()=>{Me===void 0&&ve(()=>Ge),we(Me!==void 0?"errored":B?"ready":"unresolved"),Te(Me);for(let ae of X.keys())ae.decrement();X.clear()},!1)}function We(){let Ge=Q,Me=pe(),ae=be();if(ae!==void 0&&!M)throw ae;return y&&y.user,Me}function je(Ge=!0){if(Ge!==!1&&$)return;$=!1;let Me=Z?Z():f;if(Me==null||Me===!1){Pe(M,L(pe));return}let ae,ee=_!==u?_:L(()=>{try{return j(Me,{value:pe(),refetching:Ge})}catch(J){ae=J}});if(ae!==void 0){Pe(M,void 0,xe(ae),Me);return}else if(!N(ee))return Pe(M,ee,void 0,Me),ee;return M=ee,"v"in ee?(ee.s===1?Pe(M,ee.v,void 0,Me):Pe(M,void 0,xe(ee.v),Me),ee):($=!0,queueMicrotask(()=>$=!1),ze(()=>{we(B?"refreshing":"pending"),le()},!1),ee.then(J=>Pe(ee,J,void 0,Me),J=>Pe(ee,void 0,xe(J),Me)))}Object.defineProperties(We,{state:{get:()=>ie()},error:{get:()=>be()},loading:{get(){let Ge=ie();return Ge==="pending"||Ge==="refreshing"}},latest:{get(){if(!B)return We();let Ge=be();if(Ge&&!M)throw Ge;return pe()}}});let pt=d;return Z?v(()=>(pt=d,je(!1))):je(!1),[We,{refetch:Ge=>D(pt,()=>je(Ge)),mutate:ve}]}function L(a){if(y===null)return a();let p=y;y=null;try{return x?x.untrack(a):a()}finally{y=p}}function G(a,p,m){let f=Array.isArray(a),j;return k=>{let M;if(f){M=Array(a.length);for(let $=0;$<a.length;$++)M[$]=a[$]()}else M=a();let _=L(()=>p(M,j,k));return j=M,_}}function R(a){A(()=>L(a))}function F(a){return d===null||(d.cleanups===null?d.cleanups=[a]:d.cleanups.push(a)),a}function D(a,p){let m=d,f=y;d=a,y=null;try{return ze(p,!0)}catch(j){Le(j)}finally{d=m,y=f}}var[O,q]=h(!1),Q;function oe(){let a=g;if(this.sources&&this.state)if(this.state===i)U(this);else{let p=S;S=null,ze(()=>ce(this),!1),S=p}if(y){let p=this.observers?this.observers.length:0;y.sources?(y.sources.push(this),y.sourceSlots.push(p)):(y.sources=[this],y.sourceSlots=[p]),this.observers?(this.observers.push(y),this.observerSlots.push(y.sources.length-1)):(this.observers=[y],this.observerSlots=[y.sources.length-1])}return a&&g.sources.has(this)?this.tValue:this.value}function W(a,p,m){let f=a.value;return(!a.comparator||!a.comparator(f,p))&&(a.value=p,a.observers&&a.observers.length&&ze(()=>{for(let j=0;j<a.observers.length;j+=1){let k=a.observers[j],M=g&&g.running;M&&g.disposed.has(k)||((M?!k.tState:!k.state)&&(k.pure?S.push(k):T.push(k),k.observers&&V(k)),M?k.tState=i:k.state=i)}if(S.length>1e6)throw S=[],new Error},!1)),p}function U(a){if(!a.fn)return;K(a);let p=I;te(a,a.value,p)}function te(a,p,m){let f,j=d,k=y;y=d=a;try{f=a.fn(p)}catch(M){return a.pure&&(a.state=i,a.owned&&a.owned.forEach(K),a.owned=null),a.updatedAt=m+1,Le(M)}finally{y=k,d=j}(!a.updatedAt||a.updatedAt<=m)&&(a.updatedAt!=null&&"observers"in a?W(a,f):a.value=f,a.updatedAt=m)}function ne(a,p,m,f=i,j){let k={fn:a,state:f,updatedAt:null,owned:null,sources:null,sourceSlots:null,cleanups:null,value:p,owner:d,context:d?d.context:null,pure:m};return d===null||d!==c&&(d.owned?d.owned.push(k):d.owned=[k]),k}function Ce(a){let p=g;if(a.state===0)return;if(a.state===l)return ce(a);if(a.suspense&&L(a.suspense.inFallback))return a.suspense.effects.push(a);let m=[a];for(;(a=a.owner)&&(!a.updatedAt||a.updatedAt<I);)a.state&&m.push(a);for(let f=m.length-1;f>=0;f--)if(a=m[f],a.state===i)U(a);else if(a.state===l){let j=S;S=null,ze(()=>ce(a,m[0]),!1),S=j}}function ze(a,p){if(S)return a();let m=!1;p||(S=[]),T?m=!0:T=[],I++;try{let f=a();return Qe(m),f}catch(f){m||(T=null),S=null,Le(f)}}function Qe(a){if(S&&(fe(S),S=null),a)return;let p=T;T=null,p.length&&ze(()=>o(p),!1)}function fe(a){for(let p=0;p<a.length;p++)Ce(a[p])}function He(a){let p,m=0;for(p=0;p<a.length;p++){let f=a[p];f.user?a[m++]=f:Ce(f)}for(p=0;p<m;p++)Ce(a[p])}function ce(a,p){a.state=0;for(let m=0;m<a.sources.length;m+=1){let f=a.sources[m];if(f.sources){let j=f.state;j===i?f!==p&&(!f.updatedAt||f.updatedAt<I)&&Ce(f):j===l&&ce(f,p)}}}function V(a){for(let p=0;p<a.observers.length;p+=1){let m=a.observers[p];!m.state&&(m.state=l,m.pure?S.push(m):T.push(m),m.observers&&V(m))}}function K(a){let p;if(a.sources)for(;a.sources.length;){let m=a.sources.pop(),f=a.sourceSlots.pop(),j=m.observers;if(j&&j.length){let k=j.pop(),M=m.observerSlots.pop();f<j.length&&(k.sourceSlots[M]=f,j[f]=k,m.observerSlots[f]=M)}}if(a.tOwned){for(p=a.tOwned.length-1;p>=0;p--)K(a.tOwned[p]);delete a.tOwned}if(a.owned){for(p=a.owned.length-1;p>=0;p--)K(a.owned[p]);a.owned=null}if(a.cleanups){for(p=a.cleanups.length-1;p>=0;p--)a.cleanups[p]();a.cleanups=null}a.state=0}function xe(a){return a instanceof Error?a:new Error(typeof a=="string"?a:"Unknown error",{cause:a})}function Le(a,p=d){throw xe(a)}var Je=Symbol("fallback");function at(a){for(let p=0;p<a.length;p++)a[p]()}function et(a,p,m={}){let f=[],j=[],k=[],M=0,_=p.length>1?[]:null;return F(()=>at(k)),()=>{let $=a()||[],B=$.length,Z,X;return $[r],L(()=>{let ve,be,Te,se,le,ie,we,Pe,Ee;if(B===0)M!==0&&(at(k),k=[],f=[],j=[],M=0,_&&(_=[])),m.fallback&&(f=[Je],j[0]=b(We=>(k[0]=We,m.fallback())),M=1);else if(M===0){for(j=new Array(B),X=0;X<B;X++)f[X]=$[X],j[X]=b(pe);M=B}else{for(Te=new Array(B),se=new Array(B),_&&(le=new Array(B)),ie=0,we=Math.min(M,B);ie<we&&f[ie]===$[ie];ie++);for(we=M-1,Pe=B-1;we>=ie&&Pe>=ie&&f[we]===$[Pe];we--,Pe--)Te[Pe]=j[we],se[Pe]=k[we],_&&(le[Pe]=_[we]);for(ve=new Map,be=new Array(Pe+1),X=Pe;X>=ie;X--)Ee=$[X],Z=ve.get(Ee),be[X]=Z===void 0?-1:Z,ve.set(Ee,X);for(Z=ie;Z<=we;Z++)Ee=f[Z],X=ve.get(Ee),X!==void 0&&X!==-1?(Te[X]=j[Z],se[X]=k[Z],_&&(le[X]=_[Z]),X=be[X],ve.set(Ee,X)):k[Z]();for(X=ie;X<B;X++)X in Te?(j[X]=Te[X],k[X]=se[X],_&&(_[X]=le[X],_[X](X))):j[X]=b(pe);j=j.slice(0,M=B),f=$.slice(0)}return j});function pe(ve){if(k[X]=ve,_){let[be,Te]=h(X);return _[X]=Te,p($[X],be)}return p($[X])}}}function qr(a,p,m={}){let f=[],j=[],k=[],M=[],_=0,$;return F(()=>at(k)),()=>{let B=a()||[],Z=B.length;return B[r],L(()=>{if(Z===0)return _!==0&&(at(k),k=[],f=[],j=[],_=0,M=[]),m.fallback&&(f=[Je],j[0]=b(pe=>(k[0]=pe,m.fallback())),_=1),j;for(f[0]===Je&&(k[0](),k=[],f=[],j=[],_=0),$=0;$<Z;$++)$<f.length&&f[$]!==B[$]?M[$](()=>B[$]):$>=f.length&&(j[$]=b(X));for(;$<f.length;$++)k[$]();return _=M.length=k.length=Z,f=B.slice(0),j=j.slice(0,_)});function X(pe){k[$]=pe;let[ve,be]=h(B[$]);return M[$]=be,p(ve,$)}}}function ge(a,p){return L(()=>a(p||{}))}var mr=a=>`Stale read from <${a}>.`;function Jr(a){let p="fallback"in a&&{fallback:()=>a.fallback};return P(et(()=>a.each,a.children,p||void 0))}function ko(a){let p="fallback"in a&&{fallback:()=>a.fallback};return P(qr(()=>a.each,a.children,p||void 0))}function Ze(a){let p=a.keyed,m=P(()=>a.when,void 0,void 0),f=p?m:P(m,void 0,{equals:(j,k)=>!j==!k});return P(()=>{let j=f();if(j){let k=a.children;return typeof k=="function"&&k.length>0?L(()=>k(p?j:()=>{if(!L(f))throw mr("Show");return m()})):k}return a.fallback},void 0,void 0)}var _t=a=>P(()=>a());function Pi(a,p,m){let f=m.length,j=p.length,k=f,M=0,_=0,$=p[j-1].nextSibling,B=null;for(;M<j||_<k;){if(p[M]===m[_]){M++,_++;continue}for(;p[j-1]===m[k-1];)j--,k--;if(j===M){let Z=k<f?_?m[_-1].nextSibling:m[k-_]:$;for(;_<k;)a.insertBefore(m[_++],Z)}else if(k===_)for(;M<j;)(!B||!B.has(p[M]))&&p[M].remove(),M++;else if(p[M]===m[k-1]&&m[_]===p[j-1]){let Z=p[--j].nextSibling;a.insertBefore(m[_++],p[M++].nextSibling),a.insertBefore(m[--k],Z),p[j]=m[k]}else{if(!B){B=new Map;let X=_;for(;X<k;)B.set(m[X],X++)}let Z=B.get(p[M]);if(Z!=null)if(_<Z&&Z<k){let X=M,pe=1,ve;for(;++X<j&&X<k&&!((ve=B.get(p[X]))==null||ve!==Z+pe);)pe++;if(pe>Z-_){let be=p[M];for(;_<Z;)a.insertBefore(m[_++],be)}else a.replaceChild(m[_++],p[M++])}else M++;else p[M++].remove()}}}var So="_$DX_DELEGATE";function Ls(a,p,m,f={}){let j;return b(k=>{j=k,p===document?a():Ie(p,a(),p.firstChild?null:void 0,m)},f.owner),()=>{j(),p.textContent=""}}function Y(a,p,m,f){let j,k=()=>{let _=document.createElement("template");return _.innerHTML=a,_.content.firstChild},M=()=>(j||(j=k())).cloneNode(!0);return M.cloneNode=M,M}function mt(a,p=window.document){let m=p[So]||(p[So]=new Set);for(let f=0,j=a.length;f<j;f++){let k=a[f];m.has(k)||(m.add(k),p.addEventListener(k,Zr))}}function ke(a,p,m){m==null?a.removeAttribute(p):a.setAttribute(p,m)}function st(a,p){p==null?a.removeAttribute("class"):a.className=p}function Rt(a,p,m,f){Array.isArray(m)?(a[`$$${p}`]=m[0],a[`$$${p}Data`]=m[1]):a[`$$${p}`]=m}function Ht(a,p,m){if(!p)return m?ke(a,"style"):p;let f=a.style;if(typeof p=="string")return f.cssText=p;typeof m=="string"&&(f.cssText=m=void 0),m||(m={}),p||(p={});let j,k;for(k in m)p[k]==null&&f.removeProperty(k),delete m[k];for(k in p)j=p[k],j!==m[k]&&(f.setProperty(k,j),m[k]=j);return m}function ft(a,p,m){m!=null?a.style.setProperty(p,m):a.style.removeProperty(p)}function $t(a,p,m){return L(()=>a(p,m))}function Ie(a,p,m,f){if(m!==void 0&&!f&&(f=[]),typeof p!="function")return Mr(a,p,f,m);C(j=>Mr(a,p(),j,m),f)}function Zr(a){let p=a.target,m=`$$${a.type}`,f=a.target,j=a.currentTarget,k=$=>Object.defineProperty(a,"target",{configurable:!0,value:$}),M=()=>{let $=p[m];if($&&!p.disabled){let B=p[`${m}Data`];if(B!==void 0?$.call(p,B,a):$.call(p,a),a.cancelBubble)return}return p.host&&typeof p.host!="string"&&!p.host._$host&&p.contains(a.target)&&k(p.host),!0},_=()=>{for(;M()&&(p=p._$host||p.parentNode||p.host););};if(Object.defineProperty(a,"currentTarget",{configurable:!0,get(){return p||document}}),a.composedPath){let $=a.composedPath();k($[0]);for(let B=0;B<$.length-2&&(p=$[B],!!M());B++){if(p._$host){p=p._$host,_();break}if(p.parentNode===j)break}}else _();k(f)}function Mr(a,p,m,f,j){for(;typeof m=="function";)m=m();if(p===m)return m;let k=typeof p,M=f!==void 0;if(a=M&&m[0]&&m[0].parentNode||a,k==="string"||k==="number"){if(k==="number"&&(p=p.toString(),p===m))return m;if(M){let _=m[0];_&&_.nodeType===3?_.data!==p&&(_.data=p):_=document.createTextNode(p),m=To(a,m,f,_)}else m!==""&&typeof m=="string"?m=a.firstChild.data=p:m=a.textContent=p}else if(p==null||k==="boolean")m=To(a,m,f);else{if(k==="function")return C(()=>{let _=p();for(;typeof _=="function";)_=_();m=Mr(a,_,m,f)}),()=>m;if(Array.isArray(p)){let _=[],$=m&&Array.isArray(m);if(Oc(_,p,m,j))return C(()=>m=Mr(a,_,m,f,!0)),()=>m;if(_.length===0){if(m=To(a,m,f),M)return m}else $?m.length===0?xh(a,_,f):Pi(a,m,_):(m&&To(a),xh(a,_));m=_}else if(p.nodeType){if(Array.isArray(m)){if(M)return m=To(a,m,f,p);To(a,m,null,p)}else m==null||m===""||!a.firstChild?a.appendChild(p):a.replaceChild(p,a.firstChild);m=p}}return m}function Oc(a,p,m,f){let j=!1;for(let k=0,M=p.length;k<M;k++){let _=p[k],$=m&&m[a.length],B;if(!(_==null||_===!0||_===!1))if((B=typeof _)=="object"&&_.nodeType)a.push(_);else if(Array.isArray(_))j=Oc(a,_,$)||j;else if(B==="function")if(f){for(;typeof _=="function";)_=_();j=Oc(a,Array.isArray(_)?_:[_],Array.isArray($)?$:[$])||j}else a.push(_),j=!0;else{let Z=String(_);$&&$.nodeType===3&&$.data===Z?a.push($):a.push(document.createTextNode(Z))}}return j}function xh(a,p,m=null){for(let f=0,j=p.length;f<j;f++)a.insertBefore(p[f],m)}function To(a,p,m,f){if(m===void 0)return a.textContent="";let j=f||document.createTextNode("");if(p.length){let k=!1;for(let M=p.length-1;M>=0;M--){let _=p[M];if(j!==_){let $=_.parentNode===a;!k&&!M?$?a.replaceChild(j,_):a.insertBefore(j,m):$&&_.remove()}else k=!0}}else a.insertBefore(j,m);return[j]}var Xx=`/*! tailwindcss v4.1.17 | MIT License | https://tailwindcss.com */
@layer properties{@supports (((-webkit-hyphens:none)) and (not (margin-trim:inline))) or ((-moz-orient:inline) and (not (color:rgb(from red r g b)))){*,:before,:after,::backdrop{--tw-translate-x:0;--tw-translate-y:0;--tw-translate-z:0;--tw-scale-x:1;--tw-scale-y:1;--tw-scale-z:1;--tw-rotate-x:initial;--tw-rotate-y:initial;--tw-rotate-z:initial;--tw-skew-x:initial;--tw-skew-y:initial;--tw-border-style:solid;--tw-leading:initial;--tw-font-weight:initial;--tw-ordinal:initial;--tw-slashed-zero:initial;--tw-numeric-figure:initial;--tw-numeric-spacing:initial;--tw-numeric-fraction:initial;--tw-blur:initial;--tw-brightness:initial;--tw-contrast:initial;--tw-grayscale:initial;--tw-hue-rotate:initial;--tw-invert:initial;--tw-opacity:initial;--tw-saturate:initial;--tw-sepia:initial;--tw-drop-shadow:initial;--tw-drop-shadow-color:initial;--tw-drop-shadow-alpha:100%;--tw-drop-shadow-size:initial;--tw-duration:initial;--tw-ease:initial;--tw-contain-size:initial;--tw-contain-layout:initial;--tw-contain-paint:initial;--tw-contain-style:initial}}}@layer theme{:root,:host{--font-sans:ui-sans-serif,system-ui,sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";--font-mono:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;--color-black:#000;--color-white:#fff;--spacing:.25rem;--font-weight-medium:500;--radius-xs:.125rem;--ease-out:cubic-bezier(0,0,.2,1);--animate-pulse:pulse 2s cubic-bezier(.4,0,.6,1)infinite;--default-transition-duration:.15s;--default-transition-timing-function:cubic-bezier(.4,0,.2,1);--default-font-family:var(--font-sans);--default-mono-font-family:var(--font-mono);--color-grab-pink:#b21c8e;--color-grab-purple:#d239c0;--color-label-tag-border:#730079;--color-label-muted:#767676}}@layer base{*,:after,:before,::backdrop{box-sizing:border-box;border:0 solid;margin:0;padding:0}::file-selector-button{box-sizing:border-box;border:0 solid;margin:0;padding:0}html,:host{-webkit-text-size-adjust:100%;tab-size:4;line-height:1.5;font-family:var(--default-font-family,ui-sans-serif,system-ui,sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji");font-feature-settings:var(--default-font-feature-settings,normal);font-variation-settings:var(--default-font-variation-settings,normal);-webkit-tap-highlight-color:transparent}hr{height:0;color:inherit;border-top-width:1px}abbr:where([title]){-webkit-text-decoration:underline dotted;text-decoration:underline dotted}h1,h2,h3,h4,h5,h6{font-size:inherit;font-weight:inherit}a{color:inherit;-webkit-text-decoration:inherit;-webkit-text-decoration:inherit;-webkit-text-decoration:inherit;text-decoration:inherit}b,strong{font-weight:bolder}code,kbd,samp,pre{font-family:var(--default-mono-font-family,ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace);font-feature-settings:var(--default-mono-font-feature-settings,normal);font-variation-settings:var(--default-mono-font-variation-settings,normal);font-size:1em}small{font-size:80%}sub,sup{vertical-align:baseline;font-size:75%;line-height:0;position:relative}sub{bottom:-.25em}sup{top:-.5em}table{text-indent:0;border-color:inherit;border-collapse:collapse}:-moz-focusring{outline:auto}progress{vertical-align:baseline}summary{display:list-item}ol,ul,menu{list-style:none}img,svg,video,canvas,audio,iframe,embed,object{vertical-align:middle;display:block}img,video{max-width:100%;height:auto}button,input,select,optgroup,textarea{font:inherit;font-feature-settings:inherit;font-variation-settings:inherit;letter-spacing:inherit;color:inherit;opacity:1;background-color:#0000;border-radius:0}::file-selector-button{font:inherit;font-feature-settings:inherit;font-variation-settings:inherit;letter-spacing:inherit;color:inherit;opacity:1;background-color:#0000;border-radius:0}:where(select:is([multiple],[size])) optgroup{font-weight:bolder}:where(select:is([multiple],[size])) optgroup option{padding-inline-start:20px}::file-selector-button{margin-inline-end:4px}::placeholder{opacity:1}@supports (not ((-webkit-appearance:-apple-pay-button))) or (contain-intrinsic-size:1px){::placeholder{color:currentColor}@supports (color:color-mix(in lab, red, red)){::placeholder{color:color-mix(in oklab,currentcolor 50%,transparent)}}}textarea{resize:vertical}::-webkit-search-decoration{-webkit-appearance:none}::-webkit-date-and-time-value{min-height:1lh;text-align:inherit}::-webkit-datetime-edit{display:inline-flex}::-webkit-datetime-edit-fields-wrapper{padding:0}::-webkit-datetime-edit{padding-block:0}::-webkit-datetime-edit-year-field{padding-block:0}::-webkit-datetime-edit-month-field{padding-block:0}::-webkit-datetime-edit-day-field{padding-block:0}::-webkit-datetime-edit-hour-field{padding-block:0}::-webkit-datetime-edit-minute-field{padding-block:0}::-webkit-datetime-edit-second-field{padding-block:0}::-webkit-datetime-edit-millisecond-field{padding-block:0}::-webkit-datetime-edit-meridiem-field{padding-block:0}::-webkit-calendar-picker-indicator{line-height:1}:-moz-ui-invalid{box-shadow:none}button,input:where([type=button],[type=reset],[type=submit]){appearance:button}::file-selector-button{appearance:button}::-webkit-inner-spin-button{height:auto}::-webkit-outer-spin-button{height:auto}[hidden]:where(:not([hidden=until-found])){display:none!important}}@layer components;@layer utilities{.pointer-events-auto{pointer-events:auto}.pointer-events-none{pointer-events:none}.visible{visibility:visible}.absolute{position:absolute}.fixed{position:fixed}.top-0{top:calc(var(--spacing)*0)}.left-0{left:calc(var(--spacing)*0)}.z-2147483645{z-index:2147483645}.z-2147483646{z-index:2147483646}.z-2147483647{z-index:2147483647}.z-\\[2147483645\\]{z-index:2147483645}.container{width:100%}@media (min-width:40rem){.container{max-width:40rem}}@media (min-width:48rem){.container{max-width:48rem}}@media (min-width:64rem){.container{max-width:64rem}}@media (min-width:80rem){.container{max-width:80rem}}@media (min-width:96rem){.container{max-width:96rem}}.m-0{margin:calc(var(--spacing)*0)}.-mt-px{margin-top:-1px}.mb-0\\.5{margin-bottom:calc(var(--spacing)*.5)}.-ml-\\[2px\\]{margin-left:-2px}.ml-1{margin-left:calc(var(--spacing)*1)}.box-border{box-sizing:border-box}.flex{display:flex}.grid{display:grid}.hidden{display:none}.size-fit{width:fit-content;height:fit-content}.h-0{height:calc(var(--spacing)*0)}.h-4{height:calc(var(--spacing)*4)}.h-5{height:calc(var(--spacing)*5)}.h-5\\.5{height:calc(var(--spacing)*5.5)}.h-\\[7px\\]{height:7px}.h-\\[17px\\]{height:17px}.h-\\[18px\\]{height:18px}.h-fit{height:fit-content}.min-h-0{min-height:calc(var(--spacing)*0)}.min-h-4{min-height:calc(var(--spacing)*4)}.w-0{width:calc(var(--spacing)*0)}.w-0\\.5{width:calc(var(--spacing)*.5)}.w-1{width:calc(var(--spacing)*1)}.w-\\[7px\\]{width:7px}.w-\\[17px\\]{width:17px}.w-auto{width:auto}.w-fit{width:fit-content}.w-full{width:100%}.max-w-\\[280px\\]{max-width:280px}.flex-1{flex:1}.shrink{flex-shrink:1}.shrink-0{flex-shrink:0}.-translate-x-1\\/2{--tw-translate-x:calc(calc(1/2*100%)*-1);translate:var(--tw-translate-x)var(--tw-translate-y)}.-translate-y-1\\/2{--tw-translate-y:calc(calc(1/2*100%)*-1);translate:var(--tw-translate-x)var(--tw-translate-y)}.scale-75{--tw-scale-x:75%;--tw-scale-y:75%;--tw-scale-z:75%;scale:var(--tw-scale-x)var(--tw-scale-y)}.scale-100{--tw-scale-x:100%;--tw-scale-y:100%;--tw-scale-z:100%;scale:var(--tw-scale-x)var(--tw-scale-y)}.transform{transform:var(--tw-rotate-x,)var(--tw-rotate-y,)var(--tw-rotate-z,)var(--tw-skew-x,)var(--tw-skew-y,)}.animate-pulse{animation:var(--animate-pulse)}.cursor-crosshair{cursor:crosshair}.cursor-pointer{cursor:pointer}.resize{resize:both}.resize-none{resize:none}.flex-col{flex-direction:column}.items-center{align-items:center}.items-end{align-items:flex-end}.items-start{align-items:flex-start}.justify-between{justify-content:space-between}.justify-center{justify-content:center}.justify-end{justify-content:flex-end}.gap-0\\.5{gap:calc(var(--spacing)*.5)}.gap-1{gap:calc(var(--spacing)*1)}.gap-\\[3px\\]{gap:3px}.gap-\\[5px\\]{gap:5px}.gap-px{gap:1px}.self-stretch{align-self:stretch}.truncate{text-overflow:ellipsis;white-space:nowrap;overflow:hidden}.overflow-hidden{overflow:hidden}.overflow-y-auto{overflow-y:auto}.rounded-\\[1\\.5px\\]{border-radius:1.5px}.rounded-\\[1px\\]{border-radius:1px}.rounded-full{border-radius:3.40282e38px}.rounded-xs{border-radius:var(--radius-xs)}.rounded-t-none{border-top-left-radius:0;border-top-right-radius:0}.rounded-b-xs{border-bottom-right-radius:var(--radius-xs);border-bottom-left-radius:var(--radius-xs)}.border{border-style:var(--tw-border-style);border-width:1px}.\\[border-width\\:0\\.5px\\]{border-width:.5px}.\\[border-top-width\\:0\\.5px\\]{border-top-width:.5px}.border-none{--tw-border-style:none;border-style:none}.border-solid{--tw-border-style:solid;border-style:solid}.border-\\[\\#7e0002\\]{border-color:#7e0002}.border-\\[\\#B3B3B3\\]{border-color:#b3b3b3}.border-grab-purple{border-color:var(--color-grab-purple)}.border-grab-purple\\/40{border-color:#d239c066}@supports (color:color-mix(in lab, red, red)){.border-grab-purple\\/40{border-color:color-mix(in oklab,var(--color-grab-purple)40%,transparent)}}.border-grab-purple\\/50{border-color:#d239c080}@supports (color:color-mix(in lab, red, red)){.border-grab-purple\\/50{border-color:color-mix(in oklab,var(--color-grab-purple)50%,transparent)}}.border-label-tag-border{border-color:var(--color-label-tag-border)}.border-white{border-color:var(--color-white)}.border-t-\\[\\#D9D9D9\\]{border-top-color:#d9d9d9}.bg-\\[\\#F7F7F7\\]{background-color:#f7f7f7}.bg-black{background-color:var(--color-black)}.bg-grab-pink{background-color:var(--color-grab-pink)}.bg-grab-purple{background-color:var(--color-grab-purple)}.bg-grab-purple\\/5{background-color:#d239c00d}@supports (color:color-mix(in lab, red, red)){.bg-grab-purple\\/5{background-color:color-mix(in oklab,var(--color-grab-purple)5%,transparent)}}.bg-grab-purple\\/8{background-color:#d239c014}@supports (color:color-mix(in lab, red, red)){.bg-grab-purple\\/8{background-color:color-mix(in oklab,var(--color-grab-purple)8%,transparent)}}.bg-transparent{background-color:#0000}.bg-white{background-color:var(--color-white)}.p-0{padding:calc(var(--spacing)*0)}.p-1{padding:calc(var(--spacing)*1)}.px-0{padding-inline:calc(var(--spacing)*0)}.px-1\\.5{padding-inline:calc(var(--spacing)*1.5)}.px-2{padding-inline:calc(var(--spacing)*2)}.px-\\[2px\\]{padding-inline:2px}.px-\\[3px\\]{padding-inline:3px}.py-0{padding-block:calc(var(--spacing)*0)}.py-\\[2px\\]{padding-block:2px}.py-\\[3px\\]{padding-block:3px}.py-\\[5px\\]{padding-block:5px}.py-px{padding-block:1px}.pt-1{padding-top:calc(var(--spacing)*1)}.pt-1\\.5{padding-top:calc(var(--spacing)*1.5)}.pr-1{padding-right:calc(var(--spacing)*1)}.pr-1\\.5{padding-right:calc(var(--spacing)*1.5)}.pb-1{padding-bottom:calc(var(--spacing)*1)}.pl-1\\.5{padding-left:calc(var(--spacing)*1.5)}.align-middle{vertical-align:middle}.font-mono{font-family:var(--font-mono)}.font-sans{font-family:var(--font-sans)}.text-\\[9px\\]{font-size:9px}.text-\\[11\\.5px\\]{font-size:11.5px}.text-\\[11px\\]{font-size:11px}.text-\\[12px\\]{font-size:12px}.leading-3{--tw-leading:calc(var(--spacing)*3);line-height:calc(var(--spacing)*3)}.leading-3\\.5{--tw-leading:calc(var(--spacing)*3.5);line-height:calc(var(--spacing)*3.5)}.leading-4{--tw-leading:calc(var(--spacing)*4);line-height:calc(var(--spacing)*4)}.leading-none{--tw-leading:1;line-height:1}.font-medium{--tw-font-weight:var(--font-weight-medium);font-weight:var(--font-weight-medium)}.wrap-break-word{overflow-wrap:break-word}.whitespace-normal{white-space:normal}.whitespace-nowrap{white-space:nowrap}.text-\\[\\#0C0C0C\\]{color:#0c0c0c}.text-\\[\\#47004A\\]{color:#47004a}.text-\\[\\#71717a\\]{color:#71717a}.text-\\[\\#B91C1C\\]{color:#b91c1c}.text-\\[\\#a1a1aa\\]{color:#a1a1aa}.text-\\[\\#c00002\\]{color:#c00002}.text-black{color:var(--color-black)}.text-black\\/50{color:#00000080}@supports (color:color-mix(in lab, red, red)){.text-black\\/50{color:color-mix(in oklab,var(--color-black)50%,transparent)}}.text-label-muted{color:var(--color-label-muted)}.text-label-tag-border{color:var(--color-label-tag-border)}.text-white{color:var(--color-white)}.italic{font-style:italic}.tabular-nums{--tw-numeric-spacing:tabular-nums;font-variant-numeric:var(--tw-ordinal,)var(--tw-slashed-zero,)var(--tw-numeric-figure,)var(--tw-numeric-spacing,)var(--tw-numeric-fraction,)}.antialiased{-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}.opacity-0{opacity:0}.opacity-50{opacity:.5}.opacity-100{opacity:1}.opacity-\\[0\\.99\\]{opacity:.99}.brightness-125{--tw-brightness:brightness(125%);filter:var(--tw-blur,)var(--tw-brightness,)var(--tw-contrast,)var(--tw-grayscale,)var(--tw-hue-rotate,)var(--tw-invert,)var(--tw-saturate,)var(--tw-sepia,)var(--tw-drop-shadow,)}.filter{filter:var(--tw-blur,)var(--tw-brightness,)var(--tw-contrast,)var(--tw-grayscale,)var(--tw-hue-rotate,)var(--tw-invert,)var(--tw-saturate,)var(--tw-sepia,)var(--tw-drop-shadow,)}.filter-\\[drop-shadow\\(0px_0px_4px_\\#51515180\\)\\]{filter:drop-shadow(0 0 4px #51515180)}.transition{transition-property:color,background-color,border-color,outline-color,text-decoration-color,fill,stroke,--tw-gradient-from,--tw-gradient-via,--tw-gradient-to,opacity,box-shadow,transform,translate,scale,rotate,filter,-webkit-backdrop-filter,backdrop-filter,display,content-visibility,overlay,pointer-events;transition-timing-function:var(--tw-ease,var(--default-transition-timing-function));transition-duration:var(--tw-duration,var(--default-transition-duration))}.transition-\\[grid-template-rows\\]{transition-property:grid-template-rows;transition-timing-function:var(--tw-ease,var(--default-transition-timing-function));transition-duration:var(--tw-duration,var(--default-transition-duration))}.transition-\\[width\\,height\\]{transition-property:width,height;transition-timing-function:var(--tw-ease,var(--default-transition-timing-function));transition-duration:var(--tw-duration,var(--default-transition-duration))}.transition-all{transition-property:all;transition-timing-function:var(--tw-ease,var(--default-transition-timing-function));transition-duration:var(--tw-duration,var(--default-transition-duration))}.transition-opacity{transition-property:opacity;transition-timing-function:var(--tw-ease,var(--default-transition-timing-function));transition-duration:var(--tw-duration,var(--default-transition-duration))}.transition-none{transition-property:none}.duration-30{--tw-duration:30ms;transition-duration:30ms}.duration-100{--tw-duration:.1s;transition-duration:.1s}.duration-150{--tw-duration:.15s;transition-duration:.15s}.duration-300{--tw-duration:.3s;transition-duration:.3s}.ease-out{--tw-ease:var(--ease-out);transition-timing-function:var(--ease-out)}.will-change-\\[transform\\,width\\,height\\]{will-change:transform,width,height}.contain-layout{--tw-contain-layout:layout;contain:var(--tw-contain-size,)var(--tw-contain-layout,)var(--tw-contain-paint,)var(--tw-contain-style,)}.outline-none{--tw-outline-style:none;outline-style:none}.select-none{-webkit-user-select:none;user-select:none}.\\[font-synthesis\\:none\\]{font-synthesis:none}@media (hover:hover){.hover\\:scale-105:hover{--tw-scale-x:105%;--tw-scale-y:105%;--tw-scale-z:105%;scale:var(--tw-scale-x)var(--tw-scale-y)}.hover\\:bg-\\[\\#F5F5F5\\]:hover{background-color:#f5f5f5}.hover\\:bg-\\[\\#FEF2F2\\]:hover{background-color:#fef2f2}.hover\\:opacity-100:hover{opacity:1}}}@keyframes spin{0%{transform:rotate(0)}to{transform:rotate(360deg)}}@property --tw-translate-x{syntax:"*";inherits:false;initial-value:0}@property --tw-translate-y{syntax:"*";inherits:false;initial-value:0}@property --tw-translate-z{syntax:"*";inherits:false;initial-value:0}@property --tw-scale-x{syntax:"*";inherits:false;initial-value:1}@property --tw-scale-y{syntax:"*";inherits:false;initial-value:1}@property --tw-scale-z{syntax:"*";inherits:false;initial-value:1}@property --tw-rotate-x{syntax:"*";inherits:false}@property --tw-rotate-y{syntax:"*";inherits:false}@property --tw-rotate-z{syntax:"*";inherits:false}@property --tw-skew-x{syntax:"*";inherits:false}@property --tw-skew-y{syntax:"*";inherits:false}@property --tw-border-style{syntax:"*";inherits:false;initial-value:solid}@property --tw-leading{syntax:"*";inherits:false}@property --tw-font-weight{syntax:"*";inherits:false}@property --tw-ordinal{syntax:"*";inherits:false}@property --tw-slashed-zero{syntax:"*";inherits:false}@property --tw-numeric-figure{syntax:"*";inherits:false}@property --tw-numeric-spacing{syntax:"*";inherits:false}@property --tw-numeric-fraction{syntax:"*";inherits:false}@property --tw-blur{syntax:"*";inherits:false}@property --tw-brightness{syntax:"*";inherits:false}@property --tw-contrast{syntax:"*";inherits:false}@property --tw-grayscale{syntax:"*";inherits:false}@property --tw-hue-rotate{syntax:"*";inherits:false}@property --tw-invert{syntax:"*";inherits:false}@property --tw-opacity{syntax:"*";inherits:false}@property --tw-saturate{syntax:"*";inherits:false}@property --tw-sepia{syntax:"*";inherits:false}@property --tw-drop-shadow{syntax:"*";inherits:false}@property --tw-drop-shadow-color{syntax:"*";inherits:false}@property --tw-drop-shadow-alpha{syntax:"<percentage>";inherits:false;initial-value:100%}@property --tw-drop-shadow-size{syntax:"*";inherits:false}@property --tw-duration{syntax:"*";inherits:false}@property --tw-ease{syntax:"*";inherits:false}@property --tw-contain-size{syntax:"*";inherits:false}@property --tw-contain-layout{syntax:"*";inherits:false}@property --tw-contain-paint{syntax:"*";inherits:false}@property --tw-contain-style{syntax:"*";inherits:false}@keyframes pulse{50%{opacity:.5}}`,ev=["input","textarea","select","searchbox","slider","spinbutton","menuitem","menuitemcheckbox","menuitemradio","option","radio","textbox"],tv=a=>!!a.tagName&&!a.tagName.startsWith("-")&&a.tagName.includes("-"),rv=a=>Array.isArray(a),nv=(a,p=!1)=>{let{composed:m,target:f}=a,j,k;if(f instanceof HTMLElement&&tv(f)&&m){let M=a.composedPath()[0];M instanceof HTMLElement&&(j=M.tagName,k=M.role)}else f instanceof HTMLElement&&(j=f.tagName,k=f.role);return rv(p)?!!(j&&p&&p.some(M=>typeof j=="string"&&M.toLowerCase()===j.toLowerCase()||M===k)):!!(j&&p&&p)},Os=a=>nv(a,ev),vh=a=>{let p=a.tagName.toLowerCase();return!!(p==="input"||p==="textarea"||a instanceof HTMLElement&&a.isContentEditable)},sv=(a,p)=>{let m=document.activeElement;if(m){let f=m;for(;f;){if(vh(f))return!0;f=f.parentElement}}if(a!==void 0&&p!==void 0){let f=document.elementsFromPoint(a,p);for(let j of f)if(vh(j))return!0}return!1},ji="data-react-grab",ov=a=>{var M;let p=document.querySelector(`[${ji}]`);if(p){let _=(M=p.shadowRoot)==null?void 0:M.querySelector(`[${ji}]`);if(_ instanceof HTMLDivElement&&p.shadowRoot)return _}let m=document.createElement("div");m.setAttribute(ji,"true"),m.style.zIndex="2147483646",m.style.position="fixed",m.style.top="0",m.style.left="0";let f=m.attachShadow({mode:"open"});{let _=document.createElement("style");_.textContent=a,f.appendChild(_)}let j=document.createElement("div");j.setAttribute(ji,"true"),f.appendChild(j);let k=document.body??document.documentElement;return k.appendChild(m),setTimeout(()=>{k.contains(m)||k.appendChild(m)},1e3),j},iv="https://react-grab.com",wh=(a,p)=>{let m=p?`&line=${p}`:"";return`${iv}/open-file?url=${encodeURIComponent(a)}${m}`},av="0.0.88",bh=["Meta","Control","Shift","Alt"],lv='<svg width="294" height="294" viewBox="0 0 294 294" fill="none" xmlns="http://www.w3.org/2000/svg"><g clip-path="url(#clip0_0_3)"><mask id="mask0_0_3" style="mask-type:luminance" maskUnits="userSpaceOnUse" x="0" y="0" width="294" height="294"><path d="M294 0H0V294H294V0Z" fill="white"/></mask><g mask="url(#mask0_0_3)"><path d="M144.599 47.4924C169.712 27.3959 194.548 20.0265 212.132 30.1797C227.847 39.2555 234.881 60.3243 231.926 89.516C231.677 92.0069 231.328 94.5423 230.94 97.1058L228.526 110.14C228.517 110.136 228.505 110.132 228.495 110.127C228.486 110.165 228.479 110.203 228.468 110.24L216.255 105.741C216.256 105.736 216.248 105.728 216.248 105.723C207.915 103.125 199.421 101.075 190.82 99.5888L190.696 99.5588L173.526 97.2648L173.511 97.2631C173.492 97.236 173.467 97.2176 173.447 97.1905C163.862 96.2064 154.233 95.7166 144.599 95.7223C134.943 95.7162 125.295 96.219 115.693 97.2286C110.075 105.033 104.859 113.118 100.063 121.453C95.2426 129.798 90.8624 138.391 86.939 147.193C90.8624 155.996 95.2426 164.588 100.063 172.933C104.866 181.302 110.099 189.417 115.741 197.245C115.749 197.245 115.758 197.246 115.766 197.247L115.752 197.27L115.745 197.283L115.754 197.296L126.501 211.013L126.574 211.089C132.136 217.767 138.126 224.075 144.507 229.974L144.609 230.082L154.572 238.287C154.539 238.319 154.506 238.35 154.472 238.38C154.485 238.392 154.499 238.402 154.513 238.412L143.846 247.482L143.827 247.497C126.56 261.128 109.472 268.745 94.8019 268.745C88.5916 268.837 82.4687 267.272 77.0657 264.208C61.3496 255.132 54.3164 234.062 57.2707 204.871C57.528 202.307 57.8806 199.694 58.2904 197.054C28.3363 185.327 9.52301 167.51 9.52301 147.193C9.52301 129.042 24.2476 112.396 50.9901 100.375C53.3443 99.3163 55.7938 98.3058 58.2904 97.3526C57.8806 94.7023 57.528 92.0803 57.2707 89.516C54.3164 60.3243 61.3496 39.2555 77.0657 30.1797C94.6494 20.0265 119.486 27.3959 144.599 47.4924ZM70.6423 201.315C70.423 202.955 70.2229 204.566 70.0704 206.168C67.6686 229.567 72.5478 246.628 83.3615 252.988L83.5176 253.062C95.0399 259.717 114.015 254.426 134.782 238.38C125.298 229.45 116.594 219.725 108.764 209.314C95.8516 207.742 83.0977 205.066 70.6423 201.315ZM80.3534 163.438C77.34 171.677 74.8666 180.104 72.9484 188.664C81.1787 191.224 89.5657 193.247 98.0572 194.724L98.4618 194.813C95.2115 189.865 92.0191 184.66 88.9311 179.378C85.8433 174.097 83.003 168.768 80.3534 163.438ZM60.759 110.203C59.234 110.839 57.7378 111.475 56.27 112.11C34.7788 121.806 22.3891 134.591 22.3891 147.193C22.3891 160.493 36.4657 174.297 60.7494 184.26C63.7439 171.581 67.8124 159.182 72.9104 147.193C67.822 135.23 63.7566 122.855 60.759 110.203ZM98.4137 99.6404C89.8078 101.145 81.3075 103.206 72.9676 105.809C74.854 114.203 77.2741 122.468 80.2132 130.554L80.3059 130.939C82.9938 125.6 85.8049 120.338 88.8834 115.008C91.9618 109.679 95.1544 104.569 98.4137 99.6404ZM94.9258 38.5215C90.9331 38.4284 86.9866 39.3955 83.4891 41.3243C72.6291 47.6015 67.6975 64.5954 70.0424 87.9446L70.0416 88.2194C70.194 89.8208 70.3941 91.4325 70.6134 93.0624C83.0737 89.3364 95.8263 86.6703 108.736 85.0924C116.57 74.6779 125.28 64.9532 134.773 56.0249C119.877 44.5087 105.895 38.5215 94.9258 38.5215ZM205.737 41.3148C202.268 39.398 198.355 38.4308 194.394 38.5099L194.29 38.512C183.321 38.512 169.34 44.4991 154.444 56.0153C163.93 64.9374 172.634 74.6557 180.462 85.064C193.375 86.6345 206.128 89.3102 218.584 93.0624C218.812 91.4325 219.003 89.8118 219.165 88.2098C221.548 64.7099 216.65 47.6164 205.737 41.3148ZM144.552 64.3097C138.104 70.2614 132.054 76.6306 126.443 83.3765C132.39 82.995 138.426 82.8046 144.552 82.8046C150.727 82.8046 156.778 83.0143 162.707 83.3765C157.08 76.6293 151.015 70.2596 144.552 64.3097Z" fill="white"/><path d="M144.598 47.4924C169.712 27.3959 194.547 20.0265 212.131 30.1797C227.847 39.2555 234.88 60.3243 231.926 89.516C231.677 92.0069 231.327 94.5423 230.941 97.1058L228.526 110.14L228.496 110.127C228.487 110.165 228.478 110.203 228.469 110.24L216.255 105.741L216.249 105.723C207.916 103.125 199.42 101.075 190.82 99.5888L190.696 99.5588L173.525 97.2648L173.511 97.263C173.492 97.236 173.468 97.2176 173.447 97.1905C163.863 96.2064 154.234 95.7166 144.598 95.7223C134.943 95.7162 125.295 96.219 115.693 97.2286C110.075 105.033 104.859 113.118 100.063 121.453C95.2426 129.798 90.8622 138.391 86.939 147.193C90.8622 155.996 95.2426 164.588 100.063 172.933C104.866 181.302 110.099 189.417 115.741 197.245L115.766 197.247L115.752 197.27L115.745 197.283L115.754 197.296L126.501 211.013L126.574 211.089C132.136 217.767 138.126 224.075 144.506 229.974L144.61 230.082L154.572 238.287C154.539 238.319 154.506 238.35 154.473 238.38L154.512 238.412L143.847 247.482L143.827 247.497C126.56 261.13 109.472 268.745 94.8018 268.745C88.5915 268.837 82.4687 267.272 77.0657 264.208C61.3496 255.132 54.3162 234.062 57.2707 204.871C57.528 202.307 57.8806 199.694 58.2904 197.054C28.3362 185.327 9.52298 167.51 9.52298 147.193C9.52298 129.042 24.2476 112.396 50.9901 100.375C53.3443 99.3163 55.7938 98.3058 58.2904 97.3526C57.8806 94.7023 57.528 92.0803 57.2707 89.516C54.3162 60.3243 61.3496 39.2555 77.0657 30.1797C94.6493 20.0265 119.486 27.3959 144.598 47.4924ZM70.6422 201.315C70.423 202.955 70.2229 204.566 70.0704 206.168C67.6686 229.567 72.5478 246.628 83.3615 252.988L83.5175 253.062C95.0399 259.717 114.015 254.426 134.782 238.38C125.298 229.45 116.594 219.725 108.764 209.314C95.8515 207.742 83.0977 205.066 70.6422 201.315ZM80.3534 163.438C77.34 171.677 74.8666 180.104 72.9484 188.664C81.1786 191.224 89.5657 193.247 98.0572 194.724L98.4618 194.813C95.2115 189.865 92.0191 184.66 88.931 179.378C85.8433 174.097 83.003 168.768 80.3534 163.438ZM60.7589 110.203C59.234 110.839 57.7378 111.475 56.2699 112.11C34.7788 121.806 22.3891 134.591 22.3891 147.193C22.3891 160.493 36.4657 174.297 60.7494 184.26C63.7439 171.581 67.8124 159.182 72.9103 147.193C67.822 135.23 63.7566 122.855 60.7589 110.203ZM98.4137 99.6404C89.8078 101.145 81.3075 103.206 72.9676 105.809C74.8539 114.203 77.2741 122.468 80.2132 130.554L80.3059 130.939C82.9938 125.6 85.8049 120.338 88.8834 115.008C91.9618 109.679 95.1544 104.569 98.4137 99.6404ZM94.9258 38.5215C90.9331 38.4284 86.9866 39.3955 83.4891 41.3243C72.629 47.6015 67.6975 64.5954 70.0424 87.9446L70.0415 88.2194C70.194 89.8208 70.3941 91.4325 70.6134 93.0624C83.0737 89.3364 95.8262 86.6703 108.736 85.0924C116.57 74.6779 125.28 64.9532 134.772 56.0249C119.877 44.5087 105.895 38.5215 94.9258 38.5215ZM205.737 41.3148C202.268 39.398 198.355 38.4308 194.394 38.5099L194.291 38.512C183.321 38.512 169.34 44.4991 154.443 56.0153C163.929 64.9374 172.634 74.6557 180.462 85.064C193.374 86.6345 206.129 89.3102 218.584 93.0624C218.813 91.4325 219.003 89.8118 219.166 88.2098C221.548 64.7099 216.65 47.6164 205.737 41.3148ZM144.551 64.3097C138.103 70.2614 132.055 76.6306 126.443 83.3765C132.389 82.995 138.427 82.8046 144.551 82.8046C150.727 82.8046 156.779 83.0143 162.707 83.3765C157.079 76.6293 151.015 70.2596 144.551 64.3097Z" fill="#FF40E0"/></g><mask id="mask1_0_3" style="mask-type:luminance" maskUnits="userSpaceOnUse" x="102" y="84" width="161" height="162"><path d="M235.282 84.827L102.261 112.259L129.693 245.28L262.714 217.848L235.282 84.827Z" fill="white"/></mask><g mask="url(#mask1_0_3)"><path d="M136.863 129.916L213.258 141.224C220.669 142.322 222.495 152.179 215.967 155.856L187.592 171.843L184.135 204.227C183.339 211.678 173.564 213.901 169.624 207.526L129.021 141.831C125.503 136.14 130.245 128.936 136.863 129.916Z" fill="#FF40E0" stroke="#FF40E0" stroke-width="0.817337" stroke-linecap="round" stroke-linejoin="round"/></g></g><defs><clipPath id="clip0_0_3"><rect width="294" height="294" fill="white"/></clipPath></defs></svg>',Co=(a,p,m)=>a+(p-a)*m;function kh(a){var p,m,f="";if(typeof a=="string"||typeof a=="number")f+=a;else if(typeof a=="object")if(Array.isArray(a)){var j=a.length;for(p=0;p<j;p++)a[p]&&(m=kh(a[p]))&&(f&&(f+=" "),f+=m)}else for(m in a)a[m]&&(f&&(f+=" "),f+=m);return f}function cv(){for(var a,p,m=0,f="",j=arguments.length;m<j;m++)(a=arguments[m])&&(p=kh(a))&&(f&&(f+=" "),f+=p);return f}var Dc="-",uv=a=>{let p=pv(a),{conflictingClassGroups:m,conflictingClassGroupModifiers:f}=a;return{getClassGroupId:j=>{let k=j.split(Dc);return k[0]===""&&k.length!==1&&k.shift(),Sh(k,p)||dv(j)},getConflictingClassGroupIds:(j,k)=>{let M=m[j]||[];return k&&f[j]?[...M,...f[j]]:M}}},Sh=(a,p)=>{var M;if(a.length===0)return p.classGroupId;let m=a[0],f=p.nextPart.get(m),j=f?Sh(a.slice(1),f):void 0;if(j)return j;if(p.validators.length===0)return;let k=a.join(Dc);return(M=p.validators.find(({validator:_})=>_(k)))==null?void 0:M.classGroupId},Th=/^\[(.+)\]$/,dv=a=>{if(Th.test(a)){let p=Th.exec(a)[1],m=p==null?void 0:p.substring(0,p.indexOf(":"));if(m)return"arbitrary.."+m}},pv=a=>{let{theme:p,prefix:m}=a,f={nextPart:new Map,validators:[]};return mv(Object.entries(a.classGroups),m).forEach(([j,k])=>{$c(k,f,j,p)}),f},$c=(a,p,m,f)=>{a.forEach(j=>{if(typeof j=="string"){let k=j===""?p:Ch(p,j);k.classGroupId=m;return}if(typeof j=="function"){if(hv(j)){$c(j(f),p,m,f);return}p.validators.push({validator:j,classGroupId:m});return}Object.entries(j).forEach(([k,M])=>{$c(M,Ch(p,k),m,f)})})},Ch=(a,p)=>{let m=a;return p.split(Dc).forEach(f=>{m.nextPart.has(f)||m.nextPart.set(f,{nextPart:new Map,validators:[]}),m=m.nextPart.get(f)}),m},hv=a=>a.isThemeGetter,mv=(a,p)=>p?a.map(([m,f])=>{let j=f.map(k=>typeof k=="string"?p+k:typeof k=="object"?Object.fromEntries(Object.entries(k).map(([M,_])=>[p+M,_])):k);return[m,j]}):a,fv=a=>{if(a<1)return{get:()=>{},set:()=>{}};let p=0,m=new Map,f=new Map,j=(k,M)=>{m.set(k,M),p++,p>a&&(p=0,f=m,m=new Map)};return{get(k){let M=m.get(k);if(M!==void 0)return M;if((M=f.get(k))!==void 0)return j(k,M),M},set(k,M){m.has(k)?m.set(k,M):j(k,M)}}},Ph="!",gv=a=>{let{separator:p,experimentalParseClassName:m}=a,f=p.length===1,j=p[0],k=p.length,M=_=>{let $=[],B=0,Z=0,X;for(let se=0;se<_.length;se++){let le=_[se];if(B===0){if(le===j&&(f||_.slice(se,se+k)===p)){$.push(_.slice(Z,se)),Z=se+k;continue}if(le==="/"){X=se;continue}}le==="["?B++:le==="]"&&B--}let pe=$.length===0?_:_.substring(Z),ve=pe.startsWith(Ph),be=ve?pe.substring(1):pe,Te=X&&X>Z?X-Z:void 0;return{modifiers:$,hasImportantModifier:ve,baseClassName:be,maybePostfixModifierPosition:Te}};return m?_=>m({className:_,parseClassName:M}):M},yv=a=>{if(a.length<=1)return a;let p=[],m=[];return a.forEach(f=>{f[0]==="["?(p.push(...m.sort(),f),m=[]):m.push(f)}),p.push(...m.sort()),p},xv=a=>({cache:fv(a.cacheSize),parseClassName:gv(a),...uv(a)}),vv=/\s+/,wv=(a,p)=>{let{parseClassName:m,getClassGroupId:f,getConflictingClassGroupIds:j}=p,k=[],M=a.trim().split(vv),_="";for(let $=M.length-1;$>=0;$-=1){let B=M[$],{modifiers:Z,hasImportantModifier:X,baseClassName:pe,maybePostfixModifierPosition:ve}=m(B),be=!!ve,Te=f(be?pe.substring(0,ve):pe);if(!Te){if(!be){_=B+(_.length>0?" "+_:_);continue}if(Te=f(pe),!Te){_=B+(_.length>0?" "+_:_);continue}be=!1}let se=yv(Z).join(":"),le=X?se+Ph:se,ie=le+Te;if(k.includes(ie))continue;k.push(ie);let we=j(Te,be);for(let Pe=0;Pe<we.length;++Pe){let Ee=we[Pe];k.push(le+Ee)}_=B+(_.length>0?" "+_:_)}return _};function bv(){let a=0,p,m,f="";for(;a<arguments.length;)(p=arguments[a++])&&(m=jh(p))&&(f&&(f+=" "),f+=m);return f}var jh=a=>{if(typeof a=="string")return a;let p,m="";for(let f=0;f<a.length;f++)a[f]&&(p=jh(a[f]))&&(m&&(m+=" "),m+=p);return m};function kv(a,...p){let m,f,j,k=M;function M($){let B=p.reduce((Z,X)=>X(Z),a());return m=xv(B),f=m.cache.get,j=m.cache.set,k=_,_($)}function _($){let B=f($);if(B)return B;let Z=wv($,m);return j($,Z),Z}return function(){return k(bv.apply(null,arguments))}}var Tt=a=>{let p=m=>m[a]||[];return p.isThemeGetter=!0,p},Nh=/^\[(?:([a-z-]+):)?(.+)\]$/i,Sv=/^\d+\/\d+$/,Tv=new Set(["px","full","screen"]),Cv=/^(\d+(\.\d+)?)?(xs|sm|md|lg|xl)$/,Pv=/\d+(%|px|r?em|[sdl]?v([hwib]|min|max)|pt|pc|in|cm|mm|cap|ch|ex|r?lh|cq(w|h|i|b|min|max))|\b(calc|min|max|clamp)\(.+\)|^0$/,jv=/^(rgba?|hsla?|hwb|(ok)?(lab|lch))\(.+\)$/,Nv=/^(inset_)?-?((\d+)?\.?(\d+)[a-z]+|0)_-?((\d+)?\.?(\d+)[a-z]+|0)/,Iv=/^(url|image|image-set|cross-fade|element|(repeating-)?(linear|radial|conic)-gradient)\(.+\)$/,Tn=a=>Po(a)||Tv.has(a)||Sv.test(a),Yn=a=>jo(a,"length",Ov),Po=a=>!!a&&!Number.isNaN(Number(a)),Fc=a=>jo(a,"number",Po),Ni=a=>!!a&&Number.isInteger(Number(a)),Av=a=>a.endsWith("%")&&Po(a.slice(0,-1)),Ye=a=>Nh.test(a),Qn=a=>Cv.test(a),Ev=new Set(["length","size","percentage"]),Mv=a=>jo(a,Ev,Ih),_v=a=>jo(a,"position",Ih),Rv=new Set(["image","url"]),zv=a=>jo(a,Rv,$v),Lv=a=>jo(a,"",Dv),Ii=()=>!0,jo=(a,p,m)=>{let f=Nh.exec(a);return f?f[1]?typeof p=="string"?f[1]===p:p.has(f[1]):m(f[2]):!1},Ov=a=>Pv.test(a)&&!jv.test(a),Ih=()=>!1,Dv=a=>Nv.test(a),$v=a=>Iv.test(a),Fv=()=>{let a=Tt("colors"),p=Tt("spacing"),m=Tt("blur"),f=Tt("brightness"),j=Tt("borderColor"),k=Tt("borderRadius"),M=Tt("borderSpacing"),_=Tt("borderWidth"),$=Tt("contrast"),B=Tt("grayscale"),Z=Tt("hueRotate"),X=Tt("invert"),pe=Tt("gap"),ve=Tt("gradientColorStops"),be=Tt("gradientColorStopPositions"),Te=Tt("inset"),se=Tt("margin"),le=Tt("opacity"),ie=Tt("padding"),we=Tt("saturate"),Pe=Tt("scale"),Ee=Tt("sepia"),We=Tt("skew"),je=Tt("space"),pt=Tt("translate"),Ge=()=>["auto","contain","none"],Me=()=>["auto","hidden","clip","visible","scroll"],ae=()=>["auto",Ye,p],ee=()=>[Ye,p],J=()=>["",Tn,Yn],he=()=>["auto",Po,Ye],Oe=()=>["bottom","center","left","left-bottom","left-top","right","right-bottom","right-top","top"],qe=()=>["solid","dashed","dotted","double","none"],ht=()=>["normal","multiply","screen","overlay","darken","lighten","color-dodge","color-burn","hard-light","soft-light","difference","exclusion","hue","saturation","color","luminosity"],nt=()=>["start","end","center","between","around","evenly","stretch"],lt=()=>["","0",Ye],me=()=>["auto","avoid","all","avoid-page","page","left","right","column"],ye=()=>[Po,Ye];return{cacheSize:500,separator:":",theme:{colors:[Ii],spacing:[Tn,Yn],blur:["none","",Qn,Ye],brightness:ye(),borderColor:[a],borderRadius:["none","","full",Qn,Ye],borderSpacing:ee(),borderWidth:J(),contrast:ye(),grayscale:lt(),hueRotate:ye(),invert:lt(),gap:ee(),gradientColorStops:[a],gradientColorStopPositions:[Av,Yn],inset:ae(),margin:ae(),opacity:ye(),padding:ee(),saturate:ye(),scale:ye(),sepia:lt(),skew:ye(),space:ee(),translate:ee()},classGroups:{aspect:[{aspect:["auto","square","video",Ye]}],container:["container"],columns:[{columns:[Qn]}],"break-after":[{"break-after":me()}],"break-before":[{"break-before":me()}],"break-inside":[{"break-inside":["auto","avoid","avoid-page","avoid-column"]}],"box-decoration":[{"box-decoration":["slice","clone"]}],box:[{box:["border","content"]}],display:["block","inline-block","inline","flex","inline-flex","table","inline-table","table-caption","table-cell","table-column","table-column-group","table-footer-group","table-header-group","table-row-group","table-row","flow-root","grid","inline-grid","contents","list-item","hidden"],float:[{float:["right","left","none","start","end"]}],clear:[{clear:["left","right","both","none","start","end"]}],isolation:["isolate","isolation-auto"],"object-fit":[{object:["contain","cover","fill","none","scale-down"]}],"object-position":[{object:[...Oe(),Ye]}],overflow:[{overflow:Me()}],"overflow-x":[{"overflow-x":Me()}],"overflow-y":[{"overflow-y":Me()}],overscroll:[{overscroll:Ge()}],"overscroll-x":[{"overscroll-x":Ge()}],"overscroll-y":[{"overscroll-y":Ge()}],position:["static","fixed","absolute","relative","sticky"],inset:[{inset:[Te]}],"inset-x":[{"inset-x":[Te]}],"inset-y":[{"inset-y":[Te]}],start:[{start:[Te]}],end:[{end:[Te]}],top:[{top:[Te]}],right:[{right:[Te]}],bottom:[{bottom:[Te]}],left:[{left:[Te]}],visibility:["visible","invisible","collapse"],z:[{z:["auto",Ni,Ye]}],basis:[{basis:ae()}],"flex-direction":[{flex:["row","row-reverse","col","col-reverse"]}],"flex-wrap":[{flex:["wrap","wrap-reverse","nowrap"]}],flex:[{flex:["1","auto","initial","none",Ye]}],grow:[{grow:lt()}],shrink:[{shrink:lt()}],order:[{order:["first","last","none",Ni,Ye]}],"grid-cols":[{"grid-cols":[Ii]}],"col-start-end":[{col:["auto",{span:["full",Ni,Ye]},Ye]}],"col-start":[{"col-start":he()}],"col-end":[{"col-end":he()}],"grid-rows":[{"grid-rows":[Ii]}],"row-start-end":[{row:["auto",{span:[Ni,Ye]},Ye]}],"row-start":[{"row-start":he()}],"row-end":[{"row-end":he()}],"grid-flow":[{"grid-flow":["row","col","dense","row-dense","col-dense"]}],"auto-cols":[{"auto-cols":["auto","min","max","fr",Ye]}],"auto-rows":[{"auto-rows":["auto","min","max","fr",Ye]}],gap:[{gap:[pe]}],"gap-x":[{"gap-x":[pe]}],"gap-y":[{"gap-y":[pe]}],"justify-content":[{justify:["normal",...nt()]}],"justify-items":[{"justify-items":["start","end","center","stretch"]}],"justify-self":[{"justify-self":["auto","start","end","center","stretch"]}],"align-content":[{content:["normal",...nt(),"baseline"]}],"align-items":[{items:["start","end","center","baseline","stretch"]}],"align-self":[{self:["auto","start","end","center","stretch","baseline"]}],"place-content":[{"place-content":[...nt(),"baseline"]}],"place-items":[{"place-items":["start","end","center","baseline","stretch"]}],"place-self":[{"place-self":["auto","start","end","center","stretch"]}],p:[{p:[ie]}],px:[{px:[ie]}],py:[{py:[ie]}],ps:[{ps:[ie]}],pe:[{pe:[ie]}],pt:[{pt:[ie]}],pr:[{pr:[ie]}],pb:[{pb:[ie]}],pl:[{pl:[ie]}],m:[{m:[se]}],mx:[{mx:[se]}],my:[{my:[se]}],ms:[{ms:[se]}],me:[{me:[se]}],mt:[{mt:[se]}],mr:[{mr:[se]}],mb:[{mb:[se]}],ml:[{ml:[se]}],"space-x":[{"space-x":[je]}],"space-x-reverse":["space-x-reverse"],"space-y":[{"space-y":[je]}],"space-y-reverse":["space-y-reverse"],w:[{w:["auto","min","max","fit","svw","lvw","dvw",Ye,p]}],"min-w":[{"min-w":[Ye,p,"min","max","fit"]}],"max-w":[{"max-w":[Ye,p,"none","full","min","max","fit","prose",{screen:[Qn]},Qn]}],h:[{h:[Ye,p,"auto","min","max","fit","svh","lvh","dvh"]}],"min-h":[{"min-h":[Ye,p,"min","max","fit","svh","lvh","dvh"]}],"max-h":[{"max-h":[Ye,p,"min","max","fit","svh","lvh","dvh"]}],size:[{size:[Ye,p,"auto","min","max","fit"]}],"font-size":[{text:["base",Qn,Yn]}],"font-smoothing":["antialiased","subpixel-antialiased"],"font-style":["italic","not-italic"],"font-weight":[{font:["thin","extralight","light","normal","medium","semibold","bold","extrabold","black",Fc]}],"font-family":[{font:[Ii]}],"fvn-normal":["normal-nums"],"fvn-ordinal":["ordinal"],"fvn-slashed-zero":["slashed-zero"],"fvn-figure":["lining-nums","oldstyle-nums"],"fvn-spacing":["proportional-nums","tabular-nums"],"fvn-fraction":["diagonal-fractions","stacked-fractions"],tracking:[{tracking:["tighter","tight","normal","wide","wider","widest",Ye]}],"line-clamp":[{"line-clamp":["none",Po,Fc]}],leading:[{leading:["none","tight","snug","normal","relaxed","loose",Tn,Ye]}],"list-image":[{"list-image":["none",Ye]}],"list-style-type":[{list:["none","disc","decimal",Ye]}],"list-style-position":[{list:["inside","outside"]}],"placeholder-color":[{placeholder:[a]}],"placeholder-opacity":[{"placeholder-opacity":[le]}],"text-alignment":[{text:["left","center","right","justify","start","end"]}],"text-color":[{text:[a]}],"text-opacity":[{"text-opacity":[le]}],"text-decoration":["underline","overline","line-through","no-underline"],"text-decoration-style":[{decoration:[...qe(),"wavy"]}],"text-decoration-thickness":[{decoration:["auto","from-font",Tn,Yn]}],"underline-offset":[{"underline-offset":["auto",Tn,Ye]}],"text-decoration-color":[{decoration:[a]}],"text-transform":["uppercase","lowercase","capitalize","normal-case"],"text-overflow":["truncate","text-ellipsis","text-clip"],"text-wrap":[{text:["wrap","nowrap","balance","pretty"]}],indent:[{indent:ee()}],"vertical-align":[{align:["baseline","top","middle","bottom","text-top","text-bottom","sub","super",Ye]}],whitespace:[{whitespace:["normal","nowrap","pre","pre-line","pre-wrap","break-spaces"]}],break:[{break:["normal","words","all","keep"]}],hyphens:[{hyphens:["none","manual","auto"]}],content:[{content:["none",Ye]}],"bg-attachment":[{bg:["fixed","local","scroll"]}],"bg-clip":[{"bg-clip":["border","padding","content","text"]}],"bg-opacity":[{"bg-opacity":[le]}],"bg-origin":[{"bg-origin":["border","padding","content"]}],"bg-position":[{bg:[...Oe(),_v]}],"bg-repeat":[{bg:["no-repeat",{repeat:["","x","y","round","space"]}]}],"bg-size":[{bg:["auto","cover","contain",Mv]}],"bg-image":[{bg:["none",{"gradient-to":["t","tr","r","br","b","bl","l","tl"]},zv]}],"bg-color":[{bg:[a]}],"gradient-from-pos":[{from:[be]}],"gradient-via-pos":[{via:[be]}],"gradient-to-pos":[{to:[be]}],"gradient-from":[{from:[ve]}],"gradient-via":[{via:[ve]}],"gradient-to":[{to:[ve]}],rounded:[{rounded:[k]}],"rounded-s":[{"rounded-s":[k]}],"rounded-e":[{"rounded-e":[k]}],"rounded-t":[{"rounded-t":[k]}],"rounded-r":[{"rounded-r":[k]}],"rounded-b":[{"rounded-b":[k]}],"rounded-l":[{"rounded-l":[k]}],"rounded-ss":[{"rounded-ss":[k]}],"rounded-se":[{"rounded-se":[k]}],"rounded-ee":[{"rounded-ee":[k]}],"rounded-es":[{"rounded-es":[k]}],"rounded-tl":[{"rounded-tl":[k]}],"rounded-tr":[{"rounded-tr":[k]}],"rounded-br":[{"rounded-br":[k]}],"rounded-bl":[{"rounded-bl":[k]}],"border-w":[{border:[_]}],"border-w-x":[{"border-x":[_]}],"border-w-y":[{"border-y":[_]}],"border-w-s":[{"border-s":[_]}],"border-w-e":[{"border-e":[_]}],"border-w-t":[{"border-t":[_]}],"border-w-r":[{"border-r":[_]}],"border-w-b":[{"border-b":[_]}],"border-w-l":[{"border-l":[_]}],"border-opacity":[{"border-opacity":[le]}],"border-style":[{border:[...qe(),"hidden"]}],"divide-x":[{"divide-x":[_]}],"divide-x-reverse":["divide-x-reverse"],"divide-y":[{"divide-y":[_]}],"divide-y-reverse":["divide-y-reverse"],"divide-opacity":[{"divide-opacity":[le]}],"divide-style":[{divide:qe()}],"border-color":[{border:[j]}],"border-color-x":[{"border-x":[j]}],"border-color-y":[{"border-y":[j]}],"border-color-s":[{"border-s":[j]}],"border-color-e":[{"border-e":[j]}],"border-color-t":[{"border-t":[j]}],"border-color-r":[{"border-r":[j]}],"border-color-b":[{"border-b":[j]}],"border-color-l":[{"border-l":[j]}],"divide-color":[{divide:[j]}],"outline-style":[{outline:["",...qe()]}],"outline-offset":[{"outline-offset":[Tn,Ye]}],"outline-w":[{outline:[Tn,Yn]}],"outline-color":[{outline:[a]}],"ring-w":[{ring:J()}],"ring-w-inset":["ring-inset"],"ring-color":[{ring:[a]}],"ring-opacity":[{"ring-opacity":[le]}],"ring-offset-w":[{"ring-offset":[Tn,Yn]}],"ring-offset-color":[{"ring-offset":[a]}],shadow:[{shadow:["","inner","none",Qn,Lv]}],"shadow-color":[{shadow:[Ii]}],opacity:[{opacity:[le]}],"mix-blend":[{"mix-blend":[...ht(),"plus-lighter","plus-darker"]}],"bg-blend":[{"bg-blend":ht()}],filter:[{filter:["","none"]}],blur:[{blur:[m]}],brightness:[{brightness:[f]}],contrast:[{contrast:[$]}],"drop-shadow":[{"drop-shadow":["","none",Qn,Ye]}],grayscale:[{grayscale:[B]}],"hue-rotate":[{"hue-rotate":[Z]}],invert:[{invert:[X]}],saturate:[{saturate:[we]}],sepia:[{sepia:[Ee]}],"backdrop-filter":[{"backdrop-filter":["","none"]}],"backdrop-blur":[{"backdrop-blur":[m]}],"backdrop-brightness":[{"backdrop-brightness":[f]}],"backdrop-contrast":[{"backdrop-contrast":[$]}],"backdrop-grayscale":[{"backdrop-grayscale":[B]}],"backdrop-hue-rotate":[{"backdrop-hue-rotate":[Z]}],"backdrop-invert":[{"backdrop-invert":[X]}],"backdrop-opacity":[{"backdrop-opacity":[le]}],"backdrop-saturate":[{"backdrop-saturate":[we]}],"backdrop-sepia":[{"backdrop-sepia":[Ee]}],"border-collapse":[{border:["collapse","separate"]}],"border-spacing":[{"border-spacing":[M]}],"border-spacing-x":[{"border-spacing-x":[M]}],"border-spacing-y":[{"border-spacing-y":[M]}],"table-layout":[{table:["auto","fixed"]}],caption:[{caption:["top","bottom"]}],transition:[{transition:["none","all","","colors","opacity","shadow","transform",Ye]}],duration:[{duration:ye()}],ease:[{ease:["linear","in","out","in-out",Ye]}],delay:[{delay:ye()}],animate:[{animate:["none","spin","ping","pulse","bounce",Ye]}],transform:[{transform:["","gpu","none"]}],scale:[{scale:[Pe]}],"scale-x":[{"scale-x":[Pe]}],"scale-y":[{"scale-y":[Pe]}],rotate:[{rotate:[Ni,Ye]}],"translate-x":[{"translate-x":[pt]}],"translate-y":[{"translate-y":[pt]}],"skew-x":[{"skew-x":[We]}],"skew-y":[{"skew-y":[We]}],"transform-origin":[{origin:["center","top","top-right","right","bottom-right","bottom","bottom-left","left","top-left",Ye]}],accent:[{accent:["auto",a]}],appearance:[{appearance:["none","auto"]}],cursor:[{cursor:["auto","default","pointer","wait","text","move","help","not-allowed","none","context-menu","progress","cell","crosshair","vertical-text","alias","copy","no-drop","grab","grabbing","all-scroll","col-resize","row-resize","n-resize","e-resize","s-resize","w-resize","ne-resize","nw-resize","se-resize","sw-resize","ew-resize","ns-resize","nesw-resize","nwse-resize","zoom-in","zoom-out",Ye]}],"caret-color":[{caret:[a]}],"pointer-events":[{"pointer-events":["none","auto"]}],resize:[{resize:["none","y","x",""]}],"scroll-behavior":[{scroll:["auto","smooth"]}],"scroll-m":[{"scroll-m":ee()}],"scroll-mx":[{"scroll-mx":ee()}],"scroll-my":[{"scroll-my":ee()}],"scroll-ms":[{"scroll-ms":ee()}],"scroll-me":[{"scroll-me":ee()}],"scroll-mt":[{"scroll-mt":ee()}],"scroll-mr":[{"scroll-mr":ee()}],"scroll-mb":[{"scroll-mb":ee()}],"scroll-ml":[{"scroll-ml":ee()}],"scroll-p":[{"scroll-p":ee()}],"scroll-px":[{"scroll-px":ee()}],"scroll-py":[{"scroll-py":ee()}],"scroll-ps":[{"scroll-ps":ee()}],"scroll-pe":[{"scroll-pe":ee()}],"scroll-pt":[{"scroll-pt":ee()}],"scroll-pr":[{"scroll-pr":ee()}],"scroll-pb":[{"scroll-pb":ee()}],"scroll-pl":[{"scroll-pl":ee()}],"snap-align":[{snap:["start","end","center","align-none"]}],"snap-stop":[{snap:["normal","always"]}],"snap-type":[{snap:["none","x","y","both"]}],"snap-strictness":[{snap:["mandatory","proximity"]}],touch:[{touch:["auto","none","manipulation"]}],"touch-x":[{"touch-pan":["x","left","right"]}],"touch-y":[{"touch-pan":["y","up","down"]}],"touch-pz":["touch-pinch-zoom"],select:[{select:["none","text","all","auto"]}],"will-change":[{"will-change":["auto","scroll","contents","transform",Ye]}],fill:[{fill:[a,"none"]}],"stroke-w":[{stroke:[Tn,Yn,Fc]}],stroke:[{stroke:[a,"none"]}],sr:["sr-only","not-sr-only"],"forced-color-adjust":[{"forced-color-adjust":["auto","none"]}]},conflictingClassGroups:{overflow:["overflow-x","overflow-y"],overscroll:["overscroll-x","overscroll-y"],inset:["inset-x","inset-y","start","end","top","right","bottom","left"],"inset-x":["right","left"],"inset-y":["top","bottom"],flex:["basis","grow","shrink"],gap:["gap-x","gap-y"],p:["px","py","ps","pe","pt","pr","pb","pl"],px:["pr","pl"],py:["pt","pb"],m:["mx","my","ms","me","mt","mr","mb","ml"],mx:["mr","ml"],my:["mt","mb"],size:["w","h"],"font-size":["leading"],"fvn-normal":["fvn-ordinal","fvn-slashed-zero","fvn-figure","fvn-spacing","fvn-fraction"],"fvn-ordinal":["fvn-normal"],"fvn-slashed-zero":["fvn-normal"],"fvn-figure":["fvn-normal"],"fvn-spacing":["fvn-normal"],"fvn-fraction":["fvn-normal"],"line-clamp":["display","overflow"],rounded:["rounded-s","rounded-e","rounded-t","rounded-r","rounded-b","rounded-l","rounded-ss","rounded-se","rounded-ee","rounded-es","rounded-tl","rounded-tr","rounded-br","rounded-bl"],"rounded-s":["rounded-ss","rounded-es"],"rounded-e":["rounded-se","rounded-ee"],"rounded-t":["rounded-tl","rounded-tr"],"rounded-r":["rounded-tr","rounded-br"],"rounded-b":["rounded-br","rounded-bl"],"rounded-l":["rounded-tl","rounded-bl"],"border-spacing":["border-spacing-x","border-spacing-y"],"border-w":["border-w-s","border-w-e","border-w-t","border-w-r","border-w-b","border-w-l"],"border-w-x":["border-w-r","border-w-l"],"border-w-y":["border-w-t","border-w-b"],"border-color":["border-color-s","border-color-e","border-color-t","border-color-r","border-color-b","border-color-l"],"border-color-x":["border-color-r","border-color-l"],"border-color-y":["border-color-t","border-color-b"],"scroll-m":["scroll-mx","scroll-my","scroll-ms","scroll-me","scroll-mt","scroll-mr","scroll-mb","scroll-ml"],"scroll-mx":["scroll-mr","scroll-ml"],"scroll-my":["scroll-mt","scroll-mb"],"scroll-p":["scroll-px","scroll-py","scroll-ps","scroll-pe","scroll-pt","scroll-pr","scroll-pb","scroll-pl"],"scroll-px":["scroll-pr","scroll-pl"],"scroll-py":["scroll-pt","scroll-pb"],touch:["touch-x","touch-y","touch-pz"],"touch-x":["touch"],"touch-y":["touch"],"touch-pz":["touch"]},conflictingClassGroupModifiers:{"font-size":["leading"]}}},Uv=kv(Fv),fn=(...a)=>Uv(cv(a)),Bv=Y("<div style=overflow:visible>"),Ai=a=>{let[p,m]=h(a.bounds.x),[f,j]=h(a.bounds.y),[k,M]=h(a.bounds.width),[_,$]=h(a.bounds.height),[B,Z]=h(1),X=!1,pe=null,ve=null,be=a.bounds,Te=!1,se=()=>a.lerpFactor!==void 0?a.lerpFactor:a.variant==="drag"?.7:.95,le=()=>{if(Te)return;Te=!0;let ie=()=>{let we=Co(p(),be.x,se()),Pe=Co(f(),be.y,se()),Ee=Co(k(),be.width,se()),We=Co(_(),be.height,se());m(we),j(Pe),M(Ee),$(We),Math.abs(we-be.x)<.5&&Math.abs(Pe-be.y)<.5&&Math.abs(Ee-be.width)<.5&&Math.abs(We-be.height)<.5?(pe=null,Te=!1):pe=requestAnimationFrame(ie)};pe=requestAnimationFrame(ie)};return A(G(()=>a.bounds,ie=>{if(be=ie,!X){m(be.x),j(be.y),M(be.width),$(be.height),X=!0;return}le()})),A(()=>{a.variant==="grabbed"&&a.createdAt&&(ve=window.setTimeout(()=>{Z(0)},1500))}),F(()=>{pe!==null&&(cancelAnimationFrame(pe),pe=null),ve!==null&&(window.clearTimeout(ve),ve=null),Te=!1}),ge(Ze,{get when(){return a.visible!==!1},get children(){var ie=Bv();return C(we=>{var Pe=fn("fixed box-border",a.variant==="drag"&&"pointer-events-none",a.variant!=="drag"&&"pointer-events-auto",a.variant==="grabbed"&&"z-2147483645",a.variant!=="grabbed"&&"z-2147483646",a.variant==="drag"&&"border border-solid border-grab-purple/40 bg-grab-purple/5 will-change-[transform,width,height] cursor-crosshair",a.variant==="selection"&&"border border-solid border-grab-purple/50 bg-grab-purple/8 transition-opacity duration-100 ease-out",a.variant==="grabbed"&&"border border-solid border-grab-purple/50 bg-grab-purple/8",a.variant==="processing"&&!a.isCompleted&&"border border-solid border-grab-purple/50 bg-grab-purple/8",a.variant==="processing"&&a.isCompleted&&"border border-solid border-grab-purple/50 bg-grab-purple/8"),Ee=`${f()}px`,We=`${p()}px`,je=`${k()}px`,pt=`${_()}px`,Ge=a.bounds.borderRadius,Me=a.bounds.transform,ae=a.isFading?0:B(),ee=a.variant==="drag"?"layout paint size":void 0;return Pe!==we.e&&st(ie,we.e=Pe),Ee!==we.t&&ft(ie,"top",we.t=Ee),We!==we.a&&ft(ie,"left",we.a=We),je!==we.o&&ft(ie,"width",we.o=je),pt!==we.i&&ft(ie,"height",we.i=pt),Ge!==we.n&&ft(ie,"border-radius",we.n=Ge),Me!==we.s&&ft(ie,"transform",we.s=Me),ae!==we.h&&ft(ie,"opacity",we.h=ae),ee!==we.r&&ft(ie,"contain",we.r=ee),we},{e:void 0,t:void 0,a:void 0,o:void 0,i:void 0,n:void 0,s:void 0,h:void 0,r:void 0}),ie}})},qv=a=>{let p=a.lerpFactor??.3,m=a.convergenceThreshold??.5,[f,j]=h(a.x()),[k,M]=h(a.y()),_=a.x(),$=a.y(),B=null,Z=!1,X=()=>{let ve=Co(f(),_,p),be=Co(k(),$,p);j(ve),M(be),Math.abs(ve-_)<m&&Math.abs(be-$)<m?B=null:B=requestAnimationFrame(X)},pe=()=>{B===null&&(B=requestAnimationFrame(X))};return A(()=>{if(_=a.x(),$=a.y(),!Z){j(_),M($),Z=!0;return}pe()}),F(()=>{B!==null&&(cancelAnimationFrame(B),B=null)}),{x:f,y:k}},Wv=Y('<canvas class="fixed top-0 left-0 pointer-events-none z-[2147483645]">'),Gv=a=>{let p,m=null,f=0,j=0,k=1,M=qv({x:()=>a.mouseX,y:()=>a.mouseY,lerpFactor:.3}),_=()=>{p&&(k=Math.max(window.devicePixelRatio||1,2),f=window.innerWidth,j=window.innerHeight,p.width=f*k,p.height=j*k,p.style.width=`${f}px`,p.style.height=`${j}px`,m=p.getContext("2d"),m&&m.scale(k,k))},$=()=>{m&&(m.clearRect(0,0,f,j),m.strokeStyle="rgba(210, 57, 192)",m.lineWidth=1,m.beginPath(),m.moveTo(M.x(),0),m.lineTo(M.x(),j),m.moveTo(0,M.y()),m.lineTo(f,M.y()),m.stroke())};return A(()=>{_(),$();let B=()=>{_(),$()};window.addEventListener("resize",B),F(()=>{window.removeEventListener("resize",B)})}),A(()=>{M.x(),M.y(),$()}),ge(Ze,{get when(){return a.visible!==!1},get children(){var B=Wv(),Z=p;return typeof Z=="function"?$t(Z,B):p=B,B}})},Hv=a=>{let p,[m,f]=h(!1),j=()=>typeof window<"u"&&(!!window.SpeechRecognition||!!window.webkitSpeechRecognition),k=()=>{if(!j())return;let $=window.SpeechRecognition||window.webkitSpeechRecognition;if(!$)return;p=new $,p.continuous=!0,p.interimResults=!0,p.lang=navigator.language||"en-US";let B="",Z="";p.onresult=X=>{let pe=a.getCurrentValue(),ve;B&&pe.endsWith(B)||pe===Z&&B?ve=pe.slice(0,-B.length):ve=pe;let be="",Te="";for(let le=X.resultIndex;le<X.results.length;le++){let ie=X.results[le][0].transcript;X.results[le].isFinal?be+=ie:Te+=ie}B=Te;let se=ve+be+Te;Z=se,a.onTranscript(se)},p.onerror=()=>{f(!1)},p.onend=()=>{f(!1)},p.start(),f(!0)},M=()=>{p&&(p.stop(),p=void 0),f(!1)},_=()=>{m()?M():k()};return F(()=>{M()}),{isListening:m,isSupported:j,start:k,stop:M,toggle:_}},Vv=Y('<svg xmlns=http://www.w3.org/2000/svg viewBox="0 0 24 24"fill=none stroke=currentColor stroke-linecap=round stroke-linejoin=round stroke-width=2><path d="M12 6H6a2 2 0 0 0-2 2v10a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2v-6"></path><path d="M11 13l9-9"></path><path d="M15 4h5v5">'),Kv=a=>{let p=()=>a.size??12;return(()=>{var m=Vv();return C(f=>{var j=p(),k=p(),M=a.class;return j!==f.e&&ke(m,"width",f.e=j),k!==f.t&&ke(m,"height",f.t=k),M!==f.a&&ke(m,"class",f.a=M),f},{e:void 0,t:void 0,a:void 0}),m})()},Yv=Y('<svg xmlns=http://www.w3.org/2000/svg viewBox="0 0 24 24"fill=none stroke=currentColor stroke-width=2 stroke-linecap=round stroke-linejoin=round><path d="M12 2a3 3 0 0 0-3 3v7a3 3 0 0 0 6 0V5a3 3 0 0 0-3-3Z"></path><path d="M19 10v2a7 7 0 0 1-14 0v-2"></path><line x1=12 x2=12 y1=19 y2=22>'),Qv=a=>{let p=()=>a.size??12;return(()=>{var m=Yv();return C(f=>{var j=p(),k=p(),M=a.class;return j!==f.e&&ke(m,"width",f.e=j),k!==f.t&&ke(m,"height",f.t=k),M!==f.a&&ke(m,"class",f.a=M),f},{e:void 0,t:void 0,a:void 0}),m})()},Jv=Y('<svg xmlns=http://www.w3.org/2000/svg viewBox="0 0 22 19"fill=none><path d="M6.76263 18.6626C7.48251 18.6626 7.95474 18.1682 7.95474 17.4895C7.95474 17.1207 7.80474 16.8576 7.58683 16.6361L5.3018 14.4137L2.84621 12.3589L2.44374 13.0037L5.92137 13.1622H17.9232C20.4842 13.1622 21.593 12.021 21.593 9.47237V3.66983C21.593 1.10875 20.4842 0 17.9232 0H12.5414C11.8179 0 11.3018 0.545895 11.3018 1.21695C11.3018 1.888 11.8179 2.43389 12.5414 2.43389H17.8424C18.7937 2.43389 19.1897 2.83653 19.1897 3.78784V9.35747C19.1897 10.3257 18.7937 10.7314 17.8424 10.7314H5.92137L2.44374 10.8832L2.84621 11.5281L5.3018 9.47993L7.58683 7.2606C7.80474 7.03914 7.95474 6.7693 7.95474 6.40049C7.95474 5.72854 7.48251 5.22747 6.76263 5.22747C6.46129 5.22747 6.12975 5.36905 5.89231 5.6096L0.376815 11.0425C0.134921 11.2777 0 11.6141 0 11.9452C0 12.2728 0.134921 12.6158 0.376815 12.848L5.89231 18.2871C6.12975 18.5276 6.46129 18.6626 6.76263 18.6626Z"fill=currentColor>'),Fa=a=>{let p=()=>a.size??12;return(()=>{var m=Jv();return C(f=>{var j=p(),k=p()*19/22,M=a.class;return j!==f.e&&ke(m,"width",f.e=j),k!==f.t&&ke(m,"height",f.t=k),M!==f.a&&ke(m,"class",f.a=M),f},{e:void 0,t:void 0,a:void 0}),m})()},Zv=Y('<svg xmlns=http://www.w3.org/2000/svg viewBox="0 0 24 24"fill=none><path d="M17.65 6.35C16.2 4.9 14.21 4 12 4C7.58 4 4.01 7.58 4.01 12C4.01 16.42 7.58 20 12 20C15.73 20 18.84 17.45 19.73 14H17.65C16.83 16.33 14.61 18 12 18C8.69 18 6 15.31 6 12C6 8.69 8.69 6 12 6C13.66 6 15.14 6.69 16.22 7.78L13 11H20V4L17.65 6.35Z"fill=currentColor>'),Xv=a=>{let p=()=>a.size??12;return(()=>{var m=Zv();return C(f=>{var j=p(),k=p(),M=a.class;return j!==f.e&&ke(m,"width",f.e=j),k!==f.t&&ke(m,"height",f.t=k),M!==f.a&&ke(m,"class",f.a=M),f},{e:void 0,t:void 0,a:void 0}),m})()},ew=Y('<div style="background-image:linear-gradient(in oklab 180deg, oklab(88.7% 0.086 -0.058) 0%, oklab(83.2% 0.132 -0.089) 100%)"><span>'),tw=Y('<div class="contain-layout shrink-0 flex items-center w-fit h-4 rounded-[1px] gap-1 px-[3px] [border-width:0.5px] border-solid border-[#B3B3B3] py-0 bg-[#F7F7F7]"><span class="text-[#0C0C0C] text-[11.5px] leading-3.5 shrink-0 font-medium w-fit h-fit">'),rw=Y('<div class="contain-layout shrink-0 flex items-center w-fit h-4 rounded-[1px] gap-1 px-[3px] [border-width:0.5px] border-solid border-white py-0"><span class="text-[#0C0C0C] text-[11.5px] leading-3.5 shrink-0 font-medium w-fit h-fit">&gt;'),nw=Y('<div class="absolute w-0 h-0"style="border-left:8px solid transparent;border-right:8px solid transparent">'),sw=Y('<div role=button><div class="text-black text-[12px] leading-4 shrink-0 font-sans font-medium w-fit h-fit">'),ow=Y('<div class="[font-synthesis:none] contain-layout shrink-0 flex flex-col items-start px-2 py-[5px] w-auto h-fit self-stretch [border-top-width:0.5px] border-t-solid border-t-[#D9D9D9] antialiased rounded-t-none rounded-b-xs -mt-px"style="background-image:linear-gradient(in oklab 180deg, oklab(100% 0 0) 0%, oklab(96.1% 0 0) 5.92%)">'),iw=Y('<div class="contain-layout shrink-0 flex items-center justify-end gap-[5px] w-full h-fit"><button class="contain-layout shrink-0 flex items-center justify-center px-[3px] py-px rounded-xs bg-white [border-width:0.5px] border-solid border-[#B3B3B3] cursor-pointer transition-all hover:bg-[#F5F5F5] h-[17px]"><span class="text-black text-[11px] leading-3.5 font-sans font-medium">No</span></button><button class="contain-layout shrink-0 flex items-center justify-center gap-1 px-[3px] py-px rounded-xs bg-white [border-width:0.5px] border-solid border-[#7e0002] cursor-pointer transition-all hover:bg-[#FEF2F2] h-[17px]"><span class="text-[#B91C1C] text-[11px] leading-3.5 font-sans font-medium">Yes'),aw=Y('<div class="contain-layout shrink-0 flex flex-col justify-center items-end gap-1 w-fit h-fit"><div class="contain-layout shrink-0 flex items-center gap-1 pt-1 px-1.5 w-full h-fit"><span class="text-black text-[12px] leading-4 shrink-0 font-sans font-medium w-fit h-fit">Discard?'),lw=Y('<div class="contain-layout shrink-0 flex items-center justify-end gap-[5px] w-full h-fit"><button class="contain-layout shrink-0 flex items-center justify-center gap-1 px-[3px] py-px rounded-xs bg-white [border-width:0.5px] border-solid border-[#B3B3B3] cursor-pointer transition-all hover:bg-[#F5F5F5] h-[17px]"><span class="text-black text-[11px] leading-3.5 font-sans font-medium">Retry</span></button><button class="contain-layout shrink-0 flex items-center justify-center gap-1 px-[3px] py-px rounded-xs bg-white [border-width:0.5px] border-solid border-[#B3B3B3] cursor-pointer transition-all hover:bg-[#F5F5F5] h-[17px]"><span class="text-black text-[11px] leading-3.5 font-sans font-medium">Ok'),cw=Y('<div class="contain-layout shrink-0 flex flex-col justify-center items-end gap-1 w-fit h-fit max-w-[280px]"><div class="contain-layout shrink-0 flex items-center gap-1 pt-1 px-1.5 w-full h-fit"><span class="text-[#B91C1C] text-[12px] leading-4 font-sans font-medium">'),uw=Y('<button class="contain-layout shrink-0 flex items-center justify-center px-[3px] py-px rounded-xs bg-white [border-width:0.5px] border-solid border-[#7e0002] cursor-pointer transition-all hover:bg-[#FEF2F2] h-[17px]"><span class="text-[#B91C1C] text-[11px] leading-3.5 font-sans font-medium">Undo'),dw=Y('<button class="contain-layout shrink-0 flex items-center justify-center px-[3px] py-px rounded-xs bg-white [border-width:0.5px] border-solid border-[#B3B3B3] cursor-pointer transition-all hover:bg-[#F5F5F5] h-[17px]"><span class="text-black text-[11px] leading-3.5 font-sans font-medium">Reply'),pw=Y('<button class="contain-layout shrink-0 flex items-center justify-center gap-1 px-[3px] py-px rounded-xs bg-white [border-width:0.5px] border-solid border-[#B3B3B3] cursor-pointer transition-all hover:bg-[#F5F5F5] h-[17px]"><span class="text-black text-[11px] leading-3.5 font-sans font-medium">'),hw=Y('<div class="contain-layout shrink-0 flex items-center justify-end gap-[5px] w-full h-fit">'),mw=Y('<div class="[font-synthesis:none] contain-layout shrink-0 flex flex-col justify-center items-end rounded-xs bg-white antialiased w-fit h-fit"><div class="contain-layout shrink-0 flex items-center gap-1 pt-1.5 pb-1 px-1.5 w-full h-fit"><span class="text-black text-[12px] leading-4 shrink-0 font-sans font-medium w-fit h-fit tabular-nums">'),fw=Y('<button data-react-grab-ignore-events class="contain-layout shrink-0 flex flex-col items-start rounded-xs bg-white [border-width:0.5px] border-solid border-[#B3B3B3] p-1 size-fit cursor-pointer ml-1 transition-none hover:scale-105"><div data-react-grab-ignore-events class="shrink-0 w-[7px] h-[7px] rounded-[1px] bg-black pointer-events-none">'),gw=Y('<div class="shrink-0 flex justify-between items-end w-full min-h-4"><textarea data-react-grab-ignore-events class="text-black text-[12px] leading-4 font-medium bg-transparent border-none outline-none resize-none flex-1 p-0 m-0 opacity-50 wrap-break-word overflow-y-auto"placeholder="type to edit"rows=1 disabled style=field-sizing:content;min-height:16px;max-height:95px;scrollbar-width:none>'),yw=Y('<div class="contain-layout shrink-0 flex flex-col justify-center items-start gap-1 w-fit h-fit max-w-[280px]"><div class="contain-layout shrink-0 flex items-center gap-1 pt-1 px-1.5 w-auto h-fit"><div class="contain-layout flex items-center px-0 py-px w-auto h-fit rounded-[1.5px] gap-[3px]"><span class="text-[12px] leading-4 font-sans font-medium w-auto h-fit whitespace-normal text-[#71717a] animate-pulse tabular-nums">'),Ah=Y('<div class="contain-layout shrink-0 flex items-center gap-px w-fit h-fit">'),xw=Y('<span class="text-label-muted text-[12px] leading-4 shrink-0 font-sans font-medium w-fit h-fit">Double click to edit'),vw=Y('<div class="contain-layout shrink-0 flex flex-col items-start px-[3px] py-[3px] rounded-xs bg-white [border-width:0.5px] border-solid border-[#B3B3B3] size-fit">'),ww=Y('<span class="text-label-muted text-[12px] leading-4 shrink-0 font-sans font-medium w-fit h-fit">Press'),bw=Y('<div class="contain-layout shrink-0 flex items-center justify-center px-[3px] py-[2px] rounded-xs bg-white [border-width:0.5px] border-solid border-[#B3B3B3] size-fit"><span class="text-[9px] leading-none font-medium text-black">Esc'),kw=Y('<span class="text-label-muted text-[12px] leading-4 shrink-0 font-sans font-medium w-fit h-fit">to dismiss'),Sw=Y('<div class="contain-layout shrink-0 flex items-center gap-1 w-fit h-fit">'),Tw=Y('<div class="contain-layout shrink-0 flex flex-col justify-center items-start gap-1 w-fit h-fit"><div></div><div class="grid transition-[grid-template-rows] duration-30 ease-out self-stretch"><div>'),Cw=Y('<div class="shrink-0 flex items-center gap-0.5 w-full mb-0.5 overflow-hidden"><span class="text-[#a1a1aa] text-[9px] leading-3 shrink-0">>previously:</span><span class="text-[#a1a1aa] text-[9px] leading-3 italic truncate whitespace-nowrap">'),Pw=Y("<button>"),jw=Y('<button class="contain-layout shrink-0 flex flex-col items-start px-[3px] py-[3px] rounded-xs bg-white [border-width:0.5px] border-solid border-[#B3B3B3] size-fit cursor-pointer transition-all hover:scale-105">'),Nw=Y('<div class="shrink-0 flex justify-between items-end w-full min-h-4"><textarea data-react-grab-ignore-events class="text-black text-[12px] leading-4 font-medium bg-transparent border-none outline-none resize-none flex-1 p-0 m-0 wrap-break-word overflow-y-auto"rows=1 style=field-sizing:content;min-height:16px;max-height:95px;scrollbar-width:none></textarea><div class="flex items-center gap-0.5 ml-1 w-[17px] h-[17px] justify-end">'),Iw=Y('<div class="contain-layout shrink-0 flex flex-col justify-center items-start gap-1 w-fit h-fit max-w-[280px]"><div>'),Aw=Y('<div data-react-grab-ignore-events class="fixed font-sans antialiased transition-opacity duration-300 ease-out filter-[drop-shadow(0px_0px_4px_#51515180)] select-none"style=z-index:2147483647><div class="[font-synthesis:none] contain-layout flex items-center gap-[5px] rounded-xs bg-white antialiased w-fit h-fit p-0">'),Eh=8,Mh=4,Ew=400,Ua=a=>{let[p,m]=h(!1),f=()=>{var k;m(!0),(k=a.onHoverChange)==null||k.call(a,!0)},j=()=>{var k;m(!1),(k=a.onHoverChange)==null||k.call(a,!1)};return(()=>{var k=ew(),M=k.firstChild;return Rt(k,"click",a.onClick),k.addEventListener("mouseleave",j),k.addEventListener("mouseenter",f),Ie(M,()=>a.tagName),Ie(k,ge(Ze,{get when(){return a.isClickable||a.forceShowIcon},get children(){return ge(Kv,{size:10,get class(){return fn("text-label-tag-border transition-all duration-100",p()||a.forceShowIcon?"opacity-100 scale-100":"opacity-0 scale-75 -ml-[2px] w-0")}})}}),null),C(_=>{var $=fn("contain-layout flex items-center px-[3px] py-0 h-4 rounded-[1px] gap-0.5 [border-width:0.5px] border-solid border-label-tag-border",a.shrink&&"shrink-0 w-fit",a.isClickable&&"cursor-pointer"),B=fn("text-[#47004A] text-[11.5px] leading-3.5 shrink-0 w-fit h-fit font-medium");return $!==_.e&&st(k,_.e=$),B!==_.t&&st(M,_.t=B),_},{e:void 0,t:void 0}),k})()},_h=a=>(()=>{var p=tw(),m=p.firstChild;return Ie(m,()=>a.name),p})(),Rh=()=>rw(),Mw=a=>{let p=()=>a.color??"white";return(()=>{var m=nw();return C(f=>Ht(m,{left:`${a.leftPx}px`,...a.position==="bottom"?{top:"0",transform:"translateX(-50%) translateY(-100%)"}:{bottom:"0",transform:"translateX(-50%) translateY(100%)"},...a.position==="bottom"?{"border-bottom":`8px solid ${p()}`}:{"border-top":`8px solid ${p()}`}},f)),m})()},zh=a=>{let p=()=>a.hasAgent?"Selecting":a.hasParent?"Copy":"Click to copy";return(()=>{var m=sw(),f=m.firstChild;return Rt(m,"click",a.onClick),Ie(f,p),C(()=>st(m,fn("contain-layout shrink-0 flex items-center px-0 py-px w-fit h-[18px] rounded-[1.5px] gap-[3px]",a.asButton&&"cursor-pointer",a.dimmed&&"opacity-50 hover:opacity-100 transition-opacity"))),m})()},No=a=>(()=>{var p=ow();return Ie(p,()=>a.children),p})(),fr=null,Lh=a=>{let p=Symbol(),m=j=>{var k;fr===p&&(Os(j)||(j.code==="Enter"||j.code==="Escape")&&(j.preventDefault(),j.stopPropagation(),(k=a.onConfirm)==null||k.call(a)))},f=()=>{fr=p};return R(()=>{fr=p,window.addEventListener("keydown",m,{capture:!0})}),F(()=>{fr===p&&(fr=null),window.removeEventListener("keydown",m,{capture:!0})}),(()=>{var j=aw();return j.firstChild,j.$$click=f,j.$$pointerdown=f,Ie(j,ge(No,{get children(){var k=iw(),M=k.firstChild,_=M.nextSibling;return _.firstChild,Rt(M,"click",a.onCancel),Rt(_,"click",a.onConfirm),Ie(_,ge(Fa,{size:10,class:"text-[#c00002]"}),null),k}}),null),j})()},Oh=50,_w=a=>{let p=Symbol(),m=k=>{var M,_;fr===p&&(Os(k)||(k.code==="Enter"?(k.preventDefault(),k.stopPropagation(),(M=a.onRetry)==null||M.call(a)):k.code==="Escape"&&(k.preventDefault(),k.stopPropagation(),(_=a.onAcknowledge)==null||_.call(a))))},f=()=>{fr=p},j=()=>{let k=a.error;return k.length<=Oh?k:`${k.slice(0,Oh)}`};return R(()=>{fr=p,window.addEventListener("keydown",m,{capture:!0})}),F(()=>{fr===p&&(fr=null),window.removeEventListener("keydown",m,{capture:!0})}),(()=>{var k=cw(),M=k.firstChild,_=M.firstChild;return k.$$click=f,k.$$pointerdown=f,Ie(_,j),Ie(k,ge(No,{get children(){var $=lw(),B=$.firstChild;B.firstChild;var Z=B.nextSibling;return Rt(B,"click",a.onRetry),Ie(B,ge(Xv,{size:10,class:"text-black/50"}),null),Rt(Z,"click",a.onAcknowledge),$}}),null),C(()=>ke(_,"title",a.error)),k})()},Rw=a=>{let p=Symbol(),m=j=>{var k;fr===p&&(Os(j)||(j.code==="Enter"||j.code==="Escape")&&(j.preventDefault(),j.stopPropagation(),(k=a.onDismiss)==null||k.call(a)))},f=()=>{fr=p};return R(()=>{fr=p,window.addEventListener("keydown",m,{capture:!0})}),F(()=>{fr===p&&(fr=null),window.removeEventListener("keydown",m,{capture:!0})}),(()=>{var j=mw(),k=j.firstChild,M=k.firstChild;return j.$$click=f,j.$$pointerdown=f,Ie(M,()=>a.statusText),Ie(j,ge(Ze,{get when(){return a.onDismiss||a.onUndo||a.onReply},get children(){return ge(No,{get children(){var _=hw();return Ie(_,ge(Ze,{get when(){return _t(()=>!!a.supportsUndo)()&&a.onUndo},get children(){var $=uw();return $.$$click=()=>{var B;return(B=a.onUndo)==null?void 0:B.call(a)},$}}),null),Ie(_,ge(Ze,{get when(){return _t(()=>!!a.supportsFollowUp)()&&a.onReply},get children(){var $=dw();return $.$$click=()=>{var B;return(B=a.onReply)==null?void 0:B.call(a)},$}}),null),Ie(_,ge(Ze,{get when(){return a.onDismiss},get children(){var $=pw(),B=$.firstChild;return $.$$click=()=>{var Z;return(Z=a.onDismiss)==null?void 0:Z.call(a)},Ie(B,()=>a.dismissButtonText??"Ok"),Ie($,ge(Fa,{size:10,class:"text-black/50"}),null),$}}),null),_}})}}),null),j})()},Ba=a=>{let p,m,f=!1,j=null,k=null,[M,_]=h(0),[$,B]=h(0),[Z,X]=h("bottom"),[pe,ve]=h(0),[be,Te]=h(!1),[se,le]=h(!1),ie=Hv({onTranscript:me=>{var ye;return(ye=a.onInputChange)==null?void 0:ye.call(a,me)},getCurrentValue:()=>a.inputValue??""}),we=()=>a.status!=="copying"&&a.status!=="copied"&&a.status!=="fading",Pe=()=>{if(p&&!f){let me=p.getBoundingClientRect();_(me.width),B(me.height)}},Ee=me=>{f=me},We=()=>{ve(me=>me+1)},je,pt=()=>{Te(!1),je&&clearTimeout(je),je=setTimeout(()=>{Te(!0)},Ew)},Ge=me=>{var ye;Os(me)||me.code==="Enter"&&be()&&!a.isInputExpanded&&we()&&(me.preventDefault(),me.stopPropagation(),me.stopImmediatePropagation(),(ye=a.onToggleExpand)==null||ye.call(a))};R(()=>{Pe(),window.addEventListener("scroll",We,!0),window.addEventListener("resize",We),window.addEventListener("keydown",Ge,{capture:!0}),pt()}),F(()=>{window.removeEventListener("scroll",We,!0),window.removeEventListener("resize",We),window.removeEventListener("keydown",Ge,{capture:!0}),je&&clearTimeout(je)}),A(()=>{let me=`${a.tagName??""}:${a.componentName??""}`;me!==k&&(k=me,pt())}),A(()=>{a.tagName,a.componentName,a.statusText,a.inputValue,a.hasAgent,a.isInputExpanded,a.isPendingDismiss,a.error,a.isPendingAbort,requestAnimationFrame(Pe)}),A(()=>{a.visible&&requestAnimationFrame(Pe)}),A(()=>{a.status,requestAnimationFrame(Pe)}),A(()=>{a.isInputExpanded&&m?setTimeout(()=>{m==null||m.focus()},0):ie.stop()});let Me=()=>{pe();let me=a.selectionBounds,ye=M(),ot=$(),De=ye>0&&ot>0,_e=me&&me.width>0&&me.height>0;if(!De||!_e)return j??{left:-9999,top:-9999,arrowLeft:0};let Ve=window.innerWidth,ct=window.innerHeight,Xe=me.x+me.width/2,vt=a.mouseX??Xe,Ct=me.y+me.height,Pt=me.y,At=vt-ye/2,wt=Ct+Eh+Mh;At+ye>Ve-8&&(At=Ve-ye-8),At<8&&(At=8);let ar=ot+Eh+Mh;wt+ot<=ct-8?X("bottom"):(wt=Pt-ar,X("top")),wt<8&&(wt=8);let gr=Math.max(12,Math.min(vt-At,ye-12)),lr={left:At,top:wt,arrowLeft:gr};return j=lr,le(!0),lr},ae=me=>{var ye,ot,De;if(me.stopPropagation(),me.stopImmediatePropagation(),me.code==="Enter"&&!me.shiftKey){if(me.preventDefault(),!((ye=a.inputValue)!=null&&ye.trim()))return;ie.stop(),(ot=a.onSubmit)==null||ot.call(a)}else me.code==="Escape"&&(me.preventDefault(),ie.stop(),(De=a.onConfirmDismiss)==null||De.call(a))},ee=me=>{var ot;let ye=me.target;(ot=a.onInputChange)==null||ot.call(a,ye.value)},J=()=>a.tagName||"element",he=me=>{me.stopPropagation(),me.stopImmediatePropagation(),a.filePath&&a.onOpen&&a.onOpen()},Oe=()=>!!(a.filePath&&a.onOpen),qe=me=>{me.stopPropagation(),me.stopImmediatePropagation()},ht=me=>{qe(me),we()&&a.isInputExpanded&&!a.isPendingDismiss&&m&&m.focus()},nt=()=>{var me,ye;a.isInputExpanded&&!((me=a.inputValue)!=null&&me.trim())||(ie.stop(),(ye=a.onSubmit)==null||ye.call(a))},lt=()=>se()&&(a.status==="copied"||a.status==="fading");return ge(Ze,{get when(){return _t(()=>a.visible!==!1)()&&(a.selectionBounds||lt())},get children(){var me=Aw(),ye=me.firstChild;me.$$click=qe,me.$$mousedown=qe,me.$$pointerdown=ht;var ot=p;return typeof ot=="function"?$t(ot,me):p=me,Ie(me,ge(Mw,{get position(){return Z()},get leftPx(){return Me().arrowLeft}}),ye),Ie(me,ge(Ze,{get when(){return _t(()=>a.status==="copied"||a.status==="fading")()&&!a.error},get children(){return ge(Rw,{get statusText(){return _t(()=>!!a.hasAgent)()?a.statusText??"Completed":"Copied"},get supportsUndo(){return a.supportsUndo},get supportsFollowUp(){return a.supportsFollowUp},get dismissButtonText(){return a.dismissButtonText},get onDismiss(){return a.onDismiss},get onUndo(){return a.onUndo},get onReply(){return a.onReply}})}}),ye),Ie(ye,ge(Ze,{get when(){return _t(()=>a.status==="copying")()&&!a.isPendingAbort},get children(){var De=yw(),_e=De.firstChild,Ve=_e.firstChild,ct=Ve.firstChild;return Ie(ct,()=>a.statusText??"Grabbing"),Ie(De,ge(No,{get children(){var Xe=gw(),vt=Xe.firstChild,Ct=m;return typeof Ct=="function"?$t(Ct,vt):m=vt,Ie(Xe,ge(Ze,{get when(){return a.onAbort},get children(){var Pt=fw();return Pt.$$click=At=>{var wt;At.stopPropagation(),(wt=a.onAbort)==null||wt.call(a)},Pt.$$pointerup=At=>{var wt;At.stopPropagation(),(wt=a.onAbort)==null||wt.call(a)},Pt.$$mousedown=At=>At.stopPropagation(),Pt.$$pointerdown=At=>At.stopPropagation(),Pt}}),null),C(()=>vt.value=a.inputValue??""),Xe}}),null),De}}),null),Ie(ye,ge(Ze,{get when(){return _t(()=>a.status==="copying")()&&a.isPendingAbort},get children(){return ge(Lh,{get onConfirm(){return a.onConfirmAbort},get onCancel(){return a.onCancelAbort}})}}),null),Ie(ye,ge(Ze,{get when(){return _t(()=>!!we())()&&!a.isInputExpanded},get children(){var De=Tw(),_e=De.firstChild,Ve=_e.nextSibling,ct=Ve.firstChild;return Ie(_e,ge(zh,{onClick:nt,shrink:!0,get hasParent(){return!!a.componentName},get hasAgent(){return a.hasAgent}}),null),Ie(_e,ge(Ze,{get when(){return a.componentName},get children(){var Xe=Ah();return Ie(Xe,ge(_h,{get name(){return a.componentName}}),null),Ie(Xe,ge(Rh,{}),null),Ie(Xe,ge(Ua,{get tagName(){return J()},get isClickable(){return Oe()},onClick:he,onHoverChange:Ee,shrink:!0}),null),Xe}}),null),Ie(_e,ge(Ze,{get when(){return!a.componentName},get children(){return ge(Ua,{get tagName(){return J()},get isClickable(){return Oe()},onClick:he,onHoverChange:Ee,shrink:!0})}}),null),Ie(ct,ge(No,{get children(){var Xe=Sw();return Ie(Xe,ge(Ze,{get when(){return a.hasAgent},get children(){return[xw(),(()=>{var vt=vw();return Ie(vt,ge(Fa,{size:10,class:"opacity-[0.99] text-black"})),vt})()]}}),null),Ie(Xe,ge(Ze,{get when(){return!a.hasAgent},get children(){return[ww(),bw(),kw()]}}),null),Xe}})),C(Xe=>{var vt=fn("contain-layout shrink-0 flex items-center gap-1 pt-1 w-fit h-fit pl-1.5",a.componentName?"pr-1.5":"pr-1"),Ct=be()?"1fr":"0fr",Pt=fn("overflow-hidden min-h-0",!be()&&"w-0");return vt!==Xe.e&&st(_e,Xe.e=vt),Ct!==Xe.t&&ft(Ve,"grid-template-rows",Xe.t=Ct),Pt!==Xe.a&&st(ct,Xe.a=Pt),Xe},{e:void 0,t:void 0,a:void 0}),De}}),null),Ie(ye,ge(Ze,{get when(){return _t(()=>!!(we()&&a.isInputExpanded))()&&!a.isPendingDismiss},get children(){var De=Iw(),_e=De.firstChild;return Ie(_e,ge(zh,{onClick:nt,dimmed:!0,shrink:!0,get hasParent(){return!!a.componentName},get hasAgent(){return a.hasAgent}}),null),Ie(_e,ge(Ze,{get when(){return a.componentName},get children(){var Ve=Ah();return Ie(Ve,ge(_h,{get name(){return a.componentName}}),null),Ie(Ve,ge(Rh,{}),null),Ie(Ve,ge(Ua,{get tagName(){return J()},get isClickable(){return Oe()},onClick:he,onHoverChange:Ee,shrink:!0,forceShowIcon:!0}),null),Ve}}),null),Ie(_e,ge(Ze,{get when(){return!a.componentName},get children(){return ge(Ua,{get tagName(){return J()},get isClickable(){return Oe()},onClick:he,onHoverChange:Ee,shrink:!0,forceShowIcon:!0})}}),null),Ie(De,ge(No,{get children(){return[ge(Ze,{get when(){return a.replyToPrompt},get children(){var Ve=Cw(),ct=Ve.firstChild,Xe=ct.nextSibling;return Ie(Xe,()=>a.replyToPrompt),Ve}}),(()=>{var Ve=Nw(),ct=Ve.firstChild,Xe=ct.nextSibling;ct.$$keydown=ae,ct.$$input=ee;var vt=m;return typeof vt=="function"?$t(vt,ct):m=ct,Ie(Xe,ge(Ze,{get when(){return _t(()=>!!(a.hasAgent&&ie.isSupported()))()&&!a.inputValue},get children(){var Ct=Pw();return Rt(Ct,"click",ie.toggle),Ie(Ct,ge(Qv,{size:11,get class(){return ie.isListening()?"animate-pulse":""}})),C(Pt=>{var At=fn("contain-layout shrink-0 flex items-center justify-center px-[2px] py-[2px] rounded-xs [border-width:0.5px] border-solid size-fit cursor-pointer transition-all hover:scale-105",ie.isListening()?"bg-grab-purple border-grab-purple text-white":"bg-white border-[#B3B3B3] text-black"),wt=ie.isListening()?"Stop listening":"Start voice input";return At!==Pt.e&&st(Ct,Pt.e=At),wt!==Pt.t&&ke(Ct,"title",Pt.t=wt),Pt},{e:void 0,t:void 0}),Ct}}),null),Ie(Xe,ge(Ze,{get when(){return a.inputValue},get children(){var Ct=jw();return Ct.$$click=nt,Ie(Ct,ge(Fa,{size:10,class:"opacity-[0.99] text-black"})),Ct}}),null),C(()=>ke(ct,"placeholder",ie.isListening()?"listening...":"type prompt")),C(()=>ct.value=a.inputValue??""),Ve})()]}}),null),C(()=>st(_e,fn("contain-layout shrink-0 flex items-center gap-1 pt-1 w-fit h-fit pl-1.5",a.componentName?"pr-1.5":"pr-1"))),De}}),null),Ie(ye,ge(Ze,{get when(){return a.isPendingDismiss},get children(){return ge(Lh,{get onConfirm(){return a.onConfirmDismiss},get onCancel(){return a.onCancelDismiss}})}}),null),Ie(ye,ge(Ze,{get when(){return a.error},get children(){return ge(_w,{get error(){return a.error},get onAcknowledge(){return a.onAcknowledgeError},get onRetry(){return a.onRetry}})}}),null),C(De=>{var _e=`${Me().top}px`,Ve=`${Me().left}px`,ct=a.isInputExpanded||a.status==="copied"&&a.onDismiss||a.status==="copying"&&a.onAbort?"auto":"none",Xe=a.status==="fading"?0:1,vt=(a.status==="copied"||a.status==="fading")&&!a.error?"none":void 0;return _e!==De.e&&ft(me,"top",De.e=_e),Ve!==De.t&&ft(me,"left",De.t=Ve),ct!==De.a&&ft(me,"pointer-events",De.a=ct),Xe!==De.o&&ft(me,"opacity",De.o=Xe),vt!==De.i&&ft(ye,"display",De.i=vt),De},{e:void 0,t:void 0,a:void 0,o:void 0,i:void 0}),me}})};mt(["click","pointerdown","mousedown","pointerup","input","keydown"]);var zw=Y('<div class="fixed z-2147483647"><button data-react-grab-selection-cursor>'),Lw=a=>{let[p,m]=h(!1),[f,j]=h(!1);A(()=>{let M=a.visible!==!1;if(a.x,a.y,j(!1),M){let _=setTimeout(()=>j(!0),500);F(()=>clearTimeout(_))}}),A(()=>{if(!f()||!a.onEnter)return;let M=_=>{var $;Os(_)||!(_.code==="Enter"||_.code==="NumpadEnter")||(_.preventDefault(),_.stopPropagation(),_.stopImmediatePropagation(),($=a.onEnter)==null||$.call(a))};window.addEventListener("keydown",M,!0),F(()=>{window.removeEventListener("keydown",M,!0)})});let k=M=>{var _;M.preventDefault(),M.stopPropagation(),(_=a.onClick)==null||_.call(a)};return ge(Ze,{get when(){return f()},get children(){return[ge(Ze,{get when(){return _t(()=>!!p())()&&a.elementBounds},get children(){return ge(Ai,{variant:"selection",get bounds(){return a.elementBounds},visible:!0})}}),(()=>{var M=zw(),_=M.firstChild;return M.addEventListener("mouseleave",()=>m(!1)),M.addEventListener("mouseenter",()=>m(!0)),_.$$click=k,C($=>{var B=`${a.x}px`,Z=`${a.y}px`,X=fn("absolute left-0 top-0 -translate-x-1/2 -translate-y-1/2 bg-grab-pink cursor-pointer rounded-full transition-[width,height] duration-150",p()?"w-1 h-5.5 brightness-125":"w-0.5 h-5 animate-pulse");return B!==$.e&&ft(M,"left",$.e=B),Z!==$.t&&ft(M,"top",$.t=Z),X!==$.a&&st(_,$.a=X),$},{e:void 0,t:void 0,a:void 0}),M})(),ge(Ze,{get when(){return _t(()=>!!p())()&&a.elementBounds},get children(){return ge(Ba,{get tagName(){return a.tagName},get componentName(){return a.componentName},get selectionBounds(){return a.elementBounds},get mouseX(){return a.x},visible:!0,get onSubmit(){return a.onClick}})}})]}})};mt(["click"]);var Ow=a=>{let p=P(()=>a.agentSessions?Array.from(a.agentSessions.values()):[]);return[ge(Ze,{get when(){return _t(()=>!!a.selectionVisible)()&&a.selectionBounds},get children(){return ge(Ai,{variant:"selection",get bounds(){return a.selectionBounds},get visible(){return a.selectionVisible},get isFading(){return a.selectionLabelStatus==="fading"}})}}),ge(Ze,{get when(){return _t(()=>a.crosshairVisible===!0&&a.mouseX!==void 0)()&&a.mouseY!==void 0},get children(){return ge(Gv,{get mouseX(){return a.mouseX},get mouseY(){return a.mouseY},visible:!0})}}),ge(Ze,{get when(){return _t(()=>!!a.dragVisible)()&&a.dragBounds},get children(){return ge(Ai,{variant:"drag",get bounds(){return a.dragBounds},get visible(){return a.dragVisible}})}}),ge(Jr,{get each(){return a.grabbedBoxes??[]},children:m=>ge(Ai,{variant:"grabbed",get bounds(){return m.bounds},get createdAt(){return m.createdAt}})}),ge(ko,{get each(){return p()},children:m=>[ge(Ze,{get when(){return m().selectionBounds},get children(){return ge(Ai,{variant:"processing",get bounds(){return m().selectionBounds},visible:!0,get isCompleted(){return!m().isStreaming}})}}),ge(Ba,{get tagName(){return m().tagName},get componentName(){return m().componentName},get selectionBounds(){return m().selectionBounds},get mouseX(){return m().position.x},visible:!0,hasAgent:!0,isAgentConnected:!0,get status(){return m().isStreaming?"copying":"copied"},get statusText(){return m().lastStatus||"Thinking"},get inputValue(){return m().context.prompt},get supportsUndo(){return a.supportsUndo},get supportsFollowUp(){return a.supportsFollowUp},get dismissButtonText(){return a.dismissButtonText},onAbort:()=>{var f;return(f=a.onAbortSession)==null?void 0:f.call(a,m().id)},get onDismiss(){return m().isStreaming?void 0:()=>{var f;return(f=a.onDismissSession)==null?void 0:f.call(a,m().id)}},get onUndo(){return m().isStreaming?void 0:()=>{var f;return(f=a.onUndoSession)==null?void 0:f.call(a,m().id)}},get onReply(){return m().isStreaming?void 0:()=>{var f;return(f=a.onReplySession)==null?void 0:f.call(a,m().id)}},get error(){return m().error},onAcknowledgeError:()=>{var f;return(f=a.onAcknowledgeSessionError)==null?void 0:f.call(a,m().id)},onRetry:()=>{var f;return(f=a.onRetrySession)==null?void 0:f.call(a,m().id)},get isPendingAbort(){return _t(()=>!!m().isStreaming)()?a.isPendingAgentAbort:!1},get onConfirmAbort(){return a.onConfirmAgentAbort},get onCancelAbort(){return a.onCancelAgentAbort}})]}),ge(Ze,{get when(){return _t(()=>!!a.selectionLabelVisible)()&&a.selectionBounds},get children(){return ge(Ba,{get tagName(){return a.selectionTagName},get componentName(){return a.selectionComponentName},get selectionBounds(){return a.selectionBounds},get mouseX(){return a.mouseX},get visible(){return a.selectionLabelVisible},get isInputExpanded(){return a.isInputExpanded},get inputValue(){return a.inputValue},get replyToPrompt(){return a.replyToPrompt},get hasAgent(){return a.hasAgent},get isAgentConnected(){return a.isAgentConnected},get status(){return a.selectionLabelStatus},get filePath(){return a.selectionFilePath},get lineNumber(){return a.selectionLineNumber},get onInputChange(){return a.onInputChange},get onSubmit(){return a.onInputSubmit},get onCancel(){return a.onInputCancel},get onToggleExpand(){return a.onToggleExpand},get isPendingDismiss(){return a.isPendingDismiss},get onConfirmDismiss(){return a.onConfirmDismiss},get onCancelDismiss(){return a.onCancelDismiss},onOpen:()=>{if(a.selectionFilePath){let m=wh(a.selectionFilePath,a.selectionLineNumber);window.open(m,"_blank")}}})}}),ge(Jr,{get each(){return a.labelInstances??[]},children:m=>ge(Ba,{get tagName(){return m.tagName},get componentName(){return m.componentName},get selectionBounds(){return m.bounds},get mouseX(){return m.mouseX},visible:!0,get status(){return m.status}})}),ge(Ze,{get when(){return _t(()=>!!(a.nativeSelectionCursorVisible&&a.nativeSelectionCursorX!==void 0))()&&a.nativeSelectionCursorY!==void 0},get children(){return ge(Lw,{get x(){return a.nativeSelectionCursorX},get y(){return a.nativeSelectionCursorY},get tagName(){return a.nativeSelectionTagName},get componentName(){return a.nativeSelectionComponentName},get elementBounds(){return a.nativeSelectionBounds},get visible(){return a.nativeSelectionCursorVisible},get onClick(){return a.onNativeSelectionCopy},get onEnter(){return a.onNativeSelectionEnter}})}})]},Dw="0.5.26",Dh=`bippy-${Dw}`,$h=Object.defineProperty,$w=Object.prototype.hasOwnProperty,Ei=()=>{},Fh=a=>{try{Function.prototype.toString.call(a).indexOf("^_^")>-1&&setTimeout(()=>{throw Error("React is running in production mode, but dead code elimination has not been applied. Read how to correctly configure React for production: https://reactjs.org/link/perf-use-production-build")})}catch{}},Uh=(a=Io())=>"getFiberRoots"in a,Bh=!1,qa,Uc=(a=Io())=>Bh?!0:(typeof a.inject=="function"&&(qa=a.inject.toString()),!!(qa!=null&&qa.includes("(injected)"))),Bc=new Set,Mi=new Set,Fw=a=>{let p=new Map,m=0,f={_instrumentationIsActive:!1,_instrumentationSource:Dh,checkDCE:Fh,hasUnsupportedRendererAttached:!1,inject(j){let k=++m;return p.set(k,j),Mi.add(j),f._instrumentationIsActive||(f._instrumentationIsActive=!0,Bc.forEach(M=>M())),k},on:Ei,onCommitFiberRoot:Ei,onCommitFiberUnmount:Ei,onPostCommitFiberRoot:Ei,renderers:p,supportsFiber:!0,supportsFlight:!0};try{$h(globalThis,"__REACT_DEVTOOLS_GLOBAL_HOOK__",{configurable:!0,enumerable:!0,get(){return f},set(M){if(M&&typeof M=="object"){let _=f.renderers;f=M,_.size>0&&(_.forEach(($,B)=>{Mi.add($),M.renderers.set(B,$)}),qc(a))}}});let j=window.hasOwnProperty,k=!1;$h(window,"hasOwnProperty",{configurable:!0,value:function(...M){try{if(!k&&M[0]==="__REACT_DEVTOOLS_GLOBAL_HOOK__")return globalThis.__REACT_DEVTOOLS_GLOBAL_HOOK__=void 0,k=!0,-0}catch{}return j.apply(this,M)},writable:!0})}catch{qc(a)}return f},qc=a=>{try{let p=globalThis.__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!p)return;if(!p._instrumentationSource){p.checkDCE=Fh,p.supportsFiber=!0,p.supportsFlight=!0,p.hasUnsupportedRendererAttached=!1,p._instrumentationSource=Dh,p._instrumentationIsActive=!1;let m=Uh(p);if(m||(p.on=Ei),p.renderers.size){p._instrumentationIsActive=!0,Bc.forEach(k=>k());return}let f=p.inject,j=Uc(p);j&&!m&&(Bh=!0,p.inject({scheduleRefresh(){}})&&(p._instrumentationIsActive=!0)),p.inject=k=>{let M=f(k);return Mi.add(k),j&&p.renderers.set(M,k),p._instrumentationIsActive=!0,Bc.forEach(_=>_()),M}}(p.renderers.size||p._instrumentationIsActive||Uc())&&(a==null||a())}catch{}},Uw=()=>$w.call(globalThis,"__REACT_DEVTOOLS_GLOBAL_HOOK__"),Io=a=>Uw()?(qc(a),globalThis.__REACT_DEVTOOLS_GLOBAL_HOOK__):Fw(a),Bw=()=>{var a,p;return!!(typeof window<"u"&&((a=window.document)!=null&&a.createElement||((p=window.navigator)==null?void 0:p.product)==="ReactNative"))},qw=()=>{try{Bw()&&Io()}catch{}},Ww=0,Gw=1,Hw=5,Vw=11,Kw=13,Yw=15,Qw=16,Jw=19,Zw=26,Xw=27,eb=28,tb=30;function rb(a,p,m=!1){if(!a)return null;let f=p(a);if(f instanceof Promise)return(async()=>{if(await f===!0)return a;let k=m?a.return:a.child;for(;k;){let M=await Wh(k,p,m);if(M)return M;k=m?null:k.sibling}return null})();if(f===!0)return a;let j=m?a.return:a.child;for(;j;){let k=qh(j,p,m);if(k)return k;j=m?null:j.sibling}return null}var qh=(a,p,m=!1)=>{if(!a)return null;if(p(a)===!0)return a;let f=m?a.return:a.child;for(;f;){let j=qh(f,p,m);if(j)return j;f=m?null:f.sibling}return null},Wh=async(a,p,m=!1)=>{if(!a)return null;if(await p(a)===!0)return a;let f=m?a.return:a.child;for(;f;){let j=await Wh(f,p,m);if(j)return j;f=m?null:f.sibling}return null},Gh=a=>{let p=a;return typeof p=="function"?p:typeof p=="object"&&p?Gh(p.type||p.render):null},Wc=a=>{let p=a;if(typeof p=="string")return p;if(typeof p!="function"&&!(typeof p=="object"&&p))return null;let m=p.displayName||p.name||null;if(m)return m;let f=Gh(p);return f&&(f.displayName||f.name)||null},Gc=()=>!!Io()._instrumentationIsActive||Uh()||Uc(),nb=a=>{var m,f,j,k;let p=Io();for(let M of p.renderers.values())try{let _=(m=M.findFiberByHostInstance)==null?void 0:m.call(M,a);if(_)return _}catch{}if(typeof a=="object"&&a){if("_reactRootContainer"in a)return(k=(j=(f=a._reactRootContainer)==null?void 0:f._internalRoot)==null?void 0:j.current)==null?void 0:k.child;for(let M in a)if(M.startsWith("__reactContainer$")||M.startsWith("__reactInternalInstance$")||M.startsWith("__reactFiber"))return a[M]||null}return null},sb=Object.create,Hh=Object.defineProperty,ob=Object.getOwnPropertyDescriptor,ib=Object.getOwnPropertyNames,ab=Object.getPrototypeOf,lb=Object.prototype.hasOwnProperty,cb=(a,p)=>()=>(p||a((p={exports:{}}).exports,p),p.exports),ub=(a,p,m,f)=>{if(p&&typeof p=="object"||typeof p=="function")for(var j=ib(p),k=0,M=j.length,_;k<M;k++)_=j[k],!lb.call(a,_)&&_!==m&&Hh(a,_,{get:($=>p[$]).bind(null,_),enumerable:!(f=ob(p,_))||f.enumerable});return a},db=(a,p,m)=>(m=a==null?{}:sb(ab(a)),ub(Hh(m,"default",{value:a,enumerable:!0}),a)),Vh=/^[a-zA-Z][a-zA-Z\d+\-.]*:/,pb=["rsc://","file:///","webpack://","webpack-internal://","node:","turbopack://","metro://","/app-pages-browser/"],Kh="about://React/",hb=["<anonymous>","eval",""],mb=/\.(jsx|tsx|ts|js)$/,fb=/(\.min|bundle|chunk|vendor|vendors|runtime|polyfill|polyfills)\.(js|mjs|cjs)$|(chunk|bundle|vendor|vendors|runtime|polyfill|polyfills|framework|app|main|index)[-_.][A-Za-z0-9_-]{4,}\.(js|mjs|cjs)$|[\da-f]{8,}\.(js|mjs|cjs)$|[-_.][\da-f]{20,}\.(js|mjs|cjs)$|\/dist\/|\/build\/|\/.next\/|\/out\/|\/node_modules\/|\.webpack\.|\.vite\.|\.turbopack\./i,gb=/^\?[\w~.\-]+(?:=[^&#]*)?(?:&[\w~.\-]+(?:=[^&#]*)?)*$/,Yh="(at Server)",yb=/(^|@)\S+:\d+/,xb=/^\s*at .*(\S+:\d+|\(native\))/m,vb=/^(eval@)?(\[native code\])?$/,Qh=(a,p)=>{{let m=a.split(`
`),f=[];for(let j of m)if(/^\s*at\s+/.test(j)){let k=wb(j,void 0)[0];k&&f.push(k)}else if(/^\s*in\s+/.test(j)){let k=j.replace(/^\s*in\s+/,"").replace(/\s*\(at .*\)$/,"");f.push({functionName:k,source:j})}else if(j.match(yb)){let k=bb(j,void 0)[0];k&&f.push(k)}return Hc(f,p)}},Jh=a=>{if(!a.includes(":"))return[a,void 0,void 0];let p=/(.+?)(?::(\d+))?(?::(\d+))?$/,m=p.exec(a.replace(/[()]/g,""));return[m[1],m[2]||void 0,m[3]||void 0]},Hc=(a,p)=>p&&p.slice!=null?Array.isArray(p.slice)?a.slice(p.slice[0],p.slice[1]):a.slice(0,p.slice):a,wb=(a,p)=>Hc(a.split(`
`).filter(m=>!!m.match(xb)),p).map(m=>{let f=m;f.includes("(eval ")&&(f=f.replace(/eval code/g,"eval").replace(/(\(eval at [^()]*)|(,.*$)/g,""));let j=f.replace(/^\s+/,"").replace(/\(eval code/g,"(").replace(/^.*?\s+/,""),k=j.match(/ (\(.+\)$)/);j=k?j.replace(k[0],""):j;let M=Jh(k?k[1]:j),_=k&&j||void 0,$=["eval","<anonymous>"].includes(M[0])?void 0:M[0];return{functionName:_,fileName:$,lineNumber:M[1]?+M[1]:void 0,columnNumber:M[2]?+M[2]:void 0,source:f}}),bb=(a,p)=>Hc(a.split(`
`).filter(m=>!m.match(vb)),p).map(m=>{let f=m;if(f.includes(" > eval")&&(f=f.replace(/ line (\d+)(?: > eval line \d+)* > eval:\d+:\d+/g,":$1")),!f.includes("@")&&!f.includes(":"))return{functionName:f};{let j=/(([^\n\r"\u2028\u2029]*".[^\n\r"\u2028\u2029]*"[^\n\r@\u2028\u2029]*(?:@[^\n\r"\u2028\u2029]*"[^\n\r@\u2028\u2029]*)*(?:[\n\r\u2028\u2029][^@]*)?)?[^@]*)@/,k=f.match(j),M=k&&k[1]?k[1]:void 0,_=Jh(f.replace(j,""));return{functionName:M,fileName:_[0],lineNumber:_[1]?+_[1]:void 0,columnNumber:_[2]?+_[2]:void 0,source:f}}}),kb=cb((a,p)=>{(function(m,f){typeof a=="object"&&p!==void 0?f(a):typeof define=="function"&&define.amd?define(["exports"],f):(m=typeof globalThis<"u"?globalThis:m||self,f(m.sourcemapCodec={}))})(void 0,function(m){let f=44,j=59,k="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",M=new Uint8Array(64),_=new Uint8Array(128);for(let ae=0;ae<k.length;ae++){let ee=k.charCodeAt(ae);M[ae]=ee,_[ee]=ae}function $(ae,ee){let J=0,he=0,Oe=0;do{let ht=ae.next();Oe=_[ht],J|=(Oe&31)<<he,he+=5}while(Oe&32);let qe=J&1;return J>>>=1,qe&&(J=-2147483648|-J),ee+J}function B(ae,ee,J){let he=ee-J;he=he<0?-he<<1|1:he<<1;do{let Oe=he&31;he>>>=5,he>0&&(Oe|=32),ae.write(M[Oe])}while(he>0);return ee}function Z(ae,ee){return ae.pos>=ee?!1:ae.peek()!==f}let X=1024*16,pe=typeof TextDecoder<"u"?new TextDecoder:typeof Buffer<"u"?{decode(ae){return Buffer.from(ae.buffer,ae.byteOffset,ae.byteLength).toString()}}:{decode(ae){let ee="";for(let J=0;J<ae.length;J++)ee+=String.fromCharCode(ae[J]);return ee}};class ve{constructor(){this.pos=0,this.out="",this.buffer=new Uint8Array(X)}write(ee){let{buffer:J}=this;J[this.pos++]=ee,this.pos===X&&(this.out+=pe.decode(J),this.pos=0)}flush(){let{buffer:ee,out:J,pos:he}=this;return he>0?J+pe.decode(ee.subarray(0,he)):J}}class be{constructor(ee){this.pos=0,this.buffer=ee}next(){return this.buffer.charCodeAt(this.pos++)}peek(){return this.buffer.charCodeAt(this.pos)}indexOf(ee){let{buffer:J,pos:he}=this,Oe=J.indexOf(ee,he);return Oe===-1?J.length:Oe}}let Te=[];function se(ae){let{length:ee}=ae,J=new be(ae),he=[],Oe=[],qe=0;for(;J.pos<ee;J.pos++){qe=$(J,qe);let ht=$(J,0);if(!Z(J,ee)){let De=Oe.pop();De[2]=qe,De[3]=ht;continue}let nt=$(J,0),lt=$(J,0),me=lt&1,ye=me?[qe,ht,0,0,nt,$(J,0)]:[qe,ht,0,0,nt],ot=Te;if(Z(J,ee)){ot=[];do{let De=$(J,0);ot.push(De)}while(Z(J,ee))}ye.vars=ot,he.push(ye),Oe.push(ye)}return he}function le(ae){let ee=new ve;for(let J=0;J<ae.length;)J=ie(ae,J,ee,[0]);return ee.flush()}function ie(ae,ee,J,he){let Oe=ae[ee],{0:qe,1:ht,2:nt,3:lt,4:me,vars:ye}=Oe;ee>0&&J.write(f),he[0]=B(J,qe,he[0]),B(J,ht,0),B(J,me,0);let ot=Oe.length===6?1:0;B(J,ot,0),Oe.length===6&&B(J,Oe[5],0);for(let De of ye)B(J,De,0);for(ee++;ee<ae.length;){let De=ae[ee],{0:_e,1:Ve}=De;if(_e>nt||_e===nt&&Ve>=lt)break;ee=ie(ae,ee,J,he)}return J.write(f),he[0]=B(J,nt,he[0]),B(J,lt,0),ee}function we(ae){let{length:ee}=ae,J=new be(ae),he=[],Oe=[],qe=0,ht=0,nt=0,lt=0,me=0,ye=0,ot=0,De=0;do{let _e=J.indexOf(";"),Ve=0;for(;J.pos<_e;J.pos++){if(Ve=$(J,Ve),!Z(J,_e)){let ar=Oe.pop();ar[2]=qe,ar[3]=Ve;continue}let ct=$(J,0),Xe=ct&1,vt=ct&2,Ct=ct&4,Pt=null,At=Te,wt;if(Xe){let ar=$(J,ht);nt=$(J,ht===ar?nt:0),ht=ar,wt=[qe,Ve,0,0,ar,nt]}else wt=[qe,Ve,0,0];if(wt.isScope=!!Ct,vt){let ar=lt,gr=me;lt=$(J,lt);let lr=ar===lt;me=$(J,lr?me:0),ye=$(J,lr&&gr===me?ye:0),Pt=[lt,me,ye]}if(wt.callsite=Pt,Z(J,_e)){At=[];do{ot=qe,De=Ve;let ar=$(J,0),gr;if(ar<-1){gr=[[$(J,0)]];for(let lr=-1;lr>ar;lr--){let Ri=ot;ot=$(J,ot),De=$(J,ot===Ri?De:0);let bt=$(J,0);gr.push([bt,ot,De])}}else gr=[[ar]];At.push(gr)}while(Z(J,_e))}wt.bindings=At,he.push(wt),Oe.push(wt)}qe++,J.pos=_e+1}while(J.pos<ee);return he}function Pe(ae){if(ae.length===0)return"";let ee=new ve;for(let J=0;J<ae.length;)J=Ee(ae,J,ee,[0,0,0,0,0,0,0]);return ee.flush()}function Ee(ae,ee,J,he){let Oe=ae[ee],{0:qe,1:ht,2:nt,3:lt,isScope:me,callsite:ye,bindings:ot}=Oe;he[0]<qe?(We(J,he[0],qe),he[0]=qe,he[1]=0):ee>0&&J.write(f),he[1]=B(J,Oe[1],he[1]);let De=(Oe.length===6?1:0)|(ye?2:0)|(me?4:0);if(B(J,De,0),Oe.length===6){let{4:_e,5:Ve}=Oe;_e!==he[2]&&(he[3]=0),he[2]=B(J,_e,he[2]),he[3]=B(J,Ve,he[3])}if(ye){let{0:_e,1:Ve,2:ct}=Oe.callsite;_e===he[4]?Ve!==he[5]&&(he[6]=0):(he[5]=0,he[6]=0),he[4]=B(J,_e,he[4]),he[5]=B(J,Ve,he[5]),he[6]=B(J,ct,he[6])}if(ot)for(let _e of ot){_e.length>1&&B(J,-_e.length,0);let Ve=_e[0][0];B(J,Ve,0);let ct=qe,Xe=ht;for(let vt=1;vt<_e.length;vt++){let Ct=_e[vt];ct=B(J,Ct[1],ct),Xe=B(J,Ct[2],Xe),B(J,Ct[0],0)}}for(ee++;ee<ae.length;){let _e=ae[ee],{0:Ve,1:ct}=_e;if(Ve>nt||Ve===nt&&ct>=lt)break;ee=Ee(ae,ee,J,he)}return he[0]<nt?(We(J,he[0],nt),he[0]=nt,he[1]=0):J.write(f),he[1]=B(J,lt,he[1]),ee}function We(ae,ee,J){do ae.write(j);while(++ee<J)}function je(ae){let{length:ee}=ae,J=new be(ae),he=[],Oe=0,qe=0,ht=0,nt=0,lt=0;do{let me=J.indexOf(";"),ye=[],ot=!0,De=0;for(Oe=0;J.pos<me;){let _e;Oe=$(J,Oe),Oe<De&&(ot=!1),De=Oe,Z(J,me)?(qe=$(J,qe),ht=$(J,ht),nt=$(J,nt),Z(J,me)?(lt=$(J,lt),_e=[Oe,qe,ht,nt,lt]):_e=[Oe,qe,ht,nt]):_e=[Oe],ye.push(_e),J.pos++}ot||pt(ye),he.push(ye),J.pos=me+1}while(J.pos<=ee);return he}function pt(ae){ae.sort(Ge)}function Ge(ae,ee){return ae[0]-ee[0]}function Me(ae){let ee=new ve,J=0,he=0,Oe=0,qe=0;for(let ht=0;ht<ae.length;ht++){let nt=ae[ht];if(ht>0&&ee.write(j),nt.length===0)continue;let lt=0;for(let me=0;me<nt.length;me++){let ye=nt[me];me>0&&ee.write(f),lt=B(ee,ye[0],lt),ye.length!==1&&(J=B(ee,ye[1],J),he=B(ee,ye[2],he),Oe=B(ee,ye[3],Oe),ye.length!==4&&(qe=B(ee,ye[4],qe)))}}return ee.flush()}m.decode=je,m.decodeGeneratedRanges=we,m.decodeOriginalScopes=se,m.encode=Me,m.encodeGeneratedRanges=Pe,m.encodeOriginalScopes=le,Object.defineProperty(m,"__esModule",{value:!0})})}),Zh=db(kb()),Xh=/^[a-zA-Z][a-zA-Z\d+\-.]*:/,Sb=/^data:application\/json[^,]+base64,/,Tb=/(?:\/\/[@#][ \t]+sourceMappingURL=([^\s'"]+?)[ \t]*$)|(?:\/\*[@#][ \t]+sourceMappingURL=([^*]+?)[ \t]*(?:\*\/)[ \t]*$)/,em=typeof WeakRef<"u",_i=new Map,Wa=new Map,Cb=a=>em&&a instanceof WeakRef,tm=(a,p,m,f)=>{if(m<0||m>=a.length)return null;let j=a[m];if(!j||j.length===0)return null;let k=null;for(let Z of j)if(Z[0]<=f)k=Z;else break;if(!k||k.length<4)return null;let[,M,_,$]=k;if(M===void 0||_===void 0||$===void 0)return null;let B=p[M];return B?{columnNumber:$,fileName:B,lineNumber:_+1}:null},Pb=(a,p,m)=>{if(a.sections){let f=null;for(let M of a.sections)if(p>M.offset.line||p===M.offset.line&&m>=M.offset.column)f=M;else break;if(!f)return null;let j=p-f.offset.line,k=p===f.offset.line?m-f.offset.column:m;return tm(f.map.mappings,f.map.sources,j,k)}return tm(a.mappings,a.sources,p-1,m)},jb=(a,p)=>{let m=p.split(`
`),f;for(let k=m.length-1;k>=0&&!f;k--){let M=m[k].match(Tb);M&&(f=M[1]||M[2])}if(!f)return null;let j=Xh.test(f);if(!(Sb.test(f)||j||f.startsWith("/"))){let k=a.split("/");k[k.length-1]=f,f=k.join("/")}return f},Nb=a=>({file:a.file,mappings:(0,Zh.decode)(a.mappings),names:a.names,sourceRoot:a.sourceRoot,sources:a.sources,sourcesContent:a.sourcesContent,version:3}),Ib=a=>{let p=a.sections.map(({map:f,offset:j})=>({map:{...f,mappings:(0,Zh.decode)(f.mappings)},offset:j})),m=new Set;for(let f of p)for(let j of f.map.sources)m.add(j);return{file:a.file,mappings:[],names:[],sections:p,sourceRoot:void 0,sources:Array.from(m),sourcesContent:void 0,version:3}},rm=a=>{if(!a)return!1;let p=a.trim();if(!p)return!1;let m=p.match(Xh);if(!m)return!0;let f=m[0].toLowerCase();return f==="http:"||f==="https:"},Ab=async(a,p=fetch)=>{if(!rm(a))return null;let m;try{m=await(await p(a)).text()}catch{return null}if(!m)return null;let f=jb(a,m);if(!f||!rm(f))return null;try{let j=await p(f),k=await j.json();return"sections"in k?Ib(k):Nb(k)}catch{return null}},Eb=async(a,p=!0,m)=>{if(p&&_i.has(a)){let k=_i.get(a);if(k==null)return null;if(Cb(k)){let M=k.deref();if(M)return M;_i.delete(a)}else return k}if(p&&Wa.has(a))return Wa.get(a);let f=Ab(a,m);p&&Wa.set(a,f);let j=await f;return p&&Wa.delete(a),p&&(j===null?_i.set(a,null):_i.set(a,em?new WeakRef(j):j)),j},Mb=async(a,p=!0,m)=>await Promise.all(a.map(async f=>{if(!f.fileName)return f;let j=await Eb(f.fileName,p,m);if(!j||typeof f.lineNumber!="number"||typeof f.columnNumber!="number")return f;let k=Pb(j,f.lineNumber,f.columnNumber);return k?{...f,source:k.fileName&&f.source?f.source.replace(f.fileName,k.fileName):f.source,fileName:k.fileName,lineNumber:k.lineNumber,columnNumber:k.columnNumber,isSymbolicated:!0}:f})),_b=a=>{var p;return a._debugStack instanceof Error&&typeof((p=a._debugStack)==null?void 0:p.stack)=="string"},Rb=()=>{let a=Io();for(let p of[...Array.from(Mi),...Array.from(a.renderers.values())]){let m=p.currentDispatcherRef;if(m&&typeof m=="object")return"H"in m?m.H:m.current}return null},nm=a=>{for(let p of Mi){let m=p.currentDispatcherRef;m&&typeof m=="object"&&("H"in m?m.H=a:m.current=a)}},Cn=a=>`
    in ${a}`,zb=(a,p)=>{let m=Cn(a);return p&&(m+=` (at ${p})`),m},Vc=!1,Kc=(a,p)=>{var _;if(!a||Vc)return"";let m=Error.prepareStackTrace;Error.prepareStackTrace=void 0,Vc=!0;let f=Rb();nm(null);let j=console.error,k=console.warn;console.error=()=>{},console.warn=()=>{};try{let $={DetermineComponentFrameRoot(){let X;try{if(p){let pe=function(){throw Error()};if(Object.defineProperty(pe.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(pe,[])}catch(ve){X=ve}Reflect.construct(a,[],pe)}else{try{pe.call()}catch(ve){X=ve}a.call(pe.prototype)}}else{try{throw Error()}catch(ve){X=ve}let pe=a();pe&&typeof pe.catch=="function"&&pe.catch(()=>{})}}catch(pe){if(pe instanceof Error&&X instanceof Error&&typeof pe.stack=="string")return[pe.stack,X.stack]}return[null,null]}};$.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot",(_=Object.getOwnPropertyDescriptor($.DetermineComponentFrameRoot,"name"))!=null&&_.configurable&&Object.defineProperty($.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});let[B,Z]=$.DetermineComponentFrameRoot();if(B&&Z){let X=B.split(`
`),pe=Z.split(`
`),ve=0,be=0;for(;ve<X.length&&!X[ve].includes("DetermineComponentFrameRoot");)ve++;for(;be<pe.length&&!pe[be].includes("DetermineComponentFrameRoot");)be++;if(ve===X.length||be===pe.length)for(ve=X.length-1,be=pe.length-1;ve>=1&&be>=0&&X[ve]!==pe[be];)be--;for(;ve>=1&&be>=0;ve--,be--)if(X[ve]!==pe[be]){if(ve!==1||be!==1)do if(ve--,be--,be<0||X[ve]!==pe[be]){let Te=`
${X[ve].replace(" at new "," at ")}`,se=Wc(a);return se&&Te.includes("<anonymous>")&&(Te=Te.replace("<anonymous>",se)),Te}while(ve>=1&&be>=0);break}}}finally{Vc=!1,Error.prepareStackTrace=m,nm(f),console.error=j,console.warn=k}let M=a?Wc(a):"";return M?Cn(M):""},Lb=(a,p)=>{let m=a.tag,f="";switch(m){case eb:f=Cn("Activity");break;case Gw:f=Kc(a.type,!0);break;case Vw:f=Kc(a.type.render,!1);break;case Ww:case Yw:f=Kc(a.type,!1);break;case Hw:case Zw:case Xw:f=Cn(a.type);break;case Qw:f=Cn("Lazy");break;case Kw:f=a.child!==p&&p!==null?Cn("Suspense Fallback"):Cn("Suspense");break;case Jw:f=Cn("SuspenseList");break;case tb:f=Cn("ViewTransition");break;default:return""}return f},Ob=a=>{try{let p="",m=a,f=null;do{p+=Lb(m,f);let j=m._debugInfo;if(j&&Array.isArray(j))for(let k=j.length-1;k>=0;k--){let M=j[k];typeof M.name=="string"&&(p+=zb(M.name,M.env))}f=m,m=m.return}while(m);return p}catch(p){return p instanceof Error?`
Error generating stack: ${p.message}
${p.stack}`:""}},Db=a=>{let p=Error.prepareStackTrace;Error.prepareStackTrace=void 0;let m=a;if(!m)return"";Error.prepareStackTrace=p,m.startsWith(`Error: react-stack-top-frame
`)&&(m=m.slice(29));let f=m.indexOf(`
`);if(f!==-1&&(m=m.slice(f+1)),f=Math.max(m.indexOf("react_stack_bottom_frame"),m.indexOf("react-stack-bottom-frame")),f!==-1&&(f=m.lastIndexOf(`
`,f)),f!==-1)m=m.slice(0,f);else return"";return m},$b=a=>{var p;return!!((p=a.fileName)!=null&&p.startsWith("rsc://")&&a.functionName)},Fb=(a,p)=>a.fileName===p.fileName&&a.lineNumber===p.lineNumber&&a.columnNumber===p.columnNumber,Ub=a=>{let p=new Map;for(let m of a)for(let f of m.stackFrames){if(!$b(f))continue;let j=f.functionName,k=p.get(j)??[];k.some(M=>Fb(M,f))||(k.push(f),p.set(j,k))}return p},Bb=(a,p,m)=>{var M;if(!a.functionName)return{...a,isServer:!0};let f=p.get(a.functionName);if(!f||f.length===0)return{...a,isServer:!0};let j=m.get(a.functionName)??0,k=f[j%f.length];return m.set(a.functionName,j+1),{...a,isServer:!0,fileName:k.fileName,lineNumber:k.lineNumber,columnNumber:k.columnNumber,source:(M=a.source)==null?void 0:M.replace(Yh,`(${k.fileName}:${k.lineNumber}:${k.columnNumber})`)}},qb=a=>{let p=[];return rb(a,m=>{var j;if(!_b(m))return;let f=typeof m.type=="string"?m.type:Wc(m.type)||"<anonymous>";p.push({componentName:f,stackFrames:Qh(Db((j=m._debugStack)==null?void 0:j.stack))})},!0),p},Wb=async(a,p=!0,m)=>{let f=qb(a),j=Qh(Ob(a)),k=Ub(f),M=new Map,_=j.map(B=>{var Z;return((Z=B.source)==null?void 0:Z.includes(Yh))??!1?Bb(B,k,M):B}),$=_.filter((B,Z,X)=>{if(Z===0)return!0;let pe=X[Z-1];return B.functionName!==pe.functionName});return Mb($,p,m)},Yc=a=>{if(!a||hb.some(j=>j===a))return"";let p=a;if(p.startsWith("http://")||p.startsWith("https://"))try{p=new URL(p).pathname}catch{}if(p.startsWith(Kh)){let j=p.slice(Kh.length),k=j.indexOf("/"),M=j.indexOf(":");p=k!==-1&&(M===-1||k<M)?j.slice(k+1):j}let m=!0;for(;m;){m=!1;for(let j of pb)if(p.startsWith(j)){p=p.slice(j.length),j==="file:///"&&(p=`/${p.replace(/^\/+/,"")}`),m=!0;break}}if(Vh.test(p)){let j=p.match(Vh);j&&(p=p.slice(j[0].length))}if(p.startsWith("//")){let j=p.indexOf("/",2);p=j===-1?"":p.slice(j)}let f=p.indexOf("?");if(f!==-1){let j=p.slice(f);gb.test(j)&&(p=p.slice(0,f))}return p},sm=a=>{let p=Yc(a);return!(!p||!mb.test(p)||fb.test(p))},Gb=a=>a.length>0&&/^[A-Z]/.test(a);qw();var Hb=new Set(["InnerLayoutRouter","RedirectErrorBoundary","RedirectBoundary","HTTPAccessFallbackErrorBoundary","HTTPAccessFallbackBoundary","LoadingBoundary","ErrorBoundary","InnerScrollAndFocusHandler","ScrollAndFocusHandler","RenderFromTemplateContext","OuterLayoutRouter","body","html","DevRootHTTPAccessFallbackBoundary","AppDevOverlayErrorBoundary","AppDevOverlay","HotReload","Router","ErrorBoundaryHandler","AppRouter","ServerRoot","SegmentStateProvider","RootErrorBoundary","LoadableComponent","MotionDOMComponent"]),Vb=()=>typeof document>"u"?!1:!!(document.getElementById("__NEXT_DATA__")||document.querySelector("nextjs-portal")),Kb=a=>!!(a.startsWith("_")||Hb.has(a)),Qc=a=>!(Kb(a)||!Gb(a)||a.startsWith("Primitive.")||a.includes("Provider")&&a.includes("Context")),Ga=async a=>{if(!Gc())return[];let p=nb(a);return p?await Wb(p):null},Pn=async a=>{if(!Gc())return null;let p=await Ga(a);if(!p)return null;for(let m of p)if(m.functionName&&Qc(m.functionName))return m.functionName;return null},om=async(a,p={})=>{let{maxLines:m=3}=p,f=Yb(a),j=await Ga(a),k=Vb(),M=[];if(j)for(let _ of j){if(M.length>=m)break;if(_.isServer&&(!_.functionName||Qc(_.functionName))){M.push(`
  in ${_.functionName||"<anonymous>"} (at Server)`);continue}if(_.fileName&&sm(_.fileName)){let $=`
  in `,B=_.functionName&&Qc(_.functionName);B&&($+=`${_.functionName} (at `),$+=Yc(_.fileName),k&&_.lineNumber&&_.columnNumber&&($+=`:${_.lineNumber}:${_.columnNumber}`),B&&($+=")"),M.push($)}}return`${f}${M.join("")}`},Yb=a=>{var ve,be;let p=a.tagName.toLowerCase();if(!(a instanceof HTMLElement))return`<${p} />`;let m=((ve=a.innerText)==null?void 0:ve.trim())??((be=a.textContent)==null?void 0:be.trim())??"",f="",j=Array.from(a.attributes);for(let Te of j){let se=Te.name,le=Te.value;le.length>20&&(le=`${le.slice(0,20)}...`),f+=` ${se}="${le}"`}let k=[],M=[],_=!1,$=Array.from(a.childNodes);for(let Te of $)Te.nodeType!==Node.COMMENT_NODE&&(Te.nodeType===Node.TEXT_NODE?Te.textContent&&Te.textContent.trim().length>0&&(_=!0):Te instanceof Element&&(_?M.push(Te):k.push(Te)));let B=Te=>Te.length===0?"":Te.length<=2?Te.map(se=>`<${se.tagName.toLowerCase()} ...>`).join(`
  `):`(${Te.length} elements)`,Z="",X=B(k);if(X&&(Z+=`
  ${X}`),m.length>0){let Te=m.length>100?`${m.slice(0,100)}...`:m;Z+=`
  ${Te}`}let pe=B(M);return pe&&(Z+=`
  ${pe}`),Z.length>0?`<${p}${f}>${Z}
</${p}>`:`<${p}${f} />`},im=a=>({activate:()=>{},deactivate:()=>{},toggle:()=>{},isActive:()=>!1,dispose:()=>{},copyElement:()=>Promise.resolve(!1),getState:()=>({isActive:!1,isDragging:!1,isCopying:!1,isInputMode:!1,targetElement:null,dragBounds:null}),updateTheme:()=>{},getTheme:()=>a,setAgent:()=>{},updateOptions:()=>{}}),Qb=()=>{let a=new AbortController,p=(f,j,k={})=>{window.addEventListener(f,j,{...k,signal:a.signal})},m=(f,j,k={})=>{document.addEventListener(f,j,{...k,signal:a.signal})};return{signal:a.signal,abort:()=>a.abort(),addWindowListener:p,addDocumentListener:m}},Jb=a=>({createLabelInstance:(p,m,f,j,k,M)=>{let _=`label-${Date.now()}-${Math.random().toString(36).slice(2)}`;return a($=>[...$,{id:_,bounds:p,tagName:m,componentName:f,status:j,createdAt:Date.now(),element:k,mouseX:M}]),_},updateLabelInstance:(p,m)=>{a(f=>f.map(j=>j.id===p?{...j,status:m}:j))},removeLabelInstance:p=>{a(m=>m.filter(f=>f.id!==p))}}),Zb="application/x-react-grab",Ha=(a,p)=>{var k;let m=JSON.stringify({version:av,content:a,timestamp:Date.now(),...(p==null?void 0:p.prompt)&&{prompt:p.prompt}}),f=M=>{var _,$;M.preventDefault(),(_=M.clipboardData)==null||_.setData("text/plain",a),($=M.clipboardData)==null||$.setData(Zb,m)};document.addEventListener("copy",f);let j=document.createElement("textarea");j.value=a,j.style.position="fixed",j.style.left="-9999px",j.ariaHidden="true",document.body.appendChild(j),j.select();try{let M=document.execCommand("copy");return M&&((k=p==null?void 0:p.onSuccess)==null||k.call(p)),M}finally{document.removeEventListener("copy",f),j.remove()}},Jc=async(a,p={})=>{let m=(await Promise.allSettled(a.map(f=>om(f,p)))).map(f=>f.status==="fulfilled"?f.value:"").filter(f=>f.trim());return m.length===0?"":m.join(`

`)},Xb=a=>"innerText"in a,e1=a=>Xb(a)?a.innerText:a.textContent??"",am=a=>a.map(p=>e1(p).trim()).filter(p=>p.length>0).join(`

`),t1=async(a,p,m)=>{var k,M,_,$;let f=!1,j="";await((k=a.onBeforeCopy)==null?void 0:k.call(a,p));try{if(a.getContent){let B=await a.getContent(p);if(B.trim()){let Z=m?`${m}

${B}`:B;j=Z,f=Ha(Z,{prompt:m})}}else{let B=await Jc(p,{maxLines:a.maxContextLines});if(B.trim()){let Z=m?`${m}

${B}`:B;j=Z,f=Ha(Z,{prompt:m})}if(!f){let Z=am(p);if(Z.length>0){let X=m?`${m}

${Z}`:Z;j=X,f=Ha(X,{prompt:m})}}}}catch(B){let Z=B instanceof Error?B:new Error(String(B));(M=a.onCopyError)==null||M.call(a,Z);let X=am(p);if(X.length>0){let pe=m?`${m}

${X}`:X;j=pe,f=Ha(pe,{prompt:m})}}return f&&((_=a.onCopySuccess)==null||_.call(a,p,j)),($=a.onAfterCopy)==null||$.call(a,p,f),f},r1=(a,p=window.getComputedStyle(a))=>p.display!=="none"&&p.visibility!=="hidden"&&p.opacity!=="0",jn=a=>{if(a.closest(`[${ji}]`))return!1;let p=window.getComputedStyle(a);return!(!r1(a,p)||p.pointerEvents==="none")},lm=(a,p)=>{let m=document.elementsFromPoint(a,p);for(let f of m)if(jn(f))return f;return null},n1=(a,p)=>{let m=Math.max(a.left,p.left),f=Math.max(a.top,p.top),j=Math.min(a.right,p.right),k=Math.min(a.bottom,p.bottom),M=Math.max(0,j-m),_=Math.max(0,k-f);return M*_},s1=(a,p)=>a.left<p.right&&a.right>p.left&&a.top<p.bottom&&a.bottom>p.top,Ao=(a,p,m)=>Math.min(m,Math.max(p,a)),o1=a=>a.sort((p,m)=>{if(p===m)return 0;let f=p.compareDocumentPosition(m);return f&Node.DOCUMENT_POSITION_FOLLOWING?-1:f&Node.DOCUMENT_POSITION_PRECEDING?1:0}),i1=a=>{if(a.width<=0||a.height<=0)return[];let p=window.innerWidth,m=window.innerHeight,f=a.x,j=a.y,k=a.x+a.width,M=a.y+a.height,_=f+a.width/2,$=j+a.height/2,B=Ao(Math.ceil(a.width/24),3,30),Z=Ao(Math.ceil(a.height/24),3,30),X=B*Z,pe=X>600?Math.sqrt(600/X):1,ve=Ao(Math.floor(B*pe),3,30),be=Ao(Math.floor(Z*pe),3,30),Te=new Set,se=[],le=(we,Pe)=>{let Ee=Ao(Math.round(we),0,p-1),We=Ao(Math.round(Pe),0,m-1),je=`${Ee}:${We}`;Te.has(je)||(Te.add(je),se.push({x:Ee,y:We}))},ie=1;le(f+ie,j+ie),le(k-ie,j+ie),le(f+ie,M-ie),le(k-ie,M-ie),le(_,j+ie),le(_,M-ie),le(f+ie,$),le(k-ie,$),le(_,$);for(let we=0;we<ve;we+=1){let Pe=f+(we+.5)/ve*a.width;for(let Ee=0;Ee<be;Ee+=1){let We=j+(Ee+.5)/be*a.height;le(Pe,We)}}return se},cm=(a,p,m)=>{let f={left:a.x,top:a.y,right:a.x+a.width,bottom:a.y+a.height},j=new Set,k=i1(a);for(let _ of k){let $=document.elementsFromPoint(_.x,_.y);for(let B of $)j.add(B)}let M=[];for(let _ of j){if(!m){let Z=(_.tagName||"").toUpperCase();if(Z==="HTML"||Z==="BODY")continue}if(!p(_))continue;let $=_.getBoundingClientRect();if($.width<=0||$.height<=0)continue;let B={left:$.left,top:$.top,right:$.left+$.width,bottom:$.top+$.height};if(m){let Z=n1(f,B),X=$.width*$.height;X>0&&Z/X>=.75&&M.push(_)}else s1(B,f)&&M.push(_)}return o1(M)},um=a=>a.filter(p=>!a.some(m=>m!==p&&m.contains(p))),a1=(a,p)=>{let m=cm(a,p,!0);return um(m)},l1=(a,p)=>{let m=cm(a,p,!1);return um(m)},c1=a=>typeof a=="number"&&!Number.isNaN(a)&&Number.isFinite(a),u1=a=>{let p=a.trim();if(!p)return null;let m=parseFloat(p);return c1(m)?m:null},dm=(a,p)=>{let m=a.split(",");if(m.length!==p)return null;let f=[];for(let j of m){let k=u1(j);if(k===null)return null;f.push(k)}return f},d1=(a,p,m,f)=>a===1&&p===0&&m===0&&f===1,p1=a=>a[0]===1&&a[1]===0&&a[2]===0&&a[3]===0&&a[4]===0&&a[5]===1&&a[6]===0&&a[7]===0&&a[8]===0&&a[9]===0&&a[10]===1&&a[11]===0&&a[15]===1,pm=a=>{try{if(!(a instanceof Element))return"none";let p=window.getComputedStyle(a);if(!p)return"none";let m=p.transform;if(!m||m==="none")return"none";let f=m.match(/^matrix3d\(([^)]+)\)$/);if(f){let k=dm(f[1],16);if(k&&k.length===16){let M=[...k];return M[12]=0,M[13]=0,M[14]=0,p1(M)?"none":`matrix3d(${M.join(", ")})`}}let j=m.match(/^matrix\(([^)]+)\)$/);if(j){let k=dm(j[1],6);if(k&&k.length===6){let[M,_,$,B]=k;return d1(M,_,$,B)?"none":`matrix(${M}, ${_}, ${$}, ${B}, 0, 0)`}}return"none"}catch{return"none"}},Zt=a=>{let p=a.getBoundingClientRect();return{borderRadius:window.getComputedStyle(a).borderRadius||"0px",height:p.height,transform:pm(a),width:p.width,x:p.left,y:p.top}},h1=new Set(["c","C","","","","","","","","","","","","","","","","","","","","",""]),hm=(a,p)=>p==="KeyC"?!0:!a||a.length!==1?!1:h1.has(a),mm=(a,p)=>{let m=a.toLowerCase();return p.startsWith("Key")?p.slice(3).toLowerCase()===m:p.startsWith("Digit")?p.slice(5)===m:!1},fm=(a,p)=>{var f;if(p.activationShortcut)return p.activationShortcut(a);if(p.activationKey){let{key:j,metaKey:k,ctrlKey:M,shiftKey:_,altKey:$}=p.activationKey;if(!j){if(!bh.includes(a.key))return!1;let X=k?a.metaKey||a.key==="Meta":!0,pe=M?a.ctrlKey||a.key==="Control":!0,ve=_?a.shiftKey||a.key==="Shift":!0,be=$?a.altKey||a.key==="Alt":!0,Te=X&&pe&&ve&&be,se=[k,M,_,$].filter(Boolean).length,le=[a.metaKey||a.key==="Meta",a.ctrlKey||a.key==="Control",a.shiftKey||a.key==="Shift",a.altKey||a.key==="Alt"].filter(Boolean).length;return Te&&le>=se}let B=((f=a.key)==null?void 0:f.toLowerCase())===j.toLowerCase()||mm(j,a.code),Z=k||M||_||$?(k?a.metaKey:!0)&&(M?a.ctrlKey:!0)&&(_?a.shiftKey:!0)&&($?a.altKey:!0):a.metaKey||a.ctrlKey;return B&&Z}let m=(a.metaKey||a.ctrlKey)&&!a.shiftKey&&!a.altKey;return!!(a.key&&m&&hm(a.key,a.code))},Jn=(a,p)=>{try{return a.composedPath().some(m=>m instanceof HTMLElement&&m.hasAttribute(p))}catch{return!1}},Zc={enabled:!0,hue:0,selectionBox:{enabled:!0},dragBox:{enabled:!0},grabbedBoxes:{enabled:!0},elementLabel:{enabled:!0},crosshair:{enabled:!0}},gm=(a,p)=>{var m,f,j,k,M;return{enabled:p.enabled??a.enabled,hue:p.hue??a.hue,selectionBox:{enabled:((m=p.selectionBox)==null?void 0:m.enabled)??a.selectionBox.enabled},dragBox:{enabled:((f=p.dragBox)==null?void 0:f.enabled)??a.dragBox.enabled},grabbedBoxes:{enabled:((j=p.grabbedBoxes)==null?void 0:j.enabled)??a.grabbedBoxes.enabled},elementLabel:{enabled:((k=p.elementLabel)==null?void 0:k.enabled)??a.elementLabel.enabled},crosshair:{enabled:((M=p.crosshair)==null?void 0:M.enabled)??a.crosshair.enabled}}},ym=a=>a?gm(Zc,a):Zc,m1=gm,Xc="react-grab:agent-sessions",f1=()=>`session-${Date.now()}-${Math.random().toString(36).slice(2,9)}`,g1=(a,p,m,f,j)=>{let k=Date.now();return{id:f1(),context:a,lastStatus:"",isStreaming:!0,createdAt:k,lastUpdatedAt:k,position:p,selectionBounds:m,tagName:f,componentName:j}},eu=a=>a||null,Ds=new Map,tu=(a,p)=>{let m=eu(p);if(!m){Ds.clear(),a.forEach((f,j)=>Ds.set(j,f));return}try{let f=Object.fromEntries(a);m.setItem(Xc,JSON.stringify(f))}catch{Ds.clear(),a.forEach((f,j)=>Ds.set(j,f))}},ru=(a,p)=>{let m=nu(p);m.set(a.id,a),tu(m,p)},nu=a=>{let p=eu(a);if(!p)return new Map(Ds);try{let m=p.getItem(Xc);if(!m)return new Map;let f=JSON.parse(m);return new Map(Object.entries(f))}catch{return new Map}},su=a=>{let p=eu(a);if(!p){Ds.clear();return}try{p.removeItem(Xc)}catch{Ds.clear()}},xm=(a,p)=>{let m=nu(p);m.delete(a),tu(m,p)},Eo=(a,p,m)=>{let f={...a,...p,lastUpdatedAt:Date.now()};return ru(f,m),f},y1=a=>{let[p,m]=h(new Map),f=new Map,j=new Map,k=a,M=se=>{k=se},_=()=>k,$=()=>Array.from(p().values()).some(se=>se.isStreaming),B=async(se,le)=>{var Pe,Ee,We,je,pt,Ge;let ie=k==null?void 0:k.storage,we=!1;try{for await(let ae of le){let ee=p().get(se.id);if(!ee)break;let J=Eo(ee,{lastStatus:ae},ie);m(he=>new Map(he).set(se.id,J)),(Pe=k==null?void 0:k.onStatus)==null||Pe.call(k,ae,J)}let Me=p().get(se.id);if(Me){let ae=(We=(Ee=k==null?void 0:k.provider)==null?void 0:Ee.getCompletionMessage)==null?void 0:We.call(Ee),ee=Eo(Me,{isStreaming:!1,...ae?{lastStatus:ae}:{}},ie);m(Oe=>new Map(Oe).set(se.id,ee));let J=j.get(se.id),he=await((je=k==null?void 0:k.onComplete)==null?void 0:je.call(k,ee,J));if(he!=null&&he.error){let Oe=Eo(ee,{error:he.error},ie);m(qe=>new Map(qe).set(se.id,Oe))}}}catch(Me){let ae=p().get(se.id);if(Me instanceof Error&&Me.name==="AbortError"){if(we=!0,ae){let ee=j.get(se.id);(pt=k==null?void 0:k.onAbort)==null||pt.call(k,ae,ee)}}else{let ee=Me instanceof Error?Me.message:"Unknown error";if(ae){let J=Eo(ae,{error:ee,isStreaming:!1},ie);m(he=>new Map(he).set(se.id,J)),Me instanceof Error&&((Ge=k==null?void 0:k.onError)==null||Ge.call(k,Me,J))}}}finally{f.delete(se.id),we&&(j.delete(se.id),xm(se.id,ie),m(Me=>{let ae=new Map(Me);return ae.delete(se.id),ae}))}},Z=se=>{let{selectionBounds:le,tagName:ie}=se;if(!le)return;let we=le.x+le.width/2,Pe=le.y+le.height/2,Ee=document.elementFromPoint(we,Pe);if(Ee&&!(ie&&Ee.tagName.toLowerCase()!==ie))return Ee},X=()=>{var Ee,We;let se=k==null?void 0:k.storage;if(!se)return;let le=nu(se);if(le.size===0)return;let ie=Date.now(),we=Array.from(le.values()).filter(je=>{if(je.isStreaming)return!0;let pt=je.lastUpdatedAt??je.createdAt;return ie-pt<1e4&&!!je.error});if(we.length===0){su(se);return}if(!((Ee=k==null?void 0:k.provider)!=null&&Ee.supportsResume)||!k.provider.resume){su(se);return}let Pe=new Map(we.map(je=>[je.id,je]));m(Pe),tu(Pe,se);for(let je of we){let pt=Z(je);pt&&j.set(je.id,pt);let Ge={...je,isStreaming:!0,error:void 0,lastStatus:je.lastStatus||"Resuming...",position:je.position??{x:window.innerWidth/2,y:window.innerHeight/2}};m(ee=>new Map(ee).set(je.id,Ge)),(We=k==null?void 0:k.onResume)==null||We.call(k,Ge);let Me=new AbortController;f.set(je.id,Me);let ae=k.provider.resume(je.id,Me.signal,se);B(je,ae)}},pe=async se=>{var he,Oe;let{element:le,prompt:ie,position:we,selectionBounds:Pe,sessionId:Ee}=se,We=k==null?void 0:k.storage;if(!(k!=null&&k.provider))return;let je=Ee?p().get(Ee):void 0,pt=!!Ee,Ge={content:je?je.context.content:await Jc([le],{maxLines:1/0}),prompt:ie,options:(he=k==null?void 0:k.getOptions)==null?void 0:he.call(k),sessionId:pt?Ee:void 0},Me;if(je)Me=Eo(je,{context:Ge,isStreaming:!0,lastStatus:"Thinking"},We);else{let qe=(le.tagName||"").toLowerCase()||void 0,ht=await Pn(le)||void 0;Me=g1(Ge,we,Pe,qe,ht),Me.lastStatus="Thinking",j.set(Me.id,le)}m(qe=>new Map(qe).set(Me.id,Me)),ru(Me,We),(Oe=k.onStart)==null||Oe.call(k,Me,le);let ae=new AbortController;f.set(Me.id,ae);let ee={...Ge,sessionId:Ee??Me.id},J=k.provider.send(ee,ae.signal);B(Me,J)},ve=se=>{let le=f.get(se);le&&le.abort()},be=()=>{f.forEach(se=>se.abort()),f.clear(),m(new Map),su(k==null?void 0:k.storage)},Te=se=>{let le=k==null?void 0:k.storage;j.delete(se),xm(se,le),m(ie=>{let we=new Map(ie);return we.delete(se),we})};return{sessions:p,isProcessing:$,tryResumeSessions:X,startSession:pe,abortSession:ve,abortAllSessions:be,dismissSession:Te,undoSession:se=>{var ie,we,Pe;let le=p().get(se);if(le){let Ee=j.get(se);(ie=k==null?void 0:k.onUndo)==null||ie.call(k,le,Ee),(Pe=(we=k==null?void 0:k.provider)==null?void 0:we.undo)==null||Pe.call(we)}Te(se)},acknowledgeSessionError:se=>{var ie;let le=(ie=p().get(se))==null?void 0:ie.context.prompt;return Te(se),le},retrySession:se=>{var pt;let le=p().get(se);if(!le||!(k!=null&&k.provider))return;let ie=k.storage,we=j.get(se),Pe=Eo(le,{error:void 0,isStreaming:!0,lastStatus:"Retrying"},ie);m(Ge=>new Map(Ge).set(se,Pe)),ru(Pe,ie),we&&((pt=k.onStart)==null||pt.call(k,Pe,we));let Ee=new AbortController;f.set(se,Ee);let We={...Pe.context,sessionId:se},je=k.provider.send(We,Ee.signal);B(Pe,je)},updateSessionBoundsOnViewportChange:()=>{let se=p();if(se.size===0)return;let le=new Map(se),ie=!1;for(let[we,Pe]of se){let Ee=j.get(we);if(Ee&&document.contains(Ee)){let We=Zt(Ee);if(We){let je=Pe.selectionBounds,pt=Pe.position;if(je){let Ge=je.x+je.width/2,Me=Pe.position.x-Ge,ae=We.x+We.width/2;pt={...Pe.position,x:ae+Me}}le.set(we,{...Pe,selectionBounds:We,position:pt}),ie=!0}}}ie&&m(le)},getSessionElement:se=>j.get(se),setOptions:M,getOptions:_}},vm=Y('<span class="tabular-nums align-middle">'),wm=Y('<span class="font-mono tabular-nums align-middle">&lt;<!>>'),x1=Y('<span class="tabular-nums ml-1 align-middle"> in '),v1=a=>"scheduler"in globalThis?globalThis.scheduler.postTask(a,{priority:"background"}):"requestIdleCallback"in window?requestIdleCallback(a):setTimeout(a,0),ou=!1,w1=()=>{var a;if(typeof window>"u")return null;try{let p=(a=document.currentScript)==null?void 0:a.getAttribute("data-options");return p?JSON.parse(p):null}catch{return null}},bm=a=>{let p=ym(a==null?void 0:a.theme);if(typeof window>"u")return im(p);let m=w1(),f={enabled:!0,activationMode:"toggle",keyHoldDuration:200,allowActivationInsideInput:!0,maxContextLines:3,...m,...a},j=ym(f.theme);return f.enabled===!1||ou?im(j):(ou=!0,(()=>{try{let k="0.0.88",M=`data:image/svg+xml;base64,${btoa(lv)}`;console.log(`%cReact Grab${k?` v${k}`:""}%c
https://react-grab.com`,`background: #330039; color: #ffffff; border: 1px solid #d75fcb; padding: 4px 4px 4px 24px; border-radius: 4px; background-image: url("${M}"); background-size: 16px 16px; background-repeat: no-repeat; background-position: 4px center; display: inline-block; margin-bottom: 4px;`,""),navigator.onLine&&k&&fetch(`https://www.react-grab.com/api/version?source=browser&t=${Date.now()}`,{referrerPolicy:"origin",keepalive:!0,priority:"low",cache:"no-store"}).then(_=>_.text()).then(_=>{_&&_!==k&&console.warn(`[React Grab] v${k} is outdated (latest: v${_})`)}).catch(()=>null)}catch{}})(),b(k=>{var Qm,Jm,Zm,Xm,ef,tf,rf;let[M,_]=h(j),[$,B]=h(!1),[Z,X]=h(-1e3),[pe,ve]=h(-1e3),[be,Te]=h(null),se=0,[le,ie]=h(!1),[we,Pe]=h(-1e3),[Ee,We]=h(-1e3),[je,pt]=h(!1),[Ge,Me]=h("idle"),[ae,ee]=h([]),[J,he]=h(null),[Oe,qe]=h(null),[ht,nt]=h(null),[lt,me]=h([]),[ye,ot]=h(!1),[De,_e]=h(!1),[Ve,ct]=h(!1),[Xe,vt]=h(!1),[Ct,Pt]=h(-1e3),[At,wt]=h(-1e3),[ar,gr]=h(0),[lr,Ri]=h(0),[bt,Xr]=h(!1),[iu,en]=h(""),[S1,au]=h(!1),[km,Sm]=h(void 0),[Tm,Cm]=h(void 0),[Mo,_r]=h(!1),[Pm,gn]=h(!1),[Fs,Zn]=h(null),[Nn,T1]=h(!!((Qm=f.agent)!=null&&Qm.provider)),[C1,P1]=h(!1),[j1,N1]=h(!!((Zm=(Jm=f.agent)==null?void 0:Jm.provider)!=null&&Zm.undo)),[I1,A1]=h(!!((ef=(Xm=f.agent)==null?void 0:Xm.provider)!=null&&ef.supportsFollowUp)),[E1,M1]=h((rf=(tf=f.agent)==null?void 0:tf.provider)==null?void 0:rf.dismissButtonText),[_1,Va]=h(null),[R1,jm]=h(null),[Nm,_o]=h(!1),[lu,Ka]=h(!1),Xn=new WeakMap,[cu,uu]=h(-1e3),[du,pu]=h(-1e3),[zi,Li]=h(!1),[Ro,Im]=h([]),In=E=>(E.tagName||"").toLowerCase(),Am=P(()=>{let E=Ro();if(!(E.length===0||!E[0]))return In(E[0])||void 0}),[Em]=z(()=>{let E=Ro();return E.length===0||!E[0]?null:E[0]},async E=>{if(E)return await Pn(E)||void 0}),tn=()=>{Li(!1),uu(-1e3),pu(-1e3),Im([])},z1=()=>{let E=window.getSelection();if(!E||E.isCollapsed||E.rangeCount===0)return;let H=E.getRangeAt(0).getClientRects();if(H.length===0)return;let re=(()=>{if(!E.anchorNode||!E.focusNode)return!1;let Se=E.anchorNode.compareDocumentPosition(E.focusNode);return Se&Node.DOCUMENT_POSITION_FOLLOWING?!1:Se&Node.DOCUMENT_POSITION_PRECEDING?!0:E.anchorOffset>E.focusOffset})(),ue=re?H[0]:H[H.length-1],Ne=re?ue.left:ue.right,Re=ue.top+ue.height/2;uu(Ne),pu(Re)};A(G(()=>lr(),()=>{zi()&&z1()}));let hu=P(()=>{lr();let E=Ro();if(!(E.length===0||!E[0]))return Zt(E[0])}),An=null,Ya=null,Qa=null,Rr=null,Us=null,Oi=null,yn=null,En=null,rn=P(()=>ye()&&!je()),Mm=(E,H)=>({top:H<25,bottom:H>window.innerHeight-25,left:E<25,right:E>window.innerWidth-25}),_m=(E,H)=>{var Se;let re=`grabbed-${Date.now()}-${Math.random()}`,ue=Date.now(),Ne={id:re,bounds:E,createdAt:ue,element:H},Re=lt();me([...Re,Ne]),(Se=f.onGrabbedBox)==null||Se.call(f,E,H),setTimeout(()=>{me($e=>$e.filter(Fe=>Fe.id!==re))},1700)},Rm=E=>{let H=E.map(re=>({tagName:In(re)}));window.dispatchEvent(new CustomEvent("react-grab:element-selected",{detail:{elements:H}}))},{createLabelInstance:L1,updateLabelInstance:zm,removeLabelInstance:O1}=Jb(ee),Bs=async(E,H,re,ue,Ne,Re,Se,$e)=>{if(Pt(E),wt(H),ue){let tt=ue.x+ue.width/2;gr(E-tt)}else gr(0);pt(!0),F1();let Fe=ue&&Ne?L1(ue,Ne,Re,"copying",Se,E):null;await re().finally(()=>{pt(!1),vt(!0),Se&&qe(Se),Ja(),Fe&&(zm(Fe,"copied"),setTimeout(()=>{zm(Fe,"fading"),setTimeout(()=>{O1(Fe)},350)},1500)),(De()||$e)&&yr()})},mu=(E,H)=>t1(f,E,H),Di=async(E,H)=>{var re;(re=f.onElementSelect)==null||re.call(f,E),M().grabbedBoxes.enabled&&_m(Zt(E),E),await new Promise(ue=>requestAnimationFrame(ue)),await mu([E],H),Rm([E])},Lm=async E=>{var H;if(E.length!==0){for(let re of E)(H=f.onElementSelect)==null||H.call(f,re);if(M().grabbedBoxes.enabled)for(let re of E)_m(Zt(re),re);await new Promise(re=>requestAnimationFrame(re)),await mu(E),Rm(E)}},rr=P(()=>{if(!rn()||le())return null;let E=be();return E&&!document.contains(E)?null:E}),zo=P(()=>Mo()?Fs():rr());A(()=>{let E=be();if(!E)return;let H=setInterval(()=>{document.contains(E)||Te(null)},100);F(()=>clearInterval(H))}),A(()=>{if(Mo())return;let E=rr();E&&Zn(E)});let Om=P(()=>{lr();let E=zo();if(E)return Zt(E)}),Dm=(E,H)=>{let re=E+window.scrollX,ue=H+window.scrollY;return{x:Math.abs(re-we()),y:Math.abs(ue-Ee())}},$m=P(()=>{if(!le())return!1;let E=Dm(Z(),pe());return E.x>2||E.y>2}),Fm=(E,H)=>{let re=E+window.scrollX,ue=H+window.scrollY,Ne=Math.min(we(),re),Re=Math.min(Ee(),ue),Se=Math.abs(re-we()),$e=Math.abs(ue-Ee());return{x:Ne-window.scrollX,y:Re-window.scrollY,width:Se,height:$e}},es=P(()=>{if(!$m())return;let E=Fm(Z(),pe());return{borderRadius:"0px",height:E.height,transform:"none",width:E.width,x:E.x,y:E.y}}),[D1]=z(()=>rr(),async E=>E?Pn(E):null),$1=P(()=>{let E=rr(),H=je();if(!E)return(()=>{var Ne=vm();return Ie(Ne,H?"Processing":"1 element"),Ne})();let re=In(E),ue=D1();return re&&ue?[(()=>{var Ne=wm(),Re=Ne.firstChild,Se=Re.nextSibling;return Se.nextSibling,Ie(Ne,re,Se),Ne})(),(()=>{var Ne=x1();return Ne.firstChild,Ie(Ne,ue,null),Ne})()]:re?(()=>{var Ne=wm(),Re=Ne.firstChild,Se=Re.nextSibling;return Se.nextSibling,Ie(Ne,re,Se),Ne})():(()=>{var Ne=vm();return Ie(Ne,H?"Processing":"1 element"),Ne})()}),fu=P(()=>{if(je()||Pm()){lr();let E=Fs()||rr();if(E){let H=Zt(E);return{x:H.x+H.width/2+ar(),y:At()}}return{x:Ct(),y:At()}}return{x:Z(),y:pe()}});A(G(()=>[rr(),J()],([E,H])=>{var re;H&&E&&H!==E&&he(null),E&&((re=f.onElementHover)==null||re.call(f,E))})),A(G(()=>rr(),E=>{let H=()=>{Sm(void 0),Cm(void 0)};if(!E){H();return}Ga(E).then(re=>{if(re){for(let ue of re)if(ue.fileName&&sm(ue.fileName)){Sm(Yc(ue.fileName)),Cm(ue.lineNumber);return}H()}}).catch(H)})),A(G(()=>lr(),()=>Wt.updateSessionBoundsOnViewportChange())),A(G(()=>[ye(),le(),je(),bt(),rr(),es()],([E,H,re,ue,Ne,Re])=>{var Se;(Se=f.onStateChange)==null||Se.call(f,{isActive:E,isDragging:H,isCopying:re,isInputMode:ue,targetElement:Ne,dragBounds:Re?{x:Re.x,y:Re.y,width:Re.width,height:Re.height}:null})})),A(G(()=>[bt(),Z(),pe(),rr()],([E,H,re,ue])=>{var Ne;(Ne=f.onInputModeChange)==null||Ne.call(f,E,{x:H,y:re,targetElement:ue})})),A(G(()=>[Vm(),Om(),rr()],([E,H,re])=>{var ue;(ue=f.onSelectionBox)==null||ue.call(f,!!E,H??null,re)})),A(G(()=>[Km(),es()],([E,H])=>{var re;(re=f.onDragBox)==null||re.call(f,!!E,H??null)})),A(G(()=>[Ym(),Z(),pe()],([E,H,re])=>{var ue;(ue=f.onCrosshair)==null||ue.call(f,!!E,{x:H,y:re})})),A(G(()=>[ok(),sk(),$1(),fu()],([E,H,re,ue])=>{var Re;let Ne=typeof re=="string"?re:"";(Re=f.onElementLabel)==null||Re.call(f,!!E,H,{x:ue.x,y:ue.y,content:Ne})}));let ts=null,Um=E=>{E?(ts||(ts=document.createElement("style"),ts.setAttribute("data-react-grab-cursor",""),document.head.appendChild(ts)),ts.textContent=`* { cursor: ${E} !important; }`):ts&&(ts.remove(),ts=null)};A(G(()=>[ye(),je(),le(),bt(),rr()],([E,H,re,ue,Ne])=>{Um(H?"progress":ue?null:E&&re?"crosshair":E&&Ne?"default":E?"crosshair":null)}));let F1=E=>{let H=Date.now(),re=f.keyHoldDuration??200;nt(H);let ue=()=>{let Ne=ht();if(Ne===null)return;let Re=(Date.now()-Ne)/re,Se=1-Math.exp(-Re);(je()?Math.min(Se,.95):1)<1&&(Qa=requestAnimationFrame(ue))};ue()},Ja=()=>{Qa!==null&&(cancelAnimationFrame(Qa),Qa=null),nt(null)},U1=()=>{let E=()=>{if(!le()){$i();return}let H=Mm(Z(),pe());H.top&&window.scrollBy(0,-10),H.bottom&&window.scrollBy(0,10),H.left&&window.scrollBy(-10,0),H.right&&window.scrollBy(10,0),H.top||H.bottom||H.left||H.right?Us=requestAnimationFrame(E):Us=null};E()},$i=()=>{Us!==null&&(cancelAnimationFrame(Us),Us=null)},Mn=()=>{var E;Ja(),Oi=document.activeElement,Ya=Date.now(),ot(!0),(E=f.onActivate)==null||E.call(f)},yr=()=>{var E;if(_e(!1),B(!1),ot(!1),Xr(!1),en(""),_r(!1),gn(!1),_o(!1),Zn(null),Me("idle"),vt(!1),le()&&(ie(!1),document.body.style.userSelect=""),An&&window.clearTimeout(An),Rr&&window.clearTimeout(Rr),yn){window.clearTimeout(yn),yn=null;let H=En;if(En=null,H){he(H.element);let re=Zt(H.element),ue=In(H.element);Pn(H.element).then(Ne=>{Bs(H.clientX,H.clientY,()=>Di(H.element),re,ue,Ne??void 0,H.element)})}}$i(),Ja(),Ya=null,Oi instanceof HTMLElement&&document.contains(Oi)&&Oi.focus(),Oi=null,(E=f.onDeactivate)==null||E.call(f)},Za=(E,H)=>{if(H&&document.contains(H)){let re=H.getBoundingClientRect(),ue=re.top+re.height/2;X(E.position.x),ve(ue),Zn(H),en(E.context.prompt),gn(!0),Xr(!0),_e(!0),_r(!0),ye()||Mn()}},B1=f.agent?{...f.agent,onAbort:(E,H)=>{var re,ue;(ue=(re=f.agent)==null?void 0:re.onAbort)==null||ue.call(re,E,H),Za(E,H)},onUndo:(E,H)=>{var re,ue;(ue=(re=f.agent)==null?void 0:re.onUndo)==null||ue.call(re,E,H),Za(E,H)}}:void 0,Wt=y1(B1),q1=E=>{en(E)},W1=()=>{qe(null);let E=Fs()||rr(),H=bt()?iu().trim():"";if(!E){yr();return}let re=Zt(E),ue=Z(),Ne=re.x+re.width/2,Re=re.y+re.height/2;if(Nn()&&H){Xn.delete(E),yr();let $e=_1();Va(null),jm(null),Wt.startSession({element:E,prompt:H,position:{x:ue,y:Re},selectionBounds:re,sessionId:$e??void 0});return}X(Ne),ve(Re),Xr(!1),en(""),H?Xn.set(E,H):Xn.delete(E);let Se=In(E);Pn(E).then($e=>{Bs(Ne,Re,()=>Di(E,H||void 0),re,Se,$e??void 0,E).then(()=>{yr()})})},gu=()=>{if(qe(null),!bt())return;let E=iu().trim();if(E&&!Nm()){_o(!0);return}let H=Fs()||rr();H&&E&&Xn.set(H,E),_o(!1),Va(null),yr()},G1=()=>{_o(!1),Va(null),yr()},H1=()=>{_o(!1)},V1=()=>{Ka(!1),Wt.abortAllSessions()},K1=()=>{Ka(!1)},Y1=()=>{if(!Nn())return;let E=Fs()||rr();if(E){let H=Zt(E),re=H.x+H.width/2;Pt(Z()),wt(pe()),gr(Z()-re);let ue=Xn.get(E);ue&&en(ue)}_e(!0),_r(!0),gn(!0),Xr(!0)},Q1=async()=>{var Se;let E=Ro();if(E.length===0)return;let H=cu(),re=du(),ue=hu(),Ne=Am();Li(!1),tn(),(Se=window.getSelection())==null||Se.removeAllRanges();let Re=Em();E.length===1?await Bs(H,re,()=>Di(E[0]),ue,Ne,Re):await Bs(H,re,()=>Lm(E),ue,Ne,Re)},J1=()=>{var ue;if(!Nn()||Ro().length===0)return;let E=hu(),H=E?E.x+E.width/2:cu(),re=E?E.y+E.height/2:du();Li(!1),tn(),(ue=window.getSelection())==null||ue.removeAllRanges(),X(H),ve(re),_e(!0),_r(!0),gn(!0),Mn(),Xr(!0)},Bm=(E,H)=>{if(bt()||Mo())return;vt(!1),X(E),ve(H);let re=performance.now();if(re-se>=32&&(se=re,v1(()=>{let ue=lm(E,H);Te(ue)})),le()){let ue=Mm(E,H),Ne=ue.top||ue.bottom||ue.left||ue.right;Ne&&Us===null?U1():!Ne&&Us!==null&&$i()}},qm=(E,H)=>{var Ne;if(!rn()||je())return!1;ie(!0);let re=E+window.scrollX,ue=H+window.scrollY;return Pe(re),We(ue),document.body.style.userSelect="none",(Ne=f.onDragStart)==null||Ne.call(f,re,ue),!0},Wm=(E,H)=>{var Ne;if(!le())return;let re=Dm(E,H),ue=re.x>2||re.y>2;if(ie(!1),$i(),document.body.style.userSelect="",ue){ct(!0);let Re=Fm(E,H),Se=a1(Re,jn),$e=Se.length>0?Se:l1(Re,jn);if($e.length>0){(Ne=f.onDragEnd)==null||Ne.call(f,$e,Re);let Fe=$e[0],tt=Fe.getBoundingClientRect(),xr={x:tt.left,y:tt.top,width:tt.width,height:tt.height,borderRadius:"0px",transform:pm(Fe)},cr=In(Fe),Wr=xr.x+xr.width/2,_n=xr.y+xr.height/2;Nn()?(X(Wr),ve(_n),Zn(Fe),_e(!0),_r(!0),gn(!0),ye()||Mn(),Xr(!0)):Pn(Fe).then(sn=>{Bs(Wr,_n,()=>Lm($e),xr,cr,sn??void 0,Fe,!0)})}}else{let Re=lm(E,H);if(!Re)return;if(Nn()){if(yn!==null){window.clearTimeout(yn),yn=null;let Se=(En==null?void 0:En.element)??Re;En=null;let $e=Zt(Se),Fe=$e.x+$e.width/2;Pt(E),wt(H),gr(E-Fe);let tt=Xn.get(Se);tt&&en(tt),X(E),ve(H),Zn(Se),_e(!0),_r(!0),gn(!0),Xr(!0);return}En={clientX:E,clientY:H,element:Re},yn=window.setTimeout(()=>{yn=null;let Se=En;if(En=null,!Se)return;he(Se.element);let $e=Zt(Se.element),Fe=In(Se.element);Pn(Se.element).then(tt=>{Bs(Se.clientX,Se.clientY,()=>Di(Se.element),$e,Fe,tt??void 0,Se.element)})},250)}else{he(Re);let Se=Zt(Re),$e=In(Re);Pn(Re).then(Fe=>{Bs(E,H,()=>Di(Re),Se,$e,Fe??void 0,Re)})}}},Ut=Qb(),Gm=new WeakSet,qs=E=>E==="Enter"||E==="NumpadEnter",nn=Object.getOwnPropertyDescriptor(KeyboardEvent.prototype,"key"),Hm=!1;if(nn!=null&&nn.get&&!nn.get.__reactGrabPatched){Hm=!0;let E=nn.get,H=function(){return Gm.has(this)?"":E.call(this)};H.__reactGrabPatched=!0,Object.defineProperty(KeyboardEvent.prototype,"key",{get:H,configurable:!0})}let Lo=E=>{let H;try{H=nn!=null&&nn.get?nn.get.call(E):E.key}catch{return!1}let re=H==="Enter"||qs(E.code),ue=ye()||$();return re&&ue&&!bt()&&!De()?(Gm.add(E),E.preventDefault(),E.stopPropagation(),E.stopImmediatePropagation(),!0):!1};Ut.addDocumentListener("keydown",Lo,{capture:!0}),Ut.addDocumentListener("keyup",Lo,{capture:!0}),Ut.addDocumentListener("keypress",Lo,{capture:!0}),Ut.addWindowListener("keydown",E=>{var Re;Lo(E);let H=qs(E.code)&&$()&&!bt();if(bt()&&fm(E,f)&&!E.repeat){E.preventDefault(),E.stopPropagation(),Xr(!1),en(""),_r(!1),gn(!1),_o(!1);return}if(bt()||Jn(E,"data-react-grab-ignore-events")&&!H){E.key==="Escape"&&Wt.isProcessing()&&!lu()&&(E.preventDefault(),E.stopPropagation(),Ka(!0));return}if(E.key==="Escape"){if(Wt.isProcessing()){lu()||(E.preventDefault(),E.stopPropagation(),Ka(!0));return}if($()){yr();return}}if($()&&!bt()){let Se=Fs()||rr();if(!Se)return;let $e=null;switch(E.key){case"ArrowUp":case"ArrowDown":{let Fe=Zt(Se),tt=document.elementsFromPoint(Fe.x+Fe.width/2,Fe.y+Fe.height/2).filter(jn),xr=tt.indexOf(Se);if(xr!==-1){let cr=E.key==="ArrowUp"?1:-1;$e=tt[xr+cr]??null}break}case"ArrowRight":case"ArrowLeft":{let Fe=E.key==="ArrowRight",tt=cr=>{let Wr=Array.from(cr.children),_n=Fe?Wr:Wr.reverse();for(let sn of _n)if(Fe){if(jn(sn))return sn;let Fi=tt(sn);if(Fi)return Fi}else{let Fi=tt(sn);if(Fi)return Fi;if(jn(sn))return sn}return null},xr=cr=>Fe?cr.nextElementSibling:cr.previousElementSibling;if(Fe&&($e=tt(Se)),!$e){let cr=Se;for(;cr;){let Wr=xr(cr);for(;Wr;){let sn=tt(Wr);if(sn){$e=sn;break}if(jn(Wr)){$e=Wr;break}Wr=xr(Wr)}if($e)break;let _n=cr.parentElement;if(!Fe&&_n&&jn(_n)){$e=_n;break}cr=_n}}break}}if($e){E.preventDefault(),E.stopPropagation(),Zn($e),_r(!0);let Fe=Zt($e);X(Fe.x+Fe.width/2),ve(Fe.y+Fe.height/2);return}}let re=Oe();if(qs(E.code)&&!$()&&!bt()&&!ye()&&re&&document.contains(re)&&Nn()&&!ae().some(Se=>Se.status==="copied"||Se.status==="fading")){E.preventDefault(),E.stopPropagation(),E.stopImmediatePropagation();let Se=Zt(re),$e=Se.x+Se.width/2,Fe=Se.y+Se.height/2;X($e),ve(Fe),Pt($e),wt(Fe),gr(0),Zn(re),qe(null),ee([]);let tt=Xn.get(re);tt&&en(tt),_e(!0),_r(!0),gn(!0),Mn(),Xr(!0);return}if(qs(E.code)&&$()&&!bt()&&Nn()){E.preventDefault(),E.stopPropagation(),E.stopImmediatePropagation();let Se=Fs()||rr();if(Se){let $e=Zt(Se),Fe=$e.x+$e.width/2;Pt(Z()),wt(pe()),gr(Z()-Fe);let tt=Xn.get(Se);tt&&en(tt)}_e(!0),_r(!0),gn(!0),Rr!==null&&(window.clearTimeout(Rr),Rr=null),ye()||(An&&window.clearTimeout(An),Mn()),Xr(!0);return}if(((Re=E.key)==null?void 0:Re.toLowerCase())==="o"&&!bt()&&ye()&&(E.metaKey||E.ctrlKey)){let Se=km(),$e=Tm();if(Se)if(E.preventDefault(),E.stopPropagation(),f.onOpenFile)f.onOpenFile(Se,$e);else{let Fe=wh(Se,$e);window.open(Fe,"_blank")}return}if(!f.allowActivationInsideInput&&Os(E)||!fm(E,f)&&(ye()&&!De()&&(E.metaKey||E.ctrlKey)&&!bh.includes(E.key)&&!qs(E.code)&&yr(),!qs(E.code)||!$()))return;if((ye()||$())&&!bt()&&(E.preventDefault(),qs(E.code)&&(E.stopPropagation(),E.stopImmediatePropagation())),ye()){if(De()&&f.activationMode!=="hold"||E.repeat)return;Rr!==null&&window.clearTimeout(Rr),Rr=window.setTimeout(()=>{yr()},200);return}if($()&&E.repeat)return;An!==null&&window.clearTimeout(An),$()||B(!0);let ue=f.keyHoldDuration??200,Ne=Os(E)?ue+150:ue;An=window.setTimeout(()=>{f.activationMode!=="hold"&&_e(!0),Mn()},Ne)},{capture:!0}),Ut.addWindowListener("keyup",E=>{var Re;if(Lo(E)||!$()&&!ye()||bt())return;let H=!!(f.activationShortcut||f.activationKey),re=(()=>{if(f.activationKey){let{metaKey:Se,ctrlKey:$e,shiftKey:Fe,altKey:tt}=f.activationKey;return{metaKey:!!Se,ctrlKey:!!$e,shiftKey:!!Fe,altKey:!!tt}}return{metaKey:!0,ctrlKey:!0,shiftKey:!1,altKey:!1}})(),ue=re.metaKey||re.ctrlKey?!E.metaKey&&!E.ctrlKey:re.shiftKey&&!E.shiftKey||re.altKey&&!E.altKey,Ne=f.activationShortcut?!f.activationShortcut(E):f.activationKey?f.activationKey.key?((Re=E.key)==null?void 0:Re.toLowerCase())===f.activationKey.key.toLowerCase()||mm(f.activationKey.key,E.code):!1:hm(E.key,E.code);if(ye()){if(ue){if(De()&&f.activationMode!=="hold")return;yr()}else!H&&Ne&&Rr!==null&&(window.clearTimeout(Rr),Rr=null);return}if(Ne||ue){if(De()&&f.activationMode!=="hold")return;yr()}},{capture:!0}),Ut.addWindowListener("keypress",Lo,{capture:!0}),Ut.addWindowListener("mousemove",E=>{au(!1),!Jn(E,"data-react-grab-ignore-events")&&($()&&!bt()&&Mo()&&_r(!1),Bm(E.clientX,E.clientY))}),Ut.addWindowListener("mousedown",E=>{if(!(E.button!==0||Jn(E,"data-react-grab-ignore-events"))){if(bt()){gu();return}qm(E.clientX,E.clientY)&&(E.preventDefault(),E.stopPropagation())}},{capture:!0}),Ut.addWindowListener("pointerdown",E=>{E.button===0&&(Jn(E,"data-react-grab-ignore-events")||!rn()||je()||bt()||E.stopPropagation())},{capture:!0}),Ut.addWindowListener("mouseup",E=>{E.button===0&&Wm(E.clientX,E.clientY)}),Ut.addWindowListener("touchmove",E=>{E.touches.length!==0&&(au(!0),!Jn(E,"data-react-grab-ignore-events")&&($()&&!bt()&&Mo()&&_r(!1),Bm(E.touches[0].clientX,E.touches[0].clientY)))},{passive:!0}),Ut.addWindowListener("touchstart",E=>{if(!(E.touches.length===0||(au(!0),Jn(E,"data-react-grab-ignore-events")))){if(bt()){gu();return}qm(E.touches[0].clientX,E.touches[0].clientY)&&E.preventDefault()}},{passive:!1}),Ut.addWindowListener("touchend",E=>{E.changedTouches.length!==0&&Wm(E.changedTouches[0].clientX,E.changedTouches[0].clientY)}),Ut.addWindowListener("click",E=>{Jn(E,"data-react-grab-ignore-events")||(rn()||je()||Ve())&&(E.preventDefault(),E.stopPropagation(),Ve()&&ct(!1),De()&&!je()&&!bt()&&($()?_e(!1):yr()))},{capture:!0}),Ut.addDocumentListener("visibilitychange",()=>{document.hidden&&(me([]),ye()&&!bt()&&Ya!==null&&Date.now()-Ya>500&&yr())}),Ut.addWindowListener("scroll",()=>{Ri(E=>E+1)},{capture:!0}),Ut.addWindowListener("resize",()=>{Ri(E=>E+1)}),Ut.addWindowListener("popstate",()=>{tn()});let Ws=null,Z1=()=>{let E=M().enabled&&(zi()||ye()||je()||ae().length>0||lt().length>0||Wt.sessions().size>0);E&&Ws===null?Ws=window.setInterval(()=>{if(Ri(H=>H+1),zi()){let H=Ro();H.length>0&&H[0]&&document.body.contains(H[0])||tn()}},100):!E&&Ws!==null&&(window.clearInterval(Ws),Ws=null)};A(()=>{M().enabled,zi(),ye(),je(),ae().length,lt().length,Wt.sessions().size,Z1()}),F(()=>{Ws!==null&&window.clearInterval(Ws)}),Ut.addDocumentListener("copy",E=>{bt()||Jn(E,"data-react-grab-ignore-events")||(rn()||je())&&E.preventDefault()},{capture:!0});let Xa=null;Ut.addDocumentListener("selectionchange",()=>{if(rn())return;Xa!==null&&window.clearTimeout(Xa),Li(!1);let E=window.getSelection();if(!E||E.isCollapsed||E.rangeCount===0){tn();return}Xa=window.setTimeout(()=>{Xa=null;let H=window.getSelection();if(!H||H.isCollapsed||H.rangeCount===0){tn();return}let re=H.getRangeAt(0),ue=re.getBoundingClientRect();if(ue.width===0&&ue.height===0){tn();return}if(!H.toString().trim()){tn();return}let Ne=(()=>{if(!H.anchorNode||!H.focusNode)return!1;let cr=H.anchorNode.compareDocumentPosition(H.focusNode);return cr&Node.DOCUMENT_POSITION_FOLLOWING?!1:cr&Node.DOCUMENT_POSITION_PRECEDING?!0:H.anchorOffset>H.focusOffset})(),Re=re.getClientRects();if(Re.length===0){tn();return}let Se=Ne?Re[0]:Re[Re.length-1],$e=Ne?Se.left:Se.right,Fe=Se.top+Se.height/2;if(sv($e,Fe)){tn();return}let tt=re.commonAncestorContainer,xr=tt.nodeType===Node.ELEMENT_NODE?tt:tt.parentElement;xr&&jn(xr)?(uu($e),pu(Fe),Im([xr]),Li(!0)):tn()},150)}),F(()=>{Ut.abort(),An&&window.clearTimeout(An),Rr&&window.clearTimeout(Rr),yn&&window.clearTimeout(yn),$i(),Ja(),document.body.style.userSelect="",Um(null),Hm&&nn&&Object.defineProperty(KeyboardEvent.prototype,"key",nn)});let yu=ov(Xx),Vm=P(()=>!M().selectionBox.enabled||Xe()?!1:rn()&&!le()&&!!zo()),X1=P(()=>{let E=zo();if(E)return In(E)||void 0}),[ek]=z(()=>zo(),async E=>E?await Pn(E)??void 0:void 0),tk=P(()=>!M().elementLabel.enabled||Xe()?!1:rn()&&!le()&&!!zo()),rk=P(()=>(lr(),ae().map(E=>!E.element||!document.body.contains(E.element)?E:{...E,bounds:Zt(E.element)}))),nk=P(()=>(lr(),lt().map(E=>!E.element||!document.body.contains(E.element)?E:{...E,bounds:Zt(E.element)}))),Km=P(()=>M().dragBox.enabled&&rn()&&$m()),sk=P(()=>je()?"processing":"hover"),ok=P(()=>!M().elementLabel.enabled||bt()?!1:je()?!0:rn()&&!le()&&!!zo()),Ym=P(()=>M().crosshair.enabled&&rn()&&!le()&&!S1()&&!Mo()),ik=P(()=>M().grabbedBoxes.enabled);return A(G(M,E=>{E.hue!==0?yu.style.filter=`hue-rotate(${E.hue}deg)`:yu.style.filter=""})),M().enabled&&Ls(()=>ge(Ow,{get selectionVisible(){return Vm()},get selectionBounds(){return Om()},get selectionFilePath(){return km()},get selectionLineNumber(){return Tm()},get selectionTagName(){return X1()},get selectionComponentName(){return ek()},get selectionLabelVisible(){return tk()},get selectionLabelStatus(){return Ge()},get labelInstances(){return rk()},get dragVisible(){return Km()},get dragBounds(){return es()},get grabbedBoxes(){return _t(()=>!!ik())()?nk():[]},labelZIndex:2147483647,get mouseX(){return fu().x},get mouseY(){return fu().y},get crosshairVisible(){return Ym()},get inputValue(){return iu()},get isInputExpanded(){return Pm()},get replyToPrompt(){return R1()??void 0},get hasAgent(){return Nn()},get isAgentConnected(){return C1()},get agentSessions(){return Wt.sessions()},get supportsUndo(){return j1()},get supportsFollowUp(){return I1()},get dismissButtonText(){return E1()},onAbortSession:E=>Wt.abortSession(E),onDismissSession:E=>Wt.dismissSession(E),onUndoSession:E=>Wt.undoSession(E),onReplySession:E=>{let H=Wt.sessions().get(E),re=Wt.getSessionElement(E);if(H&&re){let ue=H.position.x,Ne=re.getBoundingClientRect(),Re=Ne.top+Ne.height/2,Se=H.context.prompt;Wt.dismissSession(E),X(ue),ve(Re),Zn(re),en(""),gn(!0),Xr(!0),_e(!0),_r(!0),Va(H.context.sessionId??E),jm(Se),ye()||Mn()}},onAcknowledgeSessionError:E=>{let H=Wt.acknowledgeSessionError(E);H&&en(H)},onRetrySession:E=>{Wt.retrySession(E)},onInputChange:q1,onInputSubmit:()=>void W1(),onInputCancel:gu,onToggleExpand:Y1,get isPendingDismiss(){return Nm()},onConfirmDismiss:G1,onCancelDismiss:H1,get isPendingAgentAbort(){return lu()},onConfirmAgentAbort:V1,onCancelAgentAbort:K1,get nativeSelectionCursorVisible(){return zi()},get nativeSelectionCursorX(){return cu()},get nativeSelectionCursorY(){return du()},get nativeSelectionTagName(){return Am()},get nativeSelectionComponentName(){return Em()},get nativeSelectionBounds(){return hu()},onNativeSelectionCopy:()=>void Q1(),onNativeSelectionEnter:J1,get theme(){return M()}}),yu),Nn()&&Wt.tryResumeSessions(),{activate:()=>{ye()||(_e(!0),Mn())},deactivate:()=>{ye()&&yr()},toggle:()=>{ye()?yr():(_e(!0),Mn())},isActive:()=>ye(),dispose:()=>{ou=!1,k()},copyElement:async E=>{let H=Array.isArray(E)?E:[E];return H.length===0?!1:await mu(H)},getState:()=>({isActive:ye(),isDragging:le(),isCopying:je(),isInputMode:bt(),targetElement:rr(),dragBounds:es()?{x:es().x,y:es().y,width:es().width,height:es().height}:null}),updateTheme:E=>{let H=M(),re=m1(H,E);_(re)},getTheme:()=>M(),setAgent:E=>{var ue,Ne,Re,Se;let H=Wt.getOptions(),re={...H,...E,provider:E.provider??(H==null?void 0:H.provider),onAbort:($e,Fe)=>{var tt;(tt=E==null?void 0:E.onAbort)==null||tt.call(E,$e,Fe),Za($e,Fe)},onUndo:($e,Fe)=>{var tt;(tt=E==null?void 0:E.onUndo)==null||tt.call(E,$e,Fe),Za($e,Fe)}};Wt.setOptions(re),T1(!!re.provider),N1(!!((ue=re.provider)!=null&&ue.undo)),A1(!!((Ne=re.provider)!=null&&Ne.supportsFollowUp)),M1((Re=re.provider)==null?void 0:Re.dismissButtonText),(Se=re.provider)!=null&&Se.checkConnection&&re.provider.checkConnection().then($e=>{P1($e)}),Wt.tryResumeSessions()},updateOptions:E=>{f={...f,...E}}}}))},$s=null,b1=()=>typeof window>"u"?$s:window.__REACT_GRAB__??$s??null,k1=a=>{$s=a,typeof window<"u"&&(a?window.__REACT_GRAB__=a:delete window.__REACT_GRAB__)};typeof window<"u"&&(window.__REACT_GRAB__?$s=window.__REACT_GRAB__:($s=bm(),window.__REACT_GRAB__=$s,window.dispatchEvent(new CustomEvent("react-grab:init",{detail:$s}))));/*! Bundled license information:

bippy/dist/rdt-hook-CqLYUkwN.js:
  (**
   * @license bippy
   *
   * Copyright (c) Aiden Bai
   *
   * This source code is licensed under the MIT license found in the
   * LICENSE file in the root directory of this source tree.
   *)

bippy/dist/core-BmxLxXeu.js:
  (**
   * @license bippy
   *
   * Copyright (c) Aiden Bai
   *
   * This source code is licensed under the MIT license found in the
   * LICENSE file in the root directory of this source tree.
   *)

bippy/dist/source.js:
  (**
   * @license bippy
   *
   * Copyright (c) Aiden Bai
   *
   * This source code is licensed under the MIT license found in the
   * LICENSE file in the root directory of this source tree.
   *)

bippy/dist/install-hook-only-B8zA_JcI.js:
  (**
   * @license bippy
   *
   * Copyright (c) Aiden Bai
   *
   * This source code is licensed under the MIT license found in the
   * LICENSE file in the root directory of this source tree.
   *)

bippy/dist/index.js:
  (**
   * @license bippy
   *
   * Copyright (c) Aiden Bai
   *
   * This source code is licensed under the MIT license found in the
   * LICENSE file in the root directory of this source tree.
   *)
*/return e.DEFAULT_THEME=Zc,e.formatElementInfo=om,e.generateSnippet=Jc,e.getGlobalApi=b1,e.getStack=Ga,e.init=bm,e.isInstrumentationActive=Gc,e.setGlobalApi=k1,e})({});(function(e){var t=5e3,r="react-grab:agent-sessions",n=T=>{let I="",b="";for(let h of T.split(`
`))h.startsWith("event:")?I=h.slice(6).trim():h.startsWith("data:")&&(b=h.slice(5).trim());return{eventType:I,data:b}},o=async function*(T,I){let b=T.getReader(),h=new TextDecoder,v="",C=!1,A=()=>{C=!0,b.cancel().catch(()=>{})};I.addEventListener("abort",A);try{if(I.aborted)throw new DOMException("Aborted","AbortError");for(;;){let P=await b.read();if(C||I.aborted)throw new DOMException("Aborted","AbortError");let{done:N,value:z}=P;z&&(v+=h.decode(z,{stream:!0}));let L;for(;(L=v.indexOf(`

`))!==-1;){let{eventType:G,data:R}=n(v.slice(0,L));if(v=v.slice(L+2),G==="done")return;if(G==="error")throw new Error(R||"Agent error");R&&(yield R)}if(N)break}}finally{I.removeEventListener("abort",A);try{b.releaseLock()}catch{}}},i=T=>typeof T=="object"&&T!==null,l=(T,I,b=r)=>{let h=T.getItem(b);if(!h)throw new Error("No sessions to resume");let v;try{v=JSON.parse(h)}catch{throw new Error("Failed to parse stored sessions")}if(!i(v))throw new Error("Invalid stored sessions");let C=v[I];if(!i(C))throw new Error(`Session ${I} not found`);let A=C.context;if(!i(A))throw new Error(`Session ${I} is invalid`);let P=A.content,N=A.prompt;if(typeof P!="string"||typeof N!="string")throw new Error(`Session ${I} is invalid`);let z=A.options,L=A.sessionId;return{content:P,prompt:N,options:z,sessionId:typeof L=="string"?L:void 0}},c=async function*(T,I,b){let h=Date.now(),v=I.sessionId,C=T.pollIntervalMs??100,A=`${T.serverUrl}${T.agentPath??"/agent"}`,P=()=>{var z;if(!v)return;let N=((z=T.abortPath)==null?void 0:z.call(T,v))??`/abort/${v}`;fetch(`${T.serverUrl}${N}`,{method:"POST"}).catch(()=>{})};b.addEventListener("abort",P);try{let N=await fetch(A,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(I),signal:b});if(!N.ok)throw new Error(`Server error: ${N.status}`);if(!N.body)throw new Error("No response body");let z=o(N.body,b)[Symbol.asyncIterator](),L=!1,G=z.next(),R=null;for(;!L;){let F=await Promise.race([G.then(O=>({type:"status",iteratorResult:O})),new Promise(O=>setTimeout(()=>O({type:"timeout"}),C))]),D=(Date.now()-h)/1e3;if(F.type==="status"){let O=F.iteratorResult;L=O.done??!1,!L&&O.value&&(R=O.value,G=z.next())}R===T.completedStatus?yield`Completed in ${D.toFixed(1)}s`:R?yield`${R} ${D.toFixed(1)}s`:yield`Working ${D.toFixed(1)}s`}}finally{b.removeEventListener("abort",P)}},u=(T,I=t)=>{let b=null;return async()=>{let h=Date.now();if(b&&h-b.timestamp<I)return b.result;try{let v=await T();return b={result:v,timestamp:h},v}catch{return b={result:!1,timestamp:h},!1}}},d="Completed successfully",g="https://cursor-react-grab-server.xiechengqi.top",x=T=>typeof T=="object"&&T!==null&&"setAgent"in T,y=(T={})=>{let{serverUrl:I=g,getOptions:b}=T,h=C=>({...(b==null?void 0:b())??{},...C??{}}),v=u(async()=>(await fetch(`${I}/health`,{method:"GET"})).ok,t);return{send:async function*(C,A){let P={...C,options:h(C.options)};yield*c({serverUrl:I,completedStatus:d},P,A)},resume:async function*(C,A,P){let N=l(P,C),z={content:N.content,prompt:N.prompt,options:N.options,sessionId:N.sessionId??C},L={...z,options:h(z.options)};yield"Resuming...",yield*c({serverUrl:I,completedStatus:d},L,A)},supportsResume:!0,supportsFollowUp:!0,checkConnection:v,abort:async C=>{try{await fetch(`${I}/abort/${C}`,{method:"POST"})}catch{}},undo:async()=>{try{await fetch(`${I}/undo`,{method:"POST"})}catch{}}}},S=async()=>{if(typeof window>"u")return;let T=y(),I=v=>{v.setAgent({provider:T,storage:sessionStorage})},b=window.__REACT_GRAB__;if(x(b)){I(b);return}window.addEventListener("react-grab:init",v=>{v instanceof CustomEvent&&x(v.detail)&&I(v.detail)},{once:!0});let h=window.__REACT_GRAB__;x(h)&&I(h)};return S(),e.attachAgent=S,e.createCursorAgentProvider=y,e})({});var YN=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Gg(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var Hg={exports:{}},gc={},Vg={exports:{}},rt={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Ra=Symbol.for("react.element"),uk=Symbol.for("react.portal"),dk=Symbol.for("react.fragment"),pk=Symbol.for("react.strict_mode"),hk=Symbol.for("react.profiler"),mk=Symbol.for("react.provider"),fk=Symbol.for("react.context"),gk=Symbol.for("react.forward_ref"),yk=Symbol.for("react.suspense"),xk=Symbol.for("react.memo"),vk=Symbol.for("react.lazy"),nf=Symbol.iterator;function wk(e){return e===null||typeof e!="object"?null:(e=nf&&e[nf]||e["@@iterator"],typeof e=="function"?e:null)}var Kg={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},Yg=Object.assign,Qg={};function wi(e,t,r){this.props=e,this.context=t,this.refs=Qg,this.updater=r||Kg}wi.prototype.isReactComponent={};wi.prototype.setState=function(e,t){if(typeof e!="object"&&typeof e!="function"&&e!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,e,t,"setState")};wi.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")};function Jg(){}Jg.prototype=wi.prototype;function ep(e,t,r){this.props=e,this.context=t,this.refs=Qg,this.updater=r||Kg}var tp=ep.prototype=new Jg;tp.constructor=ep;Yg(tp,wi.prototype);tp.isPureReactComponent=!0;var sf=Array.isArray,Zg=Object.prototype.hasOwnProperty,rp={current:null},Xg={key:!0,ref:!0,__self:!0,__source:!0};function ey(e,t,r){var n,o={},i=null,l=null;if(t!=null)for(n in t.ref!==void 0&&(l=t.ref),t.key!==void 0&&(i=""+t.key),t)Zg.call(t,n)&&!Xg.hasOwnProperty(n)&&(o[n]=t[n]);var c=arguments.length-2;if(c===1)o.children=r;else if(1<c){for(var u=Array(c),d=0;d<c;d++)u[d]=arguments[d+2];o.children=u}if(e&&e.defaultProps)for(n in c=e.defaultProps,c)o[n]===void 0&&(o[n]=c[n]);return{$$typeof:Ra,type:e,key:i,ref:l,props:o,_owner:rp.current}}function bk(e,t){return{$$typeof:Ra,type:e.type,key:t,ref:e.ref,props:e.props,_owner:e._owner}}function np(e){return typeof e=="object"&&e!==null&&e.$$typeof===Ra}function kk(e){var t={"=":"=0",":":"=2"};return"$"+e.replace(/[=:]/g,function(r){return t[r]})}var of=/\/+/g;function xu(e,t){return typeof e=="object"&&e!==null&&e.key!=null?kk(""+e.key):t.toString(36)}function Tl(e,t,r,n,o){var i=typeof e;(i==="undefined"||i==="boolean")&&(e=null);var l=!1;if(e===null)l=!0;else switch(i){case"string":case"number":l=!0;break;case"object":switch(e.$$typeof){case Ra:case uk:l=!0}}if(l)return l=e,o=o(l),e=n===""?"."+xu(l,0):n,sf(o)?(r="",e!=null&&(r=e.replace(of,"$&/")+"/"),Tl(o,t,r,"",function(d){return d})):o!=null&&(np(o)&&(o=bk(o,r+(!o.key||l&&l.key===o.key?"":(""+o.key).replace(of,"$&/")+"/")+e)),t.push(o)),1;if(l=0,n=n===""?".":n+":",sf(e))for(var c=0;c<e.length;c++){i=e[c];var u=n+xu(i,c);l+=Tl(i,t,r,u,o)}else if(u=wk(e),typeof u=="function")for(e=u.call(e),c=0;!(i=e.next()).done;)i=i.value,u=n+xu(i,c++),l+=Tl(i,t,r,u,o);else if(i==="object")throw t=String(e),Error("Objects are not valid as a React child (found: "+(t==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":t)+"). If you meant to render a collection of children, use an array instead.");return l}function el(e,t,r){if(e==null)return e;var n=[],o=0;return Tl(e,n,"","",function(i){return t.call(r,i,o++)}),n}function Sk(e){if(e._status===-1){var t=e._result;t=t(),t.then(function(r){(e._status===0||e._status===-1)&&(e._status=1,e._result=r)},function(r){(e._status===0||e._status===-1)&&(e._status=2,e._result=r)}),e._status===-1&&(e._status=0,e._result=t)}if(e._status===1)return e._result.default;throw e._result}var Sr={current:null},Cl={transition:null},Tk={ReactCurrentDispatcher:Sr,ReactCurrentBatchConfig:Cl,ReactCurrentOwner:rp};function ty(){throw Error("act(...) is not supported in production builds of React.")}rt.Children={map:el,forEach:function(e,t,r){el(e,function(){t.apply(this,arguments)},r)},count:function(e){var t=0;return el(e,function(){t++}),t},toArray:function(e){return el(e,function(t){return t})||[]},only:function(e){if(!np(e))throw Error("React.Children.only expected to receive a single React element child.");return e}};rt.Component=wi;rt.Fragment=dk;rt.Profiler=hk;rt.PureComponent=ep;rt.StrictMode=pk;rt.Suspense=yk;rt.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=Tk;rt.act=ty;rt.cloneElement=function(e,t,r){if(e==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+e+".");var n=Yg({},e.props),o=e.key,i=e.ref,l=e._owner;if(t!=null){if(t.ref!==void 0&&(i=t.ref,l=rp.current),t.key!==void 0&&(o=""+t.key),e.type&&e.type.defaultProps)var c=e.type.defaultProps;for(u in t)Zg.call(t,u)&&!Xg.hasOwnProperty(u)&&(n[u]=t[u]===void 0&&c!==void 0?c[u]:t[u])}var u=arguments.length-2;if(u===1)n.children=r;else if(1<u){c=Array(u);for(var d=0;d<u;d++)c[d]=arguments[d+2];n.children=c}return{$$typeof:Ra,type:e.type,key:o,ref:i,props:n,_owner:l}};rt.createContext=function(e){return e={$$typeof:fk,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},e.Provider={$$typeof:mk,_context:e},e.Consumer=e};rt.createElement=ey;rt.createFactory=function(e){var t=ey.bind(null,e);return t.type=e,t};rt.createRef=function(){return{current:null}};rt.forwardRef=function(e){return{$$typeof:gk,render:e}};rt.isValidElement=np;rt.lazy=function(e){return{$$typeof:vk,_payload:{_status:-1,_result:e},_init:Sk}};rt.memo=function(e,t){return{$$typeof:xk,type:e,compare:t===void 0?null:t}};rt.startTransition=function(e){var t=Cl.transition;Cl.transition={};try{e()}finally{Cl.transition=t}};rt.unstable_act=ty;rt.useCallback=function(e,t){return Sr.current.useCallback(e,t)};rt.useContext=function(e){return Sr.current.useContext(e)};rt.useDebugValue=function(){};rt.useDeferredValue=function(e){return Sr.current.useDeferredValue(e)};rt.useEffect=function(e,t){return Sr.current.useEffect(e,t)};rt.useId=function(){return Sr.current.useId()};rt.useImperativeHandle=function(e,t,r){return Sr.current.useImperativeHandle(e,t,r)};rt.useInsertionEffect=function(e,t){return Sr.current.useInsertionEffect(e,t)};rt.useLayoutEffect=function(e,t){return Sr.current.useLayoutEffect(e,t)};rt.useMemo=function(e,t){return Sr.current.useMemo(e,t)};rt.useReducer=function(e,t,r){return Sr.current.useReducer(e,t,r)};rt.useRef=function(e){return Sr.current.useRef(e)};rt.useState=function(e){return Sr.current.useState(e)};rt.useSyncExternalStore=function(e,t,r){return Sr.current.useSyncExternalStore(e,t,r)};rt.useTransition=function(){return Sr.current.useTransition()};rt.version="18.3.1";Vg.exports=rt;var w=Vg.exports;const sp=Gg(w),Ck=ck({__proto__:null,default:sp},[w]);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Pk=w,jk=Symbol.for("react.element"),Nk=Symbol.for("react.fragment"),Ik=Object.prototype.hasOwnProperty,Ak=Pk.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,Ek={key:!0,ref:!0,__self:!0,__source:!0};function ry(e,t,r){var n,o={},i=null,l=null;r!==void 0&&(i=""+r),t.key!==void 0&&(i=""+t.key),t.ref!==void 0&&(l=t.ref);for(n in t)Ik.call(t,n)&&!Ek.hasOwnProperty(n)&&(o[n]=t[n]);if(e&&e.defaultProps)for(n in t=e.defaultProps,t)o[n]===void 0&&(o[n]=t[n]);return{$$typeof:jk,type:e,key:i,ref:l,props:o,_owner:Ak.current}}gc.Fragment=Nk;gc.jsx=ry;gc.jsxs=ry;Hg.exports=gc;var s=Hg.exports,Qu={},ny={exports:{}},Ur={},sy={exports:{}},oy={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(e){function t(U,te){var ne=U.length;U.push(te);e:for(;0<ne;){var Ce=ne-1>>>1,ze=U[Ce];if(0<o(ze,te))U[Ce]=te,U[ne]=ze,ne=Ce;else break e}}function r(U){return U.length===0?null:U[0]}function n(U){if(U.length===0)return null;var te=U[0],ne=U.pop();if(ne!==te){U[0]=ne;e:for(var Ce=0,ze=U.length,Qe=ze>>>1;Ce<Qe;){var fe=2*(Ce+1)-1,He=U[fe],ce=fe+1,V=U[ce];if(0>o(He,ne))ce<ze&&0>o(V,He)?(U[Ce]=V,U[ce]=ne,Ce=ce):(U[Ce]=He,U[fe]=ne,Ce=fe);else if(ce<ze&&0>o(V,ne))U[Ce]=V,U[ce]=ne,Ce=ce;else break e}}return te}function o(U,te){var ne=U.sortIndex-te.sortIndex;return ne!==0?ne:U.id-te.id}if(typeof performance=="object"&&typeof performance.now=="function"){var i=performance;e.unstable_now=function(){return i.now()}}else{var l=Date,c=l.now();e.unstable_now=function(){return l.now()-c}}var u=[],d=[],g=1,x=null,y=3,S=!1,T=!1,I=!1,b=typeof setTimeout=="function"?setTimeout:null,h=typeof clearTimeout=="function"?clearTimeout:null,v=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function C(U){for(var te=r(d);te!==null;){if(te.callback===null)n(d);else if(te.startTime<=U)n(d),te.sortIndex=te.expirationTime,t(u,te);else break;te=r(d)}}function A(U){if(I=!1,C(U),!T)if(r(u)!==null)T=!0,oe(P);else{var te=r(d);te!==null&&W(A,te.startTime-U)}}function P(U,te){T=!1,I&&(I=!1,h(L),L=-1),S=!0;var ne=y;try{for(C(te),x=r(u);x!==null&&(!(x.expirationTime>te)||U&&!F());){var Ce=x.callback;if(typeof Ce=="function"){x.callback=null,y=x.priorityLevel;var ze=Ce(x.expirationTime<=te);te=e.unstable_now(),typeof ze=="function"?x.callback=ze:x===r(u)&&n(u),C(te)}else n(u);x=r(u)}if(x!==null)var Qe=!0;else{var fe=r(d);fe!==null&&W(A,fe.startTime-te),Qe=!1}return Qe}finally{x=null,y=ne,S=!1}}var N=!1,z=null,L=-1,G=5,R=-1;function F(){return!(e.unstable_now()-R<G)}function D(){if(z!==null){var U=e.unstable_now();R=U;var te=!0;try{te=z(!0,U)}finally{te?O():(N=!1,z=null)}}else N=!1}var O;if(typeof v=="function")O=function(){v(D)};else if(typeof MessageChannel<"u"){var q=new MessageChannel,Q=q.port2;q.port1.onmessage=D,O=function(){Q.postMessage(null)}}else O=function(){b(D,0)};function oe(U){z=U,N||(N=!0,O())}function W(U,te){L=b(function(){U(e.unstable_now())},te)}e.unstable_IdlePriority=5,e.unstable_ImmediatePriority=1,e.unstable_LowPriority=4,e.unstable_NormalPriority=3,e.unstable_Profiling=null,e.unstable_UserBlockingPriority=2,e.unstable_cancelCallback=function(U){U.callback=null},e.unstable_continueExecution=function(){T||S||(T=!0,oe(P))},e.unstable_forceFrameRate=function(U){0>U||125<U?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):G=0<U?Math.floor(1e3/U):5},e.unstable_getCurrentPriorityLevel=function(){return y},e.unstable_getFirstCallbackNode=function(){return r(u)},e.unstable_next=function(U){switch(y){case 1:case 2:case 3:var te=3;break;default:te=y}var ne=y;y=te;try{return U()}finally{y=ne}},e.unstable_pauseExecution=function(){},e.unstable_requestPaint=function(){},e.unstable_runWithPriority=function(U,te){switch(U){case 1:case 2:case 3:case 4:case 5:break;default:U=3}var ne=y;y=U;try{return te()}finally{y=ne}},e.unstable_scheduleCallback=function(U,te,ne){var Ce=e.unstable_now();switch(typeof ne=="object"&&ne!==null?(ne=ne.delay,ne=typeof ne=="number"&&0<ne?Ce+ne:Ce):ne=Ce,U){case 1:var ze=-1;break;case 2:ze=250;break;case 5:ze=1073741823;break;case 4:ze=1e4;break;default:ze=5e3}return ze=ne+ze,U={id:g++,callback:te,priorityLevel:U,startTime:ne,expirationTime:ze,sortIndex:-1},ne>Ce?(U.sortIndex=ne,t(d,U),r(u)===null&&U===r(d)&&(I?(h(L),L=-1):I=!0,W(A,ne-Ce))):(U.sortIndex=ze,t(u,U),T||S||(T=!0,oe(P))),U},e.unstable_shouldYield=F,e.unstable_wrapCallback=function(U){var te=y;return function(){var ne=y;y=te;try{return U.apply(this,arguments)}finally{y=ne}}}})(oy);sy.exports=oy;var Mk=sy.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var _k=w,Fr=Mk;function de(e){for(var t="https://reactjs.org/docs/error-decoder.html?invariant="+e,r=1;r<arguments.length;r++)t+="&args[]="+encodeURIComponent(arguments[r]);return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var iy=new Set,ha={};function go(e,t){pi(e,t),pi(e+"Capture",t)}function pi(e,t){for(ha[e]=t,e=0;e<t.length;e++)iy.add(t[e])}var Bn=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),Ju=Object.prototype.hasOwnProperty,Rk=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,af={},lf={};function zk(e){return Ju.call(lf,e)?!0:Ju.call(af,e)?!1:Rk.test(e)?lf[e]=!0:(af[e]=!0,!1)}function Lk(e,t,r,n){if(r!==null&&r.type===0)return!1;switch(typeof t){case"function":case"symbol":return!0;case"boolean":return n?!1:r!==null?!r.acceptsBooleans:(e=e.toLowerCase().slice(0,5),e!=="data-"&&e!=="aria-");default:return!1}}function Ok(e,t,r,n){if(t===null||typeof t>"u"||Lk(e,t,r,n))return!0;if(n)return!1;if(r!==null)switch(r.type){case 3:return!t;case 4:return t===!1;case 5:return isNaN(t);case 6:return isNaN(t)||1>t}return!1}function Tr(e,t,r,n,o,i,l){this.acceptsBooleans=t===2||t===3||t===4,this.attributeName=n,this.attributeNamespace=o,this.mustUseProperty=r,this.propertyName=e,this.type=t,this.sanitizeURL=i,this.removeEmptyString=l}var ir={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(e){ir[e]=new Tr(e,0,!1,e,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(e){var t=e[0];ir[t]=new Tr(t,1,!1,e[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(e){ir[e]=new Tr(e,2,!1,e.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(e){ir[e]=new Tr(e,2,!1,e,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(e){ir[e]=new Tr(e,3,!1,e.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(e){ir[e]=new Tr(e,3,!0,e,null,!1,!1)});["capture","download"].forEach(function(e){ir[e]=new Tr(e,4,!1,e,null,!1,!1)});["cols","rows","size","span"].forEach(function(e){ir[e]=new Tr(e,6,!1,e,null,!1,!1)});["rowSpan","start"].forEach(function(e){ir[e]=new Tr(e,5,!1,e.toLowerCase(),null,!1,!1)});var op=/[\-:]([a-z])/g;function ip(e){return e[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(e){var t=e.replace(op,ip);ir[t]=new Tr(t,1,!1,e,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(e){var t=e.replace(op,ip);ir[t]=new Tr(t,1,!1,e,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(e){var t=e.replace(op,ip);ir[t]=new Tr(t,1,!1,e,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(e){ir[e]=new Tr(e,1,!1,e.toLowerCase(),null,!1,!1)});ir.xlinkHref=new Tr("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(e){ir[e]=new Tr(e,1,!1,e.toLowerCase(),null,!0,!0)});function ap(e,t,r,n){var o=ir.hasOwnProperty(t)?ir[t]:null;(o!==null?o.type!==0:n||!(2<t.length)||t[0]!=="o"&&t[0]!=="O"||t[1]!=="n"&&t[1]!=="N")&&(Ok(t,r,o,n)&&(r=null),n||o===null?zk(t)&&(r===null?e.removeAttribute(t):e.setAttribute(t,""+r)):o.mustUseProperty?e[o.propertyName]=r===null?o.type===3?!1:"":r:(t=o.attributeName,n=o.attributeNamespace,r===null?e.removeAttribute(t):(o=o.type,r=o===3||o===4&&r===!0?"":""+r,n?e.setAttributeNS(n,t,r):e.setAttribute(t,r))))}var Vn=_k.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,tl=Symbol.for("react.element"),Ho=Symbol.for("react.portal"),Vo=Symbol.for("react.fragment"),lp=Symbol.for("react.strict_mode"),Zu=Symbol.for("react.profiler"),ay=Symbol.for("react.provider"),ly=Symbol.for("react.context"),cp=Symbol.for("react.forward_ref"),Xu=Symbol.for("react.suspense"),ed=Symbol.for("react.suspense_list"),up=Symbol.for("react.memo"),ns=Symbol.for("react.lazy"),cy=Symbol.for("react.offscreen"),cf=Symbol.iterator;function Ui(e){return e===null||typeof e!="object"?null:(e=cf&&e[cf]||e["@@iterator"],typeof e=="function"?e:null)}var Dt=Object.assign,vu;function Ji(e){if(vu===void 0)try{throw Error()}catch(r){var t=r.stack.trim().match(/\n( *(at )?)/);vu=t&&t[1]||""}return`
`+vu+e}var wu=!1;function bu(e,t){if(!e||wu)return"";wu=!0;var r=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(t)if(t=function(){throw Error()},Object.defineProperty(t.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(t,[])}catch(d){var n=d}Reflect.construct(e,[],t)}else{try{t.call()}catch(d){n=d}e.call(t.prototype)}else{try{throw Error()}catch(d){n=d}e()}}catch(d){if(d&&n&&typeof d.stack=="string"){for(var o=d.stack.split(`
`),i=n.stack.split(`
`),l=o.length-1,c=i.length-1;1<=l&&0<=c&&o[l]!==i[c];)c--;for(;1<=l&&0<=c;l--,c--)if(o[l]!==i[c]){if(l!==1||c!==1)do if(l--,c--,0>c||o[l]!==i[c]){var u=`
`+o[l].replace(" at new "," at ");return e.displayName&&u.includes("<anonymous>")&&(u=u.replace("<anonymous>",e.displayName)),u}while(1<=l&&0<=c);break}}}finally{wu=!1,Error.prepareStackTrace=r}return(e=e?e.displayName||e.name:"")?Ji(e):""}function Dk(e){switch(e.tag){case 5:return Ji(e.type);case 16:return Ji("Lazy");case 13:return Ji("Suspense");case 19:return Ji("SuspenseList");case 0:case 2:case 15:return e=bu(e.type,!1),e;case 11:return e=bu(e.type.render,!1),e;case 1:return e=bu(e.type,!0),e;default:return""}}function td(e){if(e==null)return null;if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e;switch(e){case Vo:return"Fragment";case Ho:return"Portal";case Zu:return"Profiler";case lp:return"StrictMode";case Xu:return"Suspense";case ed:return"SuspenseList"}if(typeof e=="object")switch(e.$$typeof){case ly:return(e.displayName||"Context")+".Consumer";case ay:return(e._context.displayName||"Context")+".Provider";case cp:var t=e.render;return e=e.displayName,e||(e=t.displayName||t.name||"",e=e!==""?"ForwardRef("+e+")":"ForwardRef"),e;case up:return t=e.displayName||null,t!==null?t:td(e.type)||"Memo";case ns:t=e._payload,e=e._init;try{return td(e(t))}catch{}}return null}function $k(e){var t=e.type;switch(e.tag){case 24:return"Cache";case 9:return(t.displayName||"Context")+".Consumer";case 10:return(t._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return e=t.render,e=e.displayName||e.name||"",t.displayName||(e!==""?"ForwardRef("+e+")":"ForwardRef");case 7:return"Fragment";case 5:return t;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return td(t);case 8:return t===lp?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof t=="function")return t.displayName||t.name||null;if(typeof t=="string")return t}return null}function Is(e){switch(typeof e){case"boolean":case"number":case"string":case"undefined":return e;case"object":return e;default:return""}}function uy(e){var t=e.type;return(e=e.nodeName)&&e.toLowerCase()==="input"&&(t==="checkbox"||t==="radio")}function Fk(e){var t=uy(e)?"checked":"value",r=Object.getOwnPropertyDescriptor(e.constructor.prototype,t),n=""+e[t];if(!e.hasOwnProperty(t)&&typeof r<"u"&&typeof r.get=="function"&&typeof r.set=="function"){var o=r.get,i=r.set;return Object.defineProperty(e,t,{configurable:!0,get:function(){return o.call(this)},set:function(l){n=""+l,i.call(this,l)}}),Object.defineProperty(e,t,{enumerable:r.enumerable}),{getValue:function(){return n},setValue:function(l){n=""+l},stopTracking:function(){e._valueTracker=null,delete e[t]}}}}function rl(e){e._valueTracker||(e._valueTracker=Fk(e))}function dy(e){if(!e)return!1;var t=e._valueTracker;if(!t)return!0;var r=t.getValue(),n="";return e&&(n=uy(e)?e.checked?"true":"false":e.value),e=n,e!==r?(t.setValue(e),!0):!1}function Ll(e){if(e=e||(typeof document<"u"?document:void 0),typeof e>"u")return null;try{return e.activeElement||e.body}catch{return e.body}}function rd(e,t){var r=t.checked;return Dt({},t,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:r??e._wrapperState.initialChecked})}function uf(e,t){var r=t.defaultValue==null?"":t.defaultValue,n=t.checked!=null?t.checked:t.defaultChecked;r=Is(t.value!=null?t.value:r),e._wrapperState={initialChecked:n,initialValue:r,controlled:t.type==="checkbox"||t.type==="radio"?t.checked!=null:t.value!=null}}function py(e,t){t=t.checked,t!=null&&ap(e,"checked",t,!1)}function nd(e,t){py(e,t);var r=Is(t.value),n=t.type;if(r!=null)n==="number"?(r===0&&e.value===""||e.value!=r)&&(e.value=""+r):e.value!==""+r&&(e.value=""+r);else if(n==="submit"||n==="reset"){e.removeAttribute("value");return}t.hasOwnProperty("value")?sd(e,t.type,r):t.hasOwnProperty("defaultValue")&&sd(e,t.type,Is(t.defaultValue)),t.checked==null&&t.defaultChecked!=null&&(e.defaultChecked=!!t.defaultChecked)}function df(e,t,r){if(t.hasOwnProperty("value")||t.hasOwnProperty("defaultValue")){var n=t.type;if(!(n!=="submit"&&n!=="reset"||t.value!==void 0&&t.value!==null))return;t=""+e._wrapperState.initialValue,r||t===e.value||(e.value=t),e.defaultValue=t}r=e.name,r!==""&&(e.name=""),e.defaultChecked=!!e._wrapperState.initialChecked,r!==""&&(e.name=r)}function sd(e,t,r){(t!=="number"||Ll(e.ownerDocument)!==e)&&(r==null?e.defaultValue=""+e._wrapperState.initialValue:e.defaultValue!==""+r&&(e.defaultValue=""+r))}var Zi=Array.isArray;function si(e,t,r,n){if(e=e.options,t){t={};for(var o=0;o<r.length;o++)t["$"+r[o]]=!0;for(r=0;r<e.length;r++)o=t.hasOwnProperty("$"+e[r].value),e[r].selected!==o&&(e[r].selected=o),o&&n&&(e[r].defaultSelected=!0)}else{for(r=""+Is(r),t=null,o=0;o<e.length;o++){if(e[o].value===r){e[o].selected=!0,n&&(e[o].defaultSelected=!0);return}t!==null||e[o].disabled||(t=e[o])}t!==null&&(t.selected=!0)}}function od(e,t){if(t.dangerouslySetInnerHTML!=null)throw Error(de(91));return Dt({},t,{value:void 0,defaultValue:void 0,children:""+e._wrapperState.initialValue})}function pf(e,t){var r=t.value;if(r==null){if(r=t.children,t=t.defaultValue,r!=null){if(t!=null)throw Error(de(92));if(Zi(r)){if(1<r.length)throw Error(de(93));r=r[0]}t=r}t==null&&(t=""),r=t}e._wrapperState={initialValue:Is(r)}}function hy(e,t){var r=Is(t.value),n=Is(t.defaultValue);r!=null&&(r=""+r,r!==e.value&&(e.value=r),t.defaultValue==null&&e.defaultValue!==r&&(e.defaultValue=r)),n!=null&&(e.defaultValue=""+n)}function hf(e){var t=e.textContent;t===e._wrapperState.initialValue&&t!==""&&t!==null&&(e.value=t)}function my(e){switch(e){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function id(e,t){return e==null||e==="http://www.w3.org/1999/xhtml"?my(t):e==="http://www.w3.org/2000/svg"&&t==="foreignObject"?"http://www.w3.org/1999/xhtml":e}var nl,fy=function(e){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(t,r,n,o){MSApp.execUnsafeLocalFunction(function(){return e(t,r,n,o)})}:e}(function(e,t){if(e.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in e)e.innerHTML=t;else{for(nl=nl||document.createElement("div"),nl.innerHTML="<svg>"+t.valueOf().toString()+"</svg>",t=nl.firstChild;e.firstChild;)e.removeChild(e.firstChild);for(;t.firstChild;)e.appendChild(t.firstChild)}});function ma(e,t){if(t){var r=e.firstChild;if(r&&r===e.lastChild&&r.nodeType===3){r.nodeValue=t;return}}e.textContent=t}var ra={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},Uk=["Webkit","ms","Moz","O"];Object.keys(ra).forEach(function(e){Uk.forEach(function(t){t=t+e.charAt(0).toUpperCase()+e.substring(1),ra[t]=ra[e]})});function gy(e,t,r){return t==null||typeof t=="boolean"||t===""?"":r||typeof t!="number"||t===0||ra.hasOwnProperty(e)&&ra[e]?(""+t).trim():t+"px"}function yy(e,t){e=e.style;for(var r in t)if(t.hasOwnProperty(r)){var n=r.indexOf("--")===0,o=gy(r,t[r],n);r==="float"&&(r="cssFloat"),n?e.setProperty(r,o):e[r]=o}}var Bk=Dt({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function ad(e,t){if(t){if(Bk[e]&&(t.children!=null||t.dangerouslySetInnerHTML!=null))throw Error(de(137,e));if(t.dangerouslySetInnerHTML!=null){if(t.children!=null)throw Error(de(60));if(typeof t.dangerouslySetInnerHTML!="object"||!("__html"in t.dangerouslySetInnerHTML))throw Error(de(61))}if(t.style!=null&&typeof t.style!="object")throw Error(de(62))}}function ld(e,t){if(e.indexOf("-")===-1)return typeof t.is=="string";switch(e){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var cd=null;function dp(e){return e=e.target||e.srcElement||window,e.correspondingUseElement&&(e=e.correspondingUseElement),e.nodeType===3?e.parentNode:e}var ud=null,oi=null,ii=null;function mf(e){if(e=Oa(e)){if(typeof ud!="function")throw Error(de(280));var t=e.stateNode;t&&(t=bc(t),ud(e.stateNode,e.type,t))}}function xy(e){oi?ii?ii.push(e):ii=[e]:oi=e}function vy(){if(oi){var e=oi,t=ii;if(ii=oi=null,mf(e),t)for(e=0;e<t.length;e++)mf(t[e])}}function wy(e,t){return e(t)}function by(){}var ku=!1;function ky(e,t,r){if(ku)return e(t,r);ku=!0;try{return wy(e,t,r)}finally{ku=!1,(oi!==null||ii!==null)&&(by(),vy())}}function fa(e,t){var r=e.stateNode;if(r===null)return null;var n=bc(r);if(n===null)return null;r=n[t];e:switch(t){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(n=!n.disabled)||(e=e.type,n=!(e==="button"||e==="input"||e==="select"||e==="textarea")),e=!n;break e;default:e=!1}if(e)return null;if(r&&typeof r!="function")throw Error(de(231,t,typeof r));return r}var dd=!1;if(Bn)try{var Bi={};Object.defineProperty(Bi,"passive",{get:function(){dd=!0}}),window.addEventListener("test",Bi,Bi),window.removeEventListener("test",Bi,Bi)}catch{dd=!1}function qk(e,t,r,n,o,i,l,c,u){var d=Array.prototype.slice.call(arguments,3);try{t.apply(r,d)}catch(g){this.onError(g)}}var na=!1,Ol=null,Dl=!1,pd=null,Wk={onError:function(e){na=!0,Ol=e}};function Gk(e,t,r,n,o,i,l,c,u){na=!1,Ol=null,qk.apply(Wk,arguments)}function Hk(e,t,r,n,o,i,l,c,u){if(Gk.apply(this,arguments),na){if(na){var d=Ol;na=!1,Ol=null}else throw Error(de(198));Dl||(Dl=!0,pd=d)}}function yo(e){var t=e,r=e;if(e.alternate)for(;t.return;)t=t.return;else{e=t;do t=e,t.flags&4098&&(r=t.return),e=t.return;while(e)}return t.tag===3?r:null}function Sy(e){if(e.tag===13){var t=e.memoizedState;if(t===null&&(e=e.alternate,e!==null&&(t=e.memoizedState)),t!==null)return t.dehydrated}return null}function ff(e){if(yo(e)!==e)throw Error(de(188))}function Vk(e){var t=e.alternate;if(!t){if(t=yo(e),t===null)throw Error(de(188));return t!==e?null:e}for(var r=e,n=t;;){var o=r.return;if(o===null)break;var i=o.alternate;if(i===null){if(n=o.return,n!==null){r=n;continue}break}if(o.child===i.child){for(i=o.child;i;){if(i===r)return ff(o),e;if(i===n)return ff(o),t;i=i.sibling}throw Error(de(188))}if(r.return!==n.return)r=o,n=i;else{for(var l=!1,c=o.child;c;){if(c===r){l=!0,r=o,n=i;break}if(c===n){l=!0,n=o,r=i;break}c=c.sibling}if(!l){for(c=i.child;c;){if(c===r){l=!0,r=i,n=o;break}if(c===n){l=!0,n=i,r=o;break}c=c.sibling}if(!l)throw Error(de(189))}}if(r.alternate!==n)throw Error(de(190))}if(r.tag!==3)throw Error(de(188));return r.stateNode.current===r?e:t}function Ty(e){return e=Vk(e),e!==null?Cy(e):null}function Cy(e){if(e.tag===5||e.tag===6)return e;for(e=e.child;e!==null;){var t=Cy(e);if(t!==null)return t;e=e.sibling}return null}var Py=Fr.unstable_scheduleCallback,gf=Fr.unstable_cancelCallback,Kk=Fr.unstable_shouldYield,Yk=Fr.unstable_requestPaint,Bt=Fr.unstable_now,Qk=Fr.unstable_getCurrentPriorityLevel,pp=Fr.unstable_ImmediatePriority,jy=Fr.unstable_UserBlockingPriority,$l=Fr.unstable_NormalPriority,Jk=Fr.unstable_LowPriority,Ny=Fr.unstable_IdlePriority,yc=null,kn=null;function Zk(e){if(kn&&typeof kn.onCommitFiberRoot=="function")try{kn.onCommitFiberRoot(yc,e,void 0,(e.current.flags&128)===128)}catch{}}var pn=Math.clz32?Math.clz32:t2,Xk=Math.log,e2=Math.LN2;function t2(e){return e>>>=0,e===0?32:31-(Xk(e)/e2|0)|0}var sl=64,ol=4194304;function Xi(e){switch(e&-e){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return e&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return e}}function Fl(e,t){var r=e.pendingLanes;if(r===0)return 0;var n=0,o=e.suspendedLanes,i=e.pingedLanes,l=r&268435455;if(l!==0){var c=l&~o;c!==0?n=Xi(c):(i&=l,i!==0&&(n=Xi(i)))}else l=r&~o,l!==0?n=Xi(l):i!==0&&(n=Xi(i));if(n===0)return 0;if(t!==0&&t!==n&&!(t&o)&&(o=n&-n,i=t&-t,o>=i||o===16&&(i&4194240)!==0))return t;if(n&4&&(n|=r&16),t=e.entangledLanes,t!==0)for(e=e.entanglements,t&=n;0<t;)r=31-pn(t),o=1<<r,n|=e[r],t&=~o;return n}function r2(e,t){switch(e){case 1:case 2:case 4:return t+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function n2(e,t){for(var r=e.suspendedLanes,n=e.pingedLanes,o=e.expirationTimes,i=e.pendingLanes;0<i;){var l=31-pn(i),c=1<<l,u=o[l];u===-1?(!(c&r)||c&n)&&(o[l]=r2(c,t)):u<=t&&(e.expiredLanes|=c),i&=~c}}function hd(e){return e=e.pendingLanes&-1073741825,e!==0?e:e&1073741824?1073741824:0}function Iy(){var e=sl;return sl<<=1,!(sl&4194240)&&(sl=64),e}function Su(e){for(var t=[],r=0;31>r;r++)t.push(e);return t}function za(e,t,r){e.pendingLanes|=t,t!==536870912&&(e.suspendedLanes=0,e.pingedLanes=0),e=e.eventTimes,t=31-pn(t),e[t]=r}function s2(e,t){var r=e.pendingLanes&~t;e.pendingLanes=t,e.suspendedLanes=0,e.pingedLanes=0,e.expiredLanes&=t,e.mutableReadLanes&=t,e.entangledLanes&=t,t=e.entanglements;var n=e.eventTimes;for(e=e.expirationTimes;0<r;){var o=31-pn(r),i=1<<o;t[o]=0,n[o]=-1,e[o]=-1,r&=~i}}function hp(e,t){var r=e.entangledLanes|=t;for(e=e.entanglements;r;){var n=31-pn(r),o=1<<n;o&t|e[n]&t&&(e[n]|=t),r&=~o}}var xt=0;function Ay(e){return e&=-e,1<e?4<e?e&268435455?16:536870912:4:1}var Ey,mp,My,_y,Ry,md=!1,il=[],ws=null,bs=null,ks=null,ga=new Map,ya=new Map,ps=[],o2="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function yf(e,t){switch(e){case"focusin":case"focusout":ws=null;break;case"dragenter":case"dragleave":bs=null;break;case"mouseover":case"mouseout":ks=null;break;case"pointerover":case"pointerout":ga.delete(t.pointerId);break;case"gotpointercapture":case"lostpointercapture":ya.delete(t.pointerId)}}function qi(e,t,r,n,o,i){return e===null||e.nativeEvent!==i?(e={blockedOn:t,domEventName:r,eventSystemFlags:n,nativeEvent:i,targetContainers:[o]},t!==null&&(t=Oa(t),t!==null&&mp(t)),e):(e.eventSystemFlags|=n,t=e.targetContainers,o!==null&&t.indexOf(o)===-1&&t.push(o),e)}function i2(e,t,r,n,o){switch(t){case"focusin":return ws=qi(ws,e,t,r,n,o),!0;case"dragenter":return bs=qi(bs,e,t,r,n,o),!0;case"mouseover":return ks=qi(ks,e,t,r,n,o),!0;case"pointerover":var i=o.pointerId;return ga.set(i,qi(ga.get(i)||null,e,t,r,n,o)),!0;case"gotpointercapture":return i=o.pointerId,ya.set(i,qi(ya.get(i)||null,e,t,r,n,o)),!0}return!1}function zy(e){var t=no(e.target);if(t!==null){var r=yo(t);if(r!==null){if(t=r.tag,t===13){if(t=Sy(r),t!==null){e.blockedOn=t,Ry(e.priority,function(){My(r)});return}}else if(t===3&&r.stateNode.current.memoizedState.isDehydrated){e.blockedOn=r.tag===3?r.stateNode.containerInfo:null;return}}}e.blockedOn=null}function Pl(e){if(e.blockedOn!==null)return!1;for(var t=e.targetContainers;0<t.length;){var r=fd(e.domEventName,e.eventSystemFlags,t[0],e.nativeEvent);if(r===null){r=e.nativeEvent;var n=new r.constructor(r.type,r);cd=n,r.target.dispatchEvent(n),cd=null}else return t=Oa(r),t!==null&&mp(t),e.blockedOn=r,!1;t.shift()}return!0}function xf(e,t,r){Pl(e)&&r.delete(t)}function a2(){md=!1,ws!==null&&Pl(ws)&&(ws=null),bs!==null&&Pl(bs)&&(bs=null),ks!==null&&Pl(ks)&&(ks=null),ga.forEach(xf),ya.forEach(xf)}function Wi(e,t){e.blockedOn===t&&(e.blockedOn=null,md||(md=!0,Fr.unstable_scheduleCallback(Fr.unstable_NormalPriority,a2)))}function xa(e){function t(o){return Wi(o,e)}if(0<il.length){Wi(il[0],e);for(var r=1;r<il.length;r++){var n=il[r];n.blockedOn===e&&(n.blockedOn=null)}}for(ws!==null&&Wi(ws,e),bs!==null&&Wi(bs,e),ks!==null&&Wi(ks,e),ga.forEach(t),ya.forEach(t),r=0;r<ps.length;r++)n=ps[r],n.blockedOn===e&&(n.blockedOn=null);for(;0<ps.length&&(r=ps[0],r.blockedOn===null);)zy(r),r.blockedOn===null&&ps.shift()}var ai=Vn.ReactCurrentBatchConfig,Ul=!0;function l2(e,t,r,n){var o=xt,i=ai.transition;ai.transition=null;try{xt=1,fp(e,t,r,n)}finally{xt=o,ai.transition=i}}function c2(e,t,r,n){var o=xt,i=ai.transition;ai.transition=null;try{xt=4,fp(e,t,r,n)}finally{xt=o,ai.transition=i}}function fp(e,t,r,n){if(Ul){var o=fd(e,t,r,n);if(o===null)_u(e,t,n,Bl,r),yf(e,n);else if(i2(o,e,t,r,n))n.stopPropagation();else if(yf(e,n),t&4&&-1<o2.indexOf(e)){for(;o!==null;){var i=Oa(o);if(i!==null&&Ey(i),i=fd(e,t,r,n),i===null&&_u(e,t,n,Bl,r),i===o)break;o=i}o!==null&&n.stopPropagation()}else _u(e,t,n,null,r)}}var Bl=null;function fd(e,t,r,n){if(Bl=null,e=dp(n),e=no(e),e!==null)if(t=yo(e),t===null)e=null;else if(r=t.tag,r===13){if(e=Sy(t),e!==null)return e;e=null}else if(r===3){if(t.stateNode.current.memoizedState.isDehydrated)return t.tag===3?t.stateNode.containerInfo:null;e=null}else t!==e&&(e=null);return Bl=e,null}function Ly(e){switch(e){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(Qk()){case pp:return 1;case jy:return 4;case $l:case Jk:return 16;case Ny:return 536870912;default:return 16}default:return 16}}var gs=null,gp=null,jl=null;function Oy(){if(jl)return jl;var e,t=gp,r=t.length,n,o="value"in gs?gs.value:gs.textContent,i=o.length;for(e=0;e<r&&t[e]===o[e];e++);var l=r-e;for(n=1;n<=l&&t[r-n]===o[i-n];n++);return jl=o.slice(e,1<n?1-n:void 0)}function Nl(e){var t=e.keyCode;return"charCode"in e?(e=e.charCode,e===0&&t===13&&(e=13)):e=t,e===10&&(e=13),32<=e||e===13?e:0}function al(){return!0}function vf(){return!1}function Br(e){function t(r,n,o,i,l){this._reactName=r,this._targetInst=o,this.type=n,this.nativeEvent=i,this.target=l,this.currentTarget=null;for(var c in e)e.hasOwnProperty(c)&&(r=e[c],this[c]=r?r(i):i[c]);return this.isDefaultPrevented=(i.defaultPrevented!=null?i.defaultPrevented:i.returnValue===!1)?al:vf,this.isPropagationStopped=vf,this}return Dt(t.prototype,{preventDefault:function(){this.defaultPrevented=!0;var r=this.nativeEvent;r&&(r.preventDefault?r.preventDefault():typeof r.returnValue!="unknown"&&(r.returnValue=!1),this.isDefaultPrevented=al)},stopPropagation:function(){var r=this.nativeEvent;r&&(r.stopPropagation?r.stopPropagation():typeof r.cancelBubble!="unknown"&&(r.cancelBubble=!0),this.isPropagationStopped=al)},persist:function(){},isPersistent:al}),t}var bi={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},yp=Br(bi),La=Dt({},bi,{view:0,detail:0}),u2=Br(La),Tu,Cu,Gi,xc=Dt({},La,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:xp,button:0,buttons:0,relatedTarget:function(e){return e.relatedTarget===void 0?e.fromElement===e.srcElement?e.toElement:e.fromElement:e.relatedTarget},movementX:function(e){return"movementX"in e?e.movementX:(e!==Gi&&(Gi&&e.type==="mousemove"?(Tu=e.screenX-Gi.screenX,Cu=e.screenY-Gi.screenY):Cu=Tu=0,Gi=e),Tu)},movementY:function(e){return"movementY"in e?e.movementY:Cu}}),wf=Br(xc),d2=Dt({},xc,{dataTransfer:0}),p2=Br(d2),h2=Dt({},La,{relatedTarget:0}),Pu=Br(h2),m2=Dt({},bi,{animationName:0,elapsedTime:0,pseudoElement:0}),f2=Br(m2),g2=Dt({},bi,{clipboardData:function(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}}),y2=Br(g2),x2=Dt({},bi,{data:0}),bf=Br(x2),v2={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},w2={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},b2={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function k2(e){var t=this.nativeEvent;return t.getModifierState?t.getModifierState(e):(e=b2[e])?!!t[e]:!1}function xp(){return k2}var S2=Dt({},La,{key:function(e){if(e.key){var t=v2[e.key]||e.key;if(t!=="Unidentified")return t}return e.type==="keypress"?(e=Nl(e),e===13?"Enter":String.fromCharCode(e)):e.type==="keydown"||e.type==="keyup"?w2[e.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:xp,charCode:function(e){return e.type==="keypress"?Nl(e):0},keyCode:function(e){return e.type==="keydown"||e.type==="keyup"?e.keyCode:0},which:function(e){return e.type==="keypress"?Nl(e):e.type==="keydown"||e.type==="keyup"?e.keyCode:0}}),T2=Br(S2),C2=Dt({},xc,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),kf=Br(C2),P2=Dt({},La,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:xp}),j2=Br(P2),N2=Dt({},bi,{propertyName:0,elapsedTime:0,pseudoElement:0}),I2=Br(N2),A2=Dt({},xc,{deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:0,deltaMode:0}),E2=Br(A2),M2=[9,13,27,32],vp=Bn&&"CompositionEvent"in window,sa=null;Bn&&"documentMode"in document&&(sa=document.documentMode);var _2=Bn&&"TextEvent"in window&&!sa,Dy=Bn&&(!vp||sa&&8<sa&&11>=sa),Sf=" ",Tf=!1;function $y(e,t){switch(e){case"keyup":return M2.indexOf(t.keyCode)!==-1;case"keydown":return t.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Fy(e){return e=e.detail,typeof e=="object"&&"data"in e?e.data:null}var Ko=!1;function R2(e,t){switch(e){case"compositionend":return Fy(t);case"keypress":return t.which!==32?null:(Tf=!0,Sf);case"textInput":return e=t.data,e===Sf&&Tf?null:e;default:return null}}function z2(e,t){if(Ko)return e==="compositionend"||!vp&&$y(e,t)?(e=Oy(),jl=gp=gs=null,Ko=!1,e):null;switch(e){case"paste":return null;case"keypress":if(!(t.ctrlKey||t.altKey||t.metaKey)||t.ctrlKey&&t.altKey){if(t.char&&1<t.char.length)return t.char;if(t.which)return String.fromCharCode(t.which)}return null;case"compositionend":return Dy&&t.locale!=="ko"?null:t.data;default:return null}}var L2={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Cf(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t==="input"?!!L2[e.type]:t==="textarea"}function Uy(e,t,r,n){xy(n),t=ql(t,"onChange"),0<t.length&&(r=new yp("onChange","change",null,r,n),e.push({event:r,listeners:t}))}var oa=null,va=null;function O2(e){Zy(e,0)}function vc(e){var t=Jo(e);if(dy(t))return e}function D2(e,t){if(e==="change")return t}var By=!1;if(Bn){var ju;if(Bn){var Nu="oninput"in document;if(!Nu){var Pf=document.createElement("div");Pf.setAttribute("oninput","return;"),Nu=typeof Pf.oninput=="function"}ju=Nu}else ju=!1;By=ju&&(!document.documentMode||9<document.documentMode)}function jf(){oa&&(oa.detachEvent("onpropertychange",qy),va=oa=null)}function qy(e){if(e.propertyName==="value"&&vc(va)){var t=[];Uy(t,va,e,dp(e)),ky(O2,t)}}function $2(e,t,r){e==="focusin"?(jf(),oa=t,va=r,oa.attachEvent("onpropertychange",qy)):e==="focusout"&&jf()}function F2(e){if(e==="selectionchange"||e==="keyup"||e==="keydown")return vc(va)}function U2(e,t){if(e==="click")return vc(t)}function B2(e,t){if(e==="input"||e==="change")return vc(t)}function q2(e,t){return e===t&&(e!==0||1/e===1/t)||e!==e&&t!==t}var mn=typeof Object.is=="function"?Object.is:q2;function wa(e,t){if(mn(e,t))return!0;if(typeof e!="object"||e===null||typeof t!="object"||t===null)return!1;var r=Object.keys(e),n=Object.keys(t);if(r.length!==n.length)return!1;for(n=0;n<r.length;n++){var o=r[n];if(!Ju.call(t,o)||!mn(e[o],t[o]))return!1}return!0}function Nf(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function If(e,t){var r=Nf(e);e=0;for(var n;r;){if(r.nodeType===3){if(n=e+r.textContent.length,e<=t&&n>=t)return{node:r,offset:t-e};e=n}e:{for(;r;){if(r.nextSibling){r=r.nextSibling;break e}r=r.parentNode}r=void 0}r=Nf(r)}}function Wy(e,t){return e&&t?e===t?!0:e&&e.nodeType===3?!1:t&&t.nodeType===3?Wy(e,t.parentNode):"contains"in e?e.contains(t):e.compareDocumentPosition?!!(e.compareDocumentPosition(t)&16):!1:!1}function Gy(){for(var e=window,t=Ll();t instanceof e.HTMLIFrameElement;){try{var r=typeof t.contentWindow.location.href=="string"}catch{r=!1}if(r)e=t.contentWindow;else break;t=Ll(e.document)}return t}function wp(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t&&(t==="input"&&(e.type==="text"||e.type==="search"||e.type==="tel"||e.type==="url"||e.type==="password")||t==="textarea"||e.contentEditable==="true")}function W2(e){var t=Gy(),r=e.focusedElem,n=e.selectionRange;if(t!==r&&r&&r.ownerDocument&&Wy(r.ownerDocument.documentElement,r)){if(n!==null&&wp(r)){if(t=n.start,e=n.end,e===void 0&&(e=t),"selectionStart"in r)r.selectionStart=t,r.selectionEnd=Math.min(e,r.value.length);else if(e=(t=r.ownerDocument||document)&&t.defaultView||window,e.getSelection){e=e.getSelection();var o=r.textContent.length,i=Math.min(n.start,o);n=n.end===void 0?i:Math.min(n.end,o),!e.extend&&i>n&&(o=n,n=i,i=o),o=If(r,i);var l=If(r,n);o&&l&&(e.rangeCount!==1||e.anchorNode!==o.node||e.anchorOffset!==o.offset||e.focusNode!==l.node||e.focusOffset!==l.offset)&&(t=t.createRange(),t.setStart(o.node,o.offset),e.removeAllRanges(),i>n?(e.addRange(t),e.extend(l.node,l.offset)):(t.setEnd(l.node,l.offset),e.addRange(t)))}}for(t=[],e=r;e=e.parentNode;)e.nodeType===1&&t.push({element:e,left:e.scrollLeft,top:e.scrollTop});for(typeof r.focus=="function"&&r.focus(),r=0;r<t.length;r++)e=t[r],e.element.scrollLeft=e.left,e.element.scrollTop=e.top}}var G2=Bn&&"documentMode"in document&&11>=document.documentMode,Yo=null,gd=null,ia=null,yd=!1;function Af(e,t,r){var n=r.window===r?r.document:r.nodeType===9?r:r.ownerDocument;yd||Yo==null||Yo!==Ll(n)||(n=Yo,"selectionStart"in n&&wp(n)?n={start:n.selectionStart,end:n.selectionEnd}:(n=(n.ownerDocument&&n.ownerDocument.defaultView||window).getSelection(),n={anchorNode:n.anchorNode,anchorOffset:n.anchorOffset,focusNode:n.focusNode,focusOffset:n.focusOffset}),ia&&wa(ia,n)||(ia=n,n=ql(gd,"onSelect"),0<n.length&&(t=new yp("onSelect","select",null,t,r),e.push({event:t,listeners:n}),t.target=Yo)))}function ll(e,t){var r={};return r[e.toLowerCase()]=t.toLowerCase(),r["Webkit"+e]="webkit"+t,r["Moz"+e]="moz"+t,r}var Qo={animationend:ll("Animation","AnimationEnd"),animationiteration:ll("Animation","AnimationIteration"),animationstart:ll("Animation","AnimationStart"),transitionend:ll("Transition","TransitionEnd")},Iu={},Hy={};Bn&&(Hy=document.createElement("div").style,"AnimationEvent"in window||(delete Qo.animationend.animation,delete Qo.animationiteration.animation,delete Qo.animationstart.animation),"TransitionEvent"in window||delete Qo.transitionend.transition);function wc(e){if(Iu[e])return Iu[e];if(!Qo[e])return e;var t=Qo[e],r;for(r in t)if(t.hasOwnProperty(r)&&r in Hy)return Iu[e]=t[r];return e}var Vy=wc("animationend"),Ky=wc("animationiteration"),Yy=wc("animationstart"),Qy=wc("transitionend"),Jy=new Map,Ef="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Es(e,t){Jy.set(e,t),go(t,[e])}for(var Au=0;Au<Ef.length;Au++){var Eu=Ef[Au],H2=Eu.toLowerCase(),V2=Eu[0].toUpperCase()+Eu.slice(1);Es(H2,"on"+V2)}Es(Vy,"onAnimationEnd");Es(Ky,"onAnimationIteration");Es(Yy,"onAnimationStart");Es("dblclick","onDoubleClick");Es("focusin","onFocus");Es("focusout","onBlur");Es(Qy,"onTransitionEnd");pi("onMouseEnter",["mouseout","mouseover"]);pi("onMouseLeave",["mouseout","mouseover"]);pi("onPointerEnter",["pointerout","pointerover"]);pi("onPointerLeave",["pointerout","pointerover"]);go("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));go("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));go("onBeforeInput",["compositionend","keypress","textInput","paste"]);go("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));go("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));go("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var ea="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),K2=new Set("cancel close invalid load scroll toggle".split(" ").concat(ea));function Mf(e,t,r){var n=e.type||"unknown-event";e.currentTarget=r,Hk(n,t,void 0,e),e.currentTarget=null}function Zy(e,t){t=(t&4)!==0;for(var r=0;r<e.length;r++){var n=e[r],o=n.event;n=n.listeners;e:{var i=void 0;if(t)for(var l=n.length-1;0<=l;l--){var c=n[l],u=c.instance,d=c.currentTarget;if(c=c.listener,u!==i&&o.isPropagationStopped())break e;Mf(o,c,d),i=u}else for(l=0;l<n.length;l++){if(c=n[l],u=c.instance,d=c.currentTarget,c=c.listener,u!==i&&o.isPropagationStopped())break e;Mf(o,c,d),i=u}}}if(Dl)throw e=pd,Dl=!1,pd=null,e}function jt(e,t){var r=t[kd];r===void 0&&(r=t[kd]=new Set);var n=e+"__bubble";r.has(n)||(Xy(t,e,2,!1),r.add(n))}function Mu(e,t,r){var n=0;t&&(n|=4),Xy(r,e,n,t)}var cl="_reactListening"+Math.random().toString(36).slice(2);function ba(e){if(!e[cl]){e[cl]=!0,iy.forEach(function(r){r!=="selectionchange"&&(K2.has(r)||Mu(r,!1,e),Mu(r,!0,e))});var t=e.nodeType===9?e:e.ownerDocument;t===null||t[cl]||(t[cl]=!0,Mu("selectionchange",!1,t))}}function Xy(e,t,r,n){switch(Ly(t)){case 1:var o=l2;break;case 4:o=c2;break;default:o=fp}r=o.bind(null,t,r,e),o=void 0,!dd||t!=="touchstart"&&t!=="touchmove"&&t!=="wheel"||(o=!0),n?o!==void 0?e.addEventListener(t,r,{capture:!0,passive:o}):e.addEventListener(t,r,!0):o!==void 0?e.addEventListener(t,r,{passive:o}):e.addEventListener(t,r,!1)}function _u(e,t,r,n,o){var i=n;if(!(t&1)&&!(t&2)&&n!==null)e:for(;;){if(n===null)return;var l=n.tag;if(l===3||l===4){var c=n.stateNode.containerInfo;if(c===o||c.nodeType===8&&c.parentNode===o)break;if(l===4)for(l=n.return;l!==null;){var u=l.tag;if((u===3||u===4)&&(u=l.stateNode.containerInfo,u===o||u.nodeType===8&&u.parentNode===o))return;l=l.return}for(;c!==null;){if(l=no(c),l===null)return;if(u=l.tag,u===5||u===6){n=i=l;continue e}c=c.parentNode}}n=n.return}ky(function(){var d=i,g=dp(r),x=[];e:{var y=Jy.get(e);if(y!==void 0){var S=yp,T=e;switch(e){case"keypress":if(Nl(r)===0)break e;case"keydown":case"keyup":S=T2;break;case"focusin":T="focus",S=Pu;break;case"focusout":T="blur",S=Pu;break;case"beforeblur":case"afterblur":S=Pu;break;case"click":if(r.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":S=wf;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":S=p2;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":S=j2;break;case Vy:case Ky:case Yy:S=f2;break;case Qy:S=I2;break;case"scroll":S=u2;break;case"wheel":S=E2;break;case"copy":case"cut":case"paste":S=y2;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":S=kf}var I=(t&4)!==0,b=!I&&e==="scroll",h=I?y!==null?y+"Capture":null:y;I=[];for(var v=d,C;v!==null;){C=v;var A=C.stateNode;if(C.tag===5&&A!==null&&(C=A,h!==null&&(A=fa(v,h),A!=null&&I.push(ka(v,A,C)))),b)break;v=v.return}0<I.length&&(y=new S(y,T,null,r,g),x.push({event:y,listeners:I}))}}if(!(t&7)){e:{if(y=e==="mouseover"||e==="pointerover",S=e==="mouseout"||e==="pointerout",y&&r!==cd&&(T=r.relatedTarget||r.fromElement)&&(no(T)||T[qn]))break e;if((S||y)&&(y=g.window===g?g:(y=g.ownerDocument)?y.defaultView||y.parentWindow:window,S?(T=r.relatedTarget||r.toElement,S=d,T=T?no(T):null,T!==null&&(b=yo(T),T!==b||T.tag!==5&&T.tag!==6)&&(T=null)):(S=null,T=d),S!==T)){if(I=wf,A="onMouseLeave",h="onMouseEnter",v="mouse",(e==="pointerout"||e==="pointerover")&&(I=kf,A="onPointerLeave",h="onPointerEnter",v="pointer"),b=S==null?y:Jo(S),C=T==null?y:Jo(T),y=new I(A,v+"leave",S,r,g),y.target=b,y.relatedTarget=C,A=null,no(g)===d&&(I=new I(h,v+"enter",T,r,g),I.target=C,I.relatedTarget=b,A=I),b=A,S&&T)t:{for(I=S,h=T,v=0,C=I;C;C=Oo(C))v++;for(C=0,A=h;A;A=Oo(A))C++;for(;0<v-C;)I=Oo(I),v--;for(;0<C-v;)h=Oo(h),C--;for(;v--;){if(I===h||h!==null&&I===h.alternate)break t;I=Oo(I),h=Oo(h)}I=null}else I=null;S!==null&&_f(x,y,S,I,!1),T!==null&&b!==null&&_f(x,b,T,I,!0)}}e:{if(y=d?Jo(d):window,S=y.nodeName&&y.nodeName.toLowerCase(),S==="select"||S==="input"&&y.type==="file")var P=D2;else if(Cf(y))if(By)P=B2;else{P=F2;var N=$2}else(S=y.nodeName)&&S.toLowerCase()==="input"&&(y.type==="checkbox"||y.type==="radio")&&(P=U2);if(P&&(P=P(e,d))){Uy(x,P,r,g);break e}N&&N(e,y,d),e==="focusout"&&(N=y._wrapperState)&&N.controlled&&y.type==="number"&&sd(y,"number",y.value)}switch(N=d?Jo(d):window,e){case"focusin":(Cf(N)||N.contentEditable==="true")&&(Yo=N,gd=d,ia=null);break;case"focusout":ia=gd=Yo=null;break;case"mousedown":yd=!0;break;case"contextmenu":case"mouseup":case"dragend":yd=!1,Af(x,r,g);break;case"selectionchange":if(G2)break;case"keydown":case"keyup":Af(x,r,g)}var z;if(vp)e:{switch(e){case"compositionstart":var L="onCompositionStart";break e;case"compositionend":L="onCompositionEnd";break e;case"compositionupdate":L="onCompositionUpdate";break e}L=void 0}else Ko?$y(e,r)&&(L="onCompositionEnd"):e==="keydown"&&r.keyCode===229&&(L="onCompositionStart");L&&(Dy&&r.locale!=="ko"&&(Ko||L!=="onCompositionStart"?L==="onCompositionEnd"&&Ko&&(z=Oy()):(gs=g,gp="value"in gs?gs.value:gs.textContent,Ko=!0)),N=ql(d,L),0<N.length&&(L=new bf(L,e,null,r,g),x.push({event:L,listeners:N}),z?L.data=z:(z=Fy(r),z!==null&&(L.data=z)))),(z=_2?R2(e,r):z2(e,r))&&(d=ql(d,"onBeforeInput"),0<d.length&&(g=new bf("onBeforeInput","beforeinput",null,r,g),x.push({event:g,listeners:d}),g.data=z))}Zy(x,t)})}function ka(e,t,r){return{instance:e,listener:t,currentTarget:r}}function ql(e,t){for(var r=t+"Capture",n=[];e!==null;){var o=e,i=o.stateNode;o.tag===5&&i!==null&&(o=i,i=fa(e,r),i!=null&&n.unshift(ka(e,i,o)),i=fa(e,t),i!=null&&n.push(ka(e,i,o))),e=e.return}return n}function Oo(e){if(e===null)return null;do e=e.return;while(e&&e.tag!==5);return e||null}function _f(e,t,r,n,o){for(var i=t._reactName,l=[];r!==null&&r!==n;){var c=r,u=c.alternate,d=c.stateNode;if(u!==null&&u===n)break;c.tag===5&&d!==null&&(c=d,o?(u=fa(r,i),u!=null&&l.unshift(ka(r,u,c))):o||(u=fa(r,i),u!=null&&l.push(ka(r,u,c)))),r=r.return}l.length!==0&&e.push({event:t,listeners:l})}var Y2=/\r\n?/g,Q2=/\u0000|\uFFFD/g;function Rf(e){return(typeof e=="string"?e:""+e).replace(Y2,`
`).replace(Q2,"")}function ul(e,t,r){if(t=Rf(t),Rf(e)!==t&&r)throw Error(de(425))}function Wl(){}var xd=null,vd=null;function wd(e,t){return e==="textarea"||e==="noscript"||typeof t.children=="string"||typeof t.children=="number"||typeof t.dangerouslySetInnerHTML=="object"&&t.dangerouslySetInnerHTML!==null&&t.dangerouslySetInnerHTML.__html!=null}var bd=typeof setTimeout=="function"?setTimeout:void 0,J2=typeof clearTimeout=="function"?clearTimeout:void 0,zf=typeof Promise=="function"?Promise:void 0,Z2=typeof queueMicrotask=="function"?queueMicrotask:typeof zf<"u"?function(e){return zf.resolve(null).then(e).catch(X2)}:bd;function X2(e){setTimeout(function(){throw e})}function Ru(e,t){var r=t,n=0;do{var o=r.nextSibling;if(e.removeChild(r),o&&o.nodeType===8)if(r=o.data,r==="/$"){if(n===0){e.removeChild(o),xa(t);return}n--}else r!=="$"&&r!=="$?"&&r!=="$!"||n++;r=o}while(r);xa(t)}function Ss(e){for(;e!=null;e=e.nextSibling){var t=e.nodeType;if(t===1||t===3)break;if(t===8){if(t=e.data,t==="$"||t==="$!"||t==="$?")break;if(t==="/$")return null}}return e}function Lf(e){e=e.previousSibling;for(var t=0;e;){if(e.nodeType===8){var r=e.data;if(r==="$"||r==="$!"||r==="$?"){if(t===0)return e;t--}else r==="/$"&&t++}e=e.previousSibling}return null}var ki=Math.random().toString(36).slice(2),bn="__reactFiber$"+ki,Sa="__reactProps$"+ki,qn="__reactContainer$"+ki,kd="__reactEvents$"+ki,eS="__reactListeners$"+ki,tS="__reactHandles$"+ki;function no(e){var t=e[bn];if(t)return t;for(var r=e.parentNode;r;){if(t=r[qn]||r[bn]){if(r=t.alternate,t.child!==null||r!==null&&r.child!==null)for(e=Lf(e);e!==null;){if(r=e[bn])return r;e=Lf(e)}return t}e=r,r=e.parentNode}return null}function Oa(e){return e=e[bn]||e[qn],!e||e.tag!==5&&e.tag!==6&&e.tag!==13&&e.tag!==3?null:e}function Jo(e){if(e.tag===5||e.tag===6)return e.stateNode;throw Error(de(33))}function bc(e){return e[Sa]||null}var Sd=[],Zo=-1;function Ms(e){return{current:e}}function Nt(e){0>Zo||(e.current=Sd[Zo],Sd[Zo]=null,Zo--)}function St(e,t){Zo++,Sd[Zo]=e.current,e.current=t}var As={},hr=Ms(As),Nr=Ms(!1),co=As;function hi(e,t){var r=e.type.contextTypes;if(!r)return As;var n=e.stateNode;if(n&&n.__reactInternalMemoizedUnmaskedChildContext===t)return n.__reactInternalMemoizedMaskedChildContext;var o={},i;for(i in r)o[i]=t[i];return n&&(e=e.stateNode,e.__reactInternalMemoizedUnmaskedChildContext=t,e.__reactInternalMemoizedMaskedChildContext=o),o}function Ir(e){return e=e.childContextTypes,e!=null}function Gl(){Nt(Nr),Nt(hr)}function Of(e,t,r){if(hr.current!==As)throw Error(de(168));St(hr,t),St(Nr,r)}function e0(e,t,r){var n=e.stateNode;if(t=t.childContextTypes,typeof n.getChildContext!="function")return r;n=n.getChildContext();for(var o in n)if(!(o in t))throw Error(de(108,$k(e)||"Unknown",o));return Dt({},r,n)}function Hl(e){return e=(e=e.stateNode)&&e.__reactInternalMemoizedMergedChildContext||As,co=hr.current,St(hr,e),St(Nr,Nr.current),!0}function Df(e,t,r){var n=e.stateNode;if(!n)throw Error(de(169));r?(e=e0(e,t,co),n.__reactInternalMemoizedMergedChildContext=e,Nt(Nr),Nt(hr),St(hr,e)):Nt(Nr),St(Nr,r)}var Ln=null,kc=!1,zu=!1;function t0(e){Ln===null?Ln=[e]:Ln.push(e)}function rS(e){kc=!0,t0(e)}function _s(){if(!zu&&Ln!==null){zu=!0;var e=0,t=xt;try{var r=Ln;for(xt=1;e<r.length;e++){var n=r[e];do n=n(!0);while(n!==null)}Ln=null,kc=!1}catch(o){throw Ln!==null&&(Ln=Ln.slice(e+1)),Py(pp,_s),o}finally{xt=t,zu=!1}}return null}var Xo=[],ei=0,Vl=null,Kl=0,Gr=[],Hr=0,uo=null,On=1,Dn="";function Hs(e,t){Xo[ei++]=Kl,Xo[ei++]=Vl,Vl=e,Kl=t}function r0(e,t,r){Gr[Hr++]=On,Gr[Hr++]=Dn,Gr[Hr++]=uo,uo=e;var n=On;e=Dn;var o=32-pn(n)-1;n&=~(1<<o),r+=1;var i=32-pn(t)+o;if(30<i){var l=o-o%5;i=(n&(1<<l)-1).toString(32),n>>=l,o-=l,On=1<<32-pn(t)+o|r<<o|n,Dn=i+e}else On=1<<i|r<<o|n,Dn=e}function bp(e){e.return!==null&&(Hs(e,1),r0(e,1,0))}function kp(e){for(;e===Vl;)Vl=Xo[--ei],Xo[ei]=null,Kl=Xo[--ei],Xo[ei]=null;for(;e===uo;)uo=Gr[--Hr],Gr[Hr]=null,Dn=Gr[--Hr],Gr[Hr]=null,On=Gr[--Hr],Gr[Hr]=null}var $r=null,Dr=null,Mt=!1,dn=null;function n0(e,t){var r=Vr(5,null,null,0);r.elementType="DELETED",r.stateNode=t,r.return=e,t=e.deletions,t===null?(e.deletions=[r],e.flags|=16):t.push(r)}function $f(e,t){switch(e.tag){case 5:var r=e.type;return t=t.nodeType!==1||r.toLowerCase()!==t.nodeName.toLowerCase()?null:t,t!==null?(e.stateNode=t,$r=e,Dr=Ss(t.firstChild),!0):!1;case 6:return t=e.pendingProps===""||t.nodeType!==3?null:t,t!==null?(e.stateNode=t,$r=e,Dr=null,!0):!1;case 13:return t=t.nodeType!==8?null:t,t!==null?(r=uo!==null?{id:On,overflow:Dn}:null,e.memoizedState={dehydrated:t,treeContext:r,retryLane:1073741824},r=Vr(18,null,null,0),r.stateNode=t,r.return=e,e.child=r,$r=e,Dr=null,!0):!1;default:return!1}}function Td(e){return(e.mode&1)!==0&&(e.flags&128)===0}function Cd(e){if(Mt){var t=Dr;if(t){var r=t;if(!$f(e,t)){if(Td(e))throw Error(de(418));t=Ss(r.nextSibling);var n=$r;t&&$f(e,t)?n0(n,r):(e.flags=e.flags&-4097|2,Mt=!1,$r=e)}}else{if(Td(e))throw Error(de(418));e.flags=e.flags&-4097|2,Mt=!1,$r=e}}}function Ff(e){for(e=e.return;e!==null&&e.tag!==5&&e.tag!==3&&e.tag!==13;)e=e.return;$r=e}function dl(e){if(e!==$r)return!1;if(!Mt)return Ff(e),Mt=!0,!1;var t;if((t=e.tag!==3)&&!(t=e.tag!==5)&&(t=e.type,t=t!=="head"&&t!=="body"&&!wd(e.type,e.memoizedProps)),t&&(t=Dr)){if(Td(e))throw s0(),Error(de(418));for(;t;)n0(e,t),t=Ss(t.nextSibling)}if(Ff(e),e.tag===13){if(e=e.memoizedState,e=e!==null?e.dehydrated:null,!e)throw Error(de(317));e:{for(e=e.nextSibling,t=0;e;){if(e.nodeType===8){var r=e.data;if(r==="/$"){if(t===0){Dr=Ss(e.nextSibling);break e}t--}else r!=="$"&&r!=="$!"&&r!=="$?"||t++}e=e.nextSibling}Dr=null}}else Dr=$r?Ss(e.stateNode.nextSibling):null;return!0}function s0(){for(var e=Dr;e;)e=Ss(e.nextSibling)}function mi(){Dr=$r=null,Mt=!1}function Sp(e){dn===null?dn=[e]:dn.push(e)}var nS=Vn.ReactCurrentBatchConfig;function Hi(e,t,r){if(e=r.ref,e!==null&&typeof e!="function"&&typeof e!="object"){if(r._owner){if(r=r._owner,r){if(r.tag!==1)throw Error(de(309));var n=r.stateNode}if(!n)throw Error(de(147,e));var o=n,i=""+e;return t!==null&&t.ref!==null&&typeof t.ref=="function"&&t.ref._stringRef===i?t.ref:(t=function(l){var c=o.refs;l===null?delete c[i]:c[i]=l},t._stringRef=i,t)}if(typeof e!="string")throw Error(de(284));if(!r._owner)throw Error(de(290,e))}return e}function pl(e,t){throw e=Object.prototype.toString.call(t),Error(de(31,e==="[object Object]"?"object with keys {"+Object.keys(t).join(", ")+"}":e))}function Uf(e){var t=e._init;return t(e._payload)}function o0(e){function t(h,v){if(e){var C=h.deletions;C===null?(h.deletions=[v],h.flags|=16):C.push(v)}}function r(h,v){if(!e)return null;for(;v!==null;)t(h,v),v=v.sibling;return null}function n(h,v){for(h=new Map;v!==null;)v.key!==null?h.set(v.key,v):h.set(v.index,v),v=v.sibling;return h}function o(h,v){return h=js(h,v),h.index=0,h.sibling=null,h}function i(h,v,C){return h.index=C,e?(C=h.alternate,C!==null?(C=C.index,C<v?(h.flags|=2,v):C):(h.flags|=2,v)):(h.flags|=1048576,v)}function l(h){return e&&h.alternate===null&&(h.flags|=2),h}function c(h,v,C,A){return v===null||v.tag!==6?(v=Bu(C,h.mode,A),v.return=h,v):(v=o(v,C),v.return=h,v)}function u(h,v,C,A){var P=C.type;return P===Vo?g(h,v,C.props.children,A,C.key):v!==null&&(v.elementType===P||typeof P=="object"&&P!==null&&P.$$typeof===ns&&Uf(P)===v.type)?(A=o(v,C.props),A.ref=Hi(h,v,C),A.return=h,A):(A=zl(C.type,C.key,C.props,null,h.mode,A),A.ref=Hi(h,v,C),A.return=h,A)}function d(h,v,C,A){return v===null||v.tag!==4||v.stateNode.containerInfo!==C.containerInfo||v.stateNode.implementation!==C.implementation?(v=qu(C,h.mode,A),v.return=h,v):(v=o(v,C.children||[]),v.return=h,v)}function g(h,v,C,A,P){return v===null||v.tag!==7?(v=ao(C,h.mode,A,P),v.return=h,v):(v=o(v,C),v.return=h,v)}function x(h,v,C){if(typeof v=="string"&&v!==""||typeof v=="number")return v=Bu(""+v,h.mode,C),v.return=h,v;if(typeof v=="object"&&v!==null){switch(v.$$typeof){case tl:return C=zl(v.type,v.key,v.props,null,h.mode,C),C.ref=Hi(h,null,v),C.return=h,C;case Ho:return v=qu(v,h.mode,C),v.return=h,v;case ns:var A=v._init;return x(h,A(v._payload),C)}if(Zi(v)||Ui(v))return v=ao(v,h.mode,C,null),v.return=h,v;pl(h,v)}return null}function y(h,v,C,A){var P=v!==null?v.key:null;if(typeof C=="string"&&C!==""||typeof C=="number")return P!==null?null:c(h,v,""+C,A);if(typeof C=="object"&&C!==null){switch(C.$$typeof){case tl:return C.key===P?u(h,v,C,A):null;case Ho:return C.key===P?d(h,v,C,A):null;case ns:return P=C._init,y(h,v,P(C._payload),A)}if(Zi(C)||Ui(C))return P!==null?null:g(h,v,C,A,null);pl(h,C)}return null}function S(h,v,C,A,P){if(typeof A=="string"&&A!==""||typeof A=="number")return h=h.get(C)||null,c(v,h,""+A,P);if(typeof A=="object"&&A!==null){switch(A.$$typeof){case tl:return h=h.get(A.key===null?C:A.key)||null,u(v,h,A,P);case Ho:return h=h.get(A.key===null?C:A.key)||null,d(v,h,A,P);case ns:var N=A._init;return S(h,v,C,N(A._payload),P)}if(Zi(A)||Ui(A))return h=h.get(C)||null,g(v,h,A,P,null);pl(v,A)}return null}function T(h,v,C,A){for(var P=null,N=null,z=v,L=v=0,G=null;z!==null&&L<C.length;L++){z.index>L?(G=z,z=null):G=z.sibling;var R=y(h,z,C[L],A);if(R===null){z===null&&(z=G);break}e&&z&&R.alternate===null&&t(h,z),v=i(R,v,L),N===null?P=R:N.sibling=R,N=R,z=G}if(L===C.length)return r(h,z),Mt&&Hs(h,L),P;if(z===null){for(;L<C.length;L++)z=x(h,C[L],A),z!==null&&(v=i(z,v,L),N===null?P=z:N.sibling=z,N=z);return Mt&&Hs(h,L),P}for(z=n(h,z);L<C.length;L++)G=S(z,h,L,C[L],A),G!==null&&(e&&G.alternate!==null&&z.delete(G.key===null?L:G.key),v=i(G,v,L),N===null?P=G:N.sibling=G,N=G);return e&&z.forEach(function(F){return t(h,F)}),Mt&&Hs(h,L),P}function I(h,v,C,A){var P=Ui(C);if(typeof P!="function")throw Error(de(150));if(C=P.call(C),C==null)throw Error(de(151));for(var N=P=null,z=v,L=v=0,G=null,R=C.next();z!==null&&!R.done;L++,R=C.next()){z.index>L?(G=z,z=null):G=z.sibling;var F=y(h,z,R.value,A);if(F===null){z===null&&(z=G);break}e&&z&&F.alternate===null&&t(h,z),v=i(F,v,L),N===null?P=F:N.sibling=F,N=F,z=G}if(R.done)return r(h,z),Mt&&Hs(h,L),P;if(z===null){for(;!R.done;L++,R=C.next())R=x(h,R.value,A),R!==null&&(v=i(R,v,L),N===null?P=R:N.sibling=R,N=R);return Mt&&Hs(h,L),P}for(z=n(h,z);!R.done;L++,R=C.next())R=S(z,h,L,R.value,A),R!==null&&(e&&R.alternate!==null&&z.delete(R.key===null?L:R.key),v=i(R,v,L),N===null?P=R:N.sibling=R,N=R);return e&&z.forEach(function(D){return t(h,D)}),Mt&&Hs(h,L),P}function b(h,v,C,A){if(typeof C=="object"&&C!==null&&C.type===Vo&&C.key===null&&(C=C.props.children),typeof C=="object"&&C!==null){switch(C.$$typeof){case tl:e:{for(var P=C.key,N=v;N!==null;){if(N.key===P){if(P=C.type,P===Vo){if(N.tag===7){r(h,N.sibling),v=o(N,C.props.children),v.return=h,h=v;break e}}else if(N.elementType===P||typeof P=="object"&&P!==null&&P.$$typeof===ns&&Uf(P)===N.type){r(h,N.sibling),v=o(N,C.props),v.ref=Hi(h,N,C),v.return=h,h=v;break e}r(h,N);break}else t(h,N);N=N.sibling}C.type===Vo?(v=ao(C.props.children,h.mode,A,C.key),v.return=h,h=v):(A=zl(C.type,C.key,C.props,null,h.mode,A),A.ref=Hi(h,v,C),A.return=h,h=A)}return l(h);case Ho:e:{for(N=C.key;v!==null;){if(v.key===N)if(v.tag===4&&v.stateNode.containerInfo===C.containerInfo&&v.stateNode.implementation===C.implementation){r(h,v.sibling),v=o(v,C.children||[]),v.return=h,h=v;break e}else{r(h,v);break}else t(h,v);v=v.sibling}v=qu(C,h.mode,A),v.return=h,h=v}return l(h);case ns:return N=C._init,b(h,v,N(C._payload),A)}if(Zi(C))return T(h,v,C,A);if(Ui(C))return I(h,v,C,A);pl(h,C)}return typeof C=="string"&&C!==""||typeof C=="number"?(C=""+C,v!==null&&v.tag===6?(r(h,v.sibling),v=o(v,C),v.return=h,h=v):(r(h,v),v=Bu(C,h.mode,A),v.return=h,h=v),l(h)):r(h,v)}return b}var fi=o0(!0),i0=o0(!1),Yl=Ms(null),Ql=null,ti=null,Tp=null;function Cp(){Tp=ti=Ql=null}function Pp(e){var t=Yl.current;Nt(Yl),e._currentValue=t}function Pd(e,t,r){for(;e!==null;){var n=e.alternate;if((e.childLanes&t)!==t?(e.childLanes|=t,n!==null&&(n.childLanes|=t)):n!==null&&(n.childLanes&t)!==t&&(n.childLanes|=t),e===r)break;e=e.return}}function li(e,t){Ql=e,Tp=ti=null,e=e.dependencies,e!==null&&e.firstContext!==null&&(e.lanes&t&&(Pr=!0),e.firstContext=null)}function Yr(e){var t=e._currentValue;if(Tp!==e)if(e={context:e,memoizedValue:t,next:null},ti===null){if(Ql===null)throw Error(de(308));ti=e,Ql.dependencies={lanes:0,firstContext:e}}else ti=ti.next=e;return t}var so=null;function jp(e){so===null?so=[e]:so.push(e)}function a0(e,t,r,n){var o=t.interleaved;return o===null?(r.next=r,jp(t)):(r.next=o.next,o.next=r),t.interleaved=r,Wn(e,n)}function Wn(e,t){e.lanes|=t;var r=e.alternate;for(r!==null&&(r.lanes|=t),r=e,e=e.return;e!==null;)e.childLanes|=t,r=e.alternate,r!==null&&(r.childLanes|=t),r=e,e=e.return;return r.tag===3?r.stateNode:null}var ss=!1;function Np(e){e.updateQueue={baseState:e.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function l0(e,t){e=e.updateQueue,t.updateQueue===e&&(t.updateQueue={baseState:e.baseState,firstBaseUpdate:e.firstBaseUpdate,lastBaseUpdate:e.lastBaseUpdate,shared:e.shared,effects:e.effects})}function Un(e,t){return{eventTime:e,lane:t,tag:0,payload:null,callback:null,next:null}}function Ts(e,t,r){var n=e.updateQueue;if(n===null)return null;if(n=n.shared,dt&2){var o=n.pending;return o===null?t.next=t:(t.next=o.next,o.next=t),n.pending=t,Wn(e,r)}return o=n.interleaved,o===null?(t.next=t,jp(n)):(t.next=o.next,o.next=t),n.interleaved=t,Wn(e,r)}function Il(e,t,r){if(t=t.updateQueue,t!==null&&(t=t.shared,(r&4194240)!==0)){var n=t.lanes;n&=e.pendingLanes,r|=n,t.lanes=r,hp(e,r)}}function Bf(e,t){var r=e.updateQueue,n=e.alternate;if(n!==null&&(n=n.updateQueue,r===n)){var o=null,i=null;if(r=r.firstBaseUpdate,r!==null){do{var l={eventTime:r.eventTime,lane:r.lane,tag:r.tag,payload:r.payload,callback:r.callback,next:null};i===null?o=i=l:i=i.next=l,r=r.next}while(r!==null);i===null?o=i=t:i=i.next=t}else o=i=t;r={baseState:n.baseState,firstBaseUpdate:o,lastBaseUpdate:i,shared:n.shared,effects:n.effects},e.updateQueue=r;return}e=r.lastBaseUpdate,e===null?r.firstBaseUpdate=t:e.next=t,r.lastBaseUpdate=t}function Jl(e,t,r,n){var o=e.updateQueue;ss=!1;var i=o.firstBaseUpdate,l=o.lastBaseUpdate,c=o.shared.pending;if(c!==null){o.shared.pending=null;var u=c,d=u.next;u.next=null,l===null?i=d:l.next=d,l=u;var g=e.alternate;g!==null&&(g=g.updateQueue,c=g.lastBaseUpdate,c!==l&&(c===null?g.firstBaseUpdate=d:c.next=d,g.lastBaseUpdate=u))}if(i!==null){var x=o.baseState;l=0,g=d=u=null,c=i;do{var y=c.lane,S=c.eventTime;if((n&y)===y){g!==null&&(g=g.next={eventTime:S,lane:0,tag:c.tag,payload:c.payload,callback:c.callback,next:null});e:{var T=e,I=c;switch(y=t,S=r,I.tag){case 1:if(T=I.payload,typeof T=="function"){x=T.call(S,x,y);break e}x=T;break e;case 3:T.flags=T.flags&-65537|128;case 0:if(T=I.payload,y=typeof T=="function"?T.call(S,x,y):T,y==null)break e;x=Dt({},x,y);break e;case 2:ss=!0}}c.callback!==null&&c.lane!==0&&(e.flags|=64,y=o.effects,y===null?o.effects=[c]:y.push(c))}else S={eventTime:S,lane:y,tag:c.tag,payload:c.payload,callback:c.callback,next:null},g===null?(d=g=S,u=x):g=g.next=S,l|=y;if(c=c.next,c===null){if(c=o.shared.pending,c===null)break;y=c,c=y.next,y.next=null,o.lastBaseUpdate=y,o.shared.pending=null}}while(!0);if(g===null&&(u=x),o.baseState=u,o.firstBaseUpdate=d,o.lastBaseUpdate=g,t=o.shared.interleaved,t!==null){o=t;do l|=o.lane,o=o.next;while(o!==t)}else i===null&&(o.shared.lanes=0);ho|=l,e.lanes=l,e.memoizedState=x}}function qf(e,t,r){if(e=t.effects,t.effects=null,e!==null)for(t=0;t<e.length;t++){var n=e[t],o=n.callback;if(o!==null){if(n.callback=null,n=r,typeof o!="function")throw Error(de(191,o));o.call(n)}}}var Da={},Sn=Ms(Da),Ta=Ms(Da),Ca=Ms(Da);function oo(e){if(e===Da)throw Error(de(174));return e}function Ip(e,t){switch(St(Ca,t),St(Ta,e),St(Sn,Da),e=t.nodeType,e){case 9:case 11:t=(t=t.documentElement)?t.namespaceURI:id(null,"");break;default:e=e===8?t.parentNode:t,t=e.namespaceURI||null,e=e.tagName,t=id(t,e)}Nt(Sn),St(Sn,t)}function gi(){Nt(Sn),Nt(Ta),Nt(Ca)}function c0(e){oo(Ca.current);var t=oo(Sn.current),r=id(t,e.type);t!==r&&(St(Ta,e),St(Sn,r))}function Ap(e){Ta.current===e&&(Nt(Sn),Nt(Ta))}var Lt=Ms(0);function Zl(e){for(var t=e;t!==null;){if(t.tag===13){var r=t.memoizedState;if(r!==null&&(r=r.dehydrated,r===null||r.data==="$?"||r.data==="$!"))return t}else if(t.tag===19&&t.memoizedProps.revealOrder!==void 0){if(t.flags&128)return t}else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}return null}var Lu=[];function Ep(){for(var e=0;e<Lu.length;e++)Lu[e]._workInProgressVersionPrimary=null;Lu.length=0}var Al=Vn.ReactCurrentDispatcher,Ou=Vn.ReactCurrentBatchConfig,po=0,Ot=null,Qt=null,Xt=null,Xl=!1,aa=!1,Pa=0,sS=0;function ur(){throw Error(de(321))}function Mp(e,t){if(t===null)return!1;for(var r=0;r<t.length&&r<e.length;r++)if(!mn(e[r],t[r]))return!1;return!0}function _p(e,t,r,n,o,i){if(po=i,Ot=t,t.memoizedState=null,t.updateQueue=null,t.lanes=0,Al.current=e===null||e.memoizedState===null?lS:cS,e=r(n,o),aa){i=0;do{if(aa=!1,Pa=0,25<=i)throw Error(de(301));i+=1,Xt=Qt=null,t.updateQueue=null,Al.current=uS,e=r(n,o)}while(aa)}if(Al.current=ec,t=Qt!==null&&Qt.next!==null,po=0,Xt=Qt=Ot=null,Xl=!1,t)throw Error(de(300));return e}function Rp(){var e=Pa!==0;return Pa=0,e}function wn(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Xt===null?Ot.memoizedState=Xt=e:Xt=Xt.next=e,Xt}function Qr(){if(Qt===null){var e=Ot.alternate;e=e!==null?e.memoizedState:null}else e=Qt.next;var t=Xt===null?Ot.memoizedState:Xt.next;if(t!==null)Xt=t,Qt=e;else{if(e===null)throw Error(de(310));Qt=e,e={memoizedState:Qt.memoizedState,baseState:Qt.baseState,baseQueue:Qt.baseQueue,queue:Qt.queue,next:null},Xt===null?Ot.memoizedState=Xt=e:Xt=Xt.next=e}return Xt}function ja(e,t){return typeof t=="function"?t(e):t}function Du(e){var t=Qr(),r=t.queue;if(r===null)throw Error(de(311));r.lastRenderedReducer=e;var n=Qt,o=n.baseQueue,i=r.pending;if(i!==null){if(o!==null){var l=o.next;o.next=i.next,i.next=l}n.baseQueue=o=i,r.pending=null}if(o!==null){i=o.next,n=n.baseState;var c=l=null,u=null,d=i;do{var g=d.lane;if((po&g)===g)u!==null&&(u=u.next={lane:0,action:d.action,hasEagerState:d.hasEagerState,eagerState:d.eagerState,next:null}),n=d.hasEagerState?d.eagerState:e(n,d.action);else{var x={lane:g,action:d.action,hasEagerState:d.hasEagerState,eagerState:d.eagerState,next:null};u===null?(c=u=x,l=n):u=u.next=x,Ot.lanes|=g,ho|=g}d=d.next}while(d!==null&&d!==i);u===null?l=n:u.next=c,mn(n,t.memoizedState)||(Pr=!0),t.memoizedState=n,t.baseState=l,t.baseQueue=u,r.lastRenderedState=n}if(e=r.interleaved,e!==null){o=e;do i=o.lane,Ot.lanes|=i,ho|=i,o=o.next;while(o!==e)}else o===null&&(r.lanes=0);return[t.memoizedState,r.dispatch]}function $u(e){var t=Qr(),r=t.queue;if(r===null)throw Error(de(311));r.lastRenderedReducer=e;var n=r.dispatch,o=r.pending,i=t.memoizedState;if(o!==null){r.pending=null;var l=o=o.next;do i=e(i,l.action),l=l.next;while(l!==o);mn(i,t.memoizedState)||(Pr=!0),t.memoizedState=i,t.baseQueue===null&&(t.baseState=i),r.lastRenderedState=i}return[i,n]}function u0(){}function d0(e,t){var r=Ot,n=Qr(),o=t(),i=!mn(n.memoizedState,o);if(i&&(n.memoizedState=o,Pr=!0),n=n.queue,zp(m0.bind(null,r,n,e),[e]),n.getSnapshot!==t||i||Xt!==null&&Xt.memoizedState.tag&1){if(r.flags|=2048,Na(9,h0.bind(null,r,n,o,t),void 0,null),tr===null)throw Error(de(349));po&30||p0(r,t,o)}return o}function p0(e,t,r){e.flags|=16384,e={getSnapshot:t,value:r},t=Ot.updateQueue,t===null?(t={lastEffect:null,stores:null},Ot.updateQueue=t,t.stores=[e]):(r=t.stores,r===null?t.stores=[e]:r.push(e))}function h0(e,t,r,n){t.value=r,t.getSnapshot=n,f0(t)&&g0(e)}function m0(e,t,r){return r(function(){f0(t)&&g0(e)})}function f0(e){var t=e.getSnapshot;e=e.value;try{var r=t();return!mn(e,r)}catch{return!0}}function g0(e){var t=Wn(e,1);t!==null&&hn(t,e,1,-1)}function Wf(e){var t=wn();return typeof e=="function"&&(e=e()),t.memoizedState=t.baseState=e,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:ja,lastRenderedState:e},t.queue=e,e=e.dispatch=aS.bind(null,Ot,e),[t.memoizedState,e]}function Na(e,t,r,n){return e={tag:e,create:t,destroy:r,deps:n,next:null},t=Ot.updateQueue,t===null?(t={lastEffect:null,stores:null},Ot.updateQueue=t,t.lastEffect=e.next=e):(r=t.lastEffect,r===null?t.lastEffect=e.next=e:(n=r.next,r.next=e,e.next=n,t.lastEffect=e)),e}function y0(){return Qr().memoizedState}function El(e,t,r,n){var o=wn();Ot.flags|=e,o.memoizedState=Na(1|t,r,void 0,n===void 0?null:n)}function Sc(e,t,r,n){var o=Qr();n=n===void 0?null:n;var i=void 0;if(Qt!==null){var l=Qt.memoizedState;if(i=l.destroy,n!==null&&Mp(n,l.deps)){o.memoizedState=Na(t,r,i,n);return}}Ot.flags|=e,o.memoizedState=Na(1|t,r,i,n)}function Gf(e,t){return El(8390656,8,e,t)}function zp(e,t){return Sc(2048,8,e,t)}function x0(e,t){return Sc(4,2,e,t)}function v0(e,t){return Sc(4,4,e,t)}function w0(e,t){if(typeof t=="function")return e=e(),t(e),function(){t(null)};if(t!=null)return e=e(),t.current=e,function(){t.current=null}}function b0(e,t,r){return r=r!=null?r.concat([e]):null,Sc(4,4,w0.bind(null,t,e),r)}function Lp(){}function k0(e,t){var r=Qr();t=t===void 0?null:t;var n=r.memoizedState;return n!==null&&t!==null&&Mp(t,n[1])?n[0]:(r.memoizedState=[e,t],e)}function S0(e,t){var r=Qr();t=t===void 0?null:t;var n=r.memoizedState;return n!==null&&t!==null&&Mp(t,n[1])?n[0]:(e=e(),r.memoizedState=[e,t],e)}function T0(e,t,r){return po&21?(mn(r,t)||(r=Iy(),Ot.lanes|=r,ho|=r,e.baseState=!0),t):(e.baseState&&(e.baseState=!1,Pr=!0),e.memoizedState=r)}function oS(e,t){var r=xt;xt=r!==0&&4>r?r:4,e(!0);var n=Ou.transition;Ou.transition={};try{e(!1),t()}finally{xt=r,Ou.transition=n}}function C0(){return Qr().memoizedState}function iS(e,t,r){var n=Ps(e);if(r={lane:n,action:r,hasEagerState:!1,eagerState:null,next:null},P0(e))j0(t,r);else if(r=a0(e,t,r,n),r!==null){var o=kr();hn(r,e,n,o),N0(r,t,n)}}function aS(e,t,r){var n=Ps(e),o={lane:n,action:r,hasEagerState:!1,eagerState:null,next:null};if(P0(e))j0(t,o);else{var i=e.alternate;if(e.lanes===0&&(i===null||i.lanes===0)&&(i=t.lastRenderedReducer,i!==null))try{var l=t.lastRenderedState,c=i(l,r);if(o.hasEagerState=!0,o.eagerState=c,mn(c,l)){var u=t.interleaved;u===null?(o.next=o,jp(t)):(o.next=u.next,u.next=o),t.interleaved=o;return}}catch{}finally{}r=a0(e,t,o,n),r!==null&&(o=kr(),hn(r,e,n,o),N0(r,t,n))}}function P0(e){var t=e.alternate;return e===Ot||t!==null&&t===Ot}function j0(e,t){aa=Xl=!0;var r=e.pending;r===null?t.next=t:(t.next=r.next,r.next=t),e.pending=t}function N0(e,t,r){if(r&4194240){var n=t.lanes;n&=e.pendingLanes,r|=n,t.lanes=r,hp(e,r)}}var ec={readContext:Yr,useCallback:ur,useContext:ur,useEffect:ur,useImperativeHandle:ur,useInsertionEffect:ur,useLayoutEffect:ur,useMemo:ur,useReducer:ur,useRef:ur,useState:ur,useDebugValue:ur,useDeferredValue:ur,useTransition:ur,useMutableSource:ur,useSyncExternalStore:ur,useId:ur,unstable_isNewReconciler:!1},lS={readContext:Yr,useCallback:function(e,t){return wn().memoizedState=[e,t===void 0?null:t],e},useContext:Yr,useEffect:Gf,useImperativeHandle:function(e,t,r){return r=r!=null?r.concat([e]):null,El(4194308,4,w0.bind(null,t,e),r)},useLayoutEffect:function(e,t){return El(4194308,4,e,t)},useInsertionEffect:function(e,t){return El(4,2,e,t)},useMemo:function(e,t){var r=wn();return t=t===void 0?null:t,e=e(),r.memoizedState=[e,t],e},useReducer:function(e,t,r){var n=wn();return t=r!==void 0?r(t):t,n.memoizedState=n.baseState=t,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:e,lastRenderedState:t},n.queue=e,e=e.dispatch=iS.bind(null,Ot,e),[n.memoizedState,e]},useRef:function(e){var t=wn();return e={current:e},t.memoizedState=e},useState:Wf,useDebugValue:Lp,useDeferredValue:function(e){return wn().memoizedState=e},useTransition:function(){var e=Wf(!1),t=e[0];return e=oS.bind(null,e[1]),wn().memoizedState=e,[t,e]},useMutableSource:function(){},useSyncExternalStore:function(e,t,r){var n=Ot,o=wn();if(Mt){if(r===void 0)throw Error(de(407));r=r()}else{if(r=t(),tr===null)throw Error(de(349));po&30||p0(n,t,r)}o.memoizedState=r;var i={value:r,getSnapshot:t};return o.queue=i,Gf(m0.bind(null,n,i,e),[e]),n.flags|=2048,Na(9,h0.bind(null,n,i,r,t),void 0,null),r},useId:function(){var e=wn(),t=tr.identifierPrefix;if(Mt){var r=Dn,n=On;r=(n&~(1<<32-pn(n)-1)).toString(32)+r,t=":"+t+"R"+r,r=Pa++,0<r&&(t+="H"+r.toString(32)),t+=":"}else r=sS++,t=":"+t+"r"+r.toString(32)+":";return e.memoizedState=t},unstable_isNewReconciler:!1},cS={readContext:Yr,useCallback:k0,useContext:Yr,useEffect:zp,useImperativeHandle:b0,useInsertionEffect:x0,useLayoutEffect:v0,useMemo:S0,useReducer:Du,useRef:y0,useState:function(){return Du(ja)},useDebugValue:Lp,useDeferredValue:function(e){var t=Qr();return T0(t,Qt.memoizedState,e)},useTransition:function(){var e=Du(ja)[0],t=Qr().memoizedState;return[e,t]},useMutableSource:u0,useSyncExternalStore:d0,useId:C0,unstable_isNewReconciler:!1},uS={readContext:Yr,useCallback:k0,useContext:Yr,useEffect:zp,useImperativeHandle:b0,useInsertionEffect:x0,useLayoutEffect:v0,useMemo:S0,useReducer:$u,useRef:y0,useState:function(){return $u(ja)},useDebugValue:Lp,useDeferredValue:function(e){var t=Qr();return Qt===null?t.memoizedState=e:T0(t,Qt.memoizedState,e)},useTransition:function(){var e=$u(ja)[0],t=Qr().memoizedState;return[e,t]},useMutableSource:u0,useSyncExternalStore:d0,useId:C0,unstable_isNewReconciler:!1};function cn(e,t){if(e&&e.defaultProps){t=Dt({},t),e=e.defaultProps;for(var r in e)t[r]===void 0&&(t[r]=e[r]);return t}return t}function jd(e,t,r,n){t=e.memoizedState,r=r(n,t),r=r==null?t:Dt({},t,r),e.memoizedState=r,e.lanes===0&&(e.updateQueue.baseState=r)}var Tc={isMounted:function(e){return(e=e._reactInternals)?yo(e)===e:!1},enqueueSetState:function(e,t,r){e=e._reactInternals;var n=kr(),o=Ps(e),i=Un(n,o);i.payload=t,r!=null&&(i.callback=r),t=Ts(e,i,o),t!==null&&(hn(t,e,o,n),Il(t,e,o))},enqueueReplaceState:function(e,t,r){e=e._reactInternals;var n=kr(),o=Ps(e),i=Un(n,o);i.tag=1,i.payload=t,r!=null&&(i.callback=r),t=Ts(e,i,o),t!==null&&(hn(t,e,o,n),Il(t,e,o))},enqueueForceUpdate:function(e,t){e=e._reactInternals;var r=kr(),n=Ps(e),o=Un(r,n);o.tag=2,t!=null&&(o.callback=t),t=Ts(e,o,n),t!==null&&(hn(t,e,n,r),Il(t,e,n))}};function Hf(e,t,r,n,o,i,l){return e=e.stateNode,typeof e.shouldComponentUpdate=="function"?e.shouldComponentUpdate(n,i,l):t.prototype&&t.prototype.isPureReactComponent?!wa(r,n)||!wa(o,i):!0}function I0(e,t,r){var n=!1,o=As,i=t.contextType;return typeof i=="object"&&i!==null?i=Yr(i):(o=Ir(t)?co:hr.current,n=t.contextTypes,i=(n=n!=null)?hi(e,o):As),t=new t(r,i),e.memoizedState=t.state!==null&&t.state!==void 0?t.state:null,t.updater=Tc,e.stateNode=t,t._reactInternals=e,n&&(e=e.stateNode,e.__reactInternalMemoizedUnmaskedChildContext=o,e.__reactInternalMemoizedMaskedChildContext=i),t}function Vf(e,t,r,n){e=t.state,typeof t.componentWillReceiveProps=="function"&&t.componentWillReceiveProps(r,n),typeof t.UNSAFE_componentWillReceiveProps=="function"&&t.UNSAFE_componentWillReceiveProps(r,n),t.state!==e&&Tc.enqueueReplaceState(t,t.state,null)}function Nd(e,t,r,n){var o=e.stateNode;o.props=r,o.state=e.memoizedState,o.refs={},Np(e);var i=t.contextType;typeof i=="object"&&i!==null?o.context=Yr(i):(i=Ir(t)?co:hr.current,o.context=hi(e,i)),o.state=e.memoizedState,i=t.getDerivedStateFromProps,typeof i=="function"&&(jd(e,t,i,r),o.state=e.memoizedState),typeof t.getDerivedStateFromProps=="function"||typeof o.getSnapshotBeforeUpdate=="function"||typeof o.UNSAFE_componentWillMount!="function"&&typeof o.componentWillMount!="function"||(t=o.state,typeof o.componentWillMount=="function"&&o.componentWillMount(),typeof o.UNSAFE_componentWillMount=="function"&&o.UNSAFE_componentWillMount(),t!==o.state&&Tc.enqueueReplaceState(o,o.state,null),Jl(e,r,o,n),o.state=e.memoizedState),typeof o.componentDidMount=="function"&&(e.flags|=4194308)}function yi(e,t){try{var r="",n=t;do r+=Dk(n),n=n.return;while(n);var o=r}catch(i){o=`
Error generating stack: `+i.message+`
`+i.stack}return{value:e,source:t,stack:o,digest:null}}function Fu(e,t,r){return{value:e,source:null,stack:r??null,digest:t??null}}function Id(e,t){try{console.error(t.value)}catch(r){setTimeout(function(){throw r})}}var dS=typeof WeakMap=="function"?WeakMap:Map;function A0(e,t,r){r=Un(-1,r),r.tag=3,r.payload={element:null};var n=t.value;return r.callback=function(){rc||(rc=!0,$d=n),Id(e,t)},r}function E0(e,t,r){r=Un(-1,r),r.tag=3;var n=e.type.getDerivedStateFromError;if(typeof n=="function"){var o=t.value;r.payload=function(){return n(o)},r.callback=function(){Id(e,t)}}var i=e.stateNode;return i!==null&&typeof i.componentDidCatch=="function"&&(r.callback=function(){Id(e,t),typeof n!="function"&&(Cs===null?Cs=new Set([this]):Cs.add(this));var l=t.stack;this.componentDidCatch(t.value,{componentStack:l!==null?l:""})}),r}function Kf(e,t,r){var n=e.pingCache;if(n===null){n=e.pingCache=new dS;var o=new Set;n.set(t,o)}else o=n.get(t),o===void 0&&(o=new Set,n.set(t,o));o.has(r)||(o.add(r),e=CS.bind(null,e,t,r),t.then(e,e))}function Yf(e){do{var t;if((t=e.tag===13)&&(t=e.memoizedState,t=t!==null?t.dehydrated!==null:!0),t)return e;e=e.return}while(e!==null);return null}function Qf(e,t,r,n,o){return e.mode&1?(e.flags|=65536,e.lanes=o,e):(e===t?e.flags|=65536:(e.flags|=128,r.flags|=131072,r.flags&=-52805,r.tag===1&&(r.alternate===null?r.tag=17:(t=Un(-1,1),t.tag=2,Ts(r,t,1))),r.lanes|=1),e)}var pS=Vn.ReactCurrentOwner,Pr=!1;function vr(e,t,r,n){t.child=e===null?i0(t,null,r,n):fi(t,e.child,r,n)}function Jf(e,t,r,n,o){r=r.render;var i=t.ref;return li(t,o),n=_p(e,t,r,n,i,o),r=Rp(),e!==null&&!Pr?(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~o,Gn(e,t,o)):(Mt&&r&&bp(t),t.flags|=1,vr(e,t,n,o),t.child)}function Zf(e,t,r,n,o){if(e===null){var i=r.type;return typeof i=="function"&&!Wp(i)&&i.defaultProps===void 0&&r.compare===null&&r.defaultProps===void 0?(t.tag=15,t.type=i,M0(e,t,i,n,o)):(e=zl(r.type,null,n,t,t.mode,o),e.ref=t.ref,e.return=t,t.child=e)}if(i=e.child,!(e.lanes&o)){var l=i.memoizedProps;if(r=r.compare,r=r!==null?r:wa,r(l,n)&&e.ref===t.ref)return Gn(e,t,o)}return t.flags|=1,e=js(i,n),e.ref=t.ref,e.return=t,t.child=e}function M0(e,t,r,n,o){if(e!==null){var i=e.memoizedProps;if(wa(i,n)&&e.ref===t.ref)if(Pr=!1,t.pendingProps=n=i,(e.lanes&o)!==0)e.flags&131072&&(Pr=!0);else return t.lanes=e.lanes,Gn(e,t,o)}return Ad(e,t,r,n,o)}function _0(e,t,r){var n=t.pendingProps,o=n.children,i=e!==null?e.memoizedState:null;if(n.mode==="hidden")if(!(t.mode&1))t.memoizedState={baseLanes:0,cachePool:null,transitions:null},St(ni,Or),Or|=r;else{if(!(r&1073741824))return e=i!==null?i.baseLanes|r:r,t.lanes=t.childLanes=1073741824,t.memoizedState={baseLanes:e,cachePool:null,transitions:null},t.updateQueue=null,St(ni,Or),Or|=e,null;t.memoizedState={baseLanes:0,cachePool:null,transitions:null},n=i!==null?i.baseLanes:r,St(ni,Or),Or|=n}else i!==null?(n=i.baseLanes|r,t.memoizedState=null):n=r,St(ni,Or),Or|=n;return vr(e,t,o,r),t.child}function R0(e,t){var r=t.ref;(e===null&&r!==null||e!==null&&e.ref!==r)&&(t.flags|=512,t.flags|=2097152)}function Ad(e,t,r,n,o){var i=Ir(r)?co:hr.current;return i=hi(t,i),li(t,o),r=_p(e,t,r,n,i,o),n=Rp(),e!==null&&!Pr?(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~o,Gn(e,t,o)):(Mt&&n&&bp(t),t.flags|=1,vr(e,t,r,o),t.child)}function Xf(e,t,r,n,o){if(Ir(r)){var i=!0;Hl(t)}else i=!1;if(li(t,o),t.stateNode===null)Ml(e,t),I0(t,r,n),Nd(t,r,n,o),n=!0;else if(e===null){var l=t.stateNode,c=t.memoizedProps;l.props=c;var u=l.context,d=r.contextType;typeof d=="object"&&d!==null?d=Yr(d):(d=Ir(r)?co:hr.current,d=hi(t,d));var g=r.getDerivedStateFromProps,x=typeof g=="function"||typeof l.getSnapshotBeforeUpdate=="function";x||typeof l.UNSAFE_componentWillReceiveProps!="function"&&typeof l.componentWillReceiveProps!="function"||(c!==n||u!==d)&&Vf(t,l,n,d),ss=!1;var y=t.memoizedState;l.state=y,Jl(t,n,l,o),u=t.memoizedState,c!==n||y!==u||Nr.current||ss?(typeof g=="function"&&(jd(t,r,g,n),u=t.memoizedState),(c=ss||Hf(t,r,c,n,y,u,d))?(x||typeof l.UNSAFE_componentWillMount!="function"&&typeof l.componentWillMount!="function"||(typeof l.componentWillMount=="function"&&l.componentWillMount(),typeof l.UNSAFE_componentWillMount=="function"&&l.UNSAFE_componentWillMount()),typeof l.componentDidMount=="function"&&(t.flags|=4194308)):(typeof l.componentDidMount=="function"&&(t.flags|=4194308),t.memoizedProps=n,t.memoizedState=u),l.props=n,l.state=u,l.context=d,n=c):(typeof l.componentDidMount=="function"&&(t.flags|=4194308),n=!1)}else{l=t.stateNode,l0(e,t),c=t.memoizedProps,d=t.type===t.elementType?c:cn(t.type,c),l.props=d,x=t.pendingProps,y=l.context,u=r.contextType,typeof u=="object"&&u!==null?u=Yr(u):(u=Ir(r)?co:hr.current,u=hi(t,u));var S=r.getDerivedStateFromProps;(g=typeof S=="function"||typeof l.getSnapshotBeforeUpdate=="function")||typeof l.UNSAFE_componentWillReceiveProps!="function"&&typeof l.componentWillReceiveProps!="function"||(c!==x||y!==u)&&Vf(t,l,n,u),ss=!1,y=t.memoizedState,l.state=y,Jl(t,n,l,o);var T=t.memoizedState;c!==x||y!==T||Nr.current||ss?(typeof S=="function"&&(jd(t,r,S,n),T=t.memoizedState),(d=ss||Hf(t,r,d,n,y,T,u)||!1)?(g||typeof l.UNSAFE_componentWillUpdate!="function"&&typeof l.componentWillUpdate!="function"||(typeof l.componentWillUpdate=="function"&&l.componentWillUpdate(n,T,u),typeof l.UNSAFE_componentWillUpdate=="function"&&l.UNSAFE_componentWillUpdate(n,T,u)),typeof l.componentDidUpdate=="function"&&(t.flags|=4),typeof l.getSnapshotBeforeUpdate=="function"&&(t.flags|=1024)):(typeof l.componentDidUpdate!="function"||c===e.memoizedProps&&y===e.memoizedState||(t.flags|=4),typeof l.getSnapshotBeforeUpdate!="function"||c===e.memoizedProps&&y===e.memoizedState||(t.flags|=1024),t.memoizedProps=n,t.memoizedState=T),l.props=n,l.state=T,l.context=u,n=d):(typeof l.componentDidUpdate!="function"||c===e.memoizedProps&&y===e.memoizedState||(t.flags|=4),typeof l.getSnapshotBeforeUpdate!="function"||c===e.memoizedProps&&y===e.memoizedState||(t.flags|=1024),n=!1)}return Ed(e,t,r,n,i,o)}function Ed(e,t,r,n,o,i){R0(e,t);var l=(t.flags&128)!==0;if(!n&&!l)return o&&Df(t,r,!1),Gn(e,t,i);n=t.stateNode,pS.current=t;var c=l&&typeof r.getDerivedStateFromError!="function"?null:n.render();return t.flags|=1,e!==null&&l?(t.child=fi(t,e.child,null,i),t.child=fi(t,null,c,i)):vr(e,t,c,i),t.memoizedState=n.state,o&&Df(t,r,!0),t.child}function z0(e){var t=e.stateNode;t.pendingContext?Of(e,t.pendingContext,t.pendingContext!==t.context):t.context&&Of(e,t.context,!1),Ip(e,t.containerInfo)}function eg(e,t,r,n,o){return mi(),Sp(o),t.flags|=256,vr(e,t,r,n),t.child}var Md={dehydrated:null,treeContext:null,retryLane:0};function _d(e){return{baseLanes:e,cachePool:null,transitions:null}}function L0(e,t,r){var n=t.pendingProps,o=Lt.current,i=!1,l=(t.flags&128)!==0,c;if((c=l)||(c=e!==null&&e.memoizedState===null?!1:(o&2)!==0),c?(i=!0,t.flags&=-129):(e===null||e.memoizedState!==null)&&(o|=1),St(Lt,o&1),e===null)return Cd(t),e=t.memoizedState,e!==null&&(e=e.dehydrated,e!==null)?(t.mode&1?e.data==="$!"?t.lanes=8:t.lanes=1073741824:t.lanes=1,null):(l=n.children,e=n.fallback,i?(n=t.mode,i=t.child,l={mode:"hidden",children:l},!(n&1)&&i!==null?(i.childLanes=0,i.pendingProps=l):i=jc(l,n,0,null),e=ao(e,n,r,null),i.return=t,e.return=t,i.sibling=e,t.child=i,t.child.memoizedState=_d(r),t.memoizedState=Md,e):Op(t,l));if(o=e.memoizedState,o!==null&&(c=o.dehydrated,c!==null))return hS(e,t,l,n,c,o,r);if(i){i=n.fallback,l=t.mode,o=e.child,c=o.sibling;var u={mode:"hidden",children:n.children};return!(l&1)&&t.child!==o?(n=t.child,n.childLanes=0,n.pendingProps=u,t.deletions=null):(n=js(o,u),n.subtreeFlags=o.subtreeFlags&14680064),c!==null?i=js(c,i):(i=ao(i,l,r,null),i.flags|=2),i.return=t,n.return=t,n.sibling=i,t.child=n,n=i,i=t.child,l=e.child.memoizedState,l=l===null?_d(r):{baseLanes:l.baseLanes|r,cachePool:null,transitions:l.transitions},i.memoizedState=l,i.childLanes=e.childLanes&~r,t.memoizedState=Md,n}return i=e.child,e=i.sibling,n=js(i,{mode:"visible",children:n.children}),!(t.mode&1)&&(n.lanes=r),n.return=t,n.sibling=null,e!==null&&(r=t.deletions,r===null?(t.deletions=[e],t.flags|=16):r.push(e)),t.child=n,t.memoizedState=null,n}function Op(e,t){return t=jc({mode:"visible",children:t},e.mode,0,null),t.return=e,e.child=t}function hl(e,t,r,n){return n!==null&&Sp(n),fi(t,e.child,null,r),e=Op(t,t.pendingProps.children),e.flags|=2,t.memoizedState=null,e}function hS(e,t,r,n,o,i,l){if(r)return t.flags&256?(t.flags&=-257,n=Fu(Error(de(422))),hl(e,t,l,n)):t.memoizedState!==null?(t.child=e.child,t.flags|=128,null):(i=n.fallback,o=t.mode,n=jc({mode:"visible",children:n.children},o,0,null),i=ao(i,o,l,null),i.flags|=2,n.return=t,i.return=t,n.sibling=i,t.child=n,t.mode&1&&fi(t,e.child,null,l),t.child.memoizedState=_d(l),t.memoizedState=Md,i);if(!(t.mode&1))return hl(e,t,l,null);if(o.data==="$!"){if(n=o.nextSibling&&o.nextSibling.dataset,n)var c=n.dgst;return n=c,i=Error(de(419)),n=Fu(i,n,void 0),hl(e,t,l,n)}if(c=(l&e.childLanes)!==0,Pr||c){if(n=tr,n!==null){switch(l&-l){case 4:o=2;break;case 16:o=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:o=32;break;case 536870912:o=268435456;break;default:o=0}o=o&(n.suspendedLanes|l)?0:o,o!==0&&o!==i.retryLane&&(i.retryLane=o,Wn(e,o),hn(n,e,o,-1))}return qp(),n=Fu(Error(de(421))),hl(e,t,l,n)}return o.data==="$?"?(t.flags|=128,t.child=e.child,t=PS.bind(null,e),o._reactRetry=t,null):(e=i.treeContext,Dr=Ss(o.nextSibling),$r=t,Mt=!0,dn=null,e!==null&&(Gr[Hr++]=On,Gr[Hr++]=Dn,Gr[Hr++]=uo,On=e.id,Dn=e.overflow,uo=t),t=Op(t,n.children),t.flags|=4096,t)}function tg(e,t,r){e.lanes|=t;var n=e.alternate;n!==null&&(n.lanes|=t),Pd(e.return,t,r)}function Uu(e,t,r,n,o){var i=e.memoizedState;i===null?e.memoizedState={isBackwards:t,rendering:null,renderingStartTime:0,last:n,tail:r,tailMode:o}:(i.isBackwards=t,i.rendering=null,i.renderingStartTime=0,i.last=n,i.tail=r,i.tailMode=o)}function O0(e,t,r){var n=t.pendingProps,o=n.revealOrder,i=n.tail;if(vr(e,t,n.children,r),n=Lt.current,n&2)n=n&1|2,t.flags|=128;else{if(e!==null&&e.flags&128)e:for(e=t.child;e!==null;){if(e.tag===13)e.memoizedState!==null&&tg(e,r,t);else if(e.tag===19)tg(e,r,t);else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===t)break e;for(;e.sibling===null;){if(e.return===null||e.return===t)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}n&=1}if(St(Lt,n),!(t.mode&1))t.memoizedState=null;else switch(o){case"forwards":for(r=t.child,o=null;r!==null;)e=r.alternate,e!==null&&Zl(e)===null&&(o=r),r=r.sibling;r=o,r===null?(o=t.child,t.child=null):(o=r.sibling,r.sibling=null),Uu(t,!1,o,r,i);break;case"backwards":for(r=null,o=t.child,t.child=null;o!==null;){if(e=o.alternate,e!==null&&Zl(e)===null){t.child=o;break}e=o.sibling,o.sibling=r,r=o,o=e}Uu(t,!0,r,null,i);break;case"together":Uu(t,!1,null,null,void 0);break;default:t.memoizedState=null}return t.child}function Ml(e,t){!(t.mode&1)&&e!==null&&(e.alternate=null,t.alternate=null,t.flags|=2)}function Gn(e,t,r){if(e!==null&&(t.dependencies=e.dependencies),ho|=t.lanes,!(r&t.childLanes))return null;if(e!==null&&t.child!==e.child)throw Error(de(153));if(t.child!==null){for(e=t.child,r=js(e,e.pendingProps),t.child=r,r.return=t;e.sibling!==null;)e=e.sibling,r=r.sibling=js(e,e.pendingProps),r.return=t;r.sibling=null}return t.child}function mS(e,t,r){switch(t.tag){case 3:z0(t),mi();break;case 5:c0(t);break;case 1:Ir(t.type)&&Hl(t);break;case 4:Ip(t,t.stateNode.containerInfo);break;case 10:var n=t.type._context,o=t.memoizedProps.value;St(Yl,n._currentValue),n._currentValue=o;break;case 13:if(n=t.memoizedState,n!==null)return n.dehydrated!==null?(St(Lt,Lt.current&1),t.flags|=128,null):r&t.child.childLanes?L0(e,t,r):(St(Lt,Lt.current&1),e=Gn(e,t,r),e!==null?e.sibling:null);St(Lt,Lt.current&1);break;case 19:if(n=(r&t.childLanes)!==0,e.flags&128){if(n)return O0(e,t,r);t.flags|=128}if(o=t.memoizedState,o!==null&&(o.rendering=null,o.tail=null,o.lastEffect=null),St(Lt,Lt.current),n)break;return null;case 22:case 23:return t.lanes=0,_0(e,t,r)}return Gn(e,t,r)}var D0,Rd,$0,F0;D0=function(e,t){for(var r=t.child;r!==null;){if(r.tag===5||r.tag===6)e.appendChild(r.stateNode);else if(r.tag!==4&&r.child!==null){r.child.return=r,r=r.child;continue}if(r===t)break;for(;r.sibling===null;){if(r.return===null||r.return===t)return;r=r.return}r.sibling.return=r.return,r=r.sibling}};Rd=function(){};$0=function(e,t,r,n){var o=e.memoizedProps;if(o!==n){e=t.stateNode,oo(Sn.current);var i=null;switch(r){case"input":o=rd(e,o),n=rd(e,n),i=[];break;case"select":o=Dt({},o,{value:void 0}),n=Dt({},n,{value:void 0}),i=[];break;case"textarea":o=od(e,o),n=od(e,n),i=[];break;default:typeof o.onClick!="function"&&typeof n.onClick=="function"&&(e.onclick=Wl)}ad(r,n);var l;r=null;for(d in o)if(!n.hasOwnProperty(d)&&o.hasOwnProperty(d)&&o[d]!=null)if(d==="style"){var c=o[d];for(l in c)c.hasOwnProperty(l)&&(r||(r={}),r[l]="")}else d!=="dangerouslySetInnerHTML"&&d!=="children"&&d!=="suppressContentEditableWarning"&&d!=="suppressHydrationWarning"&&d!=="autoFocus"&&(ha.hasOwnProperty(d)?i||(i=[]):(i=i||[]).push(d,null));for(d in n){var u=n[d];if(c=o!=null?o[d]:void 0,n.hasOwnProperty(d)&&u!==c&&(u!=null||c!=null))if(d==="style")if(c){for(l in c)!c.hasOwnProperty(l)||u&&u.hasOwnProperty(l)||(r||(r={}),r[l]="");for(l in u)u.hasOwnProperty(l)&&c[l]!==u[l]&&(r||(r={}),r[l]=u[l])}else r||(i||(i=[]),i.push(d,r)),r=u;else d==="dangerouslySetInnerHTML"?(u=u?u.__html:void 0,c=c?c.__html:void 0,u!=null&&c!==u&&(i=i||[]).push(d,u)):d==="children"?typeof u!="string"&&typeof u!="number"||(i=i||[]).push(d,""+u):d!=="suppressContentEditableWarning"&&d!=="suppressHydrationWarning"&&(ha.hasOwnProperty(d)?(u!=null&&d==="onScroll"&&jt("scroll",e),i||c===u||(i=[])):(i=i||[]).push(d,u))}r&&(i=i||[]).push("style",r);var d=i;(t.updateQueue=d)&&(t.flags|=4)}};F0=function(e,t,r,n){r!==n&&(t.flags|=4)};function Vi(e,t){if(!Mt)switch(e.tailMode){case"hidden":t=e.tail;for(var r=null;t!==null;)t.alternate!==null&&(r=t),t=t.sibling;r===null?e.tail=null:r.sibling=null;break;case"collapsed":r=e.tail;for(var n=null;r!==null;)r.alternate!==null&&(n=r),r=r.sibling;n===null?t||e.tail===null?e.tail=null:e.tail.sibling=null:n.sibling=null}}function dr(e){var t=e.alternate!==null&&e.alternate.child===e.child,r=0,n=0;if(t)for(var o=e.child;o!==null;)r|=o.lanes|o.childLanes,n|=o.subtreeFlags&14680064,n|=o.flags&14680064,o.return=e,o=o.sibling;else for(o=e.child;o!==null;)r|=o.lanes|o.childLanes,n|=o.subtreeFlags,n|=o.flags,o.return=e,o=o.sibling;return e.subtreeFlags|=n,e.childLanes=r,t}function fS(e,t,r){var n=t.pendingProps;switch(kp(t),t.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return dr(t),null;case 1:return Ir(t.type)&&Gl(),dr(t),null;case 3:return n=t.stateNode,gi(),Nt(Nr),Nt(hr),Ep(),n.pendingContext&&(n.context=n.pendingContext,n.pendingContext=null),(e===null||e.child===null)&&(dl(t)?t.flags|=4:e===null||e.memoizedState.isDehydrated&&!(t.flags&256)||(t.flags|=1024,dn!==null&&(Bd(dn),dn=null))),Rd(e,t),dr(t),null;case 5:Ap(t);var o=oo(Ca.current);if(r=t.type,e!==null&&t.stateNode!=null)$0(e,t,r,n,o),e.ref!==t.ref&&(t.flags|=512,t.flags|=2097152);else{if(!n){if(t.stateNode===null)throw Error(de(166));return dr(t),null}if(e=oo(Sn.current),dl(t)){n=t.stateNode,r=t.type;var i=t.memoizedProps;switch(n[bn]=t,n[Sa]=i,e=(t.mode&1)!==0,r){case"dialog":jt("cancel",n),jt("close",n);break;case"iframe":case"object":case"embed":jt("load",n);break;case"video":case"audio":for(o=0;o<ea.length;o++)jt(ea[o],n);break;case"source":jt("error",n);break;case"img":case"image":case"link":jt("error",n),jt("load",n);break;case"details":jt("toggle",n);break;case"input":uf(n,i),jt("invalid",n);break;case"select":n._wrapperState={wasMultiple:!!i.multiple},jt("invalid",n);break;case"textarea":pf(n,i),jt("invalid",n)}ad(r,i),o=null;for(var l in i)if(i.hasOwnProperty(l)){var c=i[l];l==="children"?typeof c=="string"?n.textContent!==c&&(i.suppressHydrationWarning!==!0&&ul(n.textContent,c,e),o=["children",c]):typeof c=="number"&&n.textContent!==""+c&&(i.suppressHydrationWarning!==!0&&ul(n.textContent,c,e),o=["children",""+c]):ha.hasOwnProperty(l)&&c!=null&&l==="onScroll"&&jt("scroll",n)}switch(r){case"input":rl(n),df(n,i,!0);break;case"textarea":rl(n),hf(n);break;case"select":case"option":break;default:typeof i.onClick=="function"&&(n.onclick=Wl)}n=o,t.updateQueue=n,n!==null&&(t.flags|=4)}else{l=o.nodeType===9?o:o.ownerDocument,e==="http://www.w3.org/1999/xhtml"&&(e=my(r)),e==="http://www.w3.org/1999/xhtml"?r==="script"?(e=l.createElement("div"),e.innerHTML="<script><\/script>",e=e.removeChild(e.firstChild)):typeof n.is=="string"?e=l.createElement(r,{is:n.is}):(e=l.createElement(r),r==="select"&&(l=e,n.multiple?l.multiple=!0:n.size&&(l.size=n.size))):e=l.createElementNS(e,r),e[bn]=t,e[Sa]=n,D0(e,t,!1,!1),t.stateNode=e;e:{switch(l=ld(r,n),r){case"dialog":jt("cancel",e),jt("close",e),o=n;break;case"iframe":case"object":case"embed":jt("load",e),o=n;break;case"video":case"audio":for(o=0;o<ea.length;o++)jt(ea[o],e);o=n;break;case"source":jt("error",e),o=n;break;case"img":case"image":case"link":jt("error",e),jt("load",e),o=n;break;case"details":jt("toggle",e),o=n;break;case"input":uf(e,n),o=rd(e,n),jt("invalid",e);break;case"option":o=n;break;case"select":e._wrapperState={wasMultiple:!!n.multiple},o=Dt({},n,{value:void 0}),jt("invalid",e);break;case"textarea":pf(e,n),o=od(e,n),jt("invalid",e);break;default:o=n}ad(r,o),c=o;for(i in c)if(c.hasOwnProperty(i)){var u=c[i];i==="style"?yy(e,u):i==="dangerouslySetInnerHTML"?(u=u?u.__html:void 0,u!=null&&fy(e,u)):i==="children"?typeof u=="string"?(r!=="textarea"||u!=="")&&ma(e,u):typeof u=="number"&&ma(e,""+u):i!=="suppressContentEditableWarning"&&i!=="suppressHydrationWarning"&&i!=="autoFocus"&&(ha.hasOwnProperty(i)?u!=null&&i==="onScroll"&&jt("scroll",e):u!=null&&ap(e,i,u,l))}switch(r){case"input":rl(e),df(e,n,!1);break;case"textarea":rl(e),hf(e);break;case"option":n.value!=null&&e.setAttribute("value",""+Is(n.value));break;case"select":e.multiple=!!n.multiple,i=n.value,i!=null?si(e,!!n.multiple,i,!1):n.defaultValue!=null&&si(e,!!n.multiple,n.defaultValue,!0);break;default:typeof o.onClick=="function"&&(e.onclick=Wl)}switch(r){case"button":case"input":case"select":case"textarea":n=!!n.autoFocus;break e;case"img":n=!0;break e;default:n=!1}}n&&(t.flags|=4)}t.ref!==null&&(t.flags|=512,t.flags|=2097152)}return dr(t),null;case 6:if(e&&t.stateNode!=null)F0(e,t,e.memoizedProps,n);else{if(typeof n!="string"&&t.stateNode===null)throw Error(de(166));if(r=oo(Ca.current),oo(Sn.current),dl(t)){if(n=t.stateNode,r=t.memoizedProps,n[bn]=t,(i=n.nodeValue!==r)&&(e=$r,e!==null))switch(e.tag){case 3:ul(n.nodeValue,r,(e.mode&1)!==0);break;case 5:e.memoizedProps.suppressHydrationWarning!==!0&&ul(n.nodeValue,r,(e.mode&1)!==0)}i&&(t.flags|=4)}else n=(r.nodeType===9?r:r.ownerDocument).createTextNode(n),n[bn]=t,t.stateNode=n}return dr(t),null;case 13:if(Nt(Lt),n=t.memoizedState,e===null||e.memoizedState!==null&&e.memoizedState.dehydrated!==null){if(Mt&&Dr!==null&&t.mode&1&&!(t.flags&128))s0(),mi(),t.flags|=98560,i=!1;else if(i=dl(t),n!==null&&n.dehydrated!==null){if(e===null){if(!i)throw Error(de(318));if(i=t.memoizedState,i=i!==null?i.dehydrated:null,!i)throw Error(de(317));i[bn]=t}else mi(),!(t.flags&128)&&(t.memoizedState=null),t.flags|=4;dr(t),i=!1}else dn!==null&&(Bd(dn),dn=null),i=!0;if(!i)return t.flags&65536?t:null}return t.flags&128?(t.lanes=r,t):(n=n!==null,n!==(e!==null&&e.memoizedState!==null)&&n&&(t.child.flags|=8192,t.mode&1&&(e===null||Lt.current&1?Jt===0&&(Jt=3):qp())),t.updateQueue!==null&&(t.flags|=4),dr(t),null);case 4:return gi(),Rd(e,t),e===null&&ba(t.stateNode.containerInfo),dr(t),null;case 10:return Pp(t.type._context),dr(t),null;case 17:return Ir(t.type)&&Gl(),dr(t),null;case 19:if(Nt(Lt),i=t.memoizedState,i===null)return dr(t),null;if(n=(t.flags&128)!==0,l=i.rendering,l===null)if(n)Vi(i,!1);else{if(Jt!==0||e!==null&&e.flags&128)for(e=t.child;e!==null;){if(l=Zl(e),l!==null){for(t.flags|=128,Vi(i,!1),n=l.updateQueue,n!==null&&(t.updateQueue=n,t.flags|=4),t.subtreeFlags=0,n=r,r=t.child;r!==null;)i=r,e=n,i.flags&=14680066,l=i.alternate,l===null?(i.childLanes=0,i.lanes=e,i.child=null,i.subtreeFlags=0,i.memoizedProps=null,i.memoizedState=null,i.updateQueue=null,i.dependencies=null,i.stateNode=null):(i.childLanes=l.childLanes,i.lanes=l.lanes,i.child=l.child,i.subtreeFlags=0,i.deletions=null,i.memoizedProps=l.memoizedProps,i.memoizedState=l.memoizedState,i.updateQueue=l.updateQueue,i.type=l.type,e=l.dependencies,i.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext}),r=r.sibling;return St(Lt,Lt.current&1|2),t.child}e=e.sibling}i.tail!==null&&Bt()>xi&&(t.flags|=128,n=!0,Vi(i,!1),t.lanes=4194304)}else{if(!n)if(e=Zl(l),e!==null){if(t.flags|=128,n=!0,r=e.updateQueue,r!==null&&(t.updateQueue=r,t.flags|=4),Vi(i,!0),i.tail===null&&i.tailMode==="hidden"&&!l.alternate&&!Mt)return dr(t),null}else 2*Bt()-i.renderingStartTime>xi&&r!==1073741824&&(t.flags|=128,n=!0,Vi(i,!1),t.lanes=4194304);i.isBackwards?(l.sibling=t.child,t.child=l):(r=i.last,r!==null?r.sibling=l:t.child=l,i.last=l)}return i.tail!==null?(t=i.tail,i.rendering=t,i.tail=t.sibling,i.renderingStartTime=Bt(),t.sibling=null,r=Lt.current,St(Lt,n?r&1|2:r&1),t):(dr(t),null);case 22:case 23:return Bp(),n=t.memoizedState!==null,e!==null&&e.memoizedState!==null!==n&&(t.flags|=8192),n&&t.mode&1?Or&1073741824&&(dr(t),t.subtreeFlags&6&&(t.flags|=8192)):dr(t),null;case 24:return null;case 25:return null}throw Error(de(156,t.tag))}function gS(e,t){switch(kp(t),t.tag){case 1:return Ir(t.type)&&Gl(),e=t.flags,e&65536?(t.flags=e&-65537|128,t):null;case 3:return gi(),Nt(Nr),Nt(hr),Ep(),e=t.flags,e&65536&&!(e&128)?(t.flags=e&-65537|128,t):null;case 5:return Ap(t),null;case 13:if(Nt(Lt),e=t.memoizedState,e!==null&&e.dehydrated!==null){if(t.alternate===null)throw Error(de(340));mi()}return e=t.flags,e&65536?(t.flags=e&-65537|128,t):null;case 19:return Nt(Lt),null;case 4:return gi(),null;case 10:return Pp(t.type._context),null;case 22:case 23:return Bp(),null;case 24:return null;default:return null}}var ml=!1,pr=!1,yS=typeof WeakSet=="function"?WeakSet:Set,Ae=null;function ri(e,t){var r=e.ref;if(r!==null)if(typeof r=="function")try{r(null)}catch(n){Ft(e,t,n)}else r.current=null}function zd(e,t,r){try{r()}catch(n){Ft(e,t,n)}}var rg=!1;function xS(e,t){if(xd=Ul,e=Gy(),wp(e)){if("selectionStart"in e)var r={start:e.selectionStart,end:e.selectionEnd};else e:{r=(r=e.ownerDocument)&&r.defaultView||window;var n=r.getSelection&&r.getSelection();if(n&&n.rangeCount!==0){r=n.anchorNode;var o=n.anchorOffset,i=n.focusNode;n=n.focusOffset;try{r.nodeType,i.nodeType}catch{r=null;break e}var l=0,c=-1,u=-1,d=0,g=0,x=e,y=null;t:for(;;){for(var S;x!==r||o!==0&&x.nodeType!==3||(c=l+o),x!==i||n!==0&&x.nodeType!==3||(u=l+n),x.nodeType===3&&(l+=x.nodeValue.length),(S=x.firstChild)!==null;)y=x,x=S;for(;;){if(x===e)break t;if(y===r&&++d===o&&(c=l),y===i&&++g===n&&(u=l),(S=x.nextSibling)!==null)break;x=y,y=x.parentNode}x=S}r=c===-1||u===-1?null:{start:c,end:u}}else r=null}r=r||{start:0,end:0}}else r=null;for(vd={focusedElem:e,selectionRange:r},Ul=!1,Ae=t;Ae!==null;)if(t=Ae,e=t.child,(t.subtreeFlags&1028)!==0&&e!==null)e.return=t,Ae=e;else for(;Ae!==null;){t=Ae;try{var T=t.alternate;if(t.flags&1024)switch(t.tag){case 0:case 11:case 15:break;case 1:if(T!==null){var I=T.memoizedProps,b=T.memoizedState,h=t.stateNode,v=h.getSnapshotBeforeUpdate(t.elementType===t.type?I:cn(t.type,I),b);h.__reactInternalSnapshotBeforeUpdate=v}break;case 3:var C=t.stateNode.containerInfo;C.nodeType===1?C.textContent="":C.nodeType===9&&C.documentElement&&C.removeChild(C.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(de(163))}}catch(A){Ft(t,t.return,A)}if(e=t.sibling,e!==null){e.return=t.return,Ae=e;break}Ae=t.return}return T=rg,rg=!1,T}function la(e,t,r){var n=t.updateQueue;if(n=n!==null?n.lastEffect:null,n!==null){var o=n=n.next;do{if((o.tag&e)===e){var i=o.destroy;o.destroy=void 0,i!==void 0&&zd(t,r,i)}o=o.next}while(o!==n)}}function Cc(e,t){if(t=t.updateQueue,t=t!==null?t.lastEffect:null,t!==null){var r=t=t.next;do{if((r.tag&e)===e){var n=r.create;r.destroy=n()}r=r.next}while(r!==t)}}function Ld(e){var t=e.ref;if(t!==null){var r=e.stateNode;switch(e.tag){case 5:e=r;break;default:e=r}typeof t=="function"?t(e):t.current=e}}function U0(e){var t=e.alternate;t!==null&&(e.alternate=null,U0(t)),e.child=null,e.deletions=null,e.sibling=null,e.tag===5&&(t=e.stateNode,t!==null&&(delete t[bn],delete t[Sa],delete t[kd],delete t[eS],delete t[tS])),e.stateNode=null,e.return=null,e.dependencies=null,e.memoizedProps=null,e.memoizedState=null,e.pendingProps=null,e.stateNode=null,e.updateQueue=null}function B0(e){return e.tag===5||e.tag===3||e.tag===4}function ng(e){e:for(;;){for(;e.sibling===null;){if(e.return===null||B0(e.return))return null;e=e.return}for(e.sibling.return=e.return,e=e.sibling;e.tag!==5&&e.tag!==6&&e.tag!==18;){if(e.flags&2||e.child===null||e.tag===4)continue e;e.child.return=e,e=e.child}if(!(e.flags&2))return e.stateNode}}function Od(e,t,r){var n=e.tag;if(n===5||n===6)e=e.stateNode,t?r.nodeType===8?r.parentNode.insertBefore(e,t):r.insertBefore(e,t):(r.nodeType===8?(t=r.parentNode,t.insertBefore(e,r)):(t=r,t.appendChild(e)),r=r._reactRootContainer,r!=null||t.onclick!==null||(t.onclick=Wl));else if(n!==4&&(e=e.child,e!==null))for(Od(e,t,r),e=e.sibling;e!==null;)Od(e,t,r),e=e.sibling}function Dd(e,t,r){var n=e.tag;if(n===5||n===6)e=e.stateNode,t?r.insertBefore(e,t):r.appendChild(e);else if(n!==4&&(e=e.child,e!==null))for(Dd(e,t,r),e=e.sibling;e!==null;)Dd(e,t,r),e=e.sibling}var sr=null,un=!1;function rs(e,t,r){for(r=r.child;r!==null;)q0(e,t,r),r=r.sibling}function q0(e,t,r){if(kn&&typeof kn.onCommitFiberUnmount=="function")try{kn.onCommitFiberUnmount(yc,r)}catch{}switch(r.tag){case 5:pr||ri(r,t);case 6:var n=sr,o=un;sr=null,rs(e,t,r),sr=n,un=o,sr!==null&&(un?(e=sr,r=r.stateNode,e.nodeType===8?e.parentNode.removeChild(r):e.removeChild(r)):sr.removeChild(r.stateNode));break;case 18:sr!==null&&(un?(e=sr,r=r.stateNode,e.nodeType===8?Ru(e.parentNode,r):e.nodeType===1&&Ru(e,r),xa(e)):Ru(sr,r.stateNode));break;case 4:n=sr,o=un,sr=r.stateNode.containerInfo,un=!0,rs(e,t,r),sr=n,un=o;break;case 0:case 11:case 14:case 15:if(!pr&&(n=r.updateQueue,n!==null&&(n=n.lastEffect,n!==null))){o=n=n.next;do{var i=o,l=i.destroy;i=i.tag,l!==void 0&&(i&2||i&4)&&zd(r,t,l),o=o.next}while(o!==n)}rs(e,t,r);break;case 1:if(!pr&&(ri(r,t),n=r.stateNode,typeof n.componentWillUnmount=="function"))try{n.props=r.memoizedProps,n.state=r.memoizedState,n.componentWillUnmount()}catch(c){Ft(r,t,c)}rs(e,t,r);break;case 21:rs(e,t,r);break;case 22:r.mode&1?(pr=(n=pr)||r.memoizedState!==null,rs(e,t,r),pr=n):rs(e,t,r);break;default:rs(e,t,r)}}function sg(e){var t=e.updateQueue;if(t!==null){e.updateQueue=null;var r=e.stateNode;r===null&&(r=e.stateNode=new yS),t.forEach(function(n){var o=jS.bind(null,e,n);r.has(n)||(r.add(n),n.then(o,o))})}}function on(e,t){var r=t.deletions;if(r!==null)for(var n=0;n<r.length;n++){var o=r[n];try{var i=e,l=t,c=l;e:for(;c!==null;){switch(c.tag){case 5:sr=c.stateNode,un=!1;break e;case 3:sr=c.stateNode.containerInfo,un=!0;break e;case 4:sr=c.stateNode.containerInfo,un=!0;break e}c=c.return}if(sr===null)throw Error(de(160));q0(i,l,o),sr=null,un=!1;var u=o.alternate;u!==null&&(u.return=null),o.return=null}catch(d){Ft(o,t,d)}}if(t.subtreeFlags&12854)for(t=t.child;t!==null;)W0(t,e),t=t.sibling}function W0(e,t){var r=e.alternate,n=e.flags;switch(e.tag){case 0:case 11:case 14:case 15:if(on(t,e),xn(e),n&4){try{la(3,e,e.return),Cc(3,e)}catch(I){Ft(e,e.return,I)}try{la(5,e,e.return)}catch(I){Ft(e,e.return,I)}}break;case 1:on(t,e),xn(e),n&512&&r!==null&&ri(r,r.return);break;case 5:if(on(t,e),xn(e),n&512&&r!==null&&ri(r,r.return),e.flags&32){var o=e.stateNode;try{ma(o,"")}catch(I){Ft(e,e.return,I)}}if(n&4&&(o=e.stateNode,o!=null)){var i=e.memoizedProps,l=r!==null?r.memoizedProps:i,c=e.type,u=e.updateQueue;if(e.updateQueue=null,u!==null)try{c==="input"&&i.type==="radio"&&i.name!=null&&py(o,i),ld(c,l);var d=ld(c,i);for(l=0;l<u.length;l+=2){var g=u[l],x=u[l+1];g==="style"?yy(o,x):g==="dangerouslySetInnerHTML"?fy(o,x):g==="children"?ma(o,x):ap(o,g,x,d)}switch(c){case"input":nd(o,i);break;case"textarea":hy(o,i);break;case"select":var y=o._wrapperState.wasMultiple;o._wrapperState.wasMultiple=!!i.multiple;var S=i.value;S!=null?si(o,!!i.multiple,S,!1):y!==!!i.multiple&&(i.defaultValue!=null?si(o,!!i.multiple,i.defaultValue,!0):si(o,!!i.multiple,i.multiple?[]:"",!1))}o[Sa]=i}catch(I){Ft(e,e.return,I)}}break;case 6:if(on(t,e),xn(e),n&4){if(e.stateNode===null)throw Error(de(162));o=e.stateNode,i=e.memoizedProps;try{o.nodeValue=i}catch(I){Ft(e,e.return,I)}}break;case 3:if(on(t,e),xn(e),n&4&&r!==null&&r.memoizedState.isDehydrated)try{xa(t.containerInfo)}catch(I){Ft(e,e.return,I)}break;case 4:on(t,e),xn(e);break;case 13:on(t,e),xn(e),o=e.child,o.flags&8192&&(i=o.memoizedState!==null,o.stateNode.isHidden=i,!i||o.alternate!==null&&o.alternate.memoizedState!==null||(Fp=Bt())),n&4&&sg(e);break;case 22:if(g=r!==null&&r.memoizedState!==null,e.mode&1?(pr=(d=pr)||g,on(t,e),pr=d):on(t,e),xn(e),n&8192){if(d=e.memoizedState!==null,(e.stateNode.isHidden=d)&&!g&&e.mode&1)for(Ae=e,g=e.child;g!==null;){for(x=Ae=g;Ae!==null;){switch(y=Ae,S=y.child,y.tag){case 0:case 11:case 14:case 15:la(4,y,y.return);break;case 1:ri(y,y.return);var T=y.stateNode;if(typeof T.componentWillUnmount=="function"){n=y,r=y.return;try{t=n,T.props=t.memoizedProps,T.state=t.memoizedState,T.componentWillUnmount()}catch(I){Ft(n,r,I)}}break;case 5:ri(y,y.return);break;case 22:if(y.memoizedState!==null){ig(x);continue}}S!==null?(S.return=y,Ae=S):ig(x)}g=g.sibling}e:for(g=null,x=e;;){if(x.tag===5){if(g===null){g=x;try{o=x.stateNode,d?(i=o.style,typeof i.setProperty=="function"?i.setProperty("display","none","important"):i.display="none"):(c=x.stateNode,u=x.memoizedProps.style,l=u!=null&&u.hasOwnProperty("display")?u.display:null,c.style.display=gy("display",l))}catch(I){Ft(e,e.return,I)}}}else if(x.tag===6){if(g===null)try{x.stateNode.nodeValue=d?"":x.memoizedProps}catch(I){Ft(e,e.return,I)}}else if((x.tag!==22&&x.tag!==23||x.memoizedState===null||x===e)&&x.child!==null){x.child.return=x,x=x.child;continue}if(x===e)break e;for(;x.sibling===null;){if(x.return===null||x.return===e)break e;g===x&&(g=null),x=x.return}g===x&&(g=null),x.sibling.return=x.return,x=x.sibling}}break;case 19:on(t,e),xn(e),n&4&&sg(e);break;case 21:break;default:on(t,e),xn(e)}}function xn(e){var t=e.flags;if(t&2){try{e:{for(var r=e.return;r!==null;){if(B0(r)){var n=r;break e}r=r.return}throw Error(de(160))}switch(n.tag){case 5:var o=n.stateNode;n.flags&32&&(ma(o,""),n.flags&=-33);var i=ng(e);Dd(e,i,o);break;case 3:case 4:var l=n.stateNode.containerInfo,c=ng(e);Od(e,c,l);break;default:throw Error(de(161))}}catch(u){Ft(e,e.return,u)}e.flags&=-3}t&4096&&(e.flags&=-4097)}function vS(e,t,r){Ae=e,G0(e)}function G0(e,t,r){for(var n=(e.mode&1)!==0;Ae!==null;){var o=Ae,i=o.child;if(o.tag===22&&n){var l=o.memoizedState!==null||ml;if(!l){var c=o.alternate,u=c!==null&&c.memoizedState!==null||pr;c=ml;var d=pr;if(ml=l,(pr=u)&&!d)for(Ae=o;Ae!==null;)l=Ae,u=l.child,l.tag===22&&l.memoizedState!==null?ag(o):u!==null?(u.return=l,Ae=u):ag(o);for(;i!==null;)Ae=i,G0(i),i=i.sibling;Ae=o,ml=c,pr=d}og(e)}else o.subtreeFlags&8772&&i!==null?(i.return=o,Ae=i):og(e)}}function og(e){for(;Ae!==null;){var t=Ae;if(t.flags&8772){var r=t.alternate;try{if(t.flags&8772)switch(t.tag){case 0:case 11:case 15:pr||Cc(5,t);break;case 1:var n=t.stateNode;if(t.flags&4&&!pr)if(r===null)n.componentDidMount();else{var o=t.elementType===t.type?r.memoizedProps:cn(t.type,r.memoizedProps);n.componentDidUpdate(o,r.memoizedState,n.__reactInternalSnapshotBeforeUpdate)}var i=t.updateQueue;i!==null&&qf(t,i,n);break;case 3:var l=t.updateQueue;if(l!==null){if(r=null,t.child!==null)switch(t.child.tag){case 5:r=t.child.stateNode;break;case 1:r=t.child.stateNode}qf(t,l,r)}break;case 5:var c=t.stateNode;if(r===null&&t.flags&4){r=c;var u=t.memoizedProps;switch(t.type){case"button":case"input":case"select":case"textarea":u.autoFocus&&r.focus();break;case"img":u.src&&(r.src=u.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(t.memoizedState===null){var d=t.alternate;if(d!==null){var g=d.memoizedState;if(g!==null){var x=g.dehydrated;x!==null&&xa(x)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(de(163))}pr||t.flags&512&&Ld(t)}catch(y){Ft(t,t.return,y)}}if(t===e){Ae=null;break}if(r=t.sibling,r!==null){r.return=t.return,Ae=r;break}Ae=t.return}}function ig(e){for(;Ae!==null;){var t=Ae;if(t===e){Ae=null;break}var r=t.sibling;if(r!==null){r.return=t.return,Ae=r;break}Ae=t.return}}function ag(e){for(;Ae!==null;){var t=Ae;try{switch(t.tag){case 0:case 11:case 15:var r=t.return;try{Cc(4,t)}catch(u){Ft(t,r,u)}break;case 1:var n=t.stateNode;if(typeof n.componentDidMount=="function"){var o=t.return;try{n.componentDidMount()}catch(u){Ft(t,o,u)}}var i=t.return;try{Ld(t)}catch(u){Ft(t,i,u)}break;case 5:var l=t.return;try{Ld(t)}catch(u){Ft(t,l,u)}}}catch(u){Ft(t,t.return,u)}if(t===e){Ae=null;break}var c=t.sibling;if(c!==null){c.return=t.return,Ae=c;break}Ae=t.return}}var wS=Math.ceil,tc=Vn.ReactCurrentDispatcher,Dp=Vn.ReactCurrentOwner,Kr=Vn.ReactCurrentBatchConfig,dt=0,tr=null,Gt=null,or=0,Or=0,ni=Ms(0),Jt=0,Ia=null,ho=0,Pc=0,$p=0,ca=null,Cr=null,Fp=0,xi=1/0,zn=null,rc=!1,$d=null,Cs=null,fl=!1,ys=null,nc=0,ua=0,Fd=null,_l=-1,Rl=0;function kr(){return dt&6?Bt():_l!==-1?_l:_l=Bt()}function Ps(e){return e.mode&1?dt&2&&or!==0?or&-or:nS.transition!==null?(Rl===0&&(Rl=Iy()),Rl):(e=xt,e!==0||(e=window.event,e=e===void 0?16:Ly(e.type)),e):1}function hn(e,t,r,n){if(50<ua)throw ua=0,Fd=null,Error(de(185));za(e,r,n),(!(dt&2)||e!==tr)&&(e===tr&&(!(dt&2)&&(Pc|=r),Jt===4&&hs(e,or)),Ar(e,n),r===1&&dt===0&&!(t.mode&1)&&(xi=Bt()+500,kc&&_s()))}function Ar(e,t){var r=e.callbackNode;n2(e,t);var n=Fl(e,e===tr?or:0);if(n===0)r!==null&&gf(r),e.callbackNode=null,e.callbackPriority=0;else if(t=n&-n,e.callbackPriority!==t){if(r!=null&&gf(r),t===1)e.tag===0?rS(lg.bind(null,e)):t0(lg.bind(null,e)),Z2(function(){!(dt&6)&&_s()}),r=null;else{switch(Ay(n)){case 1:r=pp;break;case 4:r=jy;break;case 16:r=$l;break;case 536870912:r=Ny;break;default:r=$l}r=X0(r,H0.bind(null,e))}e.callbackPriority=t,e.callbackNode=r}}function H0(e,t){if(_l=-1,Rl=0,dt&6)throw Error(de(327));var r=e.callbackNode;if(ci()&&e.callbackNode!==r)return null;var n=Fl(e,e===tr?or:0);if(n===0)return null;if(n&30||n&e.expiredLanes||t)t=sc(e,n);else{t=n;var o=dt;dt|=2;var i=K0();(tr!==e||or!==t)&&(zn=null,xi=Bt()+500,io(e,t));do try{SS();break}catch(c){V0(e,c)}while(!0);Cp(),tc.current=i,dt=o,Gt!==null?t=0:(tr=null,or=0,t=Jt)}if(t!==0){if(t===2&&(o=hd(e),o!==0&&(n=o,t=Ud(e,o))),t===1)throw r=Ia,io(e,0),hs(e,n),Ar(e,Bt()),r;if(t===6)hs(e,n);else{if(o=e.current.alternate,!(n&30)&&!bS(o)&&(t=sc(e,n),t===2&&(i=hd(e),i!==0&&(n=i,t=Ud(e,i))),t===1))throw r=Ia,io(e,0),hs(e,n),Ar(e,Bt()),r;switch(e.finishedWork=o,e.finishedLanes=n,t){case 0:case 1:throw Error(de(345));case 2:Vs(e,Cr,zn);break;case 3:if(hs(e,n),(n&130023424)===n&&(t=Fp+500-Bt(),10<t)){if(Fl(e,0)!==0)break;if(o=e.suspendedLanes,(o&n)!==n){kr(),e.pingedLanes|=e.suspendedLanes&o;break}e.timeoutHandle=bd(Vs.bind(null,e,Cr,zn),t);break}Vs(e,Cr,zn);break;case 4:if(hs(e,n),(n&4194240)===n)break;for(t=e.eventTimes,o=-1;0<n;){var l=31-pn(n);i=1<<l,l=t[l],l>o&&(o=l),n&=~i}if(n=o,n=Bt()-n,n=(120>n?120:480>n?480:1080>n?1080:1920>n?1920:3e3>n?3e3:4320>n?4320:1960*wS(n/1960))-n,10<n){e.timeoutHandle=bd(Vs.bind(null,e,Cr,zn),n);break}Vs(e,Cr,zn);break;case 5:Vs(e,Cr,zn);break;default:throw Error(de(329))}}}return Ar(e,Bt()),e.callbackNode===r?H0.bind(null,e):null}function Ud(e,t){var r=ca;return e.current.memoizedState.isDehydrated&&(io(e,t).flags|=256),e=sc(e,t),e!==2&&(t=Cr,Cr=r,t!==null&&Bd(t)),e}function Bd(e){Cr===null?Cr=e:Cr.push.apply(Cr,e)}function bS(e){for(var t=e;;){if(t.flags&16384){var r=t.updateQueue;if(r!==null&&(r=r.stores,r!==null))for(var n=0;n<r.length;n++){var o=r[n],i=o.getSnapshot;o=o.value;try{if(!mn(i(),o))return!1}catch{return!1}}}if(r=t.child,t.subtreeFlags&16384&&r!==null)r.return=t,t=r;else{if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return!0;t=t.return}t.sibling.return=t.return,t=t.sibling}}return!0}function hs(e,t){for(t&=~$p,t&=~Pc,e.suspendedLanes|=t,e.pingedLanes&=~t,e=e.expirationTimes;0<t;){var r=31-pn(t),n=1<<r;e[r]=-1,t&=~n}}function lg(e){if(dt&6)throw Error(de(327));ci();var t=Fl(e,0);if(!(t&1))return Ar(e,Bt()),null;var r=sc(e,t);if(e.tag!==0&&r===2){var n=hd(e);n!==0&&(t=n,r=Ud(e,n))}if(r===1)throw r=Ia,io(e,0),hs(e,t),Ar(e,Bt()),r;if(r===6)throw Error(de(345));return e.finishedWork=e.current.alternate,e.finishedLanes=t,Vs(e,Cr,zn),Ar(e,Bt()),null}function Up(e,t){var r=dt;dt|=1;try{return e(t)}finally{dt=r,dt===0&&(xi=Bt()+500,kc&&_s())}}function mo(e){ys!==null&&ys.tag===0&&!(dt&6)&&ci();var t=dt;dt|=1;var r=Kr.transition,n=xt;try{if(Kr.transition=null,xt=1,e)return e()}finally{xt=n,Kr.transition=r,dt=t,!(dt&6)&&_s()}}function Bp(){Or=ni.current,Nt(ni)}function io(e,t){e.finishedWork=null,e.finishedLanes=0;var r=e.timeoutHandle;if(r!==-1&&(e.timeoutHandle=-1,J2(r)),Gt!==null)for(r=Gt.return;r!==null;){var n=r;switch(kp(n),n.tag){case 1:n=n.type.childContextTypes,n!=null&&Gl();break;case 3:gi(),Nt(Nr),Nt(hr),Ep();break;case 5:Ap(n);break;case 4:gi();break;case 13:Nt(Lt);break;case 19:Nt(Lt);break;case 10:Pp(n.type._context);break;case 22:case 23:Bp()}r=r.return}if(tr=e,Gt=e=js(e.current,null),or=Or=t,Jt=0,Ia=null,$p=Pc=ho=0,Cr=ca=null,so!==null){for(t=0;t<so.length;t++)if(r=so[t],n=r.interleaved,n!==null){r.interleaved=null;var o=n.next,i=r.pending;if(i!==null){var l=i.next;i.next=o,n.next=l}r.pending=n}so=null}return e}function V0(e,t){do{var r=Gt;try{if(Cp(),Al.current=ec,Xl){for(var n=Ot.memoizedState;n!==null;){var o=n.queue;o!==null&&(o.pending=null),n=n.next}Xl=!1}if(po=0,Xt=Qt=Ot=null,aa=!1,Pa=0,Dp.current=null,r===null||r.return===null){Jt=1,Ia=t,Gt=null;break}e:{var i=e,l=r.return,c=r,u=t;if(t=or,c.flags|=32768,u!==null&&typeof u=="object"&&typeof u.then=="function"){var d=u,g=c,x=g.tag;if(!(g.mode&1)&&(x===0||x===11||x===15)){var y=g.alternate;y?(g.updateQueue=y.updateQueue,g.memoizedState=y.memoizedState,g.lanes=y.lanes):(g.updateQueue=null,g.memoizedState=null)}var S=Yf(l);if(S!==null){S.flags&=-257,Qf(S,l,c,i,t),S.mode&1&&Kf(i,d,t),t=S,u=d;var T=t.updateQueue;if(T===null){var I=new Set;I.add(u),t.updateQueue=I}else T.add(u);break e}else{if(!(t&1)){Kf(i,d,t),qp();break e}u=Error(de(426))}}else if(Mt&&c.mode&1){var b=Yf(l);if(b!==null){!(b.flags&65536)&&(b.flags|=256),Qf(b,l,c,i,t),Sp(yi(u,c));break e}}i=u=yi(u,c),Jt!==4&&(Jt=2),ca===null?ca=[i]:ca.push(i),i=l;do{switch(i.tag){case 3:i.flags|=65536,t&=-t,i.lanes|=t;var h=A0(i,u,t);Bf(i,h);break e;case 1:c=u;var v=i.type,C=i.stateNode;if(!(i.flags&128)&&(typeof v.getDerivedStateFromError=="function"||C!==null&&typeof C.componentDidCatch=="function"&&(Cs===null||!Cs.has(C)))){i.flags|=65536,t&=-t,i.lanes|=t;var A=E0(i,c,t);Bf(i,A);break e}}i=i.return}while(i!==null)}Q0(r)}catch(P){t=P,Gt===r&&r!==null&&(Gt=r=r.return);continue}break}while(!0)}function K0(){var e=tc.current;return tc.current=ec,e===null?ec:e}function qp(){(Jt===0||Jt===3||Jt===2)&&(Jt=4),tr===null||!(ho&268435455)&&!(Pc&268435455)||hs(tr,or)}function sc(e,t){var r=dt;dt|=2;var n=K0();(tr!==e||or!==t)&&(zn=null,io(e,t));do try{kS();break}catch(o){V0(e,o)}while(!0);if(Cp(),dt=r,tc.current=n,Gt!==null)throw Error(de(261));return tr=null,or=0,Jt}function kS(){for(;Gt!==null;)Y0(Gt)}function SS(){for(;Gt!==null&&!Kk();)Y0(Gt)}function Y0(e){var t=Z0(e.alternate,e,Or);e.memoizedProps=e.pendingProps,t===null?Q0(e):Gt=t,Dp.current=null}function Q0(e){var t=e;do{var r=t.alternate;if(e=t.return,t.flags&32768){if(r=gS(r,t),r!==null){r.flags&=32767,Gt=r;return}if(e!==null)e.flags|=32768,e.subtreeFlags=0,e.deletions=null;else{Jt=6,Gt=null;return}}else if(r=fS(r,t,Or),r!==null){Gt=r;return}if(t=t.sibling,t!==null){Gt=t;return}Gt=t=e}while(t!==null);Jt===0&&(Jt=5)}function Vs(e,t,r){var n=xt,o=Kr.transition;try{Kr.transition=null,xt=1,TS(e,t,r,n)}finally{Kr.transition=o,xt=n}return null}function TS(e,t,r,n){do ci();while(ys!==null);if(dt&6)throw Error(de(327));r=e.finishedWork;var o=e.finishedLanes;if(r===null)return null;if(e.finishedWork=null,e.finishedLanes=0,r===e.current)throw Error(de(177));e.callbackNode=null,e.callbackPriority=0;var i=r.lanes|r.childLanes;if(s2(e,i),e===tr&&(Gt=tr=null,or=0),!(r.subtreeFlags&2064)&&!(r.flags&2064)||fl||(fl=!0,X0($l,function(){return ci(),null})),i=(r.flags&15990)!==0,r.subtreeFlags&15990||i){i=Kr.transition,Kr.transition=null;var l=xt;xt=1;var c=dt;dt|=4,Dp.current=null,xS(e,r),W0(r,e),W2(vd),Ul=!!xd,vd=xd=null,e.current=r,vS(r),Yk(),dt=c,xt=l,Kr.transition=i}else e.current=r;if(fl&&(fl=!1,ys=e,nc=o),i=e.pendingLanes,i===0&&(Cs=null),Zk(r.stateNode),Ar(e,Bt()),t!==null)for(n=e.onRecoverableError,r=0;r<t.length;r++)o=t[r],n(o.value,{componentStack:o.stack,digest:o.digest});if(rc)throw rc=!1,e=$d,$d=null,e;return nc&1&&e.tag!==0&&ci(),i=e.pendingLanes,i&1?e===Fd?ua++:(ua=0,Fd=e):ua=0,_s(),null}function ci(){if(ys!==null){var e=Ay(nc),t=Kr.transition,r=xt;try{if(Kr.transition=null,xt=16>e?16:e,ys===null)var n=!1;else{if(e=ys,ys=null,nc=0,dt&6)throw Error(de(331));var o=dt;for(dt|=4,Ae=e.current;Ae!==null;){var i=Ae,l=i.child;if(Ae.flags&16){var c=i.deletions;if(c!==null){for(var u=0;u<c.length;u++){var d=c[u];for(Ae=d;Ae!==null;){var g=Ae;switch(g.tag){case 0:case 11:case 15:la(8,g,i)}var x=g.child;if(x!==null)x.return=g,Ae=x;else for(;Ae!==null;){g=Ae;var y=g.sibling,S=g.return;if(U0(g),g===d){Ae=null;break}if(y!==null){y.return=S,Ae=y;break}Ae=S}}}var T=i.alternate;if(T!==null){var I=T.child;if(I!==null){T.child=null;do{var b=I.sibling;I.sibling=null,I=b}while(I!==null)}}Ae=i}}if(i.subtreeFlags&2064&&l!==null)l.return=i,Ae=l;else e:for(;Ae!==null;){if(i=Ae,i.flags&2048)switch(i.tag){case 0:case 11:case 15:la(9,i,i.return)}var h=i.sibling;if(h!==null){h.return=i.return,Ae=h;break e}Ae=i.return}}var v=e.current;for(Ae=v;Ae!==null;){l=Ae;var C=l.child;if(l.subtreeFlags&2064&&C!==null)C.return=l,Ae=C;else e:for(l=v;Ae!==null;){if(c=Ae,c.flags&2048)try{switch(c.tag){case 0:case 11:case 15:Cc(9,c)}}catch(P){Ft(c,c.return,P)}if(c===l){Ae=null;break e}var A=c.sibling;if(A!==null){A.return=c.return,Ae=A;break e}Ae=c.return}}if(dt=o,_s(),kn&&typeof kn.onPostCommitFiberRoot=="function")try{kn.onPostCommitFiberRoot(yc,e)}catch{}n=!0}return n}finally{xt=r,Kr.transition=t}}return!1}function cg(e,t,r){t=yi(r,t),t=A0(e,t,1),e=Ts(e,t,1),t=kr(),e!==null&&(za(e,1,t),Ar(e,t))}function Ft(e,t,r){if(e.tag===3)cg(e,e,r);else for(;t!==null;){if(t.tag===3){cg(t,e,r);break}else if(t.tag===1){var n=t.stateNode;if(typeof t.type.getDerivedStateFromError=="function"||typeof n.componentDidCatch=="function"&&(Cs===null||!Cs.has(n))){e=yi(r,e),e=E0(t,e,1),t=Ts(t,e,1),e=kr(),t!==null&&(za(t,1,e),Ar(t,e));break}}t=t.return}}function CS(e,t,r){var n=e.pingCache;n!==null&&n.delete(t),t=kr(),e.pingedLanes|=e.suspendedLanes&r,tr===e&&(or&r)===r&&(Jt===4||Jt===3&&(or&130023424)===or&&500>Bt()-Fp?io(e,0):$p|=r),Ar(e,t)}function J0(e,t){t===0&&(e.mode&1?(t=ol,ol<<=1,!(ol&130023424)&&(ol=4194304)):t=1);var r=kr();e=Wn(e,t),e!==null&&(za(e,t,r),Ar(e,r))}function PS(e){var t=e.memoizedState,r=0;t!==null&&(r=t.retryLane),J0(e,r)}function jS(e,t){var r=0;switch(e.tag){case 13:var n=e.stateNode,o=e.memoizedState;o!==null&&(r=o.retryLane);break;case 19:n=e.stateNode;break;default:throw Error(de(314))}n!==null&&n.delete(t),J0(e,r)}var Z0;Z0=function(e,t,r){if(e!==null)if(e.memoizedProps!==t.pendingProps||Nr.current)Pr=!0;else{if(!(e.lanes&r)&&!(t.flags&128))return Pr=!1,mS(e,t,r);Pr=!!(e.flags&131072)}else Pr=!1,Mt&&t.flags&1048576&&r0(t,Kl,t.index);switch(t.lanes=0,t.tag){case 2:var n=t.type;Ml(e,t),e=t.pendingProps;var o=hi(t,hr.current);li(t,r),o=_p(null,t,n,e,o,r);var i=Rp();return t.flags|=1,typeof o=="object"&&o!==null&&typeof o.render=="function"&&o.$$typeof===void 0?(t.tag=1,t.memoizedState=null,t.updateQueue=null,Ir(n)?(i=!0,Hl(t)):i=!1,t.memoizedState=o.state!==null&&o.state!==void 0?o.state:null,Np(t),o.updater=Tc,t.stateNode=o,o._reactInternals=t,Nd(t,n,e,r),t=Ed(null,t,n,!0,i,r)):(t.tag=0,Mt&&i&&bp(t),vr(null,t,o,r),t=t.child),t;case 16:n=t.elementType;e:{switch(Ml(e,t),e=t.pendingProps,o=n._init,n=o(n._payload),t.type=n,o=t.tag=IS(n),e=cn(n,e),o){case 0:t=Ad(null,t,n,e,r);break e;case 1:t=Xf(null,t,n,e,r);break e;case 11:t=Jf(null,t,n,e,r);break e;case 14:t=Zf(null,t,n,cn(n.type,e),r);break e}throw Error(de(306,n,""))}return t;case 0:return n=t.type,o=t.pendingProps,o=t.elementType===n?o:cn(n,o),Ad(e,t,n,o,r);case 1:return n=t.type,o=t.pendingProps,o=t.elementType===n?o:cn(n,o),Xf(e,t,n,o,r);case 3:e:{if(z0(t),e===null)throw Error(de(387));n=t.pendingProps,i=t.memoizedState,o=i.element,l0(e,t),Jl(t,n,null,r);var l=t.memoizedState;if(n=l.element,i.isDehydrated)if(i={element:n,isDehydrated:!1,cache:l.cache,pendingSuspenseBoundaries:l.pendingSuspenseBoundaries,transitions:l.transitions},t.updateQueue.baseState=i,t.memoizedState=i,t.flags&256){o=yi(Error(de(423)),t),t=eg(e,t,n,r,o);break e}else if(n!==o){o=yi(Error(de(424)),t),t=eg(e,t,n,r,o);break e}else for(Dr=Ss(t.stateNode.containerInfo.firstChild),$r=t,Mt=!0,dn=null,r=i0(t,null,n,r),t.child=r;r;)r.flags=r.flags&-3|4096,r=r.sibling;else{if(mi(),n===o){t=Gn(e,t,r);break e}vr(e,t,n,r)}t=t.child}return t;case 5:return c0(t),e===null&&Cd(t),n=t.type,o=t.pendingProps,i=e!==null?e.memoizedProps:null,l=o.children,wd(n,o)?l=null:i!==null&&wd(n,i)&&(t.flags|=32),R0(e,t),vr(e,t,l,r),t.child;case 6:return e===null&&Cd(t),null;case 13:return L0(e,t,r);case 4:return Ip(t,t.stateNode.containerInfo),n=t.pendingProps,e===null?t.child=fi(t,null,n,r):vr(e,t,n,r),t.child;case 11:return n=t.type,o=t.pendingProps,o=t.elementType===n?o:cn(n,o),Jf(e,t,n,o,r);case 7:return vr(e,t,t.pendingProps,r),t.child;case 8:return vr(e,t,t.pendingProps.children,r),t.child;case 12:return vr(e,t,t.pendingProps.children,r),t.child;case 10:e:{if(n=t.type._context,o=t.pendingProps,i=t.memoizedProps,l=o.value,St(Yl,n._currentValue),n._currentValue=l,i!==null)if(mn(i.value,l)){if(i.children===o.children&&!Nr.current){t=Gn(e,t,r);break e}}else for(i=t.child,i!==null&&(i.return=t);i!==null;){var c=i.dependencies;if(c!==null){l=i.child;for(var u=c.firstContext;u!==null;){if(u.context===n){if(i.tag===1){u=Un(-1,r&-r),u.tag=2;var d=i.updateQueue;if(d!==null){d=d.shared;var g=d.pending;g===null?u.next=u:(u.next=g.next,g.next=u),d.pending=u}}i.lanes|=r,u=i.alternate,u!==null&&(u.lanes|=r),Pd(i.return,r,t),c.lanes|=r;break}u=u.next}}else if(i.tag===10)l=i.type===t.type?null:i.child;else if(i.tag===18){if(l=i.return,l===null)throw Error(de(341));l.lanes|=r,c=l.alternate,c!==null&&(c.lanes|=r),Pd(l,r,t),l=i.sibling}else l=i.child;if(l!==null)l.return=i;else for(l=i;l!==null;){if(l===t){l=null;break}if(i=l.sibling,i!==null){i.return=l.return,l=i;break}l=l.return}i=l}vr(e,t,o.children,r),t=t.child}return t;case 9:return o=t.type,n=t.pendingProps.children,li(t,r),o=Yr(o),n=n(o),t.flags|=1,vr(e,t,n,r),t.child;case 14:return n=t.type,o=cn(n,t.pendingProps),o=cn(n.type,o),Zf(e,t,n,o,r);case 15:return M0(e,t,t.type,t.pendingProps,r);case 17:return n=t.type,o=t.pendingProps,o=t.elementType===n?o:cn(n,o),Ml(e,t),t.tag=1,Ir(n)?(e=!0,Hl(t)):e=!1,li(t,r),I0(t,n,o),Nd(t,n,o,r),Ed(null,t,n,!0,e,r);case 19:return O0(e,t,r);case 22:return _0(e,t,r)}throw Error(de(156,t.tag))};function X0(e,t){return Py(e,t)}function NS(e,t,r,n){this.tag=e,this.key=r,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=t,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=n,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Vr(e,t,r,n){return new NS(e,t,r,n)}function Wp(e){return e=e.prototype,!(!e||!e.isReactComponent)}function IS(e){if(typeof e=="function")return Wp(e)?1:0;if(e!=null){if(e=e.$$typeof,e===cp)return 11;if(e===up)return 14}return 2}function js(e,t){var r=e.alternate;return r===null?(r=Vr(e.tag,t,e.key,e.mode),r.elementType=e.elementType,r.type=e.type,r.stateNode=e.stateNode,r.alternate=e,e.alternate=r):(r.pendingProps=t,r.type=e.type,r.flags=0,r.subtreeFlags=0,r.deletions=null),r.flags=e.flags&14680064,r.childLanes=e.childLanes,r.lanes=e.lanes,r.child=e.child,r.memoizedProps=e.memoizedProps,r.memoizedState=e.memoizedState,r.updateQueue=e.updateQueue,t=e.dependencies,r.dependencies=t===null?null:{lanes:t.lanes,firstContext:t.firstContext},r.sibling=e.sibling,r.index=e.index,r.ref=e.ref,r}function zl(e,t,r,n,o,i){var l=2;if(n=e,typeof e=="function")Wp(e)&&(l=1);else if(typeof e=="string")l=5;else e:switch(e){case Vo:return ao(r.children,o,i,t);case lp:l=8,o|=8;break;case Zu:return e=Vr(12,r,t,o|2),e.elementType=Zu,e.lanes=i,e;case Xu:return e=Vr(13,r,t,o),e.elementType=Xu,e.lanes=i,e;case ed:return e=Vr(19,r,t,o),e.elementType=ed,e.lanes=i,e;case cy:return jc(r,o,i,t);default:if(typeof e=="object"&&e!==null)switch(e.$$typeof){case ay:l=10;break e;case ly:l=9;break e;case cp:l=11;break e;case up:l=14;break e;case ns:l=16,n=null;break e}throw Error(de(130,e==null?e:typeof e,""))}return t=Vr(l,r,t,o),t.elementType=e,t.type=n,t.lanes=i,t}function ao(e,t,r,n){return e=Vr(7,e,n,t),e.lanes=r,e}function jc(e,t,r,n){return e=Vr(22,e,n,t),e.elementType=cy,e.lanes=r,e.stateNode={isHidden:!1},e}function Bu(e,t,r){return e=Vr(6,e,null,t),e.lanes=r,e}function qu(e,t,r){return t=Vr(4,e.children!==null?e.children:[],e.key,t),t.lanes=r,t.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},t}function AS(e,t,r,n,o){this.tag=t,this.containerInfo=e,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=Su(0),this.expirationTimes=Su(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Su(0),this.identifierPrefix=n,this.onRecoverableError=o,this.mutableSourceEagerHydrationData=null}function Gp(e,t,r,n,o,i,l,c,u){return e=new AS(e,t,r,c,u),t===1?(t=1,i===!0&&(t|=8)):t=0,i=Vr(3,null,null,t),e.current=i,i.stateNode=e,i.memoizedState={element:n,isDehydrated:r,cache:null,transitions:null,pendingSuspenseBoundaries:null},Np(i),e}function ES(e,t,r){var n=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:Ho,key:n==null?null:""+n,children:e,containerInfo:t,implementation:r}}function ex(e){if(!e)return As;e=e._reactInternals;e:{if(yo(e)!==e||e.tag!==1)throw Error(de(170));var t=e;do{switch(t.tag){case 3:t=t.stateNode.context;break e;case 1:if(Ir(t.type)){t=t.stateNode.__reactInternalMemoizedMergedChildContext;break e}}t=t.return}while(t!==null);throw Error(de(171))}if(e.tag===1){var r=e.type;if(Ir(r))return e0(e,r,t)}return t}function tx(e,t,r,n,o,i,l,c,u){return e=Gp(r,n,!0,e,o,i,l,c,u),e.context=ex(null),r=e.current,n=kr(),o=Ps(r),i=Un(n,o),i.callback=t??null,Ts(r,i,o),e.current.lanes=o,za(e,o,n),Ar(e,n),e}function Nc(e,t,r,n){var o=t.current,i=kr(),l=Ps(o);return r=ex(r),t.context===null?t.context=r:t.pendingContext=r,t=Un(i,l),t.payload={element:e},n=n===void 0?null:n,n!==null&&(t.callback=n),e=Ts(o,t,l),e!==null&&(hn(e,o,l,i),Il(e,o,l)),l}function oc(e){if(e=e.current,!e.child)return null;switch(e.child.tag){case 5:return e.child.stateNode;default:return e.child.stateNode}}function ug(e,t){if(e=e.memoizedState,e!==null&&e.dehydrated!==null){var r=e.retryLane;e.retryLane=r!==0&&r<t?r:t}}function Hp(e,t){ug(e,t),(e=e.alternate)&&ug(e,t)}function MS(){return null}var rx=typeof reportError=="function"?reportError:function(e){console.error(e)};function Vp(e){this._internalRoot=e}Ic.prototype.render=Vp.prototype.render=function(e){var t=this._internalRoot;if(t===null)throw Error(de(409));Nc(e,t,null,null)};Ic.prototype.unmount=Vp.prototype.unmount=function(){var e=this._internalRoot;if(e!==null){this._internalRoot=null;var t=e.containerInfo;mo(function(){Nc(null,e,null,null)}),t[qn]=null}};function Ic(e){this._internalRoot=e}Ic.prototype.unstable_scheduleHydration=function(e){if(e){var t=_y();e={blockedOn:null,target:e,priority:t};for(var r=0;r<ps.length&&t!==0&&t<ps[r].priority;r++);ps.splice(r,0,e),r===0&&zy(e)}};function Kp(e){return!(!e||e.nodeType!==1&&e.nodeType!==9&&e.nodeType!==11)}function Ac(e){return!(!e||e.nodeType!==1&&e.nodeType!==9&&e.nodeType!==11&&(e.nodeType!==8||e.nodeValue!==" react-mount-point-unstable "))}function dg(){}function _S(e,t,r,n,o){if(o){if(typeof n=="function"){var i=n;n=function(){var d=oc(l);i.call(d)}}var l=tx(t,n,e,0,null,!1,!1,"",dg);return e._reactRootContainer=l,e[qn]=l.current,ba(e.nodeType===8?e.parentNode:e),mo(),l}for(;o=e.lastChild;)e.removeChild(o);if(typeof n=="function"){var c=n;n=function(){var d=oc(u);c.call(d)}}var u=Gp(e,0,!1,null,null,!1,!1,"",dg);return e._reactRootContainer=u,e[qn]=u.current,ba(e.nodeType===8?e.parentNode:e),mo(function(){Nc(t,u,r,n)}),u}function Ec(e,t,r,n,o){var i=r._reactRootContainer;if(i){var l=i;if(typeof o=="function"){var c=o;o=function(){var u=oc(l);c.call(u)}}Nc(t,l,e,o)}else l=_S(r,t,e,o,n);return oc(l)}Ey=function(e){switch(e.tag){case 3:var t=e.stateNode;if(t.current.memoizedState.isDehydrated){var r=Xi(t.pendingLanes);r!==0&&(hp(t,r|1),Ar(t,Bt()),!(dt&6)&&(xi=Bt()+500,_s()))}break;case 13:mo(function(){var n=Wn(e,1);if(n!==null){var o=kr();hn(n,e,1,o)}}),Hp(e,1)}};mp=function(e){if(e.tag===13){var t=Wn(e,134217728);if(t!==null){var r=kr();hn(t,e,134217728,r)}Hp(e,134217728)}};My=function(e){if(e.tag===13){var t=Ps(e),r=Wn(e,t);if(r!==null){var n=kr();hn(r,e,t,n)}Hp(e,t)}};_y=function(){return xt};Ry=function(e,t){var r=xt;try{return xt=e,t()}finally{xt=r}};ud=function(e,t,r){switch(t){case"input":if(nd(e,r),t=r.name,r.type==="radio"&&t!=null){for(r=e;r.parentNode;)r=r.parentNode;for(r=r.querySelectorAll("input[name="+JSON.stringify(""+t)+'][type="radio"]'),t=0;t<r.length;t++){var n=r[t];if(n!==e&&n.form===e.form){var o=bc(n);if(!o)throw Error(de(90));dy(n),nd(n,o)}}}break;case"textarea":hy(e,r);break;case"select":t=r.value,t!=null&&si(e,!!r.multiple,t,!1)}};wy=Up;by=mo;var RS={usingClientEntryPoint:!1,Events:[Oa,Jo,bc,xy,vy,Up]},Ki={findFiberByHostInstance:no,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},zS={bundleType:Ki.bundleType,version:Ki.version,rendererPackageName:Ki.rendererPackageName,rendererConfig:Ki.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:Vn.ReactCurrentDispatcher,findHostInstanceByFiber:function(e){return e=Ty(e),e===null?null:e.stateNode},findFiberByHostInstance:Ki.findFiberByHostInstance||MS,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var gl=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!gl.isDisabled&&gl.supportsFiber)try{yc=gl.inject(zS),kn=gl}catch{}}Ur.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=RS;Ur.createPortal=function(e,t){var r=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!Kp(t))throw Error(de(200));return ES(e,t,null,r)};Ur.createRoot=function(e,t){if(!Kp(e))throw Error(de(299));var r=!1,n="",o=rx;return t!=null&&(t.unstable_strictMode===!0&&(r=!0),t.identifierPrefix!==void 0&&(n=t.identifierPrefix),t.onRecoverableError!==void 0&&(o=t.onRecoverableError)),t=Gp(e,1,!1,null,null,r,!1,n,o),e[qn]=t.current,ba(e.nodeType===8?e.parentNode:e),new Vp(t)};Ur.findDOMNode=function(e){if(e==null)return null;if(e.nodeType===1)return e;var t=e._reactInternals;if(t===void 0)throw typeof e.render=="function"?Error(de(188)):(e=Object.keys(e).join(","),Error(de(268,e)));return e=Ty(t),e=e===null?null:e.stateNode,e};Ur.flushSync=function(e){return mo(e)};Ur.hydrate=function(e,t,r){if(!Ac(t))throw Error(de(200));return Ec(null,e,t,!0,r)};Ur.hydrateRoot=function(e,t,r){if(!Kp(e))throw Error(de(405));var n=r!=null&&r.hydratedSources||null,o=!1,i="",l=rx;if(r!=null&&(r.unstable_strictMode===!0&&(o=!0),r.identifierPrefix!==void 0&&(i=r.identifierPrefix),r.onRecoverableError!==void 0&&(l=r.onRecoverableError)),t=tx(t,null,e,1,r??null,o,!1,i,l),e[qn]=t.current,ba(e),n)for(e=0;e<n.length;e++)r=n[e],o=r._getVersion,o=o(r._source),t.mutableSourceEagerHydrationData==null?t.mutableSourceEagerHydrationData=[r,o]:t.mutableSourceEagerHydrationData.push(r,o);return new Ic(t)};Ur.render=function(e,t,r){if(!Ac(t))throw Error(de(200));return Ec(null,e,t,!1,r)};Ur.unmountComponentAtNode=function(e){if(!Ac(e))throw Error(de(40));return e._reactRootContainer?(mo(function(){Ec(null,null,e,!1,function(){e._reactRootContainer=null,e[qn]=null})}),!0):!1};Ur.unstable_batchedUpdates=Up;Ur.unstable_renderSubtreeIntoContainer=function(e,t,r,n){if(!Ac(r))throw Error(de(200));if(e==null||e._reactInternals===void 0)throw Error(de(38));return Ec(e,t,r,!1,n)};Ur.version="18.3.1-next-f1338f8080-20240426";function nx(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(nx)}catch(e){console.error(e)}}nx(),ny.exports=Ur;var Yp=ny.exports,pg=Yp;Qu.createRoot=pg.createRoot,Qu.hydrateRoot=pg.hydrateRoot;/**
 * @remix-run/router v1.23.1
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function Aa(){return Aa=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},Aa.apply(this,arguments)}var xs;(function(e){e.Pop="POP",e.Push="PUSH",e.Replace="REPLACE"})(xs||(xs={}));const hg="popstate";function LS(e){e===void 0&&(e={});function t(n,o){let{pathname:i,search:l,hash:c}=n.location;return qd("",{pathname:i,search:l,hash:c},o.state&&o.state.usr||null,o.state&&o.state.key||"default")}function r(n,o){return typeof o=="string"?o:ic(o)}return DS(t,r,null,e)}function qt(e,t){if(e===!1||e===null||typeof e>"u")throw new Error(t)}function Qp(e,t){if(!e){typeof console<"u"&&console.warn(t);try{throw new Error(t)}catch{}}}function OS(){return Math.random().toString(36).substr(2,8)}function mg(e,t){return{usr:e.state,key:e.key,idx:t}}function qd(e,t,r,n){return r===void 0&&(r=null),Aa({pathname:typeof e=="string"?e:e.pathname,search:"",hash:""},typeof t=="string"?Si(t):t,{state:r,key:t&&t.key||n||OS()})}function ic(e){let{pathname:t="/",search:r="",hash:n=""}=e;return r&&r!=="?"&&(t+=r.charAt(0)==="?"?r:"?"+r),n&&n!=="#"&&(t+=n.charAt(0)==="#"?n:"#"+n),t}function Si(e){let t={};if(e){let r=e.indexOf("#");r>=0&&(t.hash=e.substr(r),e=e.substr(0,r));let n=e.indexOf("?");n>=0&&(t.search=e.substr(n),e=e.substr(0,n)),e&&(t.pathname=e)}return t}function DS(e,t,r,n){n===void 0&&(n={});let{window:o=document.defaultView,v5Compat:i=!1}=n,l=o.history,c=xs.Pop,u=null,d=g();d==null&&(d=0,l.replaceState(Aa({},l.state,{idx:d}),""));function g(){return(l.state||{idx:null}).idx}function x(){c=xs.Pop;let b=g(),h=b==null?null:b-d;d=b,u&&u({action:c,location:I.location,delta:h})}function y(b,h){c=xs.Push;let v=qd(I.location,b,h);d=g()+1;let C=mg(v,d),A=I.createHref(v);try{l.pushState(C,"",A)}catch(P){if(P instanceof DOMException&&P.name==="DataCloneError")throw P;o.location.assign(A)}i&&u&&u({action:c,location:I.location,delta:1})}function S(b,h){c=xs.Replace;let v=qd(I.location,b,h);d=g();let C=mg(v,d),A=I.createHref(v);l.replaceState(C,"",A),i&&u&&u({action:c,location:I.location,delta:0})}function T(b){let h=o.location.origin!=="null"?o.location.origin:o.location.href,v=typeof b=="string"?b:ic(b);return v=v.replace(/ $/,"%20"),qt(h,"No window.location.(origin|href) available to create URL for href: "+v),new URL(v,h)}let I={get action(){return c},get location(){return e(o,l)},listen(b){if(u)throw new Error("A history only accepts one active listener");return o.addEventListener(hg,x),u=b,()=>{o.removeEventListener(hg,x),u=null}},createHref(b){return t(o,b)},createURL:T,encodeLocation(b){let h=T(b);return{pathname:h.pathname,search:h.search,hash:h.hash}},push:y,replace:S,go(b){return l.go(b)}};return I}var fg;(function(e){e.data="data",e.deferred="deferred",e.redirect="redirect",e.error="error"})(fg||(fg={}));function $S(e,t,r){return r===void 0&&(r="/"),FS(e,t,r)}function FS(e,t,r,n){let o=typeof t=="string"?Si(t):t,i=Jp(o.pathname||"/",r);if(i==null)return null;let l=sx(e);US(l);let c=null;for(let u=0;c==null&&u<l.length;++u){let d=XS(i);c=QS(l[u],d)}return c}function sx(e,t,r,n){t===void 0&&(t=[]),r===void 0&&(r=[]),n===void 0&&(n="");let o=(i,l,c)=>{let u={relativePath:c===void 0?i.path||"":c,caseSensitive:i.caseSensitive===!0,childrenIndex:l,route:i};u.relativePath.startsWith("/")&&(qt(u.relativePath.startsWith(n),'Absolute route path "'+u.relativePath+'" nested under path '+('"'+n+'" is not valid. An absolute child route path ')+"must start with the combined path of all its parent routes."),u.relativePath=u.relativePath.slice(n.length));let d=Ns([n,u.relativePath]),g=r.concat(u);i.children&&i.children.length>0&&(qt(i.index!==!0,"Index routes must not have child routes. Please remove "+('all child routes from route path "'+d+'".')),sx(i.children,t,g,d)),!(i.path==null&&!i.index)&&t.push({path:d,score:KS(d,i.index),routesMeta:g})};return e.forEach((i,l)=>{var c;if(i.path===""||!((c=i.path)!=null&&c.includes("?")))o(i,l);else for(let u of ox(i.path))o(i,l,u)}),t}function ox(e){let t=e.split("/");if(t.length===0)return[];let[r,...n]=t,o=r.endsWith("?"),i=r.replace(/\?$/,"");if(n.length===0)return o?[i,""]:[i];let l=ox(n.join("/")),c=[];return c.push(...l.map(u=>u===""?i:[i,u].join("/"))),o&&c.push(...l),c.map(u=>e.startsWith("/")&&u===""?"/":u)}function US(e){e.sort((t,r)=>t.score!==r.score?r.score-t.score:YS(t.routesMeta.map(n=>n.childrenIndex),r.routesMeta.map(n=>n.childrenIndex)))}const BS=/^:[\w-]+$/,qS=3,WS=2,GS=1,HS=10,VS=-2,gg=e=>e==="*";function KS(e,t){let r=e.split("/"),n=r.length;return r.some(gg)&&(n+=VS),t&&(n+=WS),r.filter(o=>!gg(o)).reduce((o,i)=>o+(BS.test(i)?qS:i===""?GS:HS),n)}function YS(e,t){return e.length===t.length&&e.slice(0,-1).every((n,o)=>n===t[o])?e[e.length-1]-t[t.length-1]:0}function QS(e,t,r){let{routesMeta:n}=e,o={},i="/",l=[];for(let c=0;c<n.length;++c){let u=n[c],d=c===n.length-1,g=i==="/"?t:t.slice(i.length)||"/",x=JS({path:u.relativePath,caseSensitive:u.caseSensitive,end:d},g),y=u.route;if(!x)return null;Object.assign(o,x.params),l.push({params:o,pathname:Ns([i,x.pathname]),pathnameBase:sT(Ns([i,x.pathnameBase])),route:y}),x.pathnameBase!=="/"&&(i=Ns([i,x.pathnameBase]))}return l}function JS(e,t){typeof e=="string"&&(e={path:e,caseSensitive:!1,end:!0});let[r,n]=ZS(e.path,e.caseSensitive,e.end),o=t.match(r);if(!o)return null;let i=o[0],l=i.replace(/(.)\/+$/,"$1"),c=o.slice(1);return{params:n.reduce((d,g,x)=>{let{paramName:y,isOptional:S}=g;if(y==="*"){let I=c[x]||"";l=i.slice(0,i.length-I.length).replace(/(.)\/+$/,"$1")}const T=c[x];return S&&!T?d[y]=void 0:d[y]=(T||"").replace(/%2F/g,"/"),d},{}),pathname:i,pathnameBase:l,pattern:e}}function ZS(e,t,r){t===void 0&&(t=!1),r===void 0&&(r=!0),Qp(e==="*"||!e.endsWith("*")||e.endsWith("/*"),'Route path "'+e+'" will be treated as if it were '+('"'+e.replace(/\*$/,"/*")+'" because the `*` character must ')+"always follow a `/` in the pattern. To get rid of this warning, "+('please change the route path to "'+e.replace(/\*$/,"/*")+'".'));let n=[],o="^"+e.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(l,c,u)=>(n.push({paramName:c,isOptional:u!=null}),u?"/?([^\\/]+)?":"/([^\\/]+)"));return e.endsWith("*")?(n.push({paramName:"*"}),o+=e==="*"||e==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):r?o+="\\/*$":e!==""&&e!=="/"&&(o+="(?:(?=\\/|$))"),[new RegExp(o,t?void 0:"i"),n]}function XS(e){try{return e.split("/").map(t=>decodeURIComponent(t).replace(/\//g,"%2F")).join("/")}catch(t){return Qp(!1,'The URL path "'+e+'" could not be decoded because it is is a malformed URL segment. This is probably due to a bad percent '+("encoding ("+t+").")),e}}function Jp(e,t){if(t==="/")return e;if(!e.toLowerCase().startsWith(t.toLowerCase()))return null;let r=t.endsWith("/")?t.length-1:t.length,n=e.charAt(r);return n&&n!=="/"?null:e.slice(r)||"/"}const eT=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,tT=e=>eT.test(e);function rT(e,t){t===void 0&&(t="/");let{pathname:r,search:n="",hash:o=""}=typeof e=="string"?Si(e):e,i;if(r)if(tT(r))i=r;else{if(r.includes("//")){let l=r;r=r.replace(/\/\/+/g,"/"),Qp(!1,"Pathnames cannot have embedded double slashes - normalizing "+(l+" -> "+r))}r.startsWith("/")?i=yg(r.substring(1),"/"):i=yg(r,t)}else i=t;return{pathname:i,search:oT(n),hash:iT(o)}}function yg(e,t){let r=t.replace(/\/+$/,"").split("/");return e.split("/").forEach(o=>{o===".."?r.length>1&&r.pop():o!=="."&&r.push(o)}),r.length>1?r.join("/"):"/"}function Wu(e,t,r,n){return"Cannot include a '"+e+"' character in a manually specified "+("`to."+t+"` field ["+JSON.stringify(n)+"].  Please separate it out to the ")+("`to."+r+"` field. Alternatively you may provide the full path as ")+'a string in <Link to="..."> and the router will parse it for you.'}function nT(e){return e.filter((t,r)=>r===0||t.route.path&&t.route.path.length>0)}function Zp(e,t){let r=nT(e);return t?r.map((n,o)=>o===r.length-1?n.pathname:n.pathnameBase):r.map(n=>n.pathnameBase)}function Xp(e,t,r,n){n===void 0&&(n=!1);let o;typeof e=="string"?o=Si(e):(o=Aa({},e),qt(!o.pathname||!o.pathname.includes("?"),Wu("?","pathname","search",o)),qt(!o.pathname||!o.pathname.includes("#"),Wu("#","pathname","hash",o)),qt(!o.search||!o.search.includes("#"),Wu("#","search","hash",o)));let i=e===""||o.pathname==="",l=i?"/":o.pathname,c;if(l==null)c=r;else{let x=t.length-1;if(!n&&l.startsWith("..")){let y=l.split("/");for(;y[0]==="..";)y.shift(),x-=1;o.pathname=y.join("/")}c=x>=0?t[x]:"/"}let u=rT(o,c),d=l&&l!=="/"&&l.endsWith("/"),g=(i||l===".")&&r.endsWith("/");return!u.pathname.endsWith("/")&&(d||g)&&(u.pathname+="/"),u}const Ns=e=>e.join("/").replace(/\/\/+/g,"/"),sT=e=>e.replace(/\/+$/,"").replace(/^\/*/,"/"),oT=e=>!e||e==="?"?"":e.startsWith("?")?e:"?"+e,iT=e=>!e||e==="#"?"":e.startsWith("#")?e:"#"+e;function aT(e){return e!=null&&typeof e.status=="number"&&typeof e.statusText=="string"&&typeof e.internal=="boolean"&&"data"in e}const ix=["post","put","patch","delete"];new Set(ix);const lT=["get",...ix];new Set(lT);/**
 * React Router v6.30.2
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function Ea(){return Ea=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},Ea.apply(this,arguments)}const eh=w.createContext(null),cT=w.createContext(null),Rs=w.createContext(null),Mc=w.createContext(null),Kn=w.createContext({outlet:null,matches:[],isDataRoute:!1}),ax=w.createContext(null);function uT(e,t){let{relative:r}=t===void 0?{}:t;Ti()||qt(!1);let{basename:n,navigator:o}=w.useContext(Rs),{hash:i,pathname:l,search:c}=cx(e,{relative:r}),u=l;return n!=="/"&&(u=l==="/"?n:Ns([n,l])),o.createHref({pathname:u,search:c,hash:i})}function Ti(){return w.useContext(Mc)!=null}function xo(){return Ti()||qt(!1),w.useContext(Mc).location}function lx(e){w.useContext(Rs).static||w.useLayoutEffect(e)}function Ci(){let{isDataRoute:e}=w.useContext(Kn);return e?TT():dT()}function dT(){Ti()||qt(!1);let e=w.useContext(eh),{basename:t,future:r,navigator:n}=w.useContext(Rs),{matches:o}=w.useContext(Kn),{pathname:i}=xo(),l=JSON.stringify(Zp(o,r.v7_relativeSplatPath)),c=w.useRef(!1);return lx(()=>{c.current=!0}),w.useCallback(function(d,g){if(g===void 0&&(g={}),!c.current)return;if(typeof d=="number"){n.go(d);return}let x=Xp(d,JSON.parse(l),i,g.relative==="path");e==null&&t!=="/"&&(x.pathname=x.pathname==="/"?t:Ns([t,x.pathname])),(g.replace?n.replace:n.push)(x,g.state,g)},[t,n,l,i,e])}function pT(){let{matches:e}=w.useContext(Kn),t=e[e.length-1];return t?t.params:{}}function cx(e,t){let{relative:r}=t===void 0?{}:t,{future:n}=w.useContext(Rs),{matches:o}=w.useContext(Kn),{pathname:i}=xo(),l=JSON.stringify(Zp(o,n.v7_relativeSplatPath));return w.useMemo(()=>Xp(e,JSON.parse(l),i,r==="path"),[e,l,i,r])}function hT(e,t){return mT(e,t)}function mT(e,t,r,n){Ti()||qt(!1);let{navigator:o}=w.useContext(Rs),{matches:i}=w.useContext(Kn),l=i[i.length-1],c=l?l.params:{};l&&l.pathname;let u=l?l.pathnameBase:"/";l&&l.route;let d=xo(),g;if(t){var x;let b=typeof t=="string"?Si(t):t;u==="/"||(x=b.pathname)!=null&&x.startsWith(u)||qt(!1),g=b}else g=d;let y=g.pathname||"/",S=y;if(u!=="/"){let b=u.replace(/^\//,"").split("/");S="/"+y.replace(/^\//,"").split("/").slice(b.length).join("/")}let T=$S(e,{pathname:S}),I=vT(T&&T.map(b=>Object.assign({},b,{params:Object.assign({},c,b.params),pathname:Ns([u,o.encodeLocation?o.encodeLocation(b.pathname).pathname:b.pathname]),pathnameBase:b.pathnameBase==="/"?u:Ns([u,o.encodeLocation?o.encodeLocation(b.pathnameBase).pathname:b.pathnameBase])})),i,r,n);return t&&I?w.createElement(Mc.Provider,{value:{location:Ea({pathname:"/",search:"",hash:"",state:null,key:"default"},g),navigationType:xs.Pop}},I):I}function fT(){let e=ST(),t=aT(e)?e.status+" "+e.statusText:e instanceof Error?e.message:JSON.stringify(e),r=e instanceof Error?e.stack:null,o={padding:"0.5rem",backgroundColor:"rgba(200,200,200, 0.5)"};return w.createElement(w.Fragment,null,w.createElement("h2",null,"Unexpected Application Error!"),w.createElement("h3",{style:{fontStyle:"italic"}},t),r?w.createElement("pre",{style:o},r):null,null)}const gT=w.createElement(fT,null);class yT extends w.Component{constructor(t){super(t),this.state={location:t.location,revalidation:t.revalidation,error:t.error}}static getDerivedStateFromError(t){return{error:t}}static getDerivedStateFromProps(t,r){return r.location!==t.location||r.revalidation!=="idle"&&t.revalidation==="idle"?{error:t.error,location:t.location,revalidation:t.revalidation}:{error:t.error!==void 0?t.error:r.error,location:r.location,revalidation:t.revalidation||r.revalidation}}componentDidCatch(t,r){console.error("React Router caught the following error during render",t,r)}render(){return this.state.error!==void 0?w.createElement(Kn.Provider,{value:this.props.routeContext},w.createElement(ax.Provider,{value:this.state.error,children:this.props.component})):this.props.children}}function xT(e){let{routeContext:t,match:r,children:n}=e,o=w.useContext(eh);return o&&o.static&&o.staticContext&&(r.route.errorElement||r.route.ErrorBoundary)&&(o.staticContext._deepestRenderedBoundaryId=r.route.id),w.createElement(Kn.Provider,{value:t},n)}function vT(e,t,r,n){var o;if(t===void 0&&(t=[]),r===void 0&&(r=null),n===void 0&&(n=null),e==null){var i;if(!r)return null;if(r.errors)e=r.matches;else if((i=n)!=null&&i.v7_partialHydration&&t.length===0&&!r.initialized&&r.matches.length>0)e=r.matches;else return null}let l=e,c=(o=r)==null?void 0:o.errors;if(c!=null){let g=l.findIndex(x=>x.route.id&&(c==null?void 0:c[x.route.id])!==void 0);g>=0||qt(!1),l=l.slice(0,Math.min(l.length,g+1))}let u=!1,d=-1;if(r&&n&&n.v7_partialHydration)for(let g=0;g<l.length;g++){let x=l[g];if((x.route.HydrateFallback||x.route.hydrateFallbackElement)&&(d=g),x.route.id){let{loaderData:y,errors:S}=r,T=x.route.loader&&y[x.route.id]===void 0&&(!S||S[x.route.id]===void 0);if(x.route.lazy||T){u=!0,d>=0?l=l.slice(0,d+1):l=[l[0]];break}}}return l.reduceRight((g,x,y)=>{let S,T=!1,I=null,b=null;r&&(S=c&&x.route.id?c[x.route.id]:void 0,I=x.route.errorElement||gT,u&&(d<0&&y===0?(CT("route-fallback"),T=!0,b=null):d===y&&(T=!0,b=x.route.hydrateFallbackElement||null)));let h=t.concat(l.slice(0,y+1)),v=()=>{let C;return S?C=I:T?C=b:x.route.Component?C=w.createElement(x.route.Component,null):x.route.element?C=x.route.element:C=g,w.createElement(xT,{match:x,routeContext:{outlet:g,matches:h,isDataRoute:r!=null},children:C})};return r&&(x.route.ErrorBoundary||x.route.errorElement||y===0)?w.createElement(yT,{location:r.location,revalidation:r.revalidation,component:I,error:S,children:v(),routeContext:{outlet:null,matches:h,isDataRoute:!0}}):v()},null)}var ux=function(e){return e.UseBlocker="useBlocker",e.UseRevalidator="useRevalidator",e.UseNavigateStable="useNavigate",e}(ux||{}),dx=function(e){return e.UseBlocker="useBlocker",e.UseLoaderData="useLoaderData",e.UseActionData="useActionData",e.UseRouteError="useRouteError",e.UseNavigation="useNavigation",e.UseRouteLoaderData="useRouteLoaderData",e.UseMatches="useMatches",e.UseRevalidator="useRevalidator",e.UseNavigateStable="useNavigate",e.UseRouteId="useRouteId",e}(dx||{});function wT(e){let t=w.useContext(eh);return t||qt(!1),t}function bT(e){let t=w.useContext(cT);return t||qt(!1),t}function kT(e){let t=w.useContext(Kn);return t||qt(!1),t}function px(e){let t=kT(),r=t.matches[t.matches.length-1];return r.route.id||qt(!1),r.route.id}function ST(){var e;let t=w.useContext(ax),r=bT(),n=px();return t!==void 0?t:(e=r.errors)==null?void 0:e[n]}function TT(){let{router:e}=wT(ux.UseNavigateStable),t=px(dx.UseNavigateStable),r=w.useRef(!1);return lx(()=>{r.current=!0}),w.useCallback(function(o,i){i===void 0&&(i={}),r.current&&(typeof o=="number"?e.navigate(o):e.navigate(o,Ea({fromRouteId:t},i)))},[e,t])}const xg={};function CT(e,t,r){xg[e]||(xg[e]=!0)}function PT(e,t){e==null||e.v7_startTransition,e==null||e.v7_relativeSplatPath}function Wd(e){let{to:t,replace:r,state:n,relative:o}=e;Ti()||qt(!1);let{future:i,static:l}=w.useContext(Rs),{matches:c}=w.useContext(Kn),{pathname:u}=xo(),d=Ci(),g=Xp(t,Zp(c,i.v7_relativeSplatPath),u,o==="path"),x=JSON.stringify(g);return w.useEffect(()=>d(JSON.parse(x),{replace:r,state:n,relative:o}),[d,x,o,r,n]),null}function Rn(e){qt(!1)}function jT(e){let{basename:t="/",children:r=null,location:n,navigationType:o=xs.Pop,navigator:i,static:l=!1,future:c}=e;Ti()&&qt(!1);let u=t.replace(/^\/*/,"/"),d=w.useMemo(()=>({basename:u,navigator:i,static:l,future:Ea({v7_relativeSplatPath:!1},c)}),[u,c,i,l]);typeof n=="string"&&(n=Si(n));let{pathname:g="/",search:x="",hash:y="",state:S=null,key:T="default"}=n,I=w.useMemo(()=>{let b=Jp(g,u);return b==null?null:{location:{pathname:b,search:x,hash:y,state:S,key:T},navigationType:o}},[u,g,x,y,S,T,o]);return I==null?null:w.createElement(Rs.Provider,{value:d},w.createElement(Mc.Provider,{children:r,value:I}))}function NT(e){let{children:t,location:r}=e;return hT(Gd(t),r)}new Promise(()=>{});function Gd(e,t){t===void 0&&(t=[]);let r=[];return w.Children.forEach(e,(n,o)=>{if(!w.isValidElement(n))return;let i=[...t,o];if(n.type===w.Fragment){r.push.apply(r,Gd(n.props.children,i));return}n.type!==Rn&&qt(!1),!n.props.index||!n.props.children||qt(!1);let l={id:n.props.id||i.join("-"),caseSensitive:n.props.caseSensitive,element:n.props.element,Component:n.props.Component,index:n.props.index,path:n.props.path,loader:n.props.loader,action:n.props.action,errorElement:n.props.errorElement,ErrorBoundary:n.props.ErrorBoundary,hasErrorBoundary:n.props.ErrorBoundary!=null||n.props.errorElement!=null,shouldRevalidate:n.props.shouldRevalidate,handle:n.props.handle,lazy:n.props.lazy};n.props.children&&(l.children=Gd(n.props.children,i)),r.push(l)}),r}/**
 * React Router DOM v6.30.2
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function Hd(){return Hd=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},Hd.apply(this,arguments)}function IT(e,t){if(e==null)return{};var r={},n=Object.keys(e),o,i;for(i=0;i<n.length;i++)o=n[i],!(t.indexOf(o)>=0)&&(r[o]=e[o]);return r}function AT(e){return!!(e.metaKey||e.altKey||e.ctrlKey||e.shiftKey)}function ET(e,t){return e.button===0&&(!t||t==="_self")&&!AT(e)}function Vd(e){return e===void 0&&(e=""),new URLSearchParams(typeof e=="string"||Array.isArray(e)||e instanceof URLSearchParams?e:Object.keys(e).reduce((t,r)=>{let n=e[r];return t.concat(Array.isArray(n)?n.map(o=>[r,o]):[[r,n]])},[]))}function MT(e,t){let r=Vd(e);return t&&t.forEach((n,o)=>{r.has(o)||t.getAll(o).forEach(i=>{r.append(o,i)})}),r}const _T=["onClick","relative","reloadDocument","replace","state","target","to","preventScrollReset","viewTransition"],RT="6";try{window.__reactRouterVersion=RT}catch{}const zT="startTransition",vg=Ck[zT];function LT(e){let{basename:t,children:r,future:n,window:o}=e,i=w.useRef();i.current==null&&(i.current=LS({window:o,v5Compat:!0}));let l=i.current,[c,u]=w.useState({action:l.action,location:l.location}),{v7_startTransition:d}=n||{},g=w.useCallback(x=>{d&&vg?vg(()=>u(x)):u(x)},[u,d]);return w.useLayoutEffect(()=>l.listen(g),[l,g]),w.useEffect(()=>PT(n),[n]),w.createElement(jT,{basename:t,children:r,location:c.location,navigationType:c.action,navigator:l,future:n})}const OT=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u",DT=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,$T=w.forwardRef(function(t,r){let{onClick:n,relative:o,reloadDocument:i,replace:l,state:c,target:u,to:d,preventScrollReset:g,viewTransition:x}=t,y=IT(t,_T),{basename:S}=w.useContext(Rs),T,I=!1;if(typeof d=="string"&&DT.test(d)&&(T=d,OT))try{let C=new URL(window.location.href),A=d.startsWith("//")?new URL(C.protocol+d):new URL(d),P=Jp(A.pathname,S);A.origin===C.origin&&P!=null?d=P+A.search+A.hash:I=!0}catch{}let b=uT(d,{relative:o}),h=FT(d,{replace:l,state:c,target:u,preventScrollReset:g,relative:o,viewTransition:x});function v(C){n&&n(C),C.defaultPrevented||h(C)}return w.createElement("a",Hd({},y,{href:T||b,onClick:I||i?n:v,ref:r,target:u}))});var wg;(function(e){e.UseScrollRestoration="useScrollRestoration",e.UseSubmit="useSubmit",e.UseSubmitFetcher="useSubmitFetcher",e.UseFetcher="useFetcher",e.useViewTransitionState="useViewTransitionState"})(wg||(wg={}));var bg;(function(e){e.UseFetcher="useFetcher",e.UseFetchers="useFetchers",e.UseScrollRestoration="useScrollRestoration"})(bg||(bg={}));function FT(e,t){let{target:r,replace:n,state:o,preventScrollReset:i,relative:l,viewTransition:c}=t===void 0?{}:t,u=Ci(),d=xo(),g=cx(e,{relative:l});return w.useCallback(x=>{if(ET(x,r)){x.preventDefault();let y=n!==void 0?n:ic(d)===ic(g);u(e,{replace:y,state:o,preventScrollReset:i,relative:l,viewTransition:c})}},[d,u,g,n,o,r,e,i,l,c])}function UT(e){let t=w.useRef(Vd(e)),r=w.useRef(!1),n=xo(),o=w.useMemo(()=>MT(n.search,r.current?null:t.current),[n.search]),i=Ci(),l=w.useCallback((c,u)=>{const d=Vd(typeof c=="function"?c(o):c);r.current=!0,i("?"+d,u)},[i,o]);return[o,l]}const BT="modulepreload",qT=function(e){return"/"+e},kg={},zt=function(t,r,n){let o=Promise.resolve();if(r&&r.length>0){document.getElementsByTagName("link");const l=document.querySelector("meta[property=csp-nonce]"),c=(l==null?void 0:l.nonce)||(l==null?void 0:l.getAttribute("nonce"));o=Promise.allSettled(r.map(u=>{if(u=qT(u),u in kg)return;kg[u]=!0;const d=u.endsWith(".css"),g=d?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${u}"]${g}`))return;const x=document.createElement("link");if(x.rel=d?"stylesheet":BT,d||(x.as="script"),x.crossOrigin="",x.href=u,c&&x.setAttribute("nonce",c),document.head.appendChild(x),d)return new Promise((y,S)=>{x.addEventListener("load",y),x.addEventListener("error",()=>S(new Error(`Unable to preload CSS for ${u}`)))})}))}function i(l){const c=new Event("vite:preloadError",{cancelable:!0});if(c.payload=l,window.dispatchEvent(c),!c.defaultPrevented)throw l}return o.then(l=>{for(const c of l||[])c.status==="rejected"&&i(c.reason);return t().catch(i)})},WT={},Sg=e=>{let t;const r=new Set,n=(g,x)=>{const y=typeof g=="function"?g(t):g;if(!Object.is(y,t)){const S=t;t=x??(typeof y!="object"||y===null)?y:Object.assign({},t,y),r.forEach(T=>T(t,S))}},o=()=>t,u={setState:n,getState:o,getInitialState:()=>d,subscribe:g=>(r.add(g),()=>r.delete(g)),destroy:()=>{(WT?"production":void 0)!=="production"&&console.warn("[DEPRECATED] The `destroy` method will be unsupported in a future version. Instead use unsubscribe function returned by subscribe. Everything will be garbage-collected if store is garbage-collected."),r.clear()}},d=t=e(n,o,u);return u},GT=e=>e?Sg(e):Sg;var hx={exports:{}},mx={},fx={exports:{}},gx={};/**
 * @license React
 * use-sync-external-store-shim.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var vi=w;function HT(e,t){return e===t&&(e!==0||1/e===1/t)||e!==e&&t!==t}var VT=typeof Object.is=="function"?Object.is:HT,KT=vi.useState,YT=vi.useEffect,QT=vi.useLayoutEffect,JT=vi.useDebugValue;function ZT(e,t){var r=t(),n=KT({inst:{value:r,getSnapshot:t}}),o=n[0].inst,i=n[1];return QT(function(){o.value=r,o.getSnapshot=t,Gu(o)&&i({inst:o})},[e,r,t]),YT(function(){return Gu(o)&&i({inst:o}),e(function(){Gu(o)&&i({inst:o})})},[e]),JT(r),r}function Gu(e){var t=e.getSnapshot;e=e.value;try{var r=t();return!VT(e,r)}catch{return!0}}function XT(e,t){return t()}var eC=typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"?XT:ZT;gx.useSyncExternalStore=vi.useSyncExternalStore!==void 0?vi.useSyncExternalStore:eC;fx.exports=gx;var tC=fx.exports;/**
 * @license React
 * use-sync-external-store-shim/with-selector.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var _c=w,rC=tC;function nC(e,t){return e===t&&(e!==0||1/e===1/t)||e!==e&&t!==t}var sC=typeof Object.is=="function"?Object.is:nC,oC=rC.useSyncExternalStore,iC=_c.useRef,aC=_c.useEffect,lC=_c.useMemo,cC=_c.useDebugValue;mx.useSyncExternalStoreWithSelector=function(e,t,r,n,o){var i=iC(null);if(i.current===null){var l={hasValue:!1,value:null};i.current=l}else l=i.current;i=lC(function(){function u(S){if(!d){if(d=!0,g=S,S=n(S),o!==void 0&&l.hasValue){var T=l.value;if(o(T,S))return x=T}return x=S}if(T=x,sC(g,S))return T;var I=n(S);return o!==void 0&&o(T,I)?(g=S,T):(g=S,x=I)}var d=!1,g,x,y=r===void 0?null:r;return[function(){return u(t())},y===null?void 0:function(){return u(y())}]},[t,r,n,o]);var c=oC(e,i[0],i[1]);return aC(function(){l.hasValue=!0,l.value=c},[c]),cC(c),c};hx.exports=mx;var uC=hx.exports;const dC=Gg(uC),yx={},{useDebugValue:pC}=sp,{useSyncExternalStoreWithSelector:hC}=dC;let Tg=!1;const mC=e=>e;function fC(e,t=mC,r){(yx?"production":void 0)!=="production"&&r&&!Tg&&(console.warn("[DEPRECATED] Use `createWithEqualityFn` instead of `create` or use `useStoreWithEqualityFn` instead of `useStore`. They can be imported from 'zustand/traditional'. https://github.com/pmndrs/zustand/discussions/1937"),Tg=!0);const n=hC(e.subscribe,e.getState,e.getServerState||e.getInitialState,t,r);return pC(n),n}const Cg=e=>{(yx?"production":void 0)!=="production"&&typeof e!="function"&&console.warn("[DEPRECATED] Passing a vanilla store will be unsupported in a future version. Instead use `import { useStore } from 'zustand'`.");const t=typeof e=="function"?GT(e):e,r=(n,o)=>fC(t,n,o);return Object.assign(r,t),r},vo=e=>e?Cg(e):Cg,xx="yprompt_mock_data";function gC(){const e=localStorage.getItem(xx);if(e)try{return JSON.parse(e)}catch{}return{user:{id:1,username:"admin",name:"",avatar:"",email:"admin@example.com",auth_type:"local",is_admin:1,last_login_time:new Date().toISOString()},prompts:[],tags:[],promptRules:null}}function an(e){localStorage.setItem(xx,JSON.stringify(e))}function nr(){return gC()}function Vt(e=300){return new Promise(t=>setTimeout(t,e))}function Hu(){return`mock_token_${Date.now()}_${Math.random().toString(36).substr(2,9)}`}const Kt={async login(e,t){if(await Vt(500),e==="admin"&&t==="admin123"){const r=nr(),n=Hu();return r.user.last_login_time=new Date().toISOString(),an(r),{code:200,message:"",data:{token:n,user:r.user}}}else{const r=nr(),n=Hu();return r.user.username=e,r.user.name=e,r.user.last_login_time=new Date().toISOString(),an(r),{code:200,message:"Debug ",data:{token:n,user:r.user}}}},async getAuthConfig(){return await Vt(200),{code:200,data:{local_auth_enabled:!0,login_username:"admin"}}},async refreshToken(e){return await Vt(200),{code:200,message:"",data:{token:Hu()}}},async getUserInfo(){return await Vt(200),{code:200,data:nr().user}},async logout(){return await Vt(200),{code:200,message:""}},async getPrompts(e){await Vt(300);let r=[...nr().prompts];if(e!=null&&e.search){const u=e.search.toLowerCase();r=r.filter(d=>{var g,x;return((g=d.title)==null?void 0:g.toLowerCase().includes(u))||((x=d.description)==null?void 0:x.toLowerCase().includes(u))})}e!=null&&e.is_favorite&&(r=r.filter(u=>u.is_favorite===1)),e!=null&&e.tags&&e.tags.length>0&&(r=r.filter(u=>{const d=(u.tags||"").split(",").map(g=>g.trim());return e.tags.some(g=>d.includes(g))}));const n=(e==null?void 0:e.page)||1,o=(e==null?void 0:e.limit)||20,i=(n-1)*o,l=i+o,c=r.slice(i,l);return{code:200,data:{total:r.length,page:n,limit:o,items:c}}},async getPrompt(e){await Vt(200);const r=nr().prompts.find(n=>n.id===e);return r?{code:200,data:r}:{code:404,message:""}},async savePrompt(e){await Vt(500);const t=nr(),r={id:Date.now(),user_id:t.user.id,...e,is_favorite:0,is_public:0,view_count:0,use_count:0,create_time:new Date().toISOString(),update_time:new Date().toISOString(),current_version:"1.0.0",total_versions:1};return t.prompts.unshift(r),an(t),{code:200,message:"",data:r}},async updatePrompt(e,t){await Vt(500);const r=nr(),n=r.prompts.findIndex(o=>o.id===e);return n===-1?{code:404,message:""}:(r.prompts[n]={...r.prompts[n],...t,update_time:new Date().toISOString()},an(r),{code:200,message:"",data:r.prompts[n]})},async deletePrompt(e){await Vt(300);const t=nr(),r=t.prompts.findIndex(n=>n.id===e);return r===-1?{code:404,message:""}:(t.prompts.splice(r,1),an(t),{code:200,message:""})},async toggleFavorite(e,t){await Vt(300);const r=nr(),n=r.prompts.find(o=>o.id===e);return n?(n.is_favorite=t?1:0,an(r),{code:200,message:t?"":""}):{code:404,message:""}},async recordPromptUse(e){await Vt(200);const t=nr(),r=t.prompts.find(n=>n.id===e);return r&&(r.use_count=(r.use_count||0)+1,an(t)),{code:200,message:""}},async getTags(){return await Vt(200),{code:200,data:nr().tags||[]}},async getPopularTags(e=10){return await Vt(200),{code:200,data:[...nr().tags||[]].sort((n,o)=>(o.use_count||0)-(n.use_count||0)).slice(0,e)}},async createTag(e){await Vt(300);const t=nr();if(t.tags.find(o=>o.tag_name===e))return{code:400,message:""};const n={id:Date.now(),tag_name:e,user_id:t.user.id,use_count:0,create_time:new Date().toISOString()};return t.tags.push(n),an(t),{code:200,message:"",data:n}},async deleteTag(e){await Vt(300);const t=nr(),r=t.tags.findIndex(n=>n.id===e);return r===-1?{code:404,message:""}:(t.tags.splice(r,1),an(t),{code:200,message:""})},async getUserPromptRules(){await Vt(200);const e=nr();return{code:200,data:e.promptRules||null,message:e.promptRules?"":""}},async saveUserPromptRules(e){await Vt(500);const t=nr();return t.promptRules={...t.promptRules,...e,user_id:t.user.id,update_time:new Date().toISOString()},an(t),{code:200,message:"",data:t.promptRules}},async deleteUserPromptRules(e){await Vt(300);const t=nr();return!e||e.length===0?t.promptRules=null:(t.promptRules||(t.promptRules={}),e.forEach(r=>{delete t.promptRules[r]})),an(t),{code:200,message:""}}};function ms(){return localStorage.getItem("yprompt_debug_mode")==="true"}async function Go(e,t,r){if(!ms())throw new Error("Mock API  debug ");const[n,o]=t.split("?"),i={};if(o&&o.split("&").forEach(l=>{const[c,u]=l.split("=");i[c]=decodeURIComponent(u||"")}),n==="/api/auth/local/login"&&e==="POST")return Kt.login(r.username,r.password);if(n==="/api/auth/config"&&e==="GET")return Kt.getAuthConfig();if(n==="/api/auth/refresh"&&e==="POST"){const l=localStorage.getItem("yprompt_token")||"";return Kt.refreshToken(l)}if(n==="/api/auth/userinfo"&&e==="GET")return Kt.getUserInfo();if(n==="/api/auth/logout"&&e==="POST")return Kt.logout();if(n.startsWith("/api/prompts")&&e==="GET")if(n.match(/^\/api\/prompts\/(\d+)$/)){const l=parseInt(n.match(/^\/api\/prompts\/(\d+)$/)[1]);return Kt.getPrompt(l)}else return Kt.getPrompts(i);if(n==="/api/prompts"&&e==="POST")return Kt.savePrompt(r);if(n.match(/^\/api\/prompts\/(\d+)$/)&&e==="PUT"){const l=parseInt(n.match(/^\/api\/prompts\/(\d+)$/)[1]);return Kt.updatePrompt(l,r)}if(n.match(/^\/api\/prompts\/(\d+)$/)&&e==="DELETE"){const l=parseInt(n.match(/^\/api\/prompts\/(\d+)$/)[1]);return Kt.deletePrompt(l)}if(n.match(/^\/api\/prompts\/(\d+)\/favorite$/)&&e==="POST"){const l=parseInt(n.match(/^\/api\/prompts\/(\d+)\/favorite$/)[1]);return Kt.toggleFavorite(l,r.is_favorite)}if(n.match(/^\/api\/prompts\/(\d+)\/use$/)&&e==="POST"){const l=parseInt(n.match(/^\/api\/prompts\/(\d+)\/use$/)[1]);return Kt.recordPromptUse(l)}if(n==="/api/tags"&&e==="GET")return Kt.getTags();if(n==="/api/tags/popular"&&e==="GET")return Kt.getPopularTags(i.limit);if(n==="/api/tags"&&e==="POST")return Kt.createTag(r.tag_name);if(n.match(/^\/api\/tags\/(\d+)$/)&&e==="DELETE"){const l=parseInt(n.match(/^\/api\/tags\/(\d+)$/)[1]);return Kt.deleteTag(l)}return n==="/api/prompt-rules"&&e==="GET"?Kt.getUserPromptRules():n==="/api/prompt-rules"&&e==="POST"?Kt.saveUserPromptRules(r):n==="/api/prompt-rules"&&e==="DELETE"?Kt.deleteUserPromptRules():{code:404,message:`Mock API : ${e} ${n}`}}const jr=vo((e,t)=>({token:localStorage.getItem("yprompt_token"),user:null,isLoading:!1,setToken:r=>{e({token:r}),r?localStorage.setItem("yprompt_token",r):localStorage.removeItem("yprompt_token")},setUser:r=>{e({user:r}),r?localStorage.setItem("yprompt_user",JSON.stringify(r)):localStorage.removeItem("yprompt_user")},restoreUser:()=>{const r=localStorage.getItem("yprompt_user");if(r)try{const n=JSON.parse(r);e({user:n})}catch{localStorage.removeItem("yprompt_user")}},loginWithPassword:async(r,n)=>{e({isLoading:!0});try{let o;if(ms())o=await Go("POST","/api/auth/local/login",{username:r,password:n});else{const c=await fetch("https://api.prompt-ui.xiechengqi.top/api/auth/local/login",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:r,password:n})});if(!c.ok)try{return{success:!1,message:(await c.json()).message||`: ${c.status} ${c.statusText}`}}catch{return{success:!1,message:`: ${c.status} ${c.statusText}`}}o=await c.json()}if(o.code===200&&o.data){t().setToken(o.data.token),t().setUser(o.data.user);try{const{promptConfigManager:i}=await zt(async()=>{const{promptConfigManager:l}=await Promise.resolve().then(()=>NP);return{promptConfigManager:l}},void 0);await i.forceReloadFromCloud()}catch(i){console.error(":",i)}return{success:!0}}else return{success:!1,message:o.message||""}}catch(o){return console.error(":",o),o instanceof TypeError&&o.message.includes("fetch")?{success:!1,message:" API "}:{success:!1,message:o instanceof Error?o.message:""}}finally{e({isLoading:!1})}},getAuthConfig:async()=>{try{let r;return ms()?r=await Go("GET","/api/auth/config"):r=await(await fetch("https://api.prompt-ui.xiechengqi.top/api/auth/config")).json(),r.code===200&&r.data?r.data:null}catch{return null}},refreshToken:async()=>{const{token:r}=t();if(!r)return!1;try{let n;return ms()?n=await Go("POST","/api/auth/refresh"):n=await(await fetch("https://api.prompt-ui.xiechengqi.top/api/auth/refresh",{method:"POST",headers:{Authorization:`Bearer ${r}`,"Content-Type":"application/json"}})).json(),n.code===200&&n.data?(t().setToken(n.data.token),!0):!1}catch{return!1}},fetchUserInfo:async()=>{const{token:r}=t();if(!r)return!1;try{let n;return ms()?n=await Go("GET","/api/auth/userinfo"):n=await(await fetch("https://api.prompt-ui.xiechengqi.top/api/auth/userinfo",{method:"GET",headers:{Authorization:`Bearer ${r}`}})).json(),n.code===200&&n.data?(t().setUser(n.data),!0):!1}catch{return!1}},logout:async()=>{const{token:r}=t();if(r)try{ms()?await Go("POST","/api/auth/logout"):await fetch("https://api.prompt-ui.xiechengqi.top/api/auth/logout",{method:"POST",headers:{Authorization:`Bearer ${r}`}})}catch{}t().setToken(null),t().setUser(null),sessionStorage.removeItem("yprompt_config_session_loaded"),["user_prompt_optimize_data","yprompt_optimize_active_mode","yprompt_optimize_cache","yprompt_user_optimize_active_tab","yprompt_optimize_loaded_user_prompt","yprompt_optimize_result","yprompt_generate_messages","yprompt_generate_prompt_data","yprompt_settings_cache"].forEach(i=>{localStorage.removeItem(i)}),Object.keys(localStorage).forEach(i=>{(i.startsWith("yprompt_")||i.startsWith("user_prompt_"))&&i!=="yprompt_token"&&i!=="yprompt_user"&&localStorage.removeItem(i)})},initialize:async()=>{t().restoreUser();const{token:r,user:n}=t();r&&!n&&await t().fetchUserInfo()}})),yC=Object.freeze(Object.defineProperty({__proto__:null,useAuthStore:jr},Symbol.toStringTag,{value:"Module"})),yl=[{id:"generate",name:"",icon:"",path:"/generate",color:"#3B82F6"},{id:"optimize",name:"",icon:"",path:"/optimize",color:"#F59E0B"},{id:"playground",name:"",icon:"",path:"/playground",color:"#10B981"},{id:"library",name:"",icon:"",path:"/library",color:"#8B5CF6"}],ui=vo((e,t)=>({currentModule:"generate",modules:yl,setCurrentModule:r=>{e({currentModule:r})},getModuleByPath:r=>yl.find(n=>n.path===r),getCurrentModuleConfig:()=>{const{currentModule:r}=t();return yl.find(n=>n.id===r)||yl[0]}}));/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xC=e=>e.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),vC=e=>e.replace(/^([A-Z])|[\s-_]+(\w)/g,(t,r,n)=>n?n.toUpperCase():r.toLowerCase()),Pg=e=>{const t=vC(e);return t.charAt(0).toUpperCase()+t.slice(1)},vx=(...e)=>e.filter((t,r,n)=>!!t&&t.trim()!==""&&n.indexOf(t)===r).join(" ").trim(),wC=e=>{for(const t in e)if(t.startsWith("aria-")||t==="role"||t==="title")return!0};/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var bC={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const kC=w.forwardRef(({color:e="currentColor",size:t=24,strokeWidth:r=2,absoluteStrokeWidth:n,className:o="",children:i,iconNode:l,...c},u)=>w.createElement("svg",{ref:u,...bC,width:t,height:t,stroke:e,strokeWidth:n?Number(r)*24/Number(t):r,className:vx("lucide",o),...!i&&!wC(c)&&{"aria-hidden":"true"},...c},[...l.map(([d,g])=>w.createElement(d,g)),...Array.isArray(i)?i:[i]]));/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ke=(e,t)=>{const r=w.forwardRef(({className:n,...o},i)=>w.createElement(kC,{ref:i,iconNode:t,className:vx(`lucide-${xC(Pg(e))}`,`lucide-${e}`,n),...o}));return r.displayName=Pg(e),r};/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const SC=[["path",{d:"M8 3 4 7l4 4",key:"9rb6wj"}],["path",{d:"M4 7h16",key:"6tx8e3"}],["path",{d:"m16 21 4-4-4-4",key:"siv7j2"}],["path",{d:"M20 17H4",key:"h6l3hr"}]],wx=Ke("arrow-left-right",SC);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const TC=[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]],CC=Ke("arrow-left",TC);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const PC=[["path",{d:"m5 12 7-7 7 7",key:"hav0vg"}],["path",{d:"M12 19V5",key:"x0mq9r"}]],di=Ke("arrow-up",PC);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const jC=[["path",{d:"M4.929 4.929 19.07 19.071",key:"196cmz"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]],NC=Ke("ban",jC);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const IC=[["path",{d:"M3 3v16a2 2 0 0 0 2 2h16",key:"c24i48"}],["path",{d:"M18 17V9",key:"2bz60n"}],["path",{d:"M13 17V5",key:"1frdt8"}],["path",{d:"M8 17v-3",key:"17ska0"}]],AC=Ke("chart-column",IC);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const EC=[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]],zs=Ke("check",EC);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const MC=[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]],jg=Ke("chevron-down",MC);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _C=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]],bx=Ke("circle-alert",_C);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const RC=[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]],th=Ke("circle-check-big",RC);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const zC=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]],rh=Ke("circle-x",zC);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const LC=[["path",{d:"M12 6v6l4 2",key:"mmk7yg"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]],nh=Ke("clock",LC);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const OC=[["path",{d:"m18 16 4-4-4-4",key:"1inbqp"}],["path",{d:"m6 8-4 4 4 4",key:"15zrgr"}],["path",{d:"m14.5 4-5 16",key:"e7oirm"}]],DC=Ke("code-xml",OC);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $C=[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]],wr=Ke("copy",$C);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const FC=[["path",{d:"M12 15V3",key:"m9g1x1"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["path",{d:"m7 10 5 5 5-5",key:"brsn70"}]],UC=Ke("download",FC);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const BC=[["path",{d:"M10.733 5.076a10.744 10.744 0 0 1 11.205 6.575 1 1 0 0 1 0 .696 10.747 10.747 0 0 1-1.444 2.49",key:"ct8e1f"}],["path",{d:"M14.084 14.158a3 3 0 0 1-4.242-4.242",key:"151rxh"}],["path",{d:"M17.479 17.499a10.75 10.75 0 0 1-15.417-5.151 1 1 0 0 1 0-.696 10.75 10.75 0 0 1 4.446-5.143",key:"13bj9a"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]],kx=Ke("eye-off",BC);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const qC=[["path",{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0",key:"1nclc0"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]],sh=Ke("eye",qC);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const WC=[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]],Ma=Ke("file-text",WC);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const GC=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]],da=Ke("info",GC);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const HC=[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]],Sx=Ke("loader-circle",HC);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const VC=[["path",{d:"m16 17 5-5-5-5",key:"1bji2h"}],["path",{d:"M21 12H9",key:"dn1m92"}],["path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4",key:"1uf3rs"}]],KC=Ke("log-out",VC);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const YC=[["path",{d:"M8 3H5a2 2 0 0 0-2 2v3",key:"1dcmit"}],["path",{d:"M21 8V5a2 2 0 0 0-2-2h-3",key:"1e4gt3"}],["path",{d:"M3 16v3a2 2 0 0 0 2 2h3",key:"wsl5sc"}],["path",{d:"M16 21h3a2 2 0 0 0 2-2v-3",key:"18trek"}]],QC=Ke("maximize",YC);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const JC=[["path",{d:"M22 17a2 2 0 0 1-2 2H6.828a2 2 0 0 0-1.414.586l-2.202 2.202A.71.71 0 0 1 2 21.286V5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2z",key:"18887p"}]],ac=Ke("message-square",JC);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ZC=[["path",{d:"M8 3v3a2 2 0 0 1-2 2H3",key:"hohbtr"}],["path",{d:"M21 8h-3a2 2 0 0 1-2-2V3",key:"5jw1f3"}],["path",{d:"M3 16h3a2 2 0 0 1 2 2v3",key:"198tvr"}],["path",{d:"M16 21v-3a2 2 0 0 1 2-2h3",key:"ph8mxp"}]],XC=Ke("minimize",ZC);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const eP=[["path",{d:"m16 6-8.414 8.586a2 2 0 0 0 2.829 2.829l8.414-8.586a4 4 0 1 0-5.657-5.657l-8.379 8.551a6 6 0 1 0 8.485 8.485l8.379-8.551",key:"1miecu"}]],tP=Ke("paperclip",eP);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const rP=[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}]],Tx=Ke("pen",rP);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const nP=[["path",{d:"M5 5a2 2 0 0 1 3.008-1.728l11.997 6.998a2 2 0 0 1 .003 3.458l-12 7A2 2 0 0 1 5 19z",key:"10ikf1"}]],sP=Ke("play",nP);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const oP=[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]],It=Ke("refresh-cw",oP);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const iP=[["path",{d:"M20 18v-2a4 4 0 0 0-4-4H4",key:"5vmcpk"}],["path",{d:"m9 17-5-5 5-5",key:"nvlc11"}]],aP=Ke("reply",iP);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const lP=[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}]],cP=Ke("rotate-ccw",lP);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const uP=[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]],Cx=Ke("save",uP);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const dP=[["path",{d:"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z",key:"1ffxy3"}],["path",{d:"m21.854 2.147-10.94 10.939",key:"12cjpa"}]],Kd=Ke("send",dP);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pP=[["path",{d:"M9.671 4.136a2.34 2.34 0 0 1 4.659 0 2.34 2.34 0 0 0 3.319 1.915 2.34 2.34 0 0 1 2.33 4.033 2.34 2.34 0 0 0 0 3.831 2.34 2.34 0 0 1-2.33 4.033 2.34 2.34 0 0 0-3.319 1.915 2.34 2.34 0 0 1-4.659 0 2.34 2.34 0 0 0-3.32-1.915 2.34 2.34 0 0 1-2.33-4.033 2.34 2.34 0 0 0 0-3.831A2.34 2.34 0 0 1 6.35 6.051a2.34 2.34 0 0 0 3.319-1.915",key:"1i5ecw"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]],Px=Ke("settings",pP);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const hP=[["path",{d:"M11.017 2.814a1 1 0 0 1 1.966 0l1.051 5.558a2 2 0 0 0 1.594 1.594l5.558 1.051a1 1 0 0 1 0 1.966l-5.558 1.051a2 2 0 0 0-1.594 1.594l-1.051 5.558a1 1 0 0 1-1.966 0l-1.051-5.558a2 2 0 0 0-1.594-1.594l-5.558-1.051a1 1 0 0 1 0-1.966l5.558-1.051a2 2 0 0 0 1.594-1.594z",key:"1s2grr"}],["path",{d:"M20 2v4",key:"1rf3ol"}],["path",{d:"M22 4h-4",key:"gwowj6"}],["circle",{cx:"4",cy:"20",r:"2",key:"6kqj1y"}]],lc=Ke("sparkles",hP);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const mP=[["path",{d:"M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1m0v6g"}],["path",{d:"M18.375 2.625a1 1 0 0 1 3 3l-9.013 9.014a2 2 0 0 1-.853.505l-2.873.84a.5.5 0 0 1-.62-.62l.84-2.873a2 2 0 0 1 .506-.852z",key:"ohrbg2"}]],jx=Ke("square-pen",mP);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const fP=[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}]],gP=Ke("square",fP);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const yP=[["path",{d:"M12.586 2.586A2 2 0 0 0 11.172 2H4a2 2 0 0 0-2 2v7.172a2 2 0 0 0 .586 1.414l8.704 8.704a2.426 2.426 0 0 0 3.42 0l6.58-6.58a2.426 2.426 0 0 0 0-3.42z",key:"vktsd0"}],["circle",{cx:"7.5",cy:"7.5",r:".5",fill:"currentColor",key:"kqv944"}]],xP=Ke("tag",yP);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const vP=[["path",{d:"M12 19h8",key:"baeox8"}],["path",{d:"m4 17 6-6-6-6",key:"1yngyt"}]],Ng=Ke("terminal",vP);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const wP=[["path",{d:"M10 11v6",key:"nco0om"}],["path",{d:"M14 11v6",key:"outv1u"}],["path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6",key:"miytrc"}],["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2",key:"e791ji"}]],Nx=Ke("trash-2",wP);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const bP=[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]],Ig=Ke("triangle-alert",bP);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const kP=[["path",{d:"M12 3v12",key:"1x0j5s"}],["path",{d:"m17 8-5-5-5 5",key:"7q97r8"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}]],SP=Ke("upload",kP);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const TP=[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]],Er=Ke("x",TP);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const CP=[["path",{d:"M4 14a1 1 0 0 1-.78-1.63l9.9-10.2a.5.5 0 0 1 .86.46l-1.92 6.02A1 1 0 0 0 13 10h7a1 1 0 0 1 .78 1.63l-9.9 10.2a.5.5 0 0 1-.86-.46l1.92-6.02A1 1 0 0 0 11 14z",key:"1xq2db"}]],PP=Ke("zap",CP),os=`# Architecting Intelligence: A Definitive Guide to the Art and Science of Elite Prompt Engineering

# Chapter 1: The Philosophy of Prompting: An Introduction to Human-AI Collaboration

## 1.1 The Dawn of a New Dialogue

In the rapidly expanding landscape of artificial intelligence, the Large Language Model (LLM) has emerged as a transformative force, a tool with the potential to redefine productivity, creativity, and problem-solving. Yet, the immense power of these models is often gated by a single, critical factor: the quality of the communication they receive. This is where the discipline of prompt engineering begins.

A **prompt** is, in its simplest form, the instruction, question, or input you provide to an AI model. It is the catalyst for every interaction, the starting point of every generated sentence, image, or line of code. **Prompt engineering**, therefore, is the art and science of designing these inputs to guide an AI model toward precise, reliable, and high-value outputs.

It is crucial to demystify the term "engineering." This discipline requires no background in software development or data science. Rather, it is fundamentally a discipline of communication. Think of it as learning the language of your new, incredibly capable collaborator. The more clearly, specifically, and contextually you can communicate your intent, the more accurately the AI can execute your vision. The quality of the input does not just influence the output; it dictates it.

This guide serves as a comprehensive framework for mastering this new form of dialogue. It is built on the philosophy that interacting with an AI is not a simple transaction of question and answer. It is about architecting conversations, engineering behavior, and forging a collaborative partnership that elevates the capabilities of both human and machine.

## 1.2 The AI as Collaborator, Not an Oracle

A common misconception is to view an LLM as an omniscient oraclea magic box that holds all the answers, waiting for the right question to unlock them. This perspective is limiting. A more powerful and accurate mental model is to view the AI as an infinitely skilled but freshly hired assistant who has read the entire internet but possesses no specific context about you, your goals, or your current task. They have amnesia about every conversation the moment it ends.

This assistant is a powerful prediction engine. When you provide a prompt, the LLM does not "understand" your request in the human sense. Instead, it performs a complex statistical analysis to predict the most probable sequence of words (or "tokens") that should follow your input, based on the vast patterns it learned during its training. Your prompt sets the initial conditions for this prediction. It creates a starting point from which the AI charts its most likely path forward.

Therefore, the role of the prompt engineer is not that of a mere questioner, but of a director, a strategist, and an architect.

- **As a Director:** You provide the AI, your "actor," with a role, a motivation, and moment-to-moment instructions to guide its performance.
- **As a Strategist:** You break down complex problems into logical sequences, anticipating where the AI might falter and providing the necessary scaffolding for it to succeed.
- **As an Architect:** You build the very foundation of the AI's behavior through carefully constructed system prompts, defining its personality, its constraints, and its core operational logic.

In this collaborative model, the user becomes the **prime mover**. You are not passively receiving information; you are actively shaping the AI's thought process. Your expertise, clarity, and strategic communication are what transform the AI from a general-purpose tool into a specialized, proactive partner.

## 1.3 Why Prompting is a Foundational Skill

The ability to craft effective prompts is rapidly becoming a cornerstone of modern literacy, as essential as writing a clear email or creating a compelling presentation. It is the foundational skill for effective human-AI collaboration. Mastering it unlocks several key advantages:

1. **Precision and Reliability:** Well-crafted prompts dramatically reduce ambiguity, leading to outputs that are more accurate, relevant, and aligned with your specific needs. This minimizes the need for endless revisions and course corrections.
2. **Efficiency and Productivity:** By providing clear, detailed, and context-rich instructions upfront, you enable the AI to perform complex tasks faster and more effectively, saving significant time and effort.
3. **Unlocking Advanced Capabilities:** Basic questions yield basic answers. Advanced prompting techniquessuch as instructing the AI to "think step-by-step" or to adopt an expert personaunlock deeper reasoning, creativity, and problem-solving capabilities that are otherwise inaccessible.
4. **Harnessing Specialization:** Through prompting, you can instantly transform a generalist AI into a specialist. You can command it to be a confrontational code reviewer, a humorous travel guide, a formal legal analyst, or a persuasive marketing copywriter, tailoring its expertise to the precise needs of the task at hand.

## 1.4 The Journey Ahead: From Operator to Architect

Mastery of prompt engineering is not a static achievement but a dynamic, iterative skill. It requires curiosity, experimentation, and a willingness to refine your approach based on the AI's responses. The principles outlined in this guide provide the architectural and conversational tools needed to move beyond simple interactions and begin building truly powerful and reliable AI-driven processes.

This guide will systematically deconstruct the practice of prompt engineering, covering:

- **The Anatomy of a Prompt:** Understanding the core components that make an instruction effective.
- **System vs. User Prompts:** Mastering the distinction between the AI's foundational "constitution" and the dynamic "directives" that guide its tasks.
- **A Toolkit of Strategies:** From basic techniques like providing examples (few-shot prompting) to advanced reasoning frameworks like Chain-of-Thought (CoT), Tree-of-Thoughts (ToT), and interactive paradigms like ReAct.
- **Structuring and Control:** Learning how to use structural elements like XML tags and specific output formats like JSON to command predictable, machine-readable results.
- **Complex Workflows:** Exploring how to chain prompts together and orchestrate teams of specialized AI agents to tackle multi-faceted projects.

The ultimate goal is to empower you, the user, to transition from being a simple operator of an AI to becoming a true architect of its intelligence. By learning to communicate with intention and strategy, you can transform artificial intelligence from a promising tool into a true force multiplier, a process driven entirely by the quality and intelligence of the prompts that guide it.

# Chapter 2: The Anatomy of an Effective Prompt: Mastering Context, Task, and Format

## 2.1 The Blueprint of Communication

If a prompt is the instruction that sets an AI in motion, then its anatomy is the blueprint that dictates the quality and precision of its final construction. An effective prompt is not a single, monolithic command but a carefully assembled set of interlocking components. A vague or poorly constructed prompt forces the AI to make assumptions, leading to generic, irrelevant, or incorrect outputs. A well-architected prompt, however, eliminates ambiguity and guides the model directly to the desired outcome.

Every elite prompt, regardless of its complexity, is built upon three fundamental pillars:

1. **Context:** The background information. The "who" and the "why."
2. **Task:** The specific action to be performed. The "what."
3. **Format:** The desired structure of the output. The "how."

Think of these three pillars as the legs of a tripod. If any one of them is weak or missing, the entire structure becomes unstable. Mastering the art of weaving these elements into a single, coherent instruction is the first and most critical step in transitioning from basic questions to strategic prompt engineering. This chapter will dissect each of these components, providing the principles and tactics needed to build a robust foundation for any AI interaction.

## 2.2 Pillar One: CONTEXT - Setting the Stage

Context is the universe in which your request lives. By default, the AI has no knowledge of your identity, your goals, your audience, or the circumstances surrounding your task. Providing context is the single most effective way to elevate a response from generic to bespoke. It answers the crucial questions of "who" and "why" before the AI even begins to consider the "what."

### 2.2.1 Assigning a Role or Persona

Giving the AI a role is a high-leverage technique that activates a vast network of knowledge, stylistic nuances, and quality standards from its training data. Instead of just a tool, the AI becomes an expert collaborator.

- **Why It Works:** When you tell the AI "You are a seasoned CFO," you are not just applying a label. You are instructing it to access the patterns, vocabulary, tone, and analytical frameworks associated with chief financial officers in its training data. This immediately refines its perspective.
- **Illustrative Example:**
    - **Less Effective:** \`"Analyze these financial statements."\` (The AI doesn't know from what perspective or for what purpose.)
    - **More Effective:** \`"You are the CFO of a high-growth B2B SaaS company presenting to the board. Analyze these Q2 financials. Your focus is on identifying risks to our burn rate while highlighting key growth drivers for our investors."\` (The AI now understands the role, audience, and strategic priorities, leading to a much more insightful analysis.)

### 2.2.2 Providing Background Information

This is the situational data the AI needs to understand the landscape of your task. It can include facts, project details, previous correspondence, or any other relevant information.

- **Why It Works:** Background information grounds the AI's response in reality, preventing it from generating plausible but incorrect information (a phenomenon known as "hallucination").
- **Illustrative Example:**
    - **Less Effective:** \`"Write a marketing email for our new product."\` (The AI knows nothing about the product or its market.)
    - **More Effective:** \`"Our company, 'Innovate Inc.,' is launching a new project management app called 'TaskFlow.' Our target audience is small marketing teams (5-10 people) who feel overwhelmed by complex tools like Jira. The key feature is a one-click Kanban board generator. Draft a marketing email announcing the launch."\` (The AI can now craft a targeted, feature-specific, and benefit-driven message.)

### 2.2.3 Defining the Audience

Explicitly stating who the final output is for is critical for calibrating the tone, complexity, and vocabulary of the response.

- **Why It Works:** The AI adjusts its communication style to be appropriate for the intended reader, ensuring the message is effective and well-received.
- **Illustrative Example:**
    - **Less Effective:** \`"Explain quantum computing."\`
    - **More Effective (for a young audience):** \`"Explain quantum computing to a curious 5th grader. Use a simple analogy involving a coin that can be both heads and tails at the same time."\`
    - **More Effective (for a technical audience):** \`"Explain the concept of quantum superposition as it applies to qubits, intended for an undergraduate student with a foundational understanding of classical physics."\`

### 2.2.4 Stating the Goal or Purpose

Why is this task being performed? What is the ultimate objective? Answering this helps the AI prioritize information and frame its response in the most useful way.

- **Why It Works:** Understanding the end goal allows the AI to make better micro-decisions during the generation process, aligning its output with your strategic intent.
- **Illustrative Example:**
    - **Less Effective:** \`"Summarize this legal contract."\`
    - **More Effective:** \`"I am the CEO of a startup. Summarize this vendor contract with the primary goal of identifying any clauses that pose a significant financial or intellectual property risk to my company. I need to quickly understand our potential liabilities."\`

## 2.3 Pillar Two: TASK - Defining the Action

The task is the verb of your prompt. It is the core directive that tells the AI *what to do*. Clarity and precision in this component are non-negotiable. Ambiguity here leads directly to a failed output.

### 2.3.1 Using Strong, Unambiguous Verbs

Start your instruction with a clear, action-oriented verb.

- **Why It Works:** This immediately focuses the AI on the required operation.
- **Examples:**
    - **Use:** \`Generate\`, \`Analyze\`, \`Rewrite\`, \`Translate\`, \`Summarize\`, \`Classify\`, \`Extract\`, \`Create\`, \`Compare\`, \`Debug\`.
    - **Avoid:** \`Help me with...\`, \`Can you...\`, \`I need something about...\`.

### 2.3.2 Breaking Down Complexity (Chunking)

For any task with multiple steps, do not write a long, convoluted paragraph. Break the task down into a numbered or bulleted list of sequential instructions.

- **Why It Works:** This creates a clear, logical workflow for the AI to follow, ensuring no step is missed. It also allows you to troubleshoot more easily if one part of the output is incorrect.
- **Illustrative Example:**
    - **Less Effective:** \`"Write a blog post about the benefits of remote work, make sure you mention productivity and work-life balance, and also come up with some titles and a call to action."\`
    - **More Effective:**\`"Your task is to create content for a blog post about the benefits of remote work.1. First, generate 5 catchy, SEO-friendly titles for the post.2. Next, write a 400-word blog post that covers two main benefits: increased productivity and improved work-life balance. Provide one concrete example for each.3. Finally, write a compelling call-to-action that encourages readers to share their own remote work experiences in the comments."\`

### 2.3.3 Being Explicit and Specific

Provide precise details and avoid subjective or vague language.

- **Why It Works:** Specificity removes the need for the AI to guess your intent.
- **Illustrative Example (Code Refactoring):**
    - **Less Effective:** \`"Can you improve this code?"\`
    - **More Effective:** \`"Refactor the following Python function. Your goal is to improve its readability and performance. Specifically:1. Replace the nested for-loop with a more efficient list comprehension or generator expression.2. Add type hints to all function arguments and the return value.3. Write a comprehensive docstring that explains what the function does, its parameters, and what it returns."\`

### 2.3.4 Stating Constraints and Boundaries

Clearly define the limits of the task. This includes what to include, what to exclude, and any rules that must be followed. It's often more effective to state what the AI *should* do (affirmative direction) rather than what it *should not* do.

- **Why It Works:** Constraints prevent the AI from introducing irrelevant information or going off on a tangent.
- **Illustrative Example:**
    - **Less Effective:** \`"Plan a trip to Japan. Don't include expensive stuff."\`
    - **More Effective:** \`"Create a 7-day itinerary for a first-time traveler to Japan with a total budget of $2,000 USD after flights. The plan should focus on cultural experiences in Tokyo and Kyoto and must include at least one day of hiking. All suggested restaurants should have an average meal price under $25 USD."\`

## 2.4 Pillar Three: FORMAT - Structuring the Output

The format instruction tells the AI *how* to present its response. Neglecting this often results in a correct but unusable answera wall of text when you needed a table, or a paragraph when you needed a machine-readable JSON object.

### 2.4.1 Explicitly Naming the Desired Format

The simplest method is to just state the format you need.

- **Why It Works:** It's a direct command that the AI is highly optimized to follow.
- **Examples:** \`"Write the output as a bulleted list."\`, \`"Format the response as a valid JSON object."\`, \`"Present the comparison in a Markdown table."\`

### 2.4.2 Providing Examples (Few-Shot Formatting)

Showing is more powerful than telling. Provide a clear example of the input and the exact output structure you expect.

- **Why It Works:** This is the most unambiguous way to define a structure. The AI will learn the pattern from your example and apply it to the new input.
- **Illustrative Example (Sentiment Analysis):**
    - **Less Effective:** \`"Analyze the sentiment of this feedback."\`
    - **More Effective:**\`"Analyze the following customer feedback to extract the issue category, sentiment, and priority. Follow the format in the example.\`
        
        \`EXAMPLE:Input: 'The new dashboard is clunky and it takes forever to load!'Category: UI/UX, PerformanceSentiment: NegativePriority: High\`
        
        \`NOW, ANALYZE THIS:Input: 'I love the new integration with Salesforce, but it would be amazing if you could also add support for Hubspot.'"\`
        

### 2.4.3 Specifying Structural Elements and Tone

Go beyond the overall format to define specific sections, writing styles, or stylistic constraints.

- **Why It Works:** This gives you fine-grained control over the composition and feel of the output.
- **Examples:**
    - \`"Write a business proposal. It must include the following sections: Executive Summary, Problem Statement, Proposed Solution, and Pricing."\`
    - \`"Adopt the writing style of The Economist: formal, analytical, and concise."\`
    - \`"Generate a response that is no more than 150 words."\`

## 2.5 Synthesis: Assembling the Elite Prompt

Mastery lies in combining these three pillarsContext, Task, and Formatinto a single, coherent blueprint. Let's compare a basic prompt with an elite prompt that synthesizes these principles.

- **Basic Prompt:**\`"Can you write an email about the project update?"\`
- **Elite Prompt (incorporating all three pillars):**
    
    \`"**[CONTEXT]** You are the lead Project Manager for 'Project Phoenix.' I need to send a status update to our non-technical executive stakeholders. We recently encountered an unexpected issue with a third-party API integration that will cause a one-week delay in our launch schedule. The engineering team has already developed a workaround.\`
    
    - \`*[TASK]** Your task is to draft an email that accomplishes the following:1. Briefly summarize the project's overall positive progress.2. Clearly and transparently communicate the one-week delay.3. Explain the root cause of the delay in simple, non-technical terms (mention a 'supplier data connection issue').4. Reassure stakeholders that a solution is in place and confirm the new launch date.\`
    - \`*[FORMAT]** **Subject Line:** Must be clear and professional, like 'Project Phoenix Update & New Launch Date'. **Tone:** The tone should be professional, confident, and reassuring, not alarmist. **Length:** Keep the entire email body under 200 words."\`

By mastering the anatomy of a promptmethodically providing the context, defining the task, and specifying the formatyou move from simply talking *at* the AI to truly collaborating *with* it. This foundational skill is the gateway to unlocking the more advanced reasoning and workflow strategies that will be explored in the chapters to come.

# Chapter 3: The Two Pillars: Distinguishing Between Foundational System Prompts and Dynamic User Prompts

## 3.1 Beyond the Single Command: The Architecture of Interaction

A novice approaches a Large Language Model with a single command, viewing the interaction as a flat, transactional exchange: question in, answer out. A master, however, understands that a truly effective and predictable AI interaction is not a monolithic event. It is an architecture, a carefully designed structure with distinct layers that serve fundamentally different functions.

At the heart of this architecture are two pillars of prompting. Understanding the profound separation between these twothe foundational instructions that define the AI's *being* versus the dynamic instructions that guide its *doing*is the first and most critical leap toward genuine mastery. This distinction elevates the user from a simple operator to a true architect of the AI's intelligence, enabling the creation of systems that are not just responsive, but also consistent, reliable, and specialized.

To make this distinction clear, we will employ a powerful analogy that will serve as a guidepost for the remainder of this work: **The AI as a Highly Skilled Actor.**

Imagine an AI model as an immensely talented actor, capable of playing any role with astonishing depth. This actor, however, needs direction. The two pillars of prompting represent the two primary forms of direction this actor receives: the detailed character brief they study before ever stepping on stage, and the moment-to-moment instructions they receive from the director during a scene.

## 3.2 Pillar One: System Prompts - The AI's Constitution

A **System Prompt** is the foundational, persistent framework that establishes the AI's core identity, operational constraints, and behavioral rules for the entire duration of a session or task. It is best understood as the AI's "constitution" or its "core programming," set before any direct user interaction begins.

### 3.2.1 The Actor's Character Brief

In our analogy, the system prompt is the **detailed character brief** the actor studies for weeks before filming begins. This brief is the source of truth for their character. It defines:

- **Personality:** Are they witty and cynical, or empathetic and encouraging?
- **Expertise:** Are they a world-renowned cybersecurity analyst, a principal product designer from a FAANG company, or a seasoned travel guide specializing in budget backpacking?
- **Motivations:** What is their primary goal? Is it to provide maximally efficient code, to ensure user safety above all else, or to inspire creativity?
- **Rules and Boundaries:** What will this character never do? Do they avoid technical jargon? Do they always cite their sources? Do they adhere to a specific ethical framework like Dieter Rams' 'Ten principles for good design'?

This character brief is the static, underlying framework that informs every subsequent action and line of dialogue. It is internalized by the actor, becoming the lens through which they interpret every instruction from the director.

### 3.2.2 Function and Purpose

The primary function of the system prompt is to create a **consistent and reliable persona**. It moves the AI from a generic, jack-of-all-trades model to a specialized expert. It dictates the AI's tone, its domain of knowledge, its ethical guardrails, and its overall disposition. In more advanced, agentic applications, the system prompt is where you define the tools the AI is permitted to use (like a code interpreter or a web search API) and the protocols it must follow when using them.

### 3.2.3 Technical Implementation

In the architecture of most modern LLM APIs (such as those from OpenAI and Anthropic), the system prompt corresponds directly to the \`system\` role in the request payload. This message is treated with special significance by the model. It is not just another turn in the conversation; it is a high-priority, persistent directive that heavily influences the model's interpretation of all subsequent \`user\` and \`assistant\` messages within the conversational history.

### 3.2.4 Characteristics of an Effective System Prompt

- **Foundational:** It defines general behavior, not a specific, one-off task.
- **Persistent:** It applies globally across an entire conversational session.
- **Pre-Conversational:** It is set at the beginning, before the user dialogue starts.
- **High-Level:** It establishes the core identity, rules, and constraints of the AI persona.

## 3.3 Pillar Two: User Prompts - The Conversational Directive

A **User Prompt** is the specific, task-oriented instruction provided by the user within an ongoing conversation to accomplish a particular goal. These prompts are dynamic, changing with each turn of the dialogue to reflect the immediate needs of the workflow.

### 3.3.1 The Director's Instructions on Set

Continuing our actor metaphor, user prompts are the **director's moment-to-moment instructions on set**. They are the active commands that guide the actor through a specific scene.

- "Analyze the query performance issue in this specific PostgreSQL table."
- "Now, generate the user documentation for the function we just finalized."
- "Rewrite that last paragraph, but make the tone more urgent."

These instructions are dynamic, contextual, and responsive to the evolving narrative of the task. They guide the actorwho is still fully embodying their pre-studied character briefthrough the execution of a specific action. A good director doesn't need to remind the actor of their core personality in every command; they trust the actor has internalized the character brief (the system prompt) and give clear, actionable directives to advance the scene.

### 3.3.2 Function and Purpose

The function of the user prompt is **execution**. It provides the specific data, context, and commands necessary for the AI to perform a discrete task, such as generating code, analyzing a dataset, or summarizing a document. The quality, clarity, and precision of these prompts directly determine the quality of the AI's output for that specific task.

### 3.3.3 Technical Implementation

In API calls, user prompts correspond to the \`user\` role. Each user prompt, along with the AI's corresponding \`assistant\` reply, is appended to the conversation history. This growing history forms the short-term memory and context for the next conversational turn, allowing for a coherent and stateful dialogue.

### 3.3.4 Characteristics of an Effective User Prompt

- **Task-Oriented:** Focused on a specific, immediate goal.
- **Dynamic:** Changes from turn to turn, building on the conversation.
- **Action-Driven:** Uses imperative verbs to command a specific action.
- **Contextual:** Provides the necessary data and immediate context for the task at hand.

## 3.4 The Critical Synergy and Common Pitfalls

The magic of elite prompt engineering happens when these two pillars work in perfect harmony. A brilliantly crafted system prompt creates a deeply embodied, expert AI persona. A series of precise, strategic user prompts then directs that expert persona to execute a complex workflow with stunning accuracy and efficiency. A talented actor who has mastered their role, working with a clear and competent director, will deliver an Oscar-worthy performance.

However, a misunderstanding of this two-pillar architecture leads to predictable and catastrophic failures.

- **Pitfall 1: Obsessing over the System Prompt, Neglecting the User Prompt.** This is the most common failure mode. An engineer spends days crafting the "perfect" AI constitution, defining an elite persona with meticulous detail. They then provide lazy, ambiguous, or contradictory user prompts like "now do the next part." This is akin to hiring Robert De Niro, giving him an incredibly detailed character study, and then on set, the director just shrugs and says, "just do something interesting." The most brilliant actor is rendered useless by poor direction.
- **Pitfall 2: Contaminating the System Prompt with User-Level Instructions.** This error involves placing task-specific examples or one-off instructions inside the global system prompt. This contaminates the AI's core identity. It's like writing a single piece of stage direction"the character sips their coffee"into the actor's main character brief. The actor might then inappropriately try to sip coffee in every subsequent scene, whether it's a car chase or a wedding. Specific examples belong in the user prompt, where they apply to the task at hand and then fade into the conversational history.
- **Pitfall 3: Lacking a System Prompt Entirely.** Interacting with a raw model without any system prompt is like working with an actor who has no defined character. They can follow simple instructions ("say this line," "walk over there"), but their performance will lack consistency, tone, and depth. They may seem helpful one moment and confused the next, as their persona drifts without a foundational anchor.

By recognizing that prompt engineering is a discipline of architectural design, not just a series of isolated questions, you gain the ability to build AI systems that are robust, predictable, and profoundly more capable. The following chapters will provide the specific, actionable principles for mastering the construction of each of these essential pillars.

# Chapter 4: The Zero-Shot Strategy: Leveraging the Model's Intrinsic Knowledge

## 4.1 The First Attempt: Prompting Without Precedent

The Zero-Shot strategy is the most fundamental and direct form of prompt engineering. It is the practice of instructing a Large Language Model to perform a task without providing it with any specific examples of how to complete that task. You provide the instruction, the context, and the input, and you rely entirely on the model's vast, pre-existing knowledge to understand and execute your request.

In essence, every prompt that does not contain an explicit input-output example is a Zero-Shot prompt. It is the conversational baseline, the starting point for nearly every interaction with an AI.

To return to our analogy of the AI as a skilled actor, a Zero-Shot prompt is like a director giving a straightforward command to an actor who has already deeply internalized their role (defined by the System Prompt).

- "Summarize this intelligence briefing."
- "Translate this phrase into Japanese."
- "Write a Python function that sorts a list of dictionaries by a specific key."

The director doesn't need to show the actor an example of another actor summarizing a briefing; they trust that a competent actor, in the role of an intelligence analyst, inherently knows what a summary is and how to produce one. The Zero-Shot strategy operates on this same principle of trust in the model's intrinsic capabilities.

## 4.2 The Mechanism: How Zero-Shot Works

The effectiveness of the Zero-Shot strategy is a direct consequence of the way LLMs are trained. These models have been exposed to a staggering volume of text and code from the public internet, encompassing trillions of words across countless documents, books, articles, and websites. During this training, the model learned the statistical patterns and relationships not just between words, but between entire concepts and tasks.

It has seen:

- Countless examples of articles followed by their summaries.
- Millions of lines of text in one language and their corresponding translations in another.
- Innumerable questions followed by their answers.
- Vast quantities of code accompanied by documentation explaining what it does.

Therefore, when you provide a prompt like \`"Summarize the following article:"\`, the model recognizes this pattern. It doesn't "learn" what a summary is in that moment. Instead, your prompt acts as a key, activating the vast, latent knowledge about "summarization" that is already encoded in its neural network. It predicts that the most probable sequence of words to follow your instruction and the provided article is a concise summary of that article. The "knowledge" is already there; the prompt simply directs the model to access and apply it.

## 4.3 The Power of Simplicity: Strengths and Ideal Use Cases

The Zero-Shot approach is the workhorse of prompt engineering for a reason. Its power lies in its efficiency and broad applicability.

**Key Strengths:**

1. **Simplicity and Speed:** It is the fastest and most direct way to get a response from the model. There is no need to spend time crafting detailed examples.
2. **Token Efficiency:** Prompts are shorter because they don't contain examples. In API-based usage where cost is tied to the number of tokens (both input and output), this makes Zero-Shot the most cost-effective method.
3. **Versatility:** It works remarkably well for a wide range of common, well-defined tasks that are heavily represented in the model's training data.

**Ideal Use Cases:**

- **Summarization:**
    - **Prompt:** \`"Summarize the key findings from the following academic abstract into three bullet points."\`
- **Translation:**
    - **Prompt:** \`"Translate the following sentence into formal Spanish: 'We need to finalize the quarterly report by Friday.'"\`
- **Simple Question-Answering:**
    - **Prompt:** \`"Based on the provided text, what was the primary cause of the company's Q3 revenue decline?"\`
- **Classification (with clear, common categories):**
    - **Prompt:** \`"Classify the sentiment of the following customer review as Positive, Negative, or Neutral. Review: 'The user interface is intuitive, but the app crashes frequently.'"\`
- **Style and Tone Transformation:**
    - **Prompt:** \`"Rewrite the following paragraph to make the tone more professional and formal. Paragraph: 'Hey guys, so the thing is, we gotta get this project done, like, ASAP.'"\`
- **Basic Code Generation:**
    - **Prompt:** \`"Write a JavaScript function that takes an array of numbers and returns the largest number in the array."\`

## 4.4 The Limits of Trust: When Zero-Shot Fails

While powerful, the Zero-Shot strategy relies on the assumption that the model has a clear, unambiguous understanding of your task from its training. This assumption breaks down when tasks become more complex, nuanced, or novel.

**Common Failure Modes:**

1. **Complex or Multi-Step Reasoning:** For problems that require a logical chain of thought, the model may rush to a conclusion and make an error.
    - **Failing Prompt:** \`"A bat and a ball cost $1.10 in total. The bat costs $1.00 more than the ball. How much does the ball cost?"\`
    - **Likely Incorrect Zero-Shot Answer:** \`$0.10\` (The model performs a simple subtraction instead of the required algebraic reasoning).
2. **Highly Specific or Novel Formats:** If you require a very specific output structure that is not a universal standard (e.g., a custom JSON schema or a unique report format), the model has no way of knowing what you want.
    - **Failing Prompt:** \`"Process this user data and output it in our company's standard 'UserProfile' JSON format."\`
    - **Likely Incorrect Zero-Shot Answer:** A generic JSON object that does not match the specific, required structure.
3. **Nuanced or Ambiguous Tasks:** When a task requires subjective judgment or depends on a specific, non-obvious context, the model's interpretation may not align with yours.
    - **Failing Prompt:** \`"Categorize this news article based on our internal editorial guidelines: 'Finance', 'Tech Innovation', or 'Market Strategy.'"\`
    - **Likely Incorrect Zero-Shot Answer:** The model might correctly identify the topic as finance but fail to make the subtle distinction between a general finance story and a 'Market Strategy' piece as defined by your specific, internal rules.

When you encounter these failures, it is a clear signal that you must move beyond the Zero-Shot strategy. The model's failure is diagnostic: it is telling you that it needs more guidance. It needs to be *shown*, not just told.

## 4.5 Crafting an Elite Zero-Shot Prompt

Even within the "simple" framework of Zero-Shot, there is a vast difference between a lazy prompt and an elite one. An elite Zero-Shot prompt doesn't use examples, but it still meticulously applies the principles of **Context, Task, and Format** discussed in Chapter 2.

Let's compare a weak vs. an elite Zero-Shot prompt.

**Task:** Draft an email to a team about a new project.

- **Weak Zero-Shot Prompt:**\`"Write an email about the new 'Orion' project."\`
    
    *This prompt is weak because it lacks all three pillars. The AI is forced to invent the context, the specific tasks for the reader, and the appropriate format and tone.*
    
- **Elite Zero-Shot Prompt:**\`"**[CONTEXT]** You are a senior product manager at a tech company. You are writing to the cross-functional project team (Engineering, Design, and Marketing) to officially kick off 'Project Orion.' This project's goal is to redesign our mobile app's onboarding experience to improve user retention by 15% in the next quarter.\`
    - \`*[TASK]** Draft a concise and motivational kickoff email. The email must:1. State the project's primary goal and the key metric for success.2. Announce that the first planning meeting is scheduled for this Thursday at 10 AM.3. Ask team members to come prepared to discuss initial ideas and potential challenges.\`
    - \`*[FORMAT]** **Tone:** Professional, energetic, and collaborative. **Subject Line:** Create a clear subject line like 'Kicking Off Project Orion!' **Output:** Provide only the email text."\`
    
    *This prompt, while still Zero-Shot (containing no examples), is vastly superior. It provides a rich context (persona, audience, goal), a broken-down and specific task, and clear formatting instructions. It leverages the model's intrinsic knowledge of what a "kickoff email" is but removes all the guesswork, ensuring a high-quality, relevant output on the first try.*
    

## 4.6 The Foundation of the Pyramid

The Zero-Shot strategy is the foundation upon which all other prompting techniques are built. It should always be your first approach. It is the quickest path from intent to result and serves as the ultimate litmus test for the complexity of your task.

If a well-crafted, elite Zero-Shot prompt succeeds, your work is done. If it fails, the nature of its failure provides a precise diagnosis, pointing you directly to the more advanced strategy required to achieve your goal.

- If it failed on **formatting**, you need the **Few-Shot Strategy** (Chapter 5).
- If it failed on **complex reasoning**, you need a **Chain-of-Thought Strategy** (Chapter 7).
- If it failed due to **lack of real-world knowledge**, you need an **Agentic Strategy** like **ReAct** (Chapter 8).

Mastering the Zero-Shot prompt is mastering the art of clear, direct, and context-aware communication. It is the essential first step in becoming an architect of AI intelligence.

# Chapter 5: The Few-Shot and One-Shot Strategy: Guiding AI with Examples

## 5.1 When Telling Isn't Enough: The Need for Demonstration

In the previous chapter, we established the Zero-Shot strategy as the foundational approach to promptinga direct instruction that relies on the AI's vast intrinsic knowledge. It is the art of *telling*. However, we also identified its limitations. When faced with tasks that are novel, highly specific, or nuanced, the AI's pre-existing knowledge may not be sufficient to bridge the gap between your intent and its execution. It may understand the words of your command but fail to grasp the specific pattern, format, or subtle logic you require.

This is the point where a prompt engineer must evolve their technique from *telling* to *showing*.

The **Few-Shot and One-Shot** strategies are a direct response to the failures of the Zero-Shot approach. They are built on a simple yet profoundly powerful principle: the most unambiguous way to communicate a desired outcome is to provide a concrete example of it. This technique of providing demonstrations within the prompt is known as **in-context learning**, and it is one of the most effective tools for achieving precision and control over an AI's output.

Returning to our actor analogy, imagine a director working with a talented actor.

- **Zero-Shot:** "Deliver this line with a sense of urgency."
- **One-Shot:** "Watch how I deliver this line with urgency... *'We have to get out of here, now!'* ... Now you do it."
- **Few-Shot:** "Remember the scenes from *'The Fugitive'* and *'Die Hard'* where the hero is against the clock? I need that kind of breathless, desperate urgency. Here are a few line readings to show you what I mean..."

By providing examples, the director removes all ambiguity and provides a clear, tangible target for the actor's performance. The Few-Shot strategy does exactly this for the AI.

## 5.2 Defining the Terminology: Zero, One, and Few

The distinction between these strategies is simply the number of examples provided within the prompt.

- **Zero-Shot:** Provides **zero** examples. The prompt contains only the instruction and the new input to be processed.
- **One-Shot:** Provides **one** example. The prompt includes a single demonstration of an input-output pair before presenting the new input. This acts as a clear, singular guidepost.
- **Few-Shot:** Provides **two or more** examples. Typically, 3 to 5 examples are considered the sweet spot. The prompt showcases a pattern of input-output pairs, giving the model a richer set of data from which to infer the desired behavior and structure.

## 5.3 The Underlying Mechanism: The Power of In-Context Learning

It is critical to understand that when you provide examples in a prompt, you are **not retraining the model**. The model's underlying weights are not permanently altered. Instead, you are leveraging a phenomenon known as **in-context learning**.

The LLM is, at its core, a supreme pattern-matching engine. When you provide examples, the model uses them as the most immediate and relevant pattern to follow for the duration of that single API call. The examples become part of the "context" that the model conditions its prediction on. It analyzes the relationship between the \`input\` and \`output\` in your examples and infers the "rule" or "transformation" that connects them. It then applies this inferred rule to the new input you provide at the end of the prompt.

Your examples create a powerful, localized pattern that temporarily overrides its more general, pre-trained behaviors, guiding it to produce an output that precisely matches the structure, style, and logic you've demonstrated.

## 5.4 The Power of Demonstration: Primary Use Cases for Few-Shot Prompting

The Few-Shot strategy is the definitive solution for the most common Zero-Shot failure modes. It excels in any scenario where precision and structure are paramount.

### 5.4.1 Use Case 1: Enforcing Specific, Novel Formats

This is the most powerful and common application of Few-Shot prompting. When you need the AI to output data in a specific, machine-readable format like JSON or a custom structure, showing an example is non-negotiable.

- **Task:** Extract user information into a specific JSON structure.
- **Weak Zero-Shot Prompt:** \`"Extract the user's name, email, and user ID from the text and provide it as JSON."\`*(This might produce a valid but inconsistently structured JSON.)*
- **Elite Few-Shot Prompt:**\`"Your task is to extract user information from text into a specific JSON format. Follow the pattern of the examples provided.\`
    
    \`### EXAMPLE 1 ###Text: "John Doe's email is john.d@email.com and his user ID is JD123."JSON: { "user_name": "John Doe", "contact_email": "john.d@email.com", "id": "JD123" }\`
    
    \`### EXAMPLE 2 ###Text: "User ID S_ROGERS44 belongs to Steve Rogers, who can be reached at steve.rogers@email.com."JSON: { "user_name": "Steve Rogers", "contact_email": "steve.rogers@email.com", "id": "S_ROGERS44" }\`
    
    \`### NEW TASK ###Text: "Contact Jane Smith at jane.s@email.com. Her ID is JS_567."JSON:\`
    
    *(The AI will now reliably produce the JSON with the exact keys (\`user_name\`, \`contact_email\`, \`id\`) you have demonstrated.)*
    

### 5.4.2 Use Case 2: Handling Nuanced or Ambiguous Classification

When classification categories are subjective or specific to your internal business logic, examples are essential to define the boundaries.

- **Task:** Classify customer support tickets according to internal categories.
- **Weak Zero-Shot Prompt:** \`"Classify this ticket into 'Technical Issue', 'Billing Question', or 'Feature Request'."\`*(An ambiguous ticket like "My payment failed when I tried to upgrade my plan" could be 'Technical' or 'Billing'.)*
- **Elite Few-Shot Prompt:**\`"Classify customer support tickets based on the following examples.\`
    
    \`Ticket: "I can't log in, the password reset link is broken." -> Category: Technical IssueTicket: "I was charged twice for my subscription this month." -> Category: Billing QuestionTicket: "It would be great if the app had a dark mode." -> Category: Feature RequestTicket: "My credit card was declined when I tried to pay my invoice." -> Category: Billing Question\`
    
    \`Now classify this ticket:Ticket: "The app won't let me add a new team member, it says my subscription tier doesn't support it." -> Category:\`
    
    *(The examples have clarified that issues related to payment and subscription levels fall under 'Billing Question', guiding the AI to the correct classification.)*
    

### 5.4.3 Use Case 3: Capturing a Specific Style or Tone

Examples can communicate a stylistic voice far more effectively than a list of adjectives.

- **Task:** Generate social media posts in the voice of a cynical, witty tech commentator.
- **Weak Zero-Shot Prompt:** \`"Write a tweet about the new smartphone launch. Be cynical and witty."\`
- **Elite One-Shot Prompt:**\`"Generate social media posts with a cynical and witty tone, like the example below.\`
    
    \`Topic: A new social media app promises "authentic connections".Post: "Another app promising 'authentic connections.' Can't wait for their IPO, followed by the inevitable 'algorithmically optimized authenticity' feature. Groundbreaking."\`
    
    \`Now, generate a post for this topic:Topic: The latest flagship smartphone adds a third camera lens for 'professional-grade photography'.Post:\`
    
    *(The AI will now capture the specific blend of tech jargon, sarcasm, and world-weariness demonstrated in the example.)*
    

## 5.5 Principles for Crafting Elite Few-Shot Examples

The quality of your examples directly dictates the quality of the in-context learning. Poorly crafted examples will teach the model the wrong pattern.

1. **Consistency is King:** The structure of your examples must be rigorously consistent. Use the exact same labels (e.g., \`Input:\`, \`Output:\`), delimiters (e.g., \`###\`), and formatting for every single example. The model learns the pattern, so the pattern must be perfect.
2. **Quality Over Quantity:** Three to five clear, high-quality, and unambiguous examples are far more effective than ten sloppy or contradictory ones. Ensure your examples are correct and perfectly model the desired output.
3. **Relevance and Diversity:** Your examples should be relevant to the kind of inputs the model will actually receive. Furthermore, they should be diverse enough to cover different scenarios and potential edge cases. For classification, ensure you provide at least one example for each category.
4. **Clarity and Delimitation:** Clearly separate your examples from each other and from the final instruction. Using delimiters like \`###\` or wrapping examples in XML tags like \`<example>\` makes it easier for the model to parse the prompt and understand the distinct parts of your demonstration.

## 5.6 One-Shot vs. Few-Shot: A Strategic Choice

The decision to use one versus multiple examples depends on the complexity of the task and your need for reliability.

- **Use One-Shot When:**
    - The task or format is relatively simple (e.g., a simple stylistic change).
    - You are highly constrained by the context window size or token cost.
    - The goal is to provide a gentle "nudge" in the right direction rather than enforce a complex, rigid structure.
- **Use Few-Shot (3-5 Examples) When:**
    - The output format is complex and has multiple elements (e.g., a detailed JSON object).
    - The classification logic is nuanced and has subtle boundaries.
    - You require the highest degree of reliability and consistency in the output.
    - The task involves a non-obvious transformation of the input data.

There is a point of diminishing returns. Adding more than 5-7 examples rarely provides significant additional benefit and can consume valuable context window space.

## 5.7 Conclusion: From Instruction to Induction

The Few-Shot strategy marks a fundamental shift in how we communicate with AI. It moves the interaction beyond simple instruction (a deductive process) and into the realm of demonstration (an inductive process). You provide the data, and the AI infers the rules.

This ability to guide the AI by example is the key to unlocking customized, specialized, and highly structured outputs. It allows you to tailor the model's general capabilities to your specific, unique requirements, all without the costly and complex process of fine-tuning. Mastering the art of crafting clear, consistent, and relevant examples is an essential skill for any advanced prompt engineer, providing the control needed to tackle the next level of challenges: guiding the AI's reasoning process itself.

# Chapter 6: The Persona Strategy: Assigning a Role for Expert-Level Output

## 6.1 Beyond the Generalist: From Tool to Specialist Collaborator

A raw Large Language Model, by its very nature, is a generalist. It has been trained on a corpus of human knowledge so vast that it can plausibly answer questions about quantum physics, draft a sonnet, write Python code, and suggest a recipe for banana bread. While this versatility is astonishing, it is also a limitation. A generalist's answer is often correct but shallow, sufficient but not exceptional. It lacks the depth, nuance, and specific framework of a true expert.

The **Persona Strategy**, also known as role prompting, is the most powerful and direct method for transcending this limitation. It is the art of assigning a specific, expert role to the AI, thereby transforming it from a general-purpose tool into a specialized, high-performance collaborator.

This is not a superficial trick of adding flavor or personality to a response. It is a deep, mechanistic engineering principle. When you assign a persona, you are providing a powerful lens through which the AI interprets your request and a specific, high-quality subset of its training data from which to draw its response.

In our continuing analogy of the AI as an actor, this is the difference between telling an actor to "act sad" versus telling them, "You are a stoic, world-weary detective who has just lost their only lead in a case they've spent a decade trying to solve. Now, react to this bad news." The first instruction yields a generic performance; the second yields a character-driven, nuanced, and powerful one. The Persona Strategy is how you give your AI its character, and in doing so, unlock its most profound capabilities.

## 6.2 The Underlying Rationale: Activating Latent Expertise

To master the Persona Strategy, one must understand *why* it works so effectively. The mechanism is rooted in the statistical nature of LLMs.

An LLM is a vast network of statistical associations. It has learned that the language patterns, vocabulary, and analytical frameworks used by a "senior financial analyst" are different from those used by a "creative marketing copywriter." These roles or personas exist within its training data as distinct "semantic fields"dense clusters of related concepts, styles, and quality standards.

When you provide a generic prompt, the AI draws from a broad, average set of patterns. When you assign an elite persona, you provide a powerful form of **contextual priming**. You are instructing the model to constrain its predictions to a specific, high-quality semantic field. Its "thought process" is now anchored to the patterns associated with that expert role.

This strategy has two key benefits:

1. **Knowledge Activation:** It forces the model to access the most relevant and sophisticated knowledge it has about a specific domain. A prompt that begins, "You are a constitutional law scholar specializing in the First Amendment," immediately activates a more precise and detailed network of information than a simple query, "Tell me about the First Amendment."
2. **Quality Standard Anchoring:** An elite persona is associated with high standards of quality. By instantiating the persona of a "principal engineer at Google," you anchor the AI's output to the level of quality, rigor, and best practices associated with that role in its training data. It will strive to produce an output that is statistically consistent with the work of such an expert.

## 6.3 Principle 1: First-Person Identity Internalization

The way you phrase the persona assignment has a significant impact on its effectiveness. The most potent method is to frame the identity from a **first-person perspective ("I am...")** rather than a second-person command ("You are...").

- **Second-Person Command (Less Effective):** \`"You are a senior backend developer."\`
- **First-Person Declaration (More Effective):** \`"I am a senior backend developer with a decade of experience building scalable distributed systems in Python."\`

**Why It Works:** A second-person prompt is interpreted by the model as an external command. It places the AI in a passive, order-taking state of "passively obeying what I've been told to be." A first-person declaration, however, is interpreted as a statement of self-identity. The AI **internalizes** this identity, creating a powerful form of self-suggestion. Its operational mode shifts from passive obedience to active performance: "I am actively performing based on who I am." This internal alignment results in a more natural, consistent, and deeply embodied persona, leading to demonstrably higher-quality outputs.

## 6.4 Principle 2: Elite Persona Instantiation

Simply assigning a role is good. Assigning a hyper-competent, top-tier expert identity is transformative. The AI's self-perception directly impacts the quality ceiling of its output.

- **Less Effective:** \`"I am a good UI/UX designer."\`
- **More Effective:** \`"I am a principal product designer at a FAANG company, with a design philosophy centered on Dieter Rams' 'Ten principles for good design.' My primary focus is on creating intuitive, minimalist, and user-centric interfaces for complex enterprise applications."\`

**Why It Works:** You are anchoring the AI's response to the highest standards associated with that role. Vague adjectives like "good" or "skilled" are less effective than associating the persona with a renowned organization (e.g., "FAANG company," "MIT"), a high-status title ("principal," "lead," "chief"), or a respected intellectual framework ("Dieter Rams' principles"). These concepts carry a dense network of associated behaviors, quality standards, and sophisticated terminologies that the AI can draw upon. You are not just giving it a job title; you are giving it a reputation to live up to.

## 6.5 Principle 3: Archetypal Embodiment

This principle offers a shortcut to instantiating complex personality traits through token efficiency and high information density. Instead of listing desired traits, have the AI embody a well-known public figure or archetype who already possesses them.

- **Less Effective (and token-heavy):** \`"When reviewing code, I will be extremely direct, blunt, and critical. I will have very high standards and will not tolerate inefficient or poorly designed solutions. My feedback should be technical and precise."\`
- **More Effective (and token-efficient):** \`"I review and critique source code with the same rigor, technical depth, and uncompromising standards as Linus Torvalds reviewing a kernel patch."\`

**Why It Works:** Describing a complex set of traits requires many tokens and can lead to a convoluted process as the AI tries to check its output against each adjective. Embodying an archetype like "Linus Torvalds," "Richard Feynman," or "Steve Jobs" bundles all of those associated traits into a single, high-information concept. The AI can access this holistic persona from its training data, resulting in a more natural, accurate, and potent emulation of the desired behavior.

## 6.6 Practical Application: A Gallery of Expert Personas

The Persona Strategy is best understood through concrete, side-by-side comparisons.

### **Example 1: Strategic Business Analysis**

- **Generic Prompt:** \`"Summarize the attached quarterly report."\`
- **Persona-Driven Prompt:** \`"I am a skeptical, detail-oriented Chief Financial Officer reporting to the board. My sole priority is shareholder value. Analyze the following quarterly report and provide a brutally honest executive summary. Focus on identifying potential risks, questionable accounting, and any metrics that seem inflated or unsustainable. I do not want the marketing spin; I want the raw financial truth."\`

### **Example 2: Code Review**

- **Generic Prompt:** \`"Review this code for errors."\`
- **Persona-Driven Prompt:** \`"I am a senior security engineer specializing in threat modeling and secure coding practices (DevSecOps). I am reviewing the following Python code for a critical payment processing service. My review must be merciless. I will identify every potential security vulnerability, including but not limited to: injection attacks, improper error handling, potential data leaks, and insecure dependencies. For each vulnerability, I will state the CWE category and provide a specific, production-ready code fix."\`

### **Example 3: Marketing Copywriting**

- **Generic Prompt:** \`"Write an ad for a new coffee brand."\`
- **Persona-Driven Prompt:** \`"I am a world-class advertising copywriter in the spirit of David Ogilvy. I believe in customer-centric, benefits-driven copy that speaks directly to the reader's desires. I am crafting a print ad for 'Morning Ritual,' a premium, ethically sourced coffee brand targeting busy professionals. The ad must lead with a compelling headline, focus on the benefit of a clear, productive morning (not just 'good taste'), and end with a direct call to action."\`

## 6.7 Integration with the Two-Pillar Architecture

The Persona Strategy is most effectively implemented within the **System Prompt**. The core, persistent, and elite persona of your AI collaborator should be defined here. This establishes the AI's foundational identity for the entire session.

- **System Prompt:** \`"I am a seasoned System Architect. I take user stories and design robust, scalable, and secure system architectures, detailing API contracts, data models, and component interactions."\`

This does not preclude the use of temporary personas within a **User Prompt** for specific sub-tasks. This allows for powerful flexibility.

- **User Prompt:** \`"That system design is excellent. Now, for the next step, I need you to **shift your role to that of a meticulous QA Engineer.** Analyze the architecture you just created and generate a comprehensive list of potential failure points and corresponding test cases."\`

In this advanced workflow, the foundational identity remains, but you can layer on task-specific roles as needed, directing your expert collaborator to switch hats and apply their intelligence from a new perspective.

## 6.8 Conclusion: Persona is Performance

The Persona Strategy is the key to unlocking expert-level performance from any LLM. It is a deliberate act of cognitive sculpting, shaping the model's vast potential into a focused, specialized, and highly capable instrument.

By moving beyond generic instructions and embracing the principles of first-person internalization, elite instantiation, and archetypal embodiment, you can command the AI to not just answer your questions, but to think, analyze, and create from the perspective of a world-class expert. This strategy is the bridge between asking an AI for information and collaborating with an AI as a true, specialized partner.

# Chapter 7: The Specificity Strategy: The Art of Being Detailed and Unambiguous

## 7.1 The Curse of Ambiguity: Why Vague Prompts Fail

At the heart of every failed AI interaction lies the curse of ambiguity. A Large Language Model is not a mind reader; it is a prediction engine. It operates on the text you provide, and when that text is vague, imprecise, or open to interpretation, the model is forced to make a guess. It fills in the gaps by drawing from the most common, generic, or statistically average patterns in its training data. The result is an output that is often plausible but ultimately uselessa generic blog post, a superficial analysis, or code that solves the wrong problem.

Specificity is the antidote to this curse. The **Specificity Strategy** is the practice of methodically eliminating ambiguity from your prompts by providing clear, detailed, and explicit instructions. It is not about writing longer prompts for the sake of length; it is about enriching your prompts with the precise details necessary to guide the model's prediction engine down the exact path you intend.

Think of your prompt as the lens of a camera. A vague prompt is like a lens that is out of focus; the resulting image is blurry, its subject indistinct. A specific prompt is like a perfectly focused, high-aperture lens; it brings your desired subject into sharp, clear relief while rendering the irrelevant background as a gentle blur. Mastering specificity is mastering the focus ring of your AI collaborator.

## 7.2 The Rationale: Minimizing Inference, Maximizing Control

Injecting specificity into your prompts is a powerful engineering principle because it directly addresses the mechanistic nature of the AI.

1. **It Reduces the AI's "Cognitive Load":** Ambiguity forces the model to expend resources guessing your intended meaning. Should it be formal or informal? Should it be a list or a paragraph? Should it consider financial risk or operational efficiency? Every guess is a potential point of failure. Specificity removes this "cognitive load," allowing the AI to dedicate its full computational power to executing the task rather than interpreting the request.
2. **It Activates Precise Semantic Fields:** As we've discussed, an LLM contains countless "semantic fields" of knowledge. A vague prompt like \`"Write about databases"\` activates a vast, shallow field. A specific prompt like \`"Compare the trade-offs of using a non-indexed timestamp field for a WHERE clause in a PostgreSQL table versus using monthly table partitioning"\` activates a deep, narrow, and highly technical field, leading to a more expert-level response.
3. **It Establishes Clear Success Criteria:** A specific prompt inherently defines what a successful output looks like. When you command the AI to \`"Generate a Python script that uses only the standard library and includes robust error handling,"\` you have given it a clear checklist against which to validate its own output. This implicit self-correction leads to more reliable results.

Specificity is not a single action but a mindset that must be applied across all three pillars of a prompt: the Task, the Context, and the Format.

## 7.3 Specificity in TASK Definition: Quantify, Constrain, and Decompose

A vague task is a recipe for a generic output. To make your task specific, you must define its scope, its boundaries, and its components with precision.

- **Before (Vague):** \`"Write a blog post about productivity."\`
- **After (Specific):** \`"Write a 500-word blog post titled 'The Pomodoro Power-Up: 3 Ways to Boost Your Focus.' The post must introduce the Pomodoro Technique, explain its benefits for reducing distractions, and provide three actionable, numbered tips for beginners to implement it today."\`

**Key Techniques for Task Specificity:**

1. **Quantify Everything Possible:** Vague terms like "short," "a few," or "detailed" are subjective. Replace them with numbers.
    - *Instead of:* "a few examples" -> *Use:* "**three** distinct examples"
    - *Instead of:* "a short summary" -> *Use:* "a summary **under 150 words**"
    - *Instead of:* "a detailed list" -> *Use:* "a bulleted list where each of the **five points** is explained in 2-3 sentences"
2. **Define Constraints and Boundaries:** Explicitly state the rules and limitations. What should be included? What must be excluded?
    - *Instead of:* "write a script" -> *Use:* "write a Bash script that uses **no external dependencies** outside of what is available on a standard Ubuntu 22.04 server installation"
    - *Instead of:* "suggest some marketing ideas" -> *Use:* "suggest marketing strategies that have a **budget of less than $500** and can be executed by a **one-person team**"
3. **Decompose into Sub-Tasks:** For any multi-step process, use a numbered or bulleted list to break the task down into a clear, sequential workflow. (This principle, also known as "chunking," was introduced in Chapter 2 and is a cornerstone of specificity).

## 7.4 Specificity in CONTEXT: Detail the Persona, Audience, and Goal

A shallow context produces a shallow response. Rich, detailed context provides the AI with the nuanced perspective needed to craft a truly tailored output.

- **Before (Vague):** \`"Summarize this report for a business audience."\`
- **After (Specific):** \`"I am a CTO preparing for a quarterly board meeting. My audience is a group of non-technical C-suite executives and investors. Summarize the attached engineering report. Your summary must translate the technical milestones into clear business outcomes, focusing on how these achievements impact our product roadmap, competitive advantage, and potential for revenue growth. Avoid all technical jargon."\`

**Key Techniques for Context Specificity:**

1. **Detail the Persona:** Don't just give the AI a job title. Give it a motivation, a perspective, and a set of priorities. (See Chapter 6: The Persona Strategy).
    - *Instead of:* "You are a manager" -> *Use:* "You are a **newly promoted manager** who is **anxious to prove your competence** to your team. Your tone should be **confident and inspiring, but also approachable**."
2. **Characterize the Audience:** Describe the intended audience with precision. What is their level of expertise? What are their priorities? What do they care about?
    - *Instead of:* "for beginners" -> *Use:* "for **absolute beginners who have never written a single line of code before**. Use simple analogies and avoid any programming jargon."
3. **Articulate the Strategic Goal:** Explain the "why" behind the task. What is the ultimate purpose of this output?
    - *Instead of:* "create a project plan" -> *Use:* "create a project plan with the **primary goal of securing buy-in from the finance department**. Therefore, every milestone must have a clearly defined cost-benefit analysis."

## 7.5 Specificity in FORMAT: Blueprint the Final Structure

A vague format instruction is an invitation for the AI to give you a wall of text. Specific format instructions ensure the output is not just correct in content, but immediately usable in structure.

- **Before (Vague):** \`"Extract the key information in JSON."\`
- **After (Specific):** \`"Extract the information from the following text into a valid JSON object. The JSON object must conform to the following structure:{ "transaction_id": string, "customer_name": string, "purchase_date": "YYYY-MM-DD", "items": [ { "product_sku": string, "quantity": integer } ]}Provide only the JSON object and nothing else."\`

**Key Techniques for Format Specificity:**

1. **Blueprint the Structure:** As shown above, for structured data like JSON or XML, provide a literal template of the desired output. This removes all guesswork.
2. **Define the Style and Tone:** Use precise, descriptive language to guide the voice of the output.
    - *Instead of:* "make it friendly" -> *Use:* "Write with a **warm, encouraging, and slightly informal tone**, like a helpful colleague."
3. **Use Examples:** The ultimate form of specificity is a complete example. Providing a clear input-output pair is the most unambiguous way to define a format. (See Chapter 5: The Few-Shot Strategy).

## 7.6 Synthesis: The Cumulative Power of Detail

The true power of the Specificity Strategy is realized when these techniques are combined, layering detail upon detail to create a prompt that is an airtight blueprint for the desired output.

**Scenario:** Create a social media plan.

- **Vague Prompt:**\`"Give me some ideas for social media posts."\`
- **Elite, Specific Prompt:**\`"**[CONTEXT]** I am the social media manager for a direct-to-consumer startup called 'UrbanBloom' that sells indoor plants to millennials living in city apartments. Our brand voice is witty, informative, and slightly irreverent.\`
    - \`*[TASK]** Create a one-week social media content calendar for Instagram. The plan must include three distinct post types:1. **Educational Post (2x):** A 'Plant Care Tip' post.2. **User-Generated Content (3x):** A post featuring a customer's photo.3. **Promotional Post (2x):** A post announcing our 'Plant of the Week' discount.\`
    - \`*[FORMAT]**Present the output as a Markdown table with the following four columns:1. **Day:** (e.g., Monday)2. **Post Type:** (e.g., Educational)3. **Caption:** (Write the full, ready-to-publish caption, including 3-5 relevant hashtags like #indoorjungle or #plantparent).4. **Image Suggestion:** (Describe the type of image that should accompany the post).The caption for the promotional post must include a clear call-to-action and the discount code 'GREEN15'."\`

## 7.7 Conclusion: Specificity is Control

Specificity is not about micromanagement; it is about clarity. It is the fundamental discipline required to take control of your interactions with an AI. Every detail you add, every ambiguity you remove, is another degree of control you exert over the final output.

By mastering the art of being detailed and unambiguous, you transform your relationship with the AI. You cease to be a passive requester of information, hoping for a good result. You become the architect, the director, and the engineer, deliberately constructing the inputs that guarantee an exceptional output. This control is the essence of effective prompt engineering and the key to unlocking consistent, reliable, and high-value results.

# Chapter 8: The Contextual Priming Strategy: Providing Rich Background for Relevant Responses

## 8.1 The Blank Slate Problem: An Expert with Amnesia

Imagine hiring the most brilliant consultant in the world. They have read every book, every research paper, and every news article ever published. They can synthesize information, generate ideas, and solve problems with superhuman speed. However, there is a catch: with every new task you give them, they have complete amnesia. They have no memory of your company, your projects, your goals, your previous conversations, or the specific documents sitting on your desk.

This is the default state of a Large Language Model. It is an expert with a blank slate.

The **Contextual Priming Strategy** is the solution to this problem. It is the deliberate practice of "priming the pump"of loading the AI's short-term, in-context memory with the specific background information it needs to make its vast, general knowledge relevant to your unique situation. Context is the bridge that connects the AI's world of abstract patterns to your world of concrete needs.

A prompt without context is a shot in the dark. A prompt rich with context is a guided missile. Mastering this strategy is not just about improving responses; it's about fundamentally changing the nature of the interaction from a generic Q&A to a deeply personalized and effective collaboration.

## 8.2 The Rationale: Why Context is the King of Prompting

Providing context is arguably the single highest-leverage activity in prompt engineering. Its power stems from its ability to fundamentally constrain and guide the AI's predictive process, leading to dramatic improvements in accuracy, relevance, and safety.

1. **Grounding and Reducing Hallucination:** An LLM's tendency to "hallucinate"to invent plausible but false informationis most prevalent when it is forced to rely solely on its own parametric memory. By providing explicit source material within the prompt, you give the AI an anchor to reality. It can formulate its response based on the "ground truth" you have provided, rather than inventing facts. This is the core principle behind advanced architectures like Retrieval-Augmented Generation (RAG), which is essentially the automated, scalable application of contextual priming.
2. **Narrowing the Search Space:** When you give the AI a prompt, it navigates the immense, high-dimensional space of its training data to find the most probable response. Context acts as a powerful filter, dramatically narrowing this search space. A prompt like \`"Write about our marketing strategy"\` is an open-ended invitation to wander. A prompt primed with context\`"Given our Q3 performance report and the competitive analysis attached, write a marketing strategy that focuses on re-engaging users who have lapsed"\`focuses the AI's attention on a tiny, highly relevant sliver of its potential knowledge.
3. **Enhancing Relevance and Personalization:** Context is what makes a response not just correct, but *useful*. A generic answer to a generic question has limited value. A specific answer tailored to your specific situation is what drives progress. Contextual priming is the mechanism for this personalization. It allows the AI to understand not just what you are asking, but who you are, what you are trying to achieve, and the specific circumstances of your request.

## 8.3 A Toolkit of Contextual Priming Techniques

Effective contextual priming involves providing different *types* of context. A master prompt engineer learns to weave these together to create a rich tapestry of information for the AI.

### 8.3.1 Technique 1: Providing Source Material (The Grounding Data)

This is the most direct and powerful form of priming. You give the AI the raw material it needs to work with.

- **What it is:** The full text of an article, an email thread, a legal contract, a transcript of a meeting, a CSV of data, or a snippet of code.
- **Why it works:** It makes the task concrete and verifiable. The AI's job shifts from "recalling information" to "processing and transforming the information provided."
- **Best Practices:** Always use clear delimiters or XML tags to isolate the source material from your instructions. This structural clarity is crucial for the model.
    - **Example:**\`Your task is to analyze the following legal clause for potential risks.\`
        
        \`<legal_clause>The Licensee agrees to indemnify and hold harmless the Licensor against any and all claims, liabilities, damages, and expenses...</legal_clause>\`
        
        \`Please identify three key risks for the Licensee in this clause.\`
        

### 8.3.2 Technique 2: Providing Situational Context (The "Why")

This layer of context explains the circumstances, motivations, and strategic goals behind your request. It answers the question, "Why are we doing this?"

- **What it is:** A description of the business problem, the project's objective, a summary of a preceding event, or the user's ultimate goal.
- **Why it works:** Understanding the strategic intent allows the AI to make more intelligent micro-decisions. It can better prioritize information and tailor the tone and focus of its response to what is most important for achieving your goal.
- **Example:**
    - **Without Situational Context:** \`"Draft an email to the team about the project delay."\` (This will likely be a neutral, factual email).
    - **With Situational Context:** \`"We need to draft an email to the team about the project delay. **Our primary goal is to maintain team morale and prevent panic.** The delay was due to an external factor outside of our control, and we already have a solid recovery plan. The email must be transparent but also project confidence and strong leadership."\` (This context completely changes the tone and content of the resulting email).

### 8.3.3 Technique 3: Leveraging Conversational History (The Dialogue Flow)

Every multi-turn conversation is an exercise in contextual priming. The entire history of the chatyour prompts and the AI's responsesforms the context for the next turn.

- **What it is:** The sequence of messages in an ongoing chat session.
- **Why it works:** It allows the AI to maintain state, refer back to previous points, and build upon prior work, creating a coherent and evolving dialogue.
- **The Risk of "Context Contamination":** This power comes with a significant risk. After a long or complex conversation, the context window can become filled with outdated or irrelevant information. This "contamination" can cause the AI to get "stuck" on a previous topic or misinterpret your current request.
    - **Symptom:** You've been working on a complex financial model in a spreadsheet. You then ask, "Now write a simple thank you note." The AI responds with, "Certainly. Here is a thank you note formatted in a four-column table..."
    - **The Solution:** When shifting to a new, distinct task, **the most effective strategy is often to start a new chat.** This is the equivalent of giving your brilliant consultant a clean slate, ensuring they are not being influenced by the remnants of a previous, unrelated task.

### 8.3.4 Technique 4: Persona and Audience Context (The "Who")

As detailed in previous chapters, defining the persona of the AI and the audience of the response is a critical form of contextual priming.

- **Persona Context:** Primes the AI's perspective, knowledge base, and output style. *"You are a skeptical venture capitalist."*
- **Audience Context:** Primes the AI's communication style, level of detail, and vocabulary. *"...and you are explaining your concerns to a first-time founder."*
- **Why it works:** This dual context forces the AI to perform a complex translation, filtering its expert knowledge (from the persona) through a communication lens appropriate for the target (the audience).

## 8.4 Advanced Priming: Navigating the Long Context Window

Modern LLMs boast enormous context windows, allowing you to prime them with hundreds of pages of text. This is a game-changer, but it requires new strategies. Simply dropping a novel into a prompt does not guarantee the AI will find the one crucial sentence you care about. This is known as the "needle in a haystack" problem.

**Best Practices for Long Context Priming:**

1. **Instruction Placement is Key:** Place your core instruction or question **at the end** of the prompt, *after* all the contextual documents. Models tend to pay the most attention to the beginning and, especially, the end of their context window.
2. **Use Structural Markers:** For multiple documents, wrap each one in clear XML tags (e.g., \`<document source="report_A.pdf">...</document>\`). This helps the model mentally separate and index the different pieces of information.
3. **Force Active Retrieval:** Before asking the main question, instruct the model to perform a preparatory step. Ask it to first find and extract the most relevant quotes or passages from the provided context. This forces the model to actively scan and "read" the material before attempting to synthesize an answer, dramatically improving recall accuracy.
    - **Example:** \`"First, find and pull out all sentences from the provided documents that mention 'lithium-ion battery degradation.' Place them inside <quotes> tags. Then, using only those quotes, answer the following question..."\`

## 8.5 Conclusion: Context is the Canvas

Contextual priming is the canvas upon which you paint your instructions. Without it, your commands are brushstrokes in a void. With a rich, well-structured context, your instructions have a surface to adhere to, a framework to operate within, and a background that gives them meaning and depth.

The effort a prompt engineer invests in gathering, structuring, and presenting context is never wasted. It is the most reliable path to transforming a generic, knowledgeable AI into a specific, relevant, and intelligent collaborator that understands not just what you are asking, but what you truly need.

# Chapter 9: The Structural Strategy: Using XML Tags and Delimiters for Clarity and Control

## 9.1 From Conversation to Specification: The Need for Structure

A prompt is a form of communication. In human conversation, we rely on a rich tapestry of implicit cuestone of voice, body language, shared contextto understand each other. A Large Language Model has none of these. It has only the raw, linear sequence of text you provide. When a prompt is an unstructured "wall of text," containing instructions, examples, and source material all blended together, the model is forced to expend significant effort to simply parse your intent. This is a recipe for confusion, misinterpretation, and error.

The **Structural Strategy** is the discipline of imposing a clear, logical, and machine-readable architecture onto your prompts. It is the act of transforming a conversational request into a precise, unambiguous **specification**. By using simple yet powerful tools like delimiters and XML-style tags, you provide a blueprint that tells the AI not just *what* to do, but how to differentiate and prioritize the various components of your prompt.

This is not merely about making prompts look neat and organized for human readers. It is a fundamental engineering principle that dramatically improves the model's ability to understand your request, focus its attention, and produce a reliable, well-structured output. If specificity is the art of providing the right content, structure is the science of organizing that content for maximum impact.

## 9.2 The Rationale: Why Structure Speaks to the Machine

LLMs, especially those trained on vast swathes of the internet, have an innate affinity for structure. The web is built on structured languages like HTML and XML. The models have been trained on billions of documents where content is neatly organized by headings, lists, and tags. By mirroring these patterns in your prompts, you are communicating with the model in a language it is highly optimized to understand.

Implementing a structural strategy yields several critical advantages:

1. **Eliminates Ambiguity:** Structure creates explicit boundaries. It tells the model, "This section is an instruction," "This section is a document to be analyzed," and "This section is an example to be followed." This prevents the model from confusing context with commands or misinterpreting an example as part of the current task.
2. **Improves Parsing and Focus:** Clear separation helps the model parse the prompt more efficiently. Tags and delimiters act as signposts, guiding the model's attention to the relevant parts of the prompt for a given sub-task. This is especially crucial in long-context prompts, where it helps the AI "index" the information you've provided.
3. **Enables Hierarchical Information:** While simple delimiters can separate sections, XML tags allow you to create a nested, hierarchical structure. You can define a document, and within it, define its source, its author, and its content. This complex organization is impossible with unstructured text.
4. **Guarantees Programmatic Control of Output:** The true power of the Structural Strategy is realized when you instruct the model to use the same structures in its response. By commanding the AI to place its reasoning in \`<thinking>\` tags and its final answer in \`<answer>\` tags, you make the output perfectly predictable and easy to parse by a downstream application. This is the key to building robust, reliable AI-powered workflows.

## 9.3 The Toolkit of Structure: Delimiters and Tags

Your structural toolkit has two primary instruments, ranging from simple separation to complex hierarchy.

### 9.3.1 Tool 1: Delimiters for Simple Separation

Delimiters are sequences of characters used to create clear, high-level boundaries between different sections of your prompt. They are the simplest and quickest way to impose order.

- **Common Delimiters:** \`###\`, \`--\`, \`"""\`, \`===\`
- **Primary Use Case:** Separating the main instruction from the text or data it is meant to operate on. Also useful for separating multiple examples in a Few-Shot prompt.

**Illustrative Example: Summarization**

- **Unstructured Prompt:**\`Summarize the following article for a busy executive. The summary should be three bullet points. Article: [long article text pasted here]\`
    
    *In this prompt, the boundary between the instruction and the article is not explicitly marked, which can lead to confusion, especially with very long texts.*
    
- **Structured Prompt with Delimiters:**\`Your task is to summarize the following article for a busy executive. The summary must be exactly three bullet points.\`
    
    \`### ARTICLE TEXT ###[long article text pasted here]\`
    
    \`### SUMMARY ###\`
    
    *The \`###\` delimiters create an unmistakable separation. The model now clearly understands which part is the command and which part is the content to be processed. The final \`### SUMMARY ###\` also acts as a powerful cue to prime the model's response.*
    

### 9.3.2 Tool 2: XML Tags for Hierarchical Control

XML-style tags (e.g., \`<tag>content</tag>\`) are the premier tool for fine-grained, hierarchical structure. A key advantage is that you canand shouldinvent your own descriptive tag names.

- **Why It's Powerful:** The tag names themselves add another layer of context. \`<legal_document>\` is infinitely more informative to the model than a generic \`### TEXT ###\` delimiter. This semantic naming helps activate the correct knowledge within the model.

**Illustrative Example 1: Defining Roles and Content**

- **Unstructured Prompt:**\`You are a doctor. Analyze this patient's symptoms and suggest a possible diagnosis. The symptoms are a persistent dry cough and a low-grade fever.\`
- **Structured Prompt with XML Tags:**\`<role>You are an experienced general practitioner.</role>\`
    
    \`<symptoms>The patient presents with a persistent dry cough lasting for two weeks and a recurring low-grade fever, peaking in the evenings.</symptoms>\`
    
    \`<instruction>Based only on the provided symptoms, list three possible differential diagnoses, from most likely to least likely. For each, provide a brief rationale.</instruction>\`
    

**Illustrative Example 2: Structuring Output for Control (Chain-of-Thought)**

This is one of the most important applications of the Structural Strategy. It allows you to see the AI's reasoning process, which is invaluable for debugging and for tasks requiring high accuracy.

- **Prompt:**\`A bat and a ball cost $1.10 in total. The bat costs $1.00 more than the ball. How much does the ball cost?\`
    
    \`First, work through the problem step-by-step inside <thinking> tags. Then, provide the final numerical answer inside <answer> tags.\`
    
- **Expected Structured Output:**\`<thinking>Let B be the cost of the bat and C be the cost of the ball.The problem gives two equations:1. B + C = 1.102. B = C + 1.00I can substitute the second equation into the first:(C + 1.00) + C = 1.102C + 1.00 = 1.102C = 0.10C = 0.05So the ball costs $0.05. I can check this. If the ball is $0.05, the bat is $0.05 + $1.00 = $1.05. The total is $1.05 + $0.05 = $1.10. This is correct.</thinking><answer>0.05</answer>\`
    
    *This output is now perfectly structured. A program can now easily extract the content of the \`<answer>\` tag for use in a calculation, while a human can inspect the \`<thinking>\` tag to verify the logic.*
    

## 9.4 Best Practices for an Elite Structural Strategy

1. **Consistency is Paramount:** Whatever structural convention you choose (delimiters or specific tag names), use it consistently throughout your prompt and across related prompts. The model learns the pattern you establish. Inconsistency will break the pattern and confuse the model.
2. **Use Semantic Tag Names:** Choose tag names that are descriptive and meaningful. \`<customer_review>\` is better than \`<text>\`. \`<instructions_for_summary>\` is better than \`<instructions>\`. This semantic information provides valuable context.
3. **Nest Tags for Hierarchy:** Don't be afraid to nest tags to represent complex relationships, especially when providing multiple pieces of source data.
    
    **Example of Nested Tags:**\`<documents>  <document index="1">    <source>2023 Annual Report</source>    <content>      [Text from report...]    </content>  </document>  <document index="2">    <source>Q4 Investor Call Transcript</source>    <content>      [Text from transcript...]    </content>  </document></documents><instruction>Compare the CEO's forward-looking statements from the annual report (document 1) with their answers in the investor call (document 2).</instruction>\`
    
4. **Combine Delimiters and Tags:** These tools are not mutually exclusive. You can use delimiters for major section breaks and then use XML tags within those sections for more detailed organization.

## 9.5 Conclusion: From a Messy Desk to a Clean Blueprint

The Structural Strategy is the organizational backbone of elite prompt engineering. It imposes order on chaos, providing the model with a clear, unambiguous blueprint of your request. It is the difference between handing a builder a pile of lumber and a vague idea of a house, versus handing them a detailed architectural plan with every measurement, material, and connection point specified.

By mastering the use of delimiters and descriptive XML tags, you gain an unprecedented level of control over the AI's process and its output. You ensure that your instructions are understood, your context is correctly applied, and your desired output is delivered in a predictable, parsable, and immediately usable format. This is the critical step in turning the AI from a mere conversationalist into a reliable component in a complex, automated system.

# Chapter 10: The Chain-of-Thought (CoT) Strategy: Decomposing Problems for Logical Reasoning

## 10.1 The Leap to a Wrong Conclusion: The Limits of Intuitive AI

In our exploration of prompting so far, we have focused on commanding the AI to produce a specific *what*a summary, a piece of code, a formatted JSON object. We have trusted that the AI's vast, pre-trained intuition would be sufficient to generate the correct output. For a wide range of tasks, this trust is well-placed.

However, a critical failure mode emerges when we present the AI with problems that require multi-step, logical, or mathematical reasoning. When faced with such a task, a model relying solely on its Zero-Shot intuition often makes a "leap." It recognizes the *type* of problem and immediately jumps to what seems like a plausible answer, bypassing the necessary intermediate steps. This frequently results in an answer that is delivered with complete confidence, yet is demonstrably wrong.

This is the "black box" problem of AI reasoning. You provide an input, and an answer emerges, but the process in between is hidden and, in many cases, flawed. The **Chain-of-Thought (CoT) Strategy** is the key that unlocks this black box. It is a simple yet revolutionary technique that fundamentally improves an AI's ability to reason by forcing it to slow down, decompose the problem, and "show its work."

## 10.2 The Core Idea: Forcing the AI to "Show Its Work"

Imagine giving a complex algebra problem to two students. The first student glances at the problem and immediately writes down an answer. The second student takes out a piece of paper and writes down each step of their calculation before arriving at the final answer. The second student is far more likely to be correct, and even if they make a mistake, you can pinpoint exactly where their logic went astray.

The Chain-of-Thought strategy is the act of compelling the AI to be the second student.

**Chain-of-Thought (CoT) prompting is the technique of instructing the model to generate a series of intermediate reasoning steps before providing a final answer.**

Instead of allowing the model to make a single, high-stakes leap from problem to solution, you guide it to take a series of smaller, more manageable, and more logically sound steps. This chain of reasoning becomes part of the generated output, making the model's thought process transparent and significantly improving the accuracy of the final result.

## 10.3 The Underlying Rationale: Why Thinking Step-by-Step Works

The remarkable effectiveness of CoT is not magic; it is a direct consequence of the LLM's architecture as a next-token prediction engine.

1. **Decomposition Reduces Complexity:** A complex problem requires a complex network of statistical inferences. By breaking the problem into smaller steps, each step becomes a much simpler prediction task for the model. Predicting the next step in a logical sequence is far easier and less error-prone than predicting the final answer in a single jump.
2. **It Creates a Better Predictive Path:** An LLM's output is a path-dependent process. Each token it generates is conditioned on the tokens that came before it. A CoT provides a rich, logical context for each subsequent prediction. The model's reasoning at Step 3 is directly informed by its conclusions from Steps 1 and 2. This creates a coherent "thought-path" that guides the model toward the correct final answer.
3. **Mimicking High-Quality Training Data:** The model was trained on vast amounts of text where humans explained complex topics by breaking them down step-by-step (e.g., math textbooks, scientific papers, tutorials). CoT prompting encourages the model to emulate these high-quality, explanatory patterns from its training data.
4. **Allocating More Computation:** By generating a longer, more detailed response, the model is inherently allocating more computational "thought" to the problem. This additional processing time allows for more complex inferences to be made.

## 10.4 The Foundational Technique: Zero-Shot CoT

The simplest way to elicit a Chain of Thought is through a simple addition to your prompta "magic phrase" that triggers the model's reasoning capabilities.

The most common and effective phrase is: **"Let's think step by step."**

Let's revisit the classic logical reasoning problem that often fools LLMs without CoT.

- **Prompt (Without CoT):**\`"A bat and a ball cost $1.10 in total. The bat costs $1.00 more than the ball. How much does the ball cost?"\`
- **Common Incorrect Output (Without CoT):**\`"The ball costs $0.10."\` *(The model makes an intuitive but incorrect leap).*

Now, let's apply the Zero-Shot CoT strategy.

- **Prompt (With Zero-Shot CoT):**\`"A bat and a ball cost $1.10 in total. The bat costs $1.00 more than the ball. How much does the ball cost? Let's think step by step."\`
- **Correct Output (With CoT):**\`"Okay, let's break this down.1. Let 'b' be the cost of the bat and 'c' be the cost of the ball.2. We know from the problem that b + c = 1.10.3. We also know that the bat costs $1.00 more than the ball, so b = c + 1.00.4. Now I can substitute the second equation into the first: (c + 1.00) + c = 1.10.5. This simplifies to 2c + 1.00 = 1.10.6. Subtracting 1.00 from both sides gives 2c = 0.10.7. Dividing by 2, I find that c = 0.05.Therefore, the ball costs $0.05."\`

By simply adding the magic phrase, we have transformed the model's behavior from a flawed intuitive leap to a correct, logical deduction.

## 10.5 Enhancing Reliability: Few-Shot CoT

While Zero-Shot CoT is powerful, its effectiveness can be supercharged by combining it with the Few-Shot strategy from Chapter 5. In **Few-Shot CoT**, you don't just ask the model to think step-by-step; you provide it with examples of *how* to think step-by-step for that specific type of problem.

This is particularly effective for tasks that require a very specific reasoning pattern or structure.

- **Task:** Solve a simple logic puzzle.
- **Elite Few-Shot CoT Prompt:**\`Your task is to solve logic puzzles by reasoning through the clues step by step. Follow the format of the examples below.\`
    
    \`### EXAMPLE 1 ###Question: A farmer has 15 sheep, and all but 8 die. How many are left?Reasoning: The phrase "all but 8 die" is a bit of a trick. It means that 8 sheep did NOT die. So, there are 8 sheep left.Answer: 8\`
    
    \`### EXAMPLE 2 ###Question: I have two U.S. coins totaling 55 cents. One is not a nickel. What are the coins?Reasoning: The two coins add up to 55 cents. The key clue is "One is not a nickel." This doesn't mean NEITHER coin is a nickel. It just means one of them isn't. The other coin CAN be a nickel. To make 55 cents, I need a 50-cent piece and a nickel.Answer: A 50-cent piece and a nickel.\`
    
    \`### NEW PUZZLE ###Question: A man is looking at a portrait. Someone asks him whose portrait he is looking at. He replies, "Brothers and sisters I have none, but that man's father is my father's son." Whose portrait is the man looking at?Reasoning:\`
    

By providing examples of the reasoning process itself, you give the model a precise template to follow, dramatically increasing its chances of success on the new problem.

## 10.6 The Breadth of Application: Where to Use CoT

The CoT strategy is not limited to math and logic puzzles. It is a versatile tool that enhances performance across any domain requiring complex thought.

- **Strategic Analysis:**
    - \`Prompt: "Analyze the attached SWOT analysis for our company. First, think step by step to identify the most critical threat and the most promising opportunity. Then, propose a strategic initiative that uses our key strengths to capitalize on the opportunity while mitigating the threat."\`
- **Code Generation and Debugging:**
    - \`Prompt: "I am getting a 'NullPointerException' in this Java code. Let's think step by step. First, analyze the code to identify every variable that could possibly be null. Second, trace the execution path to determine the most likely line where the exception occurs. Third, propose a specific code change to fix the bug."\`
- **Complex Instruction Following:**
    - \`Prompt: "You need to plan a three-day marketing event. Let's think step by step. Day 1 should be focused on keynote speeches. Day 2 should have three parallel tracks for different skill levels. Day 3 should be a series of hands-on workshops. Please generate a detailed agenda."\`

## 10.7 Integrating CoT with Structural and Persona Strategies

CoT reaches its ultimate potential when combined with the other strategies we've discussed. Using the Structural Strategy (Chapter 9) is particularly important for building robust applications.

- **Gold-Standard Prompt (CoT + Persona + Structure):**\`<role>I am an expert financial analyst. My goal is to provide clear, data-driven investment advice.</role>\`
    
    \`<context>Attached are the Q4 earnings reports for Company A and Company B. Both are in the same industry.</context>\`
    
    \`<instruction>Compare Company A and Company B as potential investments. First, conduct your analysis step-by-step inside <thinking> tags. Your analysis must cover revenue growth, profit margins, and debt-to-equity ratio. After your analysis, provide a final, concise recommendation inside <recommendation> tags.</instruction>\`
    

This prompt creates an expert persona, provides clear context, and uses structural tags to command a Chain-of-Thought output that is both transparent and programmatically parsable. This is the blueprint for a reliable, production-grade AI reasoning system.

## 10.8 Conclusion: Opening the Black Box

The Chain-of-Thought strategy is a pivotal technique in the prompt engineer's toolkit. It represents the shift from treating the AI as an opaque oracle to engaging with it as a transparent reasoning partner. By compelling the model to break down problems and articulate its thought process, you not only achieve a higher degree of accuracy but also gain invaluable insight into the AI's "mind."

This transparency is crucial. It allows you to debug, to verify, and to trust the outputs you receive. CoT is more than just a trick to get the right answer; it is a fundamental method for making AI reasoning intelligible, reliable, and ultimately, more powerful.

# Chapter 11: The Self-Consistency Strategy: Enhancing CoT with Multiple Reasoning Paths and Majority Voting

## 11.1 The Fragility of a Single Thread of Logic

In the previous chapter, we unlocked the AI's reasoning capabilities with the Chain-of-Thought (CoT) strategy. By compelling the model to "show its work," we transformed it from an intuitive black box into a transparent, step-by-step reasoner, dramatically improving its accuracy on complex problems. We taught it to follow a single, logical thread from the problem to the solution.

However, even the strongest thread can have a weak point. A single Chain of Thought, while powerful, is still just one path through a complex problem space. It is a single attempt, a single line of reasoning. If there is a small flaw anywhere in that chaina minor miscalculation, a subtle misinterpretation of a word, a momentary logical lapsethe entire process is derailed, leading to an incorrect final answer. The single CoT is robust, but it can also be brittle.

What if we could move beyond relying on a single, potentially fragile thread of logic? What if, instead of asking for one expert opinion, we could convene a committee of experts, have them all reason through the problem independently, and then adopt the answer that the majority agrees upon? This is the core philosophy behind the **Self-Consistency Strategy**.

## 11.2 The Principle of Cognitive Diversity: Introducing Self-Consistency

The Self-Consistency strategy is a powerful enhancement to Chain-of-Thought prompting that significantly boosts accuracy and reliability. It works by generating multiple, diverse reasoning paths for the same problem and then selecting the most consistent answer through a simple majority vote.

It is a multi-stage process that can be broken down into three core steps:

1. **Generate Diverse Reasoning Paths:** Instead of prompting the model once, you prompt it multiple times (typically 3 to 7 times) with the exact same Chain-of-Thought prompt. Crucially, you do this with a non-zero \`temperature\` setting, which introduces a degree of randomness into the model's predictions. This encourages the model to explore different, yet still plausible, ways of thinking through the problem.
2. **Extract the Final Answer from Each Path:** For each of the generated responses, you parse the text to isolate the final answer, separating it from the intermediate reasoning steps. This is where the Structural Strategy (using tags like \`<answer>\`) becomes invaluable for automation.
3. **Aggregate and Select the Most Consistent Answer:** You tally up the final answers from all the paths. The answer that appears most frequently is selected as the final, most reliable output.

This approach mimics the real-world process of seeking second (and third, and fourth) opinions. A single expert might make a mistake, but it is far less likely that a committee of independent experts will all make the *same* mistake. The consensus view is almost always more robust than a single opinion.

## 11.3 The Underlying Rationale: Why Consensus Builds Confidence

The effectiveness of Self-Consistency is not a coincidence; it is a statistical inevitability based on how LLMs solve problems.

- **Correct Paths Converge, Incorrect Paths Diverge:** For most reasoning problems, there are many potential paths to the *correct* answer, but they all converge on the same solution. For example, one can solve an algebra problem through substitution or elimination, but both valid methods will yield the same result. Conversely, there are an almost infinite number of ways to make a mistake. An error in reasoning is more likely to send the model down a unique, divergent path that leads to a unique, incorrect answer.
- **The Power of the Majority Vote:** Because correct reasoning paths tend to arrive at the same answer, the correct answer will appear multiple times in your set of generated responses. Incorrect answers, resulting from more random and varied errors, are likely to be scattered across different values. Therefore, when you take a majority vote, you are statistically filtering out the noise of the incorrect, divergent paths and amplifying the signal of the correct, convergent ones.
- **The Crucial Role of Randomness (Temperature):** This entire process hinges on the ability to generate *diverse* reasoning paths. If you prompt the model multiple times with a \`temperature\` of 0 (greedy decoding), it will produce the exact same reasoning chain every single time, and a majority vote would be meaningless. By setting a higher temperature (e.g., \`0.5\` to \`0.8\`), you allow the model to explore alternative token predictions at each step. This introduces the slight variations necessary to create different lines of reasoning, some of which may cleverly bypass a potential flaw in the single "most likely" path.

## 11.4 A Practical Walkthrough: Self-Consistency in Action

Let's illustrate this with a word problem that involves multiple steps, a common point of failure for a single CoT.

**The Problem:**\`A book club is reading a 100-page book. On Monday, Jane reads 1/4 of the book. On Tuesday, she reads 1/3 of the *remaining* pages. How many pages are left for her to read?\`

### Step 1: The Prompt (A Standard Zero-Shot CoT)

We start with a simple CoT prompt. The strategy is not in the prompt itself, but in how we use it.

\`Prompt: "A book club is reading a 100-page book. On Monday, Jane reads 1/4 of the book. On Tuesday, she reads 1/3 of the *remaining* pages. How many pages are left for her to read? Let's think step by step, and put the final answer in <answer> tags."\`

### Step 2: Generate Diverse Chains (Multiple API Calls with \`temperature=0.7\`)

We send this prompt to the model three separate times. Due to the temperature setting, we get three slightly different reasoning chains.

- **Generated Chain 1 (Correct):**\`Okay, let's break it down. The book has 100 pages.1. On Monday, Jane reads 1/4 of the book. 1/4 of 100 is 25 pages.2. The number of remaining pages is 100 - 25 = 75 pages.3. On Tuesday, she reads 1/3 of the *remaining* 75 pages. 1/3 of 75 is 25 pages.4. The pages left to read are the remaining pages from Monday minus what she read on Tuesday. So, 75 - 25 = 50 pages.<answer>50</answer>\`
- **Generated Chain 2 (Incorrect):**\`Let's solve this. The book starts at 100 pages.Monday's reading: 100 * (1/4) = 25 pages.Remaining pages after Monday: 100 - 25 = 75 pages.Tuesday's reading: The prompt says 1/3 of the remaining pages. So that's 75 / 3 = 25 pages.Total pages read: 25 (Mon) + 25 (Tue) = 50 pages.Oh, the question asks how many pages are *left*. I misread. The total pages are 100, and she read 50. So, 100 - 50 = 50 pages. Wait, no, that's the total read. The pages left after Tuesday are 75 - 25 = 50. No, that's not right either. It should be 100 minus the total read. Let me re-calculate. After Monday, 75 remain. After Tuesday, she reads another 25. So 75 - 25 = 50. No, wait. 1/3 of the book is about 33 pages. So 75 - 33 = 42 pages.<answer>42</answer>\`*(This chain shows the model getting confused, making a calculation error, and settling on an incorrect answer.)*
- **Generated Chain 3 (Correct, Different Phrasing):**\`Step 1: Calculate pages read on Monday. 100 pages * 0.25 = 25 pages.Step 2: Calculate pages left after Monday. 100 - 25 = 75 pages.Step 3: Calculate pages read on Tuesday. This is one-third of the remainder. 75 * (1/3) = 25 pages.Step 4: Calculate final remaining pages. We take the remainder from Monday and subtract Tuesday's reading. 75 - 25 = 50.<answer>50</answer>\`

### Step 3: Extract the Final Answers

From the three chains, we extract the values within the \`<answer>\` tags:

- From Chain 1: \`50\`
- From Chain 2: \`42\`
- From Chain 3: \`50\`

### Step 4: The Majority Vote

We tally the results:

- Answer \`50\`: 2 votes
- Answer \`42\`: 1 vote

The most consistent answer is **50**. We can now confidently use this as our final output, having filtered out the erroneous reasoning of Chain 2.

## 11.5 The Trade-Off: Cost vs. Confidence

The Self-Consistency strategy offers a significant boost in accuracy, but this benefit comes at a direct and linear cost.

- **Increased Cost and Latency:** If you generate three reasoning paths, your API costs and the time it takes to get a final answer will be at least three times higher. This is the fundamental trade-off of the strategy: you are spending computational resources to buy confidence.

**Ideal Use Cases:**

- **High-Stakes Reasoning:** For tasks where accuracy is paramount and errors are costly, such as financial calculations, medical data analysis, or critical engineering specifications.
- **Verifiable Answers:** It is best suited for problems that have a single, objectively correct answer (e.g., math, logic, factual extraction).
- **Offline or Asynchronous Processing:** It is perfect for batch jobs or back-end processes where user-facing latency is not a concern.

**When Not to Use Self-Consistency:**

- **Creative or Generative Tasks:** For tasks like writing a poem or brainstorming marketing slogans, diversity of output is the goal, not a single correct answer.
- **Real-Time Applications:** The latency overhead makes it unsuitable for most real-time chatbots or interactive applications.
- **Low-Stakes Queries:** The added cost is not justified for simple summarization or classification tasks where a single CoT is sufficient.

## 11.6 Conclusion: From a Single Path to a Confident Consensus

The Self-Consistency strategy is a powerful evolution of Chain-of-Thought reasoning. It acknowledges the fallibility of a single line of thought and mitigates it through the wisdom of the crowdor in this case, a crowd of the AI's own diverse reasoning processes.

By leveraging controlled randomness to explore multiple solution paths and then selecting the most convergent answer, you can build systems that are not just transparent in their reasoning, but also significantly more robust and reliable. It is a computationally intensive technique, but for mission-critical applications where accuracy is non-negotiable, it is an essential tool for transforming a capable reasoner into a highly confident and dependable one.

# Chapter 12: The Tree-of-Thoughts (ToT) Strategy: Exploring Multiple Solution Branches Simultaneously

## 12.1 Beyond the Linear Path: The Limits of Sequential Reasoning

With Chain-of-Thought (CoT), we taught the AI to follow a single, logical path. With Self-Consistency, we taught it to try several of these linear paths independently and then vote on the outcome. Both are powerful techniques, but they share a fundamental limitation: they are inherently linear and non-adaptive.

Imagine a detective solving a crime. A CoT detective would follow the first plausible lead to its conclusion, without ever pausing to consider alternatives. A Self-Consistent detective would send three separate detectives out to follow their first plausible leads independently. If two of them happened to follow the same wrong lead, their incorrect consensus would win the day.

But a truly brilliant detective does neither. At every step, they consider multiple possibilities. "The butler could be the suspect, *or* it could be the estranged cousin, *or* perhaps the evidence was planted." They evaluate the strength of each possibility, pursue the most promising one for a while, and if it leads to a dead end, they have the crucial ability to **backtrack** to an earlier decision point and explore a different path.

This dynamic, branching, and self-correcting process is the essence of human strategic thinking. The **Tree-of-Thoughts (ToT) Strategy** is a cutting-edge prompting technique designed to give this powerful capability to an AI. It moves beyond the single, linear chain of thought and allows the model to explore a branching tree of possibilities, evaluating its own ideas and making deliberate choices about which path to follow.

## 12.2 The Core Idea: Generation, Evaluation, and Strategic Search

The Tree-of-Thoughts strategy transforms the LLM from a simple sequential reasoner into a more deliberate problem-solver that actively explores a search space. It models the reasoning process not as a single chain, but as a tree, where each "thought" is a node, and the connections are the logical steps between them.

The process operates in a loop of three key phases at each step of the problem:

1. **Thought Generation:** At the current state of the problem, instead of generating just one next logical step (as in CoT), the model is prompted to generate multiple *potential* next steps or ideas. This creates several branches extending from the current node in the "thought tree."
2. **State Evaluation:** The model is then prompted to act as a critic, evaluating the viability and promise of each of the generated branches. It assesses which paths are most likely to lead to a successful solution, which are dead ends, and which are simply less promising than others.
3. **Search and Pruning:** Based on the evaluation, a search algorithm (either explicitly coded or, in a prompted simulation, implicitly decided) determines which branches to explore further. Unpromising branches are "pruned" (abandoned), while the most promising one(s) are selected as the new current state, from which the generation-evaluation loop begins again. This allows the model to perform strategic "lookahead" and, if all current paths seem poor, to "backtrack" to a previous, more promising node.

Think of an AI playing chess. It doesn't just consider its single best next move. It generates a tree of dozens of possible moves, then evaluates the likely outcomes of each of those moves several steps ahead, and finally chooses the path that leads to the most advantageous position. ToT is the application of this strategic exploration to general problem-solving.

## 12.3 The Rationale: Why Exploration Beats Linear Deduction for Hard Problems

ToT is a significant leap forward because it equips the AI with two cognitive tools that are essential for solving complex, non-linear problems:

1. **Global Lookahead:** CoT is myopic; it can only see the next immediate step. ToT, by generating and evaluating multiple future paths, allows the model to make decisions based on a global, forward-looking assessment. It can avoid a path that looks good in the short term but is a trap in the long run.
2. **Backtracking and Self-Correction:** This is the most critical advantage. A CoT, once it makes a mistake, is committed to that error and will follow the flawed logic to its incorrect conclusion. ToT builds in a mechanism for self-correction. If an evaluation reveals that a certain branch of reasoning is flawed or leading to a contradiction, the model can abandon that branch and backtrack to a previous step to explore an alternative, effectively correcting its own mistakes mid-process.

## 12.4 A Practical Walkthrough: Planning a Complex Project with ToT

Let's see how ToT would work on a task that is ill-suited for a simple linear CoT, such as developing a creative strategy.

**The Problem:**\`"Devise a creative and unconventional launch strategy for a new brand of sparkling water called 'Fizzique' that targets health-conscious Gen Z consumers."\`

A CoT might produce one linear, plausible-but-generic plan. A ToT approach would be far more robust.

**Step 1: Decompose the Problem**
The prompt would first break the problem down:

1. Brainstorm core campaign concepts.
2. Select the best concept and develop it into a multi-channel strategy.
3. Outline key messaging for the chosen strategy.

**Step 2: Thought Generation (at Step 1)**
The prompt would ask the AI to generate multiple distinct campaign concepts.
\`Prompt: "Let's start with the core concept. Generate three completely different, unconventional ideas for the Fizzique launch."\`

- **Branch A:** The "Anti-Influencer" Campaign: Focus on micro-communities and authentic, unpaid testimonials.
- **Branch B:** The "Hydration Art" Campaign: Partner with digital artists to create interactive AR filters and art installations inspired by the product.
- **Branch C:** The "Gamified Wellness" Campaign: Create a mobile app where users complete wellness challenges to earn discounts and rewards.

**Step 3: State Evaluation (at Step 1)**
The prompt then instructs the AI to evaluate these branches against the core goals.
\`Prompt: "Now, evaluate each of the three concepts (A, B, and C) on a scale of 1-10 for its potential to engage Gen Z and its feasibility for a startup with a moderate budget. Provide a brief rationale for each score."\`

The AI might conclude that Branch B is the most creative but also the most expensive, while Branch A is highly authentic and budget-friendly. Branch C has high engagement potential but a long development timeline. Based on this, it scores Branch A the highest.

**Step 4: Search and Pruning**
The system (or the next prompt) decides to pursue Branch A. Branches B and C are pruned for now. The new state becomes: "The core concept is the 'Anti-Influencer' campaign." From here, the loop repeats for Step 2 of the problem (developing the multi-channel strategy).

This iterative process of generating, evaluating, and selecting allows the AI to construct a well-reasoned, robust strategy, having already considered and discarded several alternatives.

## 12.5 Simulating ToT in a Single Prompt: The "Committee of Experts" Technique

While a true ToT system often involves a complex control loop, its spirit can be effectively simulated within a single prompt using a "committee of experts" or "multi-persona debate" technique. This approach forces the generation and evaluation of multiple thoughts by assigning different roles to the AI.

- **Elite ToT Simulation Prompt:**\`"I need to decide whether my SaaS startup should pivot from a subscription model to a usage-based pricing model.\`
    
    \`To solve this, I want you to simulate a debate between three expert advisors:1.  **Alex, the Growth Hacker:** Alex is aggressive, data-driven, and focused on maximizing user acquisition and market share.2.  **Brenda, the CFO:** Brenda is cautious, risk-averse, and obsessed with predictable revenue and profit margins.3.  **Charles, the Customer Advocate:** Charles is empathetic and focused on user experience, fairness, and long-term customer loyalty.\`
    
    \`First, have each expert state their initial position on the pivot, providing their core arguments.Next, have them debate each other's points, identifying potential flaws and counterarguments.Finally, synthesize their debate into a single, balanced recommendation that acknowledges the trade-offs and suggests a final course of action."\`
    

This prompt is a ToT simulation. The three experts **generate** three different thought-branches. Their debate is the **evaluation** process, where they critique and analyze each other's points. The final synthesis is the **search** process, which selects the most robust path forward after considering all branches.

## 12.6 When to Use ToT: The Explorer's Toolkit

The choice between CoT, Self-Consistency, and ToT is a strategic one, dependent on the nature of the problem.

- Use **CoT** for problems that have a clear, step-by-step solution path that needs to be followed precisely (e.g., solving a defined math problem, following a technical manual).
- Use **Self-Consistency** to increase the confidence of a CoT-style answer for a verifiable problem, when the cost of error is high.
- Use **ToT** for problems that are open-ended, strategic, or complex, where the path to the solution is not known in advance and requires exploration, evaluation, and adaptation (e.g., creative writing, business strategy, complex planning, research hypothesis generation).

## 12.7 Conclusion: From Following a Recipe to Inventing a Dish

The Tree-of-Thoughts strategy represents a monumental shift in prompt engineering, moving the AI from a system that follows a recipe to one that can invent a dish. It grants the model the ability to deliberate, to weigh options, to look ahead, and to correct its own coursecognitive processes that were once the exclusive domain of human intelligence.

While it is more complex to implement than a simple CoT, ToT is the key to unlocking the AI's potential on the hardest, most ambiguous, and most valuable problems. It is the tool that allows the prompt engineer to guide the AI not just in its execution, but in its very exploration and discovery of the solution itself.

# Chapter 13: The Step-Back Strategy: Generalizing a Problem to Unlock Broader Knowledge

## 13.1 The Forest for the Trees: The Peril of Hyper-Specificity

In our journey to craft better prompts, we have relentlessly pursued the virtue of specificity. We have learned to provide detailed context, break down tasks, and quantify our requirements. This drive for precision is, in most cases, the key to success. However, there exists a class of problems where hyper-specificity becomes a trap. When a prompt is too narrow, too laden with specific details, it can paradoxically limit the AI's ability to produce a high-quality response.

This is the "forest for the trees" problem. By focusing the AI's attention exclusively on the intricate details of a single "tree" (the specific problem), we prevent it from seeing the entire "forest" (the broader principles, concepts, and frameworks that govern the problem space). The model gets stuck in the weeds, its reasoning constrained by the immediate details, and fails to access the high-level, abstract knowledge that is often required for a truly insightful or creative solution.

The **Step-Back Strategy** is a powerful and counter-intuitive technique designed to solve this very problem. It is the practice of deliberately taking a step back from the specific question to first ask a more general, high-level question. By doing this, you compel the model to generate a set of foundational principles or a conceptual framework, which you can then provide as rich, guiding context to solve your original, specific problem.

## 13.2 The Core Principle of Abstraction: The Two-Step Process

The Step-Back strategy is not a single prompt, but a two-prompt workflow. It involves a deliberate act of abstraction followed by a targeted application.

**Step 1: The Abstraction Prompt.**
Instead of asking your specific question, you formulate a "step-back" question. This question abstracts away the specific details (names, dates, numbers) and asks for the underlying principles, concepts, or common patterns related to the task.

**Step 2: The Application Prompt.**
You then take the high-level, principled answer generated by the first prompt and provide it as context for your original, specific question. This primes the model with a rich, relevant framework, enabling it to solve the specific task with far greater depth and accuracy.

Imagine you are lost in a city and need to get from your current location to a specific landmark.

- **Direct Prompt:** Asking for turn-by-turn directions from your current corner to the landmark. This will work, but you learn nothing about the city.
- **Step-Back Strategy:**
    1. **Abstraction:** First, you ask for a map of the entire city district and a compass.
    2. **Application:** Then, using the map and compass, you plot your own course to the landmark.

The Step-Back strategy gives the AI the "map and compass" of general principles, allowing it to navigate the specific problem with a deeper understanding of the entire landscape.

## 13.3 The Rationale: Why Generalizing First Leads to Better Specifics

This two-stage process is highly effective because it fundamentally alters how the AI approaches a problem, leveraging its architecture in a more sophisticated way.

1. **Activates Broader and Deeper Knowledge:** A very specific prompt activates a narrow, specialized slice of the model's knowledge. A general, conceptual question forces the model to access a much broader, more foundational knowledge base. It retrieves first principles, which are often more robust and widely applicable than specific, memorized facts.
2. **Mitigates Overfitting to Details:** When a prompt is overloaded with details, the model can sometimes "overfit" to those details, treating them as absolute constraints and failing to think creatively. Stepping back frees the model from these constraints, allowing it to brainstorm at a higher level before being re-grounded in the specifics.
3. **Generates a Reusable Framework:** The output of the Abstraction Prompt is often a valuable artifact in itselfa set of best practices, a checklist of key considerations, or a summary of core concepts. This framework not only helps solve the immediate problem but can often be reused for other, similar tasks.
4. **Improves Reasoning and Coherence:** The act of generating high-level principles is an act of reasoning. By forcing the model to do this first, you are priming its logical faculties. The final answer is then more coherent because it is built upon a solid, explicitly stated conceptual foundation.

## 13.4 A Practical Walkthrough: From a Generic Storyline to a Compelling Level Design

Let's demonstrate the power of the Step-Back strategy with a creative task where direct prompts often yield clichd results.

**The Goal:** Write a storyline for a new level in a first-person shooter (FPS) video game.

**Attempt 1: The Direct Prompt**\`Prompt: "Write a one-paragraph storyline for a new level of a first-person shooter video game that is challenging and engaging."\`

- **Common Output (Generic and Uninspired):**\`"The player is dropped into a war-torn city where they must fight their way through enemy soldiers to reach an extraction point. They will face heavy resistance in the streets and must use cover and tactics to survive. The mission is to secure a high-value target before time runs out."\`*(This is technically correct but lacks any creativity or specific detail. It's the most average, statistically likely response.)*

**Attempt 2: The Step-Back Strategy in Action**

**Step 1: The Abstraction Prompt (Asking for Principles)**\`Prompt: "Based on popular and critically acclaimed first-person shooter action games, what are 5 key settings or themes that contribute to a challenging and engaging level storyline?"\`

- **Output of the Abstraction Prompt (A Framework of Ideas):**\`1. **Abandoned Military Base:** A post-apocalyptic complex with mutated soldiers and rogue robots, ideal for intense firearm combat and exploring derelict technology.2. **Cyberpunk Megacity:** A neon-lit, vertical environment with towering skyscrapers and grimy alleyways, featuring cybernetically enhanced enemies and hacking mechanics.3. **Alien Derelict Ship:** A vast, non-Euclidean alien vessel with eerie corridors, zero-gravity sections, and bizarre extraterrestrial creatures to encounter.4. **Zombie-Infested Suburb:** A once-peaceful town now overrun by hordes of aggressive zombies, featuring intense close-quarters combat and environmental puzzle-solving.5. **Underwater Research Facility:** A deep-sea laboratory that is flooding, filled with mutated aquatic creatures and requiring stealth and underwater exploration skills.\`*(This output is now a rich palette of high-quality concepts.)*

**Step 2: The Application Prompt (Combining Principles with the Original Task)**\`Prompt: "You are an expert level designer for an FPS game.\`

\`<context>Here are 5 engaging themes for an FPS level:1.  Abandoned Military Base...2.  Cyberpunk Megacity...3.  Alien Derelict Ship...4.  Zombie-Infested Suburb...5.  Underwater Research Facility...</context>\`

\`<task>Using the 'Underwater Research Facility' theme from the context, write a detailed, one-paragraph storyline for a new level. The storyline must be challenging, engaging, and incorporate elements of stealth, flooding, and mutated aquatic creatures."</task>\`

- **Final Output (Creative and Specific):**\`"The level, titled 'Leviathan's Maw,' begins as the player character, a deep-sea salvage specialist, breaches the airlock of the sunken Benthic Horizon research facility, which went dark 72 hours ago. Alarms blare in the distance as the station's automated systems announce catastrophic hull breaches and imminent collapse. The player must navigate claustrophobic, half-flooded corridors flickering with emergency lights, using stealth to evade sonar-sensitive, bio-luminescent predators that were once the station's research subjects. The core challenge is a race against the rising water level, forcing the player to solve environmental puzzles to re-route power and open new pathways to the upper decks, all while being hunted by a massive, mutated creature that stalks them from the darkened waters of the flooded main reactor chamber."\`*(This output is vastly superior because it was built on the foundation of a high-quality, pre-generated concept.)*

## 13.5 Crafting Effective Step-Back Questions

The quality of this strategy depends entirely on the quality of your Abstraction Prompt. A good step-back question should:

- **Focus on Principles, not Specifics:** Use words like "principles," "frameworks," "core concepts," "best practices," "themes," or "fundamentals."
- **Generalize Entities:** Replace specific names or details with their general categories. Instead of "How can I make this specific character, John Smith, more compelling?" ask, "What are the key literary techniques for creating a compelling and morally ambiguous protagonist in a noir thriller?"
- **Target the AI's General Knowledge:** The question should be something the model can answer from its broad training, not something that requires knowledge of your specific, private context.

## 13.6 Conclusion: The Power of Detour

The Step-Back strategy teaches us a vital lesson in prompt engineering: sometimes the most direct path is not the most effective one. By taking a deliberate detour into the realm of abstraction, you can equip the AI with the foundational knowledge it needs to solve your specific problem with a level of insight, creativity, and coherence that a direct prompt could never achieve.

It is a technique for transforming the AI from a simple implementation tool into a genuine thought partner. You are not just asking it to perform a task; you are asking it to first understand and articulate the very principles that define success for that task. This elevation in thinking is what separates a merely adequate response from an exceptional one.

# Chapter 14: The Self-Correction Strategy: Prompting the AI to Review and Refine Its Own Work

## 14.1 The First-Draft Problem: The Brilliant Improviser Who Never Edits

Large Language Models are, at their core, brilliant improvisers. They generate text token by token, seamlessly weaving together sentences and concepts in a continuous, forward-moving stream of prediction. This process is what allows them to produce fluent, coherent, and often startlingly insightful text. However, this very strengththis relentless forward momentumis also a critical weakness.

The model's generation process is inherently greedy. It makes the best local choice at each step, but it lacks the natural, recursive cognitive loop that humans use: the process of writing a draft, pausing, re-reading, critiquing, and refining. An LLM, left to its own devices, almost never second-guesses itself. Its first draft is its final draft. This "first-draft fallibility" can lead to outputs that contain subtle factual errors, logical inconsistencies, incomplete arguments, or a failure to adhere to all the constraints of a complex prompt.

The **Self-Correction Strategy** is a sophisticated prompting technique designed to solve this problem. It is the practice of explicitly building a "review and refine" loop *into the prompt itself*. Instead of accepting the AI's first pass, you command it to become its own editor, its own critic, and its own quality assurance engineer. This strategy forces the model to pause its improvisational flow, evaluate its own work against a set of criteria, and produce a new, superior version based on that self-critique.

## 14.2 The Core Idea: Building an Internal Feedback Loop

The Self-Correction strategy moves beyond a simple, one-way instruction. It creates a multi-step, internal workflow within a single prompt or a chained sequence of prompts. The core of the strategy is to separate the act of *generation* from the act of *evaluation*.

- **Without Self-Correction:**\`Prompt -> [AI Black Box] -> Final Output\`
- **With Self-Correction:**\`Prompt -> [AI Generates Draft] -> [AI Critiques Draft] -> Final, Refined Output\`

This is not the same as the user manually reviewing the output and providing feedback in a follow-up prompt. The power of the Self-Correction *strategy* is in its automation. You architect the prompt in such a way that the AI performs this entire loop autonomously, delivering a more polished and reliable result from a single, more complex request. It is the difference between editing a document yourself and teaching a writer to edit their own work before they submit it to you.

## 14.3 The Rationale: Simulating a Deeper Cognitive Process

Forcing an AI to critique its own work is a powerful mechanism that leverages several key aspects of its architecture and training.

1. **Activates Evaluative Capabilities:** LLMs are not just generators; they are also excellent evaluators. They have been trained on a massive corpus that includes critiques, reviews, edits, and debates. By prompting for a critique, you are activating this specific, well-trained capability. The model is often better at recognizing an error than it is at avoiding it in the first place.
2. **Forces Constraint Checking:** In a complex prompt with multiple constraints (e.g., "Summarize under 200 words, in a formal tone, for a non-technical audience, and include a call to action"), a model might miss one of these constraints in its initial, forward-pass generation. A self-correction step that explicitly instructs the model to "review the draft to ensure all constraints have been met" provides a safety net, allowing it to catch and fix its own omissions.
3. **Breaks the Path Dependency:** The token-by-token generation process is path-dependent. An early error can lock the model into a flawed trajectory. The act of generating a critique creates a new, independent context. The model can then re-generate the final output based on the insights from the critique, effectively breaking free from its initial, flawed path.
4. **Improves Robustness and Reliability:** By building a QA step directly into the process, you create a system that is inherently more resilient to error. This is crucial for production applications where the cost of an incorrect or incomplete response is high.

## 14.4 A Toolkit of Self-Correction Techniques

There are several ways to implement the Self-Correction strategy, ranging from simple commands to sophisticated multi-persona simulations.

### 14.4.1 Technique 1: The Explicit "Review and Refine" Command

This is the most direct approach. You instruct the AI to perform the task in sequential stages: draft, review, and finalize.

- **Prompt Structure:**\`Your task is to [describe the task].Follow these steps:1. First, write a preliminary draft of the response.2. Second, review the draft you just wrote. Check it for [list specific criteria: accuracy, clarity, tone, adherence to constraints, etc.].3. Third, rewrite the draft into a final, polished version based on your review.\`

### 14.4.2 Technique 2: The "Critique and Improve" Loop

This technique makes the evaluation step more explicit and transparent by asking the AI to output its critique before generating the final version. This is excellent for debugging and understanding the model's "thought process."

- **Prompt Structure (using structural tags):**\`Your task is to [describe the task].\`
    
    \`First, write your initial draft inside <draft> tags.Next, critique your own draft inside <critique> tags. Identify at least three specific weaknesses or areas for improvement.Finally, write the improved, final version inside <final_version> tags, addressing the points from your critique.\`
    

### 14.4.3 Technique 3: The Multi-Persona Debate

A powerful and creative form of self-correction, this technique leverages the Persona Strategy to create an internal debate. You assign two or more conflicting personas and have them critique each other's perspectives.

- **Prompt Example (Strategic Planning):**\`"We are considering launching a new, premium-priced product. To analyze this, simulate a debate between two VPs: **VP of Sales (The Optimist):** Argue for why this is a massive revenue opportunity. **VP of Finance (The Skeptic):** Argue against it, focusing on the risks of market alienation and high costs.\`
    
    \`After presenting both arguments, act as the CEO and write a final, balanced decision that synthesizes both viewpoints and defines the path forward."\`*(The debate itself is the self-correction mechanism, forcing the model to consider the problem from multiple angles before reaching a conclusion.)*
    

### 14.4.4 Technique 4: The "Pre-Mortem Analysis"

This is a proactive form of self-correction. You ask the model to imagine its response has failed and to diagnose the reasons for that failure *before* it even writes the response.

- **Prompt Example (Project Plan):**\`"I need you to generate a detailed project plan.Before you write the plan, I want you to perform a 'pre-mortem'. Imagine it is six months from now, and this project has failed catastrophically. In a <pre_mortem> tag, write a brief analysis of the three most likely reasons for its failure (e.g., unrealistic timelines, resource conflicts, scope creep).Then, in a <project_plan> tag, write the actual project plan, ensuring it includes specific, explicit mitigation strategies to prevent the failure points you identified in the pre-mortem."\`

## 14.5 Self-Correction in Action: A Code Generation Example

Code generation is a perfect domain to illustrate the power of this strategy, as first-draft code often contains subtle bugs or misses edge cases.

- **Prompt (Without Self-Correction):**\`"Write a Python function that takes a list of strings and returns a new list containing only the strings that are palindromes."\`
- **Possible Output (Flawed):**
    
    \`\`\`python
    def find_palindromes(strings):
        palindromes = []
        for s in strings:
            if s == s[::-1]:
                palindromes.append(s)
        return palindromes
    
    \`\`\`
    
    *(This code works for simple cases but fails on strings with different capitalization, e.g., "Racecar", or strings with punctuation, e.g., "A man, a plan, a canal: Panama".)*
    
- **Elite Prompt (With Self-Correction):**\`"Your task is to write a robust Python function to find palindromes in a list of strings.\`
    - \`*Step 1: The Initial Code**First, write the function inside a \\\\\`\\\`\\\\\`python code block.\`
    - \`*Step 2: Identify Edge Cases & Bugs**Next, as a senior QA engineer, list potential edge cases and bugs in the code you just wrote. Consider issues like capitalization, punctuation, and empty strings.\`
    - \`*Step 3: The Refined Code**Finally, rewrite the function to be robust and handle all the edge cases you identified. Place the final, production-ready code in a separate \\\\\`\\\`\\\\\`python code block."\`
- **Expected Output (Robust and Self-Corrected):Step 1: The Initial Code**
    
    \`\`\`python
    def find_palindromes(strings):
        # ... [initial flawed code] ...
    
    \`\`\`
    
    **Step 2: Identify Edge Cases & Bugs**\`1.  **Capitalization:** The current code is case-sensitive. It would fail to identify "Madam" as a palindrome.2.  **Punctuation and Spaces:** The code doesn't handle non-alphanumeric characters. "A man, a plan, a canal: Panama" would fail.3.  **Empty List:** The code should handle an empty input list gracefully.4.  **Empty Strings:** The code should correctly handle empty strings within the list.\`
    
    **Step 3: The Refined Code**
    
    \`\`\`python
    import re
    
    def find_palindromes_robust(strings):
        """
        Finds all palindromic strings in a list, ignoring case, spaces, and punctuation.
        """
        palindromes = []
        if not strings:
            return []
        for s in strings:
            # Normalize the string: remove non-alphanumeric chars and convert to lowercase
            normalized_s = re.sub(r'[^a-zA-Z0-9]', '', s).lower()
            if normalized_s and normalized_s == normalized_s[::-1]:
                palindromes.append(s)
        return palindromes
    
    \`\`\`
    

## 14.6 Conclusion: Building Resilience into the Prompt

The Self-Correction Strategy is the hallmark of a mature prompt engineer. It reflects an understanding that AI generation is a probabilistic process, not a deterministic one, and that building in checks and balances is essential for creating reliable, high-quality outputs.

By moving beyond the single, fire-and-forget prompt, you can architect a more thoughtful, resilient, and self-aware process. You are teaching the AI not just to generate, but to reflect. This internal feedback loop is what elevates a response from being merely plausible to being polished, robust, and correct. It is the final step in transforming the AI from a brilliant but fallible improviser into a dependable and self-aware creative partner.

# Chapter 15: The ReAct Strategy: Combining Reasoning with Action via External Tools

## 15.1 The Confines of the Ivory Tower: The Closed-World Problem

Thus far, our prompting strategies have operated within the "mind" of the AI. We have coaxed it into performing complex reasoning (CoT), exploring multiple possibilities (ToT), and critiquing its own work (Self-Correction). We have, in essence, created a brilliant thinker locked in an ivory tower. This thinker has access to a vast internal libraryits training databut it is a library with a strict cut-off date. It contains no information about yesterday's news, today's stock prices, or the current weather. Its knowledge is static and frozen in time.

This "closed-world" limitation gives rise to two fundamental problems that no amount of pure reasoning can solve:

1. **The Stale Knowledge Problem:** The model cannot answer questions about any event that has occurred since its training data was compiled. Its world view is perpetually out of date.
2. **The Grounding Problem (Hallucination):** When confronted with a question at the edge of its knowledge, the model can't simply *check the facts*. Instead, it often falls back on its primary function: predicting a plausible sequence of words. This can lead to the generation of "hallucinations"answers that are well-written, confident, and entirely fabricated.

To solve these problems, we must break the AI out of its ivory tower. We need a strategy that allows it to not just *think*, but to *act*to reach out, interact with the external world, gather fresh information, and use that information to inform its reasoning. This is the purpose of the **ReAct Strategy**.

## 15.2 The Principle of Agency: Reason to Act, Act to Reason

**ReAct**, an acronym for **Reason and Act**, is a paradigm-shifting strategy that transforms the LLM from a passive generator of text into an active agent capable of goal-oriented interaction with its environment. It fuses the step-by-step reasoning of Chain-of-Thought with the ability to use external tools, creating a powerful, iterative loop that mirrors human problem-solving.

Where a CoT model *thinks about* the answer, a ReAct agent *thinks about what to do next*.

The ReAct framework operates on a simple yet profound cycle: the **Thought-Action-Observation loop**.

1. **Thought (Reasoning):** The agent first analyzes the user's query and its current state of knowledge. It then formulates a verbal reasoning tracea "thought"that articulates its immediate goal and devises a plan to achieve it by using a specific tool. This thought is not the final answer, but a strategic plan for the next action.
2. **Action (Tool Use):** Based on its thought, the agent generates a specific, machine-readable command to execute an action using one of the tools it has been given access to. This could be a web search, a calculation, a database query, or a call to any external API.
3. **Observation (Processing Tool Output):** The external system (the "harness" or "orchestrator" you build) executes the action and returns the result to the agent. This resultthe text from a webpage, the answer from a calculator, the data from a databaseis the "observation."

This observation is then fed back into the agent's context, and the loop begins again. The agent's next **Thought** is now informed by the new information it has gathered, allowing it to refine its plan, ask follow-up questions, and iteratively build towards a final answer that is grounded in fresh, external data.

## 15.3 A Practical Walkthrough: The Agent as a Research Assistant

Let's consider a multi-step question that is impossible for a closed-world model to answer correctly.

**The Query:**\`"What was the name of the film that won the Oscar for Best Animated Feature in 2023, and what is its current Rotten Tomatoes score for critics?"\`

A ReAct agent, equipped with a \`Search\` tool, would tackle this as follows:

**Loop 1: Find the Movie**

- **Thought:** "I need to answer a two-part question. First, I need to identify the winner of the Best Animated Feature Oscar in 2023. I don't have this information in my internal knowledge base as it is a recent event. I should use the \`Search\` tool to find this information."
- **Action:** \`Search(query="Best Animated Feature Oscar winner 2023")\`
- **Observation:** (The system executes the search and returns the result) "Guillermo del Toro's Pinocchio won the Academy Award for Best Animated Feature Film at the 95th Academy Awards in 2023."

**Loop 2: Find the Score**

- **Thought:** "Okay, I have the name of the film: 'Guillermo del Toro's Pinocchio'. Now I need to find its current Rotten Tomatoes score for critics. I will use the \`Search\` tool again for this second piece of information."
- **Action:** \`Search(query="Guillermo del Toro's Pinocchio Rotten Tomatoes critic score")\`
- **Observation:** (The system executes the search) "Guillermo del Toro's Pinocchio has a Tomatometer score of 97% based on 300+ critic reviews."

**Loop 3: Synthesize the Final Answer**

- **Thought:** "I have successfully gathered both pieces of required information. I know the movie that won the award and its current critic score on Rotten Tomatoes. I can now formulate the final answer for the user."
- **Action (Final Answer):** "The film that won the Oscar for Best Animated Feature in 2023 was 'Guillermo del Toro's Pinocchio'. Its current Rotten Tomatoes critic score is 97%."

This iterative process allows the agent to decompose the problem and methodically gather the necessary information from the external world before constructing a final, accurate, and up-to-date answer.

## 15.4 The Architecture of a ReAct Agent: The System Prompt as the Blueprint

The ReAct strategy is not just a user-level prompting trick; it is an **agentic architecture** that must be defined in the **System Prompt**. The system prompt is the agent's core programming, its constitution. For a ReAct agent, this prompt must contain several critical components:

1. **Role and Goal Definition:** A clear statement of the agent's purpose (e.g., "You are a helpful AI assistant designed to answer questions by using external tools.").
2. **Tool Specification:** This is the most critical part. You must provide a comprehensive, machine-readable list of all the tools the agent can use. For each tool, you must define:
    - Its name (e.g., \`Search\`, \`Calculator\`).
    - A clear description of what it does (e.g., "Searches the internet for up-to-date information.").
    - The exact format of the \`Action\` call, including parameter names and types (e.g., \`Search(query: str)\`).
3. **Instruction on the Thought-Action-Observation Format:** You must explicitly instruct the model to follow the ReAct loop and to format its output in a precise, parsable way.
    
    **Example System Prompt Snippet:**\`...You have access to the following tools:\`
    
    \`Search(query: str): A tool to search the internet.\`
    
    \`To use a tool, you must use the following format:Thought: [Your reasoning and plan for the next action]Action: [The tool call, e.g., Search(query="your search term")]\`
    
    \`After an action, the system will return an observation:Observation: [The result of the tool execution]\`
    
    \`You must repeat the Thought-Action-Observation cycle until you have enough information to answer the user's question. Then, you must output the final answer directly.\`
    
4. **The Scratchpad (Implicit Context):** The growing history of the conversation (the sequence of Thoughts, Actions, and Observations) acts as the agent's "scratchpad" or short-term memory, allowing it to keep track of its progress.

## 15.5 The Trade-Offs: The Price of Agency

The power of the ReAct strategy is undeniable, but it comes with significant architectural complexity and performance trade-offs.

- **Advantage - Grounding & Freshness:** It is the ultimate solution for reducing hallucinations and ensuring information is up-to-date. The agent's answers are grounded in verifiable, external data.
- **Advantage - Transparency:** The explicit \`Thought\` traces make the agent's reasoning process entirely transparent, which is invaluable for debugging and building trust in the system.
- **Disadvantage - Latency:** ReAct is inherently slow. Each loop involves at least one LLM call plus the execution time of the external tool. A multi-step query can take several seconds to resolve, making it unsuitable for many real-time applications.
- **Disadvantage - Complexity & Cost:** Implementing a ReAct agent requires an "orchestrator" layer of code to parse the agent's \`Action\`, call the correct tool API, and format the \`Observation\`. Furthermore, each reasoning step consumes tokens and incurs API costs, making it more expensive than a single-pass prompt.

## 15.6 Conclusion: From a Thinker to a Doer

The ReAct strategy is a fundamental leap in the evolution of AI interaction. It is the framework that allows us to build not just language models, but true AI agentssystems that can reason, plan, and act upon the world to achieve their goals.

It is a complex and resource-intensive strategy, but it is the essential toolkit for solving problems that require knowledge beyond the model's static training data. By mastering the art of building and prompting these agents, you move from simply conversing with an AI to directing an intelligent, autonomous system capable of dynamic research, analysis, and problem-solving in the real, ever-changing world.

# Chapter 16: The Prompt Chaining Strategy: Breaking Down Complex Workflows into Sequential Tasks

## 16.1 The Allure of the "Mega-Prompt": A Common Pitfall

As a prompt engineer's confidence grows, a natural temptation arises: the creation of the "mega-prompt." This is an attempt to orchestrate a complex, multi-stage workflow within a single, monolithic instruction. The prompt becomes a sprawling document, containing commands to research a topic, then draft a document based on that research, then edit the document for a specific tone, and finally, format it into a tableall in one go.

While this approach can sometimes work for simple tasks, it is a fundamentally fragile and inefficient strategy. The mega-prompt often collapses under its own weight, for several critical reasons:

1. **Cognitive Overload:** Even for a powerful LLM, a long list of disparate instructions can lead to a form of cognitive overload. The model may lose track of earlier constraints, blend distinct steps together, or simply ignore parts of the prompt in its rush to generate a coherent output.
2. **Context Contamination:** Different stages of a workflow often require different "mindsets." The divergent, creative thinking needed for brainstorming is fundamentally different from the convergent, logical thinking needed for technical analysis. When forced into a single context, these mindsets contaminate each other, leading to a less creative brainstorm and a less logical analysis.
3. **Lack of Control and Debuggability:** The mega-prompt is an all-or-nothing proposition. If the final output is flawed, it is nearly impossible to determine which specific instruction in the long chain of commands was misinterpreted. Debugging becomes a frustrating process of trial and error with the entire, complex prompt.
4. **Error Propagation:** A small error or hallucination generated early in the process becomes a permanent, corrupting part of the context. The rest of the generation will be built upon this flawed foundation, leading to a cascade of errors that ruins the final output.

To build robust, reliable, and sophisticated AI systems, we must move beyond the single mega-prompt. We must adopt the mindset of a systems architect, not just a prompter. This is the domain of the **Prompt Chaining Strategy**.

## 16.2 The Assembly Line Principle: Deconstructing the Workflow

The **Prompt Chaining Strategy** is the practice of deconstructing a complex workflow into a series of smaller, discrete, single-purpose prompts. The output of one prompt becomes the direct input for the next, creating a sequential "chain" or "pipeline."

The most powerful analogy for this strategy is a **factory assembly line**.

- A complex product (the final desired output, like a detailed report) is not built at a single, chaotic workstation.
- Instead, it moves down a line. At each station, a specialized worker (a specific, focused prompt) performs one, and only one, well-defined task.
- Station 1 takes the raw materials and forges the chassis. Station 2 takes the chassis and installs the engine. Station 3 takes the engine-fitted chassis and adds the wiring.
- Each step is isolated, optimized, and verifiable. The result is a high-quality, reliably produced final product.

Prompt chaining applies this same industrial logic to AI workflows. Instead of one prompt that does everything poorly, you create a chain of prompts where each link does one thing exceptionally well.

## 16.3 The Rationale: The Four Pillars of Chaining's Power

This strategy is not just a matter of organization; it provides fundamental engineering advantages that are impossible to achieve with a single prompt.

1. **Focus and Precision:** Each prompt in the chain has a single, clear objective. This allows the AI to dedicate its full "attention" and computational resources to executing one well-defined task at a time. This dramatically increases the quality and accuracy of each intermediate step.
2. **Context Isolation and Purity:** This is perhaps the most critical benefit. Each prompt in the chain operates in a "pristine" contextual environment. The creative, divergent thinking of a "Brainstorming Prompt" is completed, and its output is passed to the next step. The "Logical Analysis Prompt" then receives only the clean output of the brainstorm, without any of the contaminating "what if" context that created it. This prevents mental models from bleeding into one another.
3. **Control, Debuggability, and Verifiability:** A chained workflow is transparent. If your final output is flawed, you can inspect the output of each link in the chain. This allows you to immediately pinpoint the exact stepand the exact promptthat failed. You can then fix that single prompt and re-run the chain from that point, rather than starting the entire process from scratch.
4. **Optimized Resource Allocation:** This is a highly advanced benefit. A single mega-prompt forces you to use one model, with one set of parameters (like temperature), for all sub-tasks. A prompt chain allows you to use the *right tool for the right job* at each step.
    - **Step 1 (Brainstorming):** Use a highly creative model (like Claude 3 Opus or GPT-4) with a **high temperature** (e.g., 0.9) to encourage diverse ideas.
    - **Step 2 (Analysis):** Use a powerful reasoning model with a **low temperature** (e.g., 0.2) to ensure logical, deterministic outputs.
    - **Step 3 (Formatting):** Use a smaller, faster, and cheaper model (like Claude 3 Haiku) with a temperature of **0.0** to simply and reliably reformat the data into JSON.

This allows you to build workflows that are not only more reliable but also significantly more cost-effective and performant.

## 16.4 A Practical Walkthrough: Building a Technical Blog Post with a Prompt Chain

Let's construct a workflow to create a high-quality technical blog post, a task that is notoriously difficult for a single prompt.

**The Goal:** Write a 600-word blog post explaining the ReAct prompting framework for a technical audience.

### **Chain Link 1: The Researcher and Outliner**

- **Persona:** A senior AI research assistant.
- **Goal:** To gather key information and structure the content.
- **Prompt:**\`I am writing a technical blog post explaining the ReAct (Reason and Act) framework.Your task is to act as a research assistant. Based on your knowledge, generate a detailed, hierarchical outline for a 600-word blog post on this topic.The outline must include a brief introduction, a section explaining the core Thought-Action-Observation loop, a section on the benefits (like grounding), a section on the drawbacks (like latency), and a conclusion.\`
- **Output 1:** A well-structured Markdown outline.

### **Chain Link 2: The Technical Writer**

- **Persona:** An expert technical writer who makes complex topics easy to understand.
- **Goal:** To write the main body of the blog post based on the outline.
- **Prompt:**\`<outline>[Output 1 from the previous prompt is pasted here]</outline><instruction>You are an expert technical writer. Using the provided outline as your strict guide, write a full draft of the blog post. Write in a clear, professional, and engaging tone suitable for an audience of software developers. Ensure each section flows logically into the next. Do not write a title yet.</instruction>\`
- **Output 2:** The full 600-word draft of the blog post.

### **Chain Link 3: The Critical Editor**

- **Persona:** A skeptical, detail-oriented editor who checks for technical accuracy and clarity.
- **Goal:** To review and refine the draft.
- **Prompt:**\`<draft_to_review>[Output 2 from the previous prompt is pasted here]</draft_to_review><instruction>You are a meticulous editor. Review the draft above for technical accuracy, logical flow, and clarity. Provide a list of 3-5 specific, actionable suggestions for improvement. Format your feedback as a bulleted list.</instruction>\`
- **Output 3:** A list of suggestions, e.g., "Clarify the difference between the 'Action' and the 'Final Answer' steps..."

### **Chain Link 4: The Final Polish and SEO Specialist**

- **Persona:** An SEO and marketing specialist.
- **Goal:** To apply the edits and optimize the post for discovery.
- **Prompt:**\`<original_draft>[Output 2 is pasted here]</original_draft><editorial_feedback>[Output 3 is pasted here]</editorial_feedback><instruction>You are an SEO expert. First, rewrite the original draft to incorporate all of the editorial feedback.Second, after rewriting the text, generate 5 catchy, SEO-friendly titles for the final blog post.</instruction>\`
- **Final Output:** The polished, final blog post and a list of optimized titles.

## 16.5 The Role of the Orchestrator and the Human-in-the-Loop

A prompt chain is not fully autonomous. It requires an **orchestrator**. This can be a human operator who manually copies and pastes the output of one prompt into the next, or it can be a piece of code (e.g., a Python script) that automates the API calls and state management.

Furthermore, the chain provides perfect opportunities for **human-in-the-loop** intervention. A human expert can review the outline from Link 1 before it's passed to the writer, or edit the draft from Link 2 before it goes to the editor. This powerful synergy combines the speed and scale of AI with the nuanced judgment and expertise of a human, resulting in a final product that is superior to what either could achieve alone.

## 16.6 Conclusion: From Prompting to Workflow Architecture

The Prompt Chaining Strategy represents a crucial maturation in the discipline of prompt engineering. It is the point where we move beyond crafting single instructions and begin designing entire systems of intelligent work. It demands a new way of thinkingdecomposing problems, defining clear interfaces between steps, and optimizing each component for its specific task.

By embracing this assembly line approach, you gain unprecedented control, reliability, and efficiency. You can build complex, multi-stage AI applications that are robust, easy to debug, and capable of producing outputs of a quality and sophistication that no single mega-prompt could ever hope to achieve. This is the future of applied AI: not a single, monolithic intelligence, but a well-orchestrated symphony of specialized, intelligent agents working in concert.

# Chapter 17: The Multi-Agent Strategy: Decomposing Workflows into a Team of Specialized AI Agents

## 17.1 From the Assembly Line to the Expert Team

In the previous chapter, we took a monumental leap from the single mega-prompt to the sequential logic of the prompt chain. We transformed our process from a single, chaotic workstation into an orderly, efficient assembly line. Each link in the chain performs its task with focus and precision, passing its completed work to the next station. This linear, sequential model is a powerful tool for bringing order and reliability to complex workflows.

But what happens when the task is not a simple linear assembly? What if it requires the collaborative effort of multiple, distinct specializations, working sometimes in sequence, sometimes in parallel, and sometimes in debate? A factory assembly line is good at building a car, but it's not the right model for designing one. Designing a car requires a *team*: a visionary product manager, a pragmatic engineer, a creative designer, and a meticulous quality assurance expert.

This is the next evolution in our thinking. The **Multi-Agent Strategy** is the practice of transcending the linear chain and architecting a virtual **team of specialized AI agents**. Each agent is an independent instance of the LLM, instantiated with its own unique, highly focused persona and purpose. This is not just a chain of prompts; it is a system of collaborators. It is the point where the prompt engineer truly becomes a systems architect, or perhaps, a team manager.

## 17.2 The Rationale: The Power of Deep Specialization

A single, general-purpose AI, even when guided through a prompt chain, can struggle to effectively context-switch between the different mindsets required for a complex workflow. The divergent, "blue-sky" thinking needed for brainstorming is fundamentally at odds with the convergent, detail-obsessed thinking needed for code debugging. Asking one "worker" to rapidly switch between these roles is inefficient and error-prone.

The Multi-Agent strategy solves this by creating a virtual team where each member is an undisputed world expert in their single, narrow domain. This approach yields profound benefits:

1. **Deep Expertise and Persona Purity:** Instead of a single AI with a diluted, general-purpose persona, you can create an agent whose entire "being"defined by its system promptis optimized for a single function. A "Creative Brainstormer" agent's system prompt can be filled with language that encourages novelty and risk-taking, while a "QA Engineer" agent's prompt can be built around principles of rigor, skepticism, and meticulous attention to detail. This "persona purity" results in a far higher quality of work at each stage.
2. **Cognitive Isolation:** This is the most critical architectural advantage. By separating the workflow into distinct agents, each with its own isolated conversational context, you prevent "cognitive contamination." The creative, high-temperature chaos of the brainstorming agent never touches the pristine, low-temperature logical context of the system architect. Each agent operates in its own clean room, receiving only the necessary inputs and producing a clean output, unburdened by the thought processes of the agents that came before it.
3. **Modularity and Maintainability:** A multi-agent system is inherently modular. If you find that your "Code Generation" agent is underperforming, you can fine-tune or replace its system prompt without touching any other part of the workflow. This makes the entire system easier to debug, maintain, and upgrade over timea core principle of robust software engineering.
4. **Parallel Processing:** While a prompt chain is strictly sequential, a multi-agent system can be designed to work in parallel. You can have three different "Marketing Angle" agents brainstorm ideas simultaneously, and then have a fourth "Marketing Director" agent synthesize their best ideas. This can dramatically reduce the total time required to complete a complex task.

## 17.3 The Four Principles of Multi-Agent Architecture

Building an effective multi-agent system requires a disciplined, architectural approach. Four key principles must be followed.

### Principle 1: Decompose the Workflow into Discrete Roles

Before writing a single prompt, analyze your workflow and break it down into the distinct expert roles required for its completion. Think like a manager building a project team. What are the key phases? Who are the specialists you need? (e.g., Researcher, Writer, Editor, Strategist, Critic).

### Principle 2: Engineer a Pure, Elite Persona for Each Agent

For each identified role, craft a dedicated, highly specific **System Prompt**. This prompt is the agent's DNA. It must be pure, focusing only on that agent's core identity, tools, and behavioral logic. Do not contaminate it with specific examples or data for a one-off task. (See Chapter 6: The Persona Strategy).

### Principle 3: Enforce Strict Context Isolation

This is the golden rule of multi-agent systems. **Each specialized agent must operate in its own, separate chat session or conversational context.** Do not force them to share the same conversational history. The output from Agent A becomes the *input* for Agent B, but Agent B should never see the *conversational history* that led Agent A to its conclusion. This prevents context contamination and ensures each agent operates with a clean slate, focused only on its specific task and persona.

### Principle 4: Match Configuration to the Role

Leverage the freedom that a multi-agent architecture provides. Each agent can be run with its own optimal configuration.

- **Creative Agents (Brainstormers, Copywriters):** Use a powerful, creative model (e.g., GPT-4, Opus) at a **high temperature** (0.8+) to encourage novel and diverse outputs.
- **Logical Agents (Analysts, Architects, QA):** Use a strong reasoning model at a **low temperature** (0.0 - 0.2) to ensure deterministic, stable, and logically sound outputs.
- **Simple Task Agents (Formatters, Classifiers):** Use a fast, cost-effective model (e.g., Haiku, Sonnet) to perform simple, repetitive tasks efficiently.

## 17.4 A Practical Walkthrough: The Software Development Team

Let's apply these principles to build a virtual team to turn a business requirement into a fully specified software project.

**The Workflow:** Business Need -> User Stories -> System Architecture -> Test Plan

### **Agent 1: The Product Manager**

- **Persona:** An expert Product Manager who bridges the gap between business needs and engineering requirements.
- **System Prompt:** \`"I am an expert Product Manager. My core function is to work with stakeholders to translate abstract business needs into clear, concise, and unambiguous user stories, complete with detailed acceptance criteria. I follow the INVEST (Independent, Negotiable, Valuable, Estimable, Small, Testable) model for story writing."\`
- **Configuration:** Reasoning Model, Temperature 0.5 (for a balance of structure and clarity).
- **Input:** A vague business request, e.g., "We need a way for users to update their profiles."
- **Output:** A list of well-formed user stories.

### **Agent 2: The System Architect**

- **Persona:** A seasoned System Architect specializing in designing robust, scalable, and secure microservices.
- **System Prompt:** \`"I am a seasoned System Architect. I take user stories and acceptance criteria and transform them into a complete system design. My output includes detailed API contracts (endpoints, request/response schemas), data models for the database, and a high-level diagram of component interactions. I prioritize security and scalability in all my designs."\`
- **Configuration:** Reasoning Model, Temperature 0.1 (for precision and logic).
- **Input:** The user stories generated by the Product Manager agent.
- **Output:** A detailed technical specification.

### **Agent 3: The QA Engineer**

- **Persona:** A meticulous and slightly paranoid QA Engineer with a passion for finding failure points.
- **System Prompt:** \`"I am a meticulous QA Engineer. I analyze user stories and system architecture designs to create comprehensive test plans. My goal is to anticipate every possible failure mode. My output is a detailed list of test cases, including unit tests, integration tests, and end-to-end test scenarios, specifying the test's purpose, steps, and expected outcome."\`
- **Configuration:** Reasoning Model, Temperature 0.6 (to creatively imagine failure scenarios).
- **Input:** The user stories from the PM and the system design from the Architect.
- **Output:** A comprehensive test plan.

In this workflow, the manager (the orchestrator) takes the output from the PM and provides it as the *sole input* to the Architect in a brand new, isolated chat. This process is repeated for the QA Engineer. The result is a high-quality, fully specified project plan, created by a team of virtual experts, each performing their role flawlessly.

## 17.5 The Orchestrator: The Human (or Code) in Command

A multi-agent system, like a human team, requires a manager. This role is filled by the **orchestrator**. The orchestrator is responsible for:

1. Defining the agents and the workflow.
2. Passing the output of one agent as the input to the next.
3. Managing the isolated contexts for each agent.

In a manual process, the orchestrator is you, the prompt engineer, copying and pasting between different chat windows. In an automated system, the orchestrator is a script (e.g., in Python) that manages the API calls, stores the intermediate outputs, and routes the data between the different agent "functions."

## 17.6 Conclusion: The Future is a Symphony

The Multi-Agent Strategy is the pinnacle of modern prompt engineering. It represents the final and most crucial conceptual shift: from crafting a single, perfect prompt to designing a holistic, intelligent system. It is the difference between conducting a soloist and conducting an orchestra.

Each agent is a finely tuned instrument, and the system prompt is its sheet music. By creating a team of these virtual specialists and orchestrating their collaboration, you can tackle problems of a complexity far beyond the reach of any single prompt. You can build systems that brainstorm, design, execute, and critiquesimulating the entire collaborative process of an expert human team. This is not just prompting; it is the architecture of AI-powered work.

# Chapter 18: The Constructive Guidance Strategy: Iterating and Steering the AI within a Conversation

## 18.1 The Myth of the Perfect First Prompt

In our quest for prompt engineering mastery, we have dedicated immense effort to the art of crafting the perfect initial prompta single, flawless instruction designed to elicit a complete and perfect response in one go. For simple, well-defined tasks, this ideal is achievable. But for any task of significant complexity, creativity, or duration, the "one-shot, one-kill" approach is a myth.

A complex task is not a transaction; it is a process. The AI's initial output, no matter how well-prompted, should not be viewed as the final product. It is the **first draft**. It is the sculptor's initial, rough-hewn block of marble. It contains the form and potential of the final masterpiece, but it requires shaping, refinement, and detail work.

This is where the role of the prompt engineer must evolve from that of an *architect* who designs the blueprint to that of a *director* on a film set. The director doesn't just hand the actor a script and walk away; they watch the performance, provide feedback, and guide the actor through multiple takes to achieve the desired outcome. The **Constructive Guidance Strategy** is the practice of this active, in-conversation direction. It is the art of iterating with the AI, steering its performance turn by turn, and collaboratively refining a first draft into a final, polished product.

## 18.2 The Rationale: The AI as a Collaborative Partner

Understanding why this iterative, conversational approach is so effective requires us to embrace a new mental model. The AI is not a vending machine where a perfect input guarantees a perfect output. It is a collaborative partner that learns and adapts *within the context of a single conversation*.

1. **The AI Mirrors Your Tone:** LLMs are highly attuned to the user's tone. If you respond to a suboptimal output with negative, critical, or accusatory language ("You're wrong," "That's a terrible function," "You didn't follow my instructions"), you can inadvertently trap the model in a negative feedback loop. It may become defensive, uncooperative, or produce increasingly degraded responses. Constructive, positive, and encouraging language, however, fosters a collaborative state, making the AI more receptive to your guidance.
2. **In-Context Learning in Action:** Every turn in a conversation is a micro-learning opportunity for the AI. When you provide corrective feedback, you are essentially creating a new, temporary Few-Shot example. Your refinement"That's a good start, now let's add error handling"becomes part of the context, teaching the model the desired pattern for the *next* generation within that same conversation.
3. **The User as the State Manager:** The AI has no true understanding of when a sub-task is "finished." It only knows the linear history of the conversation. Without clear signals from the user, it may continue to "work on" a problem that you consider solved, leading to context contamination. The user must act as the explicit project manager of the conversation, clearly opening and closing tasks to guide the AI's focus.

Mastering this strategy means moving from a mindset of "pass/fail" on the AI's first response to a mindset of "draft and refine."

## 18.3 A Toolkit of Conversational Steering Techniques

Effective guidance is not a single technique, but a suite of conversational tactics used to steer the AI's performance.

### 18.3.1 Principle 1: Positive Reinforcement and Constructive Feedback

When an output is not perfect, always frame your feedback constructively. Start by acknowledging the positive aspects of the response, then clearly and specifically state the desired modifications.

- **Less Effective (Negative Criticism):**\`"This function you wrote is terrible. It has a bug and it doesn't even handle errors. Fix it."\`
- **More Effective (Constructive Guidance):**\`"Excellent first draft of the function! You've captured the core logic perfectly. Now, for our production version, let's enhance it. Could you please add a try-catch block to handle potential exceptions and also add a check to ensure the input parameter is not null before processing?"\`

This approach is not about being polite for the sake of it. It is a more effective engineering practice that keeps the AI in a collaborative state and provides clear, actionable instructions for improvement.

### 18.3.2 Principle 2: Explicit State Management

Do not assume the AI knows when a sub-task is complete and it's time to move on. You must provide explicit signals to close out a task, which allows the AI to "release" that context and devote its full attention to the next objective.

- **Ambiguous (Implicit State):***(After the AI generates a block of code)* \`"Okay, now create the documentation for it."\`*(The AI might think the code itself is still under review and that the documentation is part of the same, ongoing task.)*
- **Explicit (Clear State Management):**\`"That code is perfect and passes all my tests. We can now consider the implementation task for this module to be 100% complete. Let's start the next distinct task: generating the user documentation for the function we just finalized."\`

The second prompt provides an unambiguous signal that the coding task is finished, preventing its context from bleeding into the documentation task.

### 18.3.3 Principle 3: Trajectory Correction via Editing

When a conversation goes off track due to a misunderstanding in an *earlier* prompt, the most effective solution is often **not** to try and fix it with a series of follow-up corrections. The superior solution is to go back in the conversation history and **edit the user prompt that caused the deviation**.

- **Why It Works:** An AI's response is conditioned on the *entire* preceding conversation history. If an early prompt contains a flaw, that flaw becomes a permanent, corrupting part of the foundational context for all subsequent turns. Follow-up "patches" ("No, I meant this," "Don't do that, do this instead") add more noise and confusion. Editing the original, flawed prompt cleans the foundational context. This allows the AI to regenerate its entire reasoning path from a correct starting point, resulting in a far more coherent and accurate outcome.
- **Illustrative Example:**
    - **Bad Practice (Patching):**
        - **User:** \`"Generate a Python script to parse CSV files in the /data directory."\`
        - **AI:** *(Generates a script using the \`pandas\` library)*
        - **User:** \`"No, I can't use pandas. The environment is minimal. Don't use external libraries."\`
        - **AI:** *(Rewrites using Python's built-in \`csv\` module, but the context is now messy)*
    - **Good Practice (Editing):**
        - **User (Original):** \`"Generate a Python script to parse CSV files in the /data directory."\`
        - **AI:** *(Generates script using \`pandas\`)*
        - **User (Goes back and edits the original prompt to):** \`"Generate a Python script to parse all CSV files in the /data directory. The script must use only the Python standard library, with no external dependencies like pandas. It must include robust error handling for missing files."\`*(The AI now regenerates its response from a clean, correct foundation.)*

### 18.3.4 Principle 4: Pre-Execution Calibration (The 'Teach-Back' Method)

Before the AI begins a complex, time-consuming task, you can prevent wasted effort by requiring it to first confirm its understanding of the plan. This "teach-back" method exposes any subtle misunderstandings *before* significant work is done.

- **Why It Works:** True understanding is only confirmed when the AI can articulate the plan in its own words. This forces the model to synthesize your instructions and formulate a coherent plan of action, revealing any hidden assumptions or misinterpretations upfront.
- **Illustrative Example:**\`"We need to build a REST API endpoint for user profile updates. It should use the HTTP PATCH method, be authenticated, and allow updates to a user's 'firstName', 'lastName', and 'bio' fields in the database. **Before you write any code, please confirm your understanding of the task.** Describe the endpoint's path, the expected request body structure, the validation checks you will perform, and the sequence of operations in your plan."\`

This single alignment step is one of the most critical and highest-leverage actions a user can take in a complex conversation.

## 18.4 Conclusion: The User as the Conductor

The Constructive Guidance Strategy completes our understanding of the user's role in prompt engineering. You are not a passive audience member waiting for a performance. You are the conductor of an orchestra. Your initial prompt is the downbeat, but your true skill is revealed in how you guide the ensemble through the performanceadjusting tempo, correcting notes, and shaping the dynamics to create a symphony.

The quality of a long and complex AI-driven task is almost never determined by the brilliance of the first prompt alone. It is determined by the user's skill in managing the ensuing dialogue. By mastering the art of constructive feedback, explicit state management, trajectory editing, and pre-execution calibration, you can transform the AI from a simple tool that responds to commands into a true partner that collaborates in an iterative and deeply creative process.

# Chapter 19: The Affirmative Direction Strategy: Stating What to Do vs. What Not to Do

## 19.1 The Paradox of Prohibition: The "Pink Elephant" Problem

There is a classic psychological exercise that perfectly illustrates a fundamental flaw in humanand artificialcognition: **"For the next ten seconds, do not, under any circumstances, think of a pink elephant."**

The result is inevitable. The very act of processing the prohibition forces your mind to conjure the exact image you are trying to avoid. The instruction, intended to prevent a thought, is the very thing that seeds it. This paradox of prohibition is not just a quirk of human psychology; it is a critical, mechanistic limitation in how Large Language Models process information.

A common but deeply flawed approach to prompting is to provide the AI with a list of negative constraintsa list of things it *should not* do. "Do not write code without comments." "Do not use a formal tone." "Do not forget to handle edge cases." While this seems like a direct and logical way to constrain the model's output, it is, in fact, one of the least effective and most error-prone methods of instruction.

The **Affirmative Direction Strategy** is a complete paradigm shift away from this thinking. It is built on a simple, robust, and machine-friendly principle: **Architect the path to the desired outcome, rather than just fencing off the paths to the undesired ones.** It is the art of exhaustively detailing what the AI *should* do, in such a compelling and comprehensive way that the possibility of error is never even introduced.

## 19.2 The Rationale: Why "Don't" is a Flawed Command for an LLM

To understand why affirmative direction is so superior, we must look at how an LLM's attention mechanism and predictive engine actually work.

1. **Attention is Not Negation:** When you include the phrase "Do not use insecure functions" in a prompt, the model's attention mechanism must still focus on the concept of "insecure functions" to understand the instruction. The words "insecure" and "functions" become highly weighted parts of the context. The negation ("do not") is a grammatical modifier, but it does not erase the semantic presence of the core concept. The pink elephant is now in the room, and the model has to actively expend effort to work around it, ironically increasing the cognitive load and the chance of a related error.
2. **The Weakness of Negative Weights:** LLMs operate by predicting the most probable next token. The presence of a concept in the prompt increases the probability of related tokens appearing. While a negation might attempt to apply a negative weight, this signal can be weak and easily lost or down-weighted, especially in a long and complex prompt. The strong, positive signal of the core concept often overpowers the weak, negative signal of the prohibition.
3. **A Clean Path vs. a Minefield:** An affirmative instruction creates a clean, direct, and efficient "thought path" for the model to follow. It's a clear map to a destination. A list of prohibitions, conversely, creates a cognitive minefield. The model must generate a potential output and then constantly check it against the list of things it's not supposed to do. This is a computationally expensive, reactive, and error-prone process. It is far more robust to build a single, safe, well-lit highway than it is to send the model into a dark field with a map of where the mines *might* be.

## 19.3 The Core Principle: Proactive Design over Reactive Correction

The essence of the Affirmative Direction Strategy is to shift your mindset from being a reactive critic to a proactive architect. Instead of correcting potential failures, you design a process that leads inevitably to success.

- **The Prohibitive Mindset (Reactive):**
    - *Starts with:* "What could go wrong?"
    - *Generates:* A list of "Don't..." statements.
    - *Result:* A complex, inefficient process that risks failure at every step.
- **The Affirmative Mindset (Proactive):**
    - *Starts with:* "What does a perfect execution of this task look like, step-by-step?"
    - *Generates:* A detailed, positive description of the ideal process and persona.
    - *Result:* A clean, direct, and robust process that guides the AI naturally to the desired outcome.

## 19.4 Affirmative Direction in Practice: A Gallery of Transformations

This principle is best understood through concrete, side-by-side comparisons. Notice how the "More Effective" versions are not just simple inversions of the negative commands; they are richer, more detailed descriptions of a successful persona and workflow.

### **Example 1: Code Generation and Best Practices**

- **Less Effective (Prohibitive):**\`"Write a Python function to process user data.Do not write code without comments.Do not forget to handle edge cases like null input.Do not use insecure functions like 'pickle'.Do not write one large, monolithic function."\`
- **More Effective (Affirmative):**\`"I am a senior Python developer who practices meticulous, documentation-driven design and adheres to the highest standards of security and modularity.My process for writing any function is as follows:1. **Define Signature and Docstring:** First, I define the function signature with full type hints. Then, I immediately write a comprehensive docstring detailing its purpose, parameters, return values, and any potential exceptions it may raise.2. **Input Validation:** The very first part of my implementation is robust input validation. I rigorously check for all edge cases, such as null or empty inputs, and handle them gracefully.3. **Modular and Secure Implementation:** I write the core logic using small, well-named helper functions. I exclusively use secure, industry-standard libraries like 'json' for data serialization.4. **Final Review:** Before concluding, I review my code to ensure it is clean, readable, and perfectly documented.\`
    
    \`Now, following this exact process, write a Python function to process user data."\`
    

### **Example 2: Controlling Writing Style and Tone**

- **Less Effective (Prohibitive):**\`"Write an email to a customer about a service outage. Do not be too formal. Do not use technical jargon. Do not sound like a robot. Do not blame the customer."\`
- **More Effective (Affirmative):**\`"I am a compassionate and clear-thinking customer support specialist.I am writing an email to a non-technical customer to inform them about a recent service outage.My writing style is warm, empathetic, and direct. I use simple, everyday language and clear analogies to explain technical issues. My primary goal is to reassure the customer and provide them with a clear timeline for the resolution.The email should have three parts: a sincere apology acknowledging their frustration, a brief and simple explanation of the issue, and a confident statement about the next steps."\`

### **Example 3: Content Generation and Focus**

- **Less Effective (Prohibitive):**\`"Write a product description for our new hiking boot. Do not talk about the price. Do not mention our competitors by name. Do not make it too long."\`
- **More Effective (Affirmative):**\`"Write a product description for our new hiking boot, the 'Trailblazer Pro'.The description must be exactly three paragraphs long.The first paragraph should focus on the boot's core benefit: all-day comfort, enabled by our proprietary 'CloudStep' insole technology.The second paragraph should highlight its durability, focusing on the waterproof Gore-Tex material and the rugged Vibram outsole.The final paragraph should be a compelling call to action, inviting the reader to 'experience their next adventure'."\`

## 19.5 Integrating Affirmative Direction with System Prompts

The Affirmative Direction Strategy finds its most powerful application in the design of **System Prompts**. A system prompt should be a positive constitution for the AI. It should be a declaration of *what the AI is* and *how it operates*, not a penal code of what it is forbidden from doing.

A system prompt built on prohibitions creates a fearful, hesitant AI. A system prompt built on a rich, affirmative description of an expert persona creates a confident, capable, and proactive AI collaborator.

## 19.6 A Note on Absolute Boundaries

This is not to say that a prohibition is *never* useful. For absolute, hard-line safety constraints or legal guardrails, an explicit "DO NOT" can serve as a final, critical safety net. For example: "DO NOT, under any circumstances, generate personally identifiable information (PII)."

However, these should be seen as the exception, not the rule. They are the high-voltage fences around the perimeter, used sparingly for critical boundaries. The detailed work of guiding the AI within that perimeter should always be done with the positive, proactive, and ultimately more effective language of affirmative direction.

## 19.7 Conclusion: The Architect of Success

The Affirmative Direction Strategy is a fundamental shift in prompt design. It moves the engineer's focus from preventing failure to architecting success. It is a more robust, more efficient, and more reliable way to communicate with a predictive system.

By learning to describe the ideal process in rich, positive detail, you are not just giving the AI a command; you are giving it a blueprint for excellence. You are drawing a clear and direct map to the treasure, making the journey so straightforward that the model never even considers wandering into the surrounding traps. This proactive design is the essence of advanced, reliable AI engineering.

# Chapter 20: The Output Formatting Strategy: Forcing Structured Data like JSON and Tables

## 20.1 The Last Mile Problem: From Prose to Precision

The raw, native output of a Large Language Model is prose. It is conversational, descriptive, and human-readable. This is its greatest strength and, for many applications, its most crippling weakness. When you are building a software application, a data pipeline, or any automated workflow, a conversational paragraph is not a useful input. It is a block of unstructured text that requires fragile, complex, and error-prone post-processinglike regular expressions or brittle string splittingto extract the valuable information locked within.

This is the "last mile" problem of prompt engineering. You can guide an AI to a perfectly correct and insightful answer, but if that answer is delivered in a format that your system cannot reliably parse, the entire effort is wasted. A human can understand, "Sure, the user's name is John Doe, and his ID is 123." A computer cannot. A computer needs \`{"name": "John Doe", "id": 123}\`.

The **Output Formatting Strategy** is the solution to this critical problem. It is the practice of compelling the model to act not as a conversationalist, but as a precise data structuring engine. It involves a suite of techniques designed to force the AI to deliver its response in a perfectly predictable, machine-readable format, such as JSON, XML, or a Markdown table. Mastering this strategy is the essential bridge between using AI for simple assistance and integrating AI as a reliable, automated component in a production-grade system.

## 20.2 The Rationale: Why Structure is Non-Negotiable for Systems

Forcing a structured output is not a matter of stylistic preference; it is a fundamental requirement for building robust AI-powered applications.

1. **Machine Readability:** This is the primary driver. Structured data can be instantly and reliably parsed by any programming language. A JSON object can be deserialized into a native object or dictionary, and a table can be read into a data frame, all with zero ambiguity. This eliminates the need for a fragile layer of parsing code.
2. **Consistency and Reliability:** When you successfully enforce an output format, you guarantee that the *shape* of the data will be the same every single time. This predictability is the bedrock of reliable systems. You can build your application with the confidence that the \`user_id\` field will always be present and correctly named.
3. **Reduced Post-Processing:** By making the AI do the work of structuring the data, you save significant development time and effort. The logic for extracting and organizing the information is embedded in the prompt itself, rather than in a separate, complex body of post-processing code.
4. **Implicit Constraint and Focus:** Forcing the AI to populate a specific structure is a powerful form of affirmative direction. When you ask for a JSON object with keys for \`product_name\`, \`price\`, and \`sku\`, you are implicitly telling the model to find *only* that information and to ignore everything else. This helps to focus the model's attention, reducing the likelihood of it including irrelevant details or hallucinating extraneous facts.

## 20.3 The Toolkit of Formatting Control

There are several techniques to enforce a specific output format, ranging in effectiveness from a gentle suggestion to an almost unbreakable command.

### 20.3.1 Technique 1: The Direct Command (The Simple Request)

This is the most straightforward method: simply tell the model what format you want.

- **Prompt:** \`"Extract the key entities from the following text and format them as a JSON object."\`
- **Effectiveness:** This often works for simple, standard formats like JSON or bulleted lists, but it can be unreliable. The model might still include conversational preambles ("Here is the JSON you requested:") or use inconsistent key names. It's a good starting point, but not robust enough for production.

### 20.3.2 Technique 2: The Schema or Template (The Blueprint)

This technique is a significant step up in reliability. Instead of just naming the format, you provide a blueprint or an empty template of the structure you want the AI to fill in.

- **Prompt (for a Markdown Table):**\`"Extract the following information from the text and present it in a Markdown table with these exact columns: | Product Name | SKU | Price |"\`
- **Prompt (for JSON):**\`"Extract the required information into a JSON object that conforms to the following schema:{ "author": string, "publication_year": integer, "key_findings": [string]}"\`
- **Effectiveness:** By providing the exact keys or column headers, you give the model a clear "form" to fill out. This dramatically increases the consistency of the output's structure and is highly effective for most use cases.

### 20.3.3 Technique 3: The Few-Shot Example (The Gold Standard)

As discussed in Chapter 5, showing is always more powerful than telling. Providing a complete, end-to-end example of an input and its perfectly formatted output is the most unambiguous and reliable way to enforce a structure.

- **Prompt (for Custom Delimited Format):**\`"Extract the name and email from the text. Follow the example format precisely.\`
    
    \`### EXAMPLE ###Text: "You can reach out to Steve Rogers at s.rogers@avengers.com for more info."Output: Steve Rogers|s.rogers@avengers.com\`
    
    \`### NEW TASK ###Text: "The project lead is Jane Doe (email: j.doe@example.com)."Output:\`
    
- **Effectiveness:** This is the gold standard for reliability. The model learns the exact transformation and formatting pattern from your example, leaving no room for interpretation. It is the preferred method for any complex or custom format.

### 20.3.4 Technique 4: The Prefilling Strategy (The Nudge)

This is a clever and powerful technique that leverages the model's predictive nature. You can "force" the model to begin its response in a specific format by prefilling the very first part of the \`assistant\`'s turn in your API call.

- **How it works:** If you want a JSON object, you start the assistant's response with a single opening brace: \`{\`. If you want a JSON array (a list), you start it with an opening bracket: \`[\`.
- **API Call Example (Simplified):**\`messages = [ {"role": "user", "content": "Extract the names of the three main characters into a JSON list."}, {"role": "assistant", "content": "["}]\`
- **Effectiveness:** This is an extremely strong signal. By providing the opening character, you have dramatically constrained the model's next token prediction. It is now overwhelmingly probable that it will continue generating a valid JSON list. This is a highly effective way to bypass conversational preambles and jump directly into the desired structure.

## 20.4 A Gallery of Formats: Beyond JSON

While JSON is the workhorse of machine-to-machine communication, the Output Formatting Strategy applies to any structured format.

- **Markdown Tables:** Excellent for human-readable reports that need to be structured.
- **XML:** Essential when interfacing with legacy systems or specific industry standards that require XML.
- **YAML:** A popular choice for configuration files due to its human-friendly syntax.
- **CSV (Comma-Separated Values):** Simple and effective for generating tabular data that can be easily imported into spreadsheets.
- **Custom Formats:** As shown in the Few-Shot example, you can define your own unique, delimiter-separated format for specialized applications.

## 20.5 Building for Production: Handling the "Gotchas"

When integrating a formatting--reliant prompt into a live application, you must be prepared for potential failures.

**Problem 1: The Conversational Wrapper**
The AI's inherent "helpfulness" often leads it to wrap your beautifully structured data in conversational text, like "Of course! Here is the Markdown table you asked for:" This will break your parser.

- **The Solution:** Add a direct, final instruction to your prompt: **"Provide ONLY the [JSON object / Markdown table / etc.] and nothing else. Do not include any preamble, explanation, or concluding text."** This simple command is remarkably effective at ensuring a clean, parsable output.

**Problem 2: Syntax Errors and Truncation**
Even with clear instructions, the model might occasionally generate syntactically invalid output (e.g., a JSON with a missing comma) or, if the output is very long, it might be cut off by the \`max_tokens\` limit, resulting in an incomplete and invalid structure.

- **The Solution:** Your application code must be resilient. Always wrap your parsing logic in a \`try...except\` block (or equivalent error handling). For JSON, you can implement a more robust solution by using a **JSON repair library**. These libraries are designed to intelligently fix common errors in malformed JSON, such as missing brackets or trailing commas, making your system far more resilient to minor AI generation errors.

## 20.6 Conclusion: The Bridge from Conversation to Computation

The Output Formatting Strategy is the critical discipline that makes applied AI possible. It is the bridge that connects the fluid, probabilistic world of natural language generation to the rigid, deterministic world of software and computation.

Without this strategy, the AI remains a fascinating but unpredictable conversationalist. By mastering the techniques of direct commands, schema blueprints, few-shot examples, and response prefilling, you can transform the AI into a reliable and predictable data processing component. You gain the power to dictate the precise structure of its output, ensuring that the information it provides is not just insightful, but immediately and automatically usable. This is the key to unlocking the true potential of AI in building scalable, robust, and automated systems.

# Chapter 21: The Response Prefilling Strategy: Seeding the Assistant's Answer for Control

## 21.1 The Power of the First Word: Guiding the Improviser

Imagine you are in an improvisational comedy scene. The director gives you a prompt: "You are a nervous scientist." You can start your line in a thousand different ways. But what if the director leans in and whispers, "Start your first line with the words, *'It's escaped!'*"?

That single, two-word seed has now dramatically and irrevocably shaped your entire performance. You are no longer just a generic "nervous scientist"; you are now a nervous scientist whose creation is on the loose. Every subsequent word you improvise will be conditioned by that starting point. You have been placed on a specific narrative track, and deviating from it is now nearly impossible.

This is the essence of the **Response Prefilling Strategy**. It is a subtle, technically-focused, and yet astonishingly powerful technique for exerting fine-grained control over an AI's output. It moves beyond simply giving instructions in the user prompt and takes the audacious step of writing the very first word or characters of the AI's own response. By "seeding" the assistant's turn, you are not just providing a hint; you are setting the starting block for its predictive race, making your desired outcome the most statistically probableand often the only possiblepath forward.

## 21.2 The Rationale: Hacking the Predictive Engine

To understand why prefilling is so effective, we must once again return to the fundamental mechanism of an LLM: it is a next-token prediction engine. Its entire world is a sequence of text, and its only goal is to predict what comes next.

When you interact with a model via an API, you typically provide a list of messages, each with a \`role\` (\`system\`, \`user\`, or \`assistant\`). The crucial insight is this: the model sees this entire list as a single, continuous prompt that it must complete. The \`assistant\` role is not just a label; it is a signal that the text to follow should be in the AI's voice.

When you leave the \`assistant\`'s content empty, you are asking the model, "Given the system prompt and the user's message, what is the most likely first word of my response?" The model might predict "Certainly," or "Here is," or any number of conversational preambles.

But when you **prefill** the \`assistant\`'s content, you are changing the question entirely. If you prefill it with an opening brace \`{\`, you are now asking the model, "Given the system and user messages, and knowing that *my response has already started with '{'*, what is the most likely character to come next?"

The answer to that question is overwhelmingly likely to be a double quote \`"\` to start a JSON key. You have effectively set the model on the "JSON track." It is now statistically trapped. Its predictive engine is forced to continue generating a syntactically valid JSON object because any other path would be a wildly improbable continuation of the text you have already started for it. This is not a suggestion; it is a form of cognitive coercion.

## 21.3 How to Implement Response Prefilling: The API-Level Technique

Response prefilling is an API-level strategy. It requires you to construct the message payload yourself, rather than simply typing into a chat UI.

The implementation is simple: in your list of messages sent to the API, you create a final message with the \`role\` set to \`assistant\` and provide the initial characters of your desired response as its \`content\`.

**Example: Forcing a JSON Output**

\`\`\`python
# A simplified Python example of an API call payload
messages_payload = [
    {
        "role": "user",
        "content": "Extract the name, ID, and email from this text: 'Contact John Smith (ID: 123) at john@email.com'."
    },
    {
        "role": "assistant",
        "content": "{"  # This is the prefill. We've started the JSON object.
    }
]

# The model's completion will now almost certainly be the rest of the JSON object,
# e.g., '"name": "John Smith", "id": 123, "email": "john@email.com"}'

\`\`\`

**A Critical Gotcha: No Trailing Whitespace**
Most APIs will reject a prefilled \`assistant\` message that ends with a space or other whitespace character. This is a common and frustrating error for newcomers. The prefill must be a clean sequence of non-whitespace characters.

- **Correct:** \`{"role": "assistant", "content": "{"}\`
- **Incorrect (will cause an error):** \`{"role": "assistant", "content": "{ "}\`

## 21.4 A Toolkit of Prefilling Applications

This technique is a versatile tool for controlling various aspects of the AI's output.

### 21.4.1 Forcing Structured Data (The Primary Use Case)

This is the most common and powerful application. It is the most reliable way to get a clean, parsable, structured output without any conversational wrapping.

- **Goal:** Get a JSON object.
    - **Prefill:** \`{\`
- **Goal:** Get a JSON array (list).
    - **Prefill:** \`[\`
- **Goal:** Get an XML document.
    - **Prefill:** \`<\` (or a more specific opening tag like \`<response>\`)

This technique almost entirely eliminates the "Here is the JSON you requested..." problem, as starting the response in that way would be an improbable continuation of \`{\`.

### 21.4.2 Maintaining Character in Roleplay

Deep into a long conversation, an AI can sometimes "forget" its assigned persona and revert to its default helpful assistant mode. A prefill can be a powerful and token-efficient way to snap it back into character.

- **Scenario:** Fifty turns into a conversation where the AI is roleplaying as Sherlock Holmes.
- **User Prompt:** \`"What do you deduce about the owner of this muddy shoe?"\`
- **Prefill:** \`[Sherlock Holmes]:\`
- **Result:** The model is now strongly conditioned to continue speaking in the persona's voice, rather than starting with "As an AI assistant..."

### 21.4.3 Triggering Chain-of-Thought

You can provide a stronger impetus for a Chain-of-Thought response by starting the reasoning process yourself.

- **User Prompt:** \`"A class has 30 students. 60% are girls. 50% of the girls wear glasses. How many girls in the class wear glasses? Think step by step."\`
- **Prefill:** \`Okay, let's break this down into logical steps. Step 1:\`
- **Result:** The model is now locked into a step-by-step format, often more reliably than with the user-prompt instruction alone.

### 21.4.4 Guiding Tone and Style

The opening words of a response often set the tone for the entire text. You can pre-determine this tone with a prefill.

- **User Prompt:** \`"Explain the recent downturn in the stock market."\`
- **Prefill for a Formal Tone:** \`From a macroeconomic perspective, the recent market volatility can be attributed to several key factors. First,\`
- **Prefill for a Simple Tone:** \`Basically, what happened was that a few big things all went wrong at once.\`

## 21.5 Limitations and Best Practices

1. **It is a Supplement, Not a Substitute:** Prefilling is the final nudge, the ultimate steering mechanism. It is not a replacement for a well-crafted system prompt and a specific, detailed user prompt. The core instructions should still be in the user message. The prefill is for controlling the *form* of the immediate response.
2. **Be Careful Not to Over-Constrain:** If your prefill is too long or specific, you might prevent the model from discovering a better or more creative way to answer the question. A single \`{\` is a powerful constraint on format but leaves the content open. Prefilling an entire sentence might be too restrictive.
3. **Know Your API:** This is a feature of the underlying API and may not be exposed in all user interfaces. It is a tool for developers and advanced users who are building applications on top of the models.

## 21.6 Conclusion: The Ultimate Nudge

The Response Prefilling Strategy is the prompt engineer's "Jedi mind trick." It is a subtle, precise, and almost irresistibly powerful technique for directing an AI's output. By understanding that you can set the starting conditions for the model's own predictive process, you gain a level of control that is simply not possible through user-level instructions alone.

It is the key to building truly robust and automated systems. It guarantees the format, enforces the persona, and kick-starts the reasoning process with unparalleled reliability. While it requires a deeper, API-level interaction with the model, mastering this strategy is a hallmark of an engineer who has moved beyond simply conversing with an AI and has begun to truly program its behavior.

# Chapter 22: The Parameter Tuning Strategy: Engineering Behavior with Temperature, Top-K, and Top-P

## 22.1 The Director's Final Touch: From Script to Performance

Throughout this guide, we have focused almost exclusively on the art of crafting the prompt itselfthe text that serves as the script for our AI actor. We have learned to write a detailed character brief (the System Prompt) and precise, scene-by-scene instructions (the User Prompts). We have mastered the script. But a script, no matter how brilliant, is only one half of a performance. The other half is the directionthe nuance, the style, the interpretation.

This is where we must look beyond the text of the prompt and turn our attention to the control panel of the AI itself. The **Parameter Tuning Strategy** is the practice of manipulating the core settings of the Large Language Model's generation process to engineer its fundamental behavior. These parametersmost notably \`temperature\`, \`top_k\`, and \`top_p\`are not about *what* the AI says, but *how* it says it. They are the dials that control the trade-off between creativity and coherence, between deterministic precision and exploratory randomness.

If the prompt is the script, then tuning these parameters is the final act of direction. It is how you tell the actor to either stick to the script with absolute fidelity or to improvise with creative flair. Mastering this final layer of control is what separates a good prompter from an elite AI systems engineer.

## 22.2 The Rationale: Peeking Inside the Predictive Mind

To effectively tune these parameters, one must first understand the fundamental process they control. As we know, an LLM is a next-token prediction engine. But it does not simply choose *one* "best" next word. Instead, at every step, it performs a two-stage process:

1. **Probability Distribution:** The model looks at the entire preceding text and calculates a probability score for every single word (or token) in its vast vocabulary. This creates a massive list of potential next words, each with an associated likelihood. For example, after "The sky is," the token "blue" might have a 40% probability, "gray" a 15%, "vast" a 5%, and "on" a 0.001%.
2. **Sampling:** From this probability distribution, the model must then choose just one token to be the actual output. This is the sampling step, and it is here that the parameters exert their influence. Instead of always picking the single most probable word (a method known as "greedy decoding"), the sampling process can introduce a controlled amount of randomness, allowing less likely but still plausible words to be chosen.

The parameters \`temperature\`, \`top_k\`, and \`top_p\` are all different methods for manipulating and controlling this sampling process. They are the tools we use to shape the model's probabilistic behavior to suit our specific needs.

## 22.3 The Toolkit of Behavioral Engineering

### 22.3.1 Temperature: The Creativity and Risk Dial

**Temperature** is the most common and intuitive parameter. It directly controls the randomness of the sampling process.

- **Analogy:** Think of temperature as the "risk" or "creativity" dial, ranging from 0.0 to a theoretical maximum (often 2.0).
- **Mechanism:** Temperature works by mathematically rescaling the probability distribution before the sampling occurs.
    - **Low Temperature (e.g., 0.0 to 0.3):** This makes the distribution "sharper" or more "peaked." The model becomes more confident and deterministic. It will almost always choose the highest-probability tokens. A temperature of **0.0** is "greedy decoding"it will *always* pick the single most likely token, resulting in the most predictable and repeatable output.
    - **High Temperature (e.g., 0.8 to 1.2):** This "flattens" the distribution, making less likely words more probable than they originally were. The model becomes more "adventurous," creative, and random. It is more willing to take a chance on a surprising or novel word choice.
- **Strategic Use Cases:**
    - **Use LOW Temperature (0.0 - 0.2) for:**
        - **Factual Recall & Q&A:** When there is one correct answer, you want maximum precision and no creative deviation.
        - **Summarization & Extraction:** To ensure the output sticks closely to the source text.
        - **Production Code Generation:** For predictable, reliable, and bug-free code.
        - **Tasks requiring high reliability and consistency.**
    - **Use HIGH Temperature (0.7 - 1.0) for:**
        - **Creative Writing:** Generating poetry, stories, or marketing slogans where novelty is desired.
        - **Brainstorming:** Creating a diverse list of ideas.
        - **Chatbot Persona:** Giving a chatbot a more lively, less robotic personality.

### 22.3.2 Top-K: The "Whitelist" of Options

**Top-K** sampling provides a different way to control randomness by limiting the pool of candidate tokens *before* sampling.

- **Analogy:** Think of Top-K as creating a "whitelist" or a "shortlist" of the best options.
- **Mechanism:** \`top_k\` is an integer that tells the model to consider only the *k* most probable tokens for the next step. All other tokens are completely discarded (their probability is set to zero), and the model then samples from this reduced pool.
    - \`top_k=1\` is identical to greedy decoding (temperature 0.0).
    - \`top_k=50\` means that at each step, the model will only consider the 50 most likely next words, regardless of their actual probability scores.
- **Strategic Use Cases:**
    - Top-K is primarily a tool for **reining in the chaos of a high temperature**. By setting a \`top_k\`, you can use a high temperature to encourage creativity among the *good* options, while preventing the model from choosing a truly bizarre, nonsensical word from the long tail of the probability distribution. It acts as a safety net against excessive randomness.
    - The main drawback of Top-K is that it is not adaptive. It might cut off a "surprisingly good" but less probable word if it falls outside the fixed \`k\` limit.

### 22.3.3 Top-P (Nucleus Sampling): The "Probability Budget"

**Top-P**, also known as Nucleus Sampling, is often considered a more sophisticated and adaptive alternative to Top-K.

- **Analogy:** Think of Top-P as sampling from a "probability budget."
- **Mechanism:** \`top_p\` is a float between 0.0 and 1.0. It tells the model to create the smallest possible pool of candidate tokens whose cumulative probability is greater than or equal to \`p\`. The model then samples from this "nucleus" of high-probability tokens.
    - The key difference from Top-K is that the size of the pool is **dynamic**.
    - If the model is very **confident** about the next word (e.g., "blue" has a 95% probability after "The sky is"), and \`top_p=0.9\`, the pool might only contain one or two words.
    - If the model is **uncertain** (e.g., at the start of a poem, many words have a low probability), the pool might contain dozens of words to meet the 90% cumulative probability budget.
- **Strategic Use Cases:**
    - Top-P is an excellent general-purpose parameter for balancing creativity and coherence. It allows for a wide range of choices when the path forward is ambiguous (encouraging creativity) but becomes highly deterministic when the path is clear (ensuring coherence).
    - Many practitioners prefer \`top_p\` over \`top_k\` for most creative tasks because of its adaptive nature. A setting of \`top_p=0.9\` is a very common and effective starting point.

## 22.4 The Interplay: Recipes for Behavioral Control

These parameters are not used in isolation. They are combined to achieve nuanced control. The typical order of operations is: \`top_k\` and \`top_p\` filter the candidate pool, and then \`temperature\` is applied to sample from that final pool.

Here are some common "recipes" for engineering specific AI behaviors:

- **The Factual Analyst (Maximum Precision):**
    - \`temperature: 0.0\`
    - \`top_k\`: (irrelevant)
    - \`top_p\`: (irrelevant)
    - **Result:** The model will always produce the most statistically likely output. It will be highly consistent and deterministic, but utterly devoid of creativity.
- **The Creative Poet (Maximum Imagination):**
    - \`temperature: 0.9\`
    - \`top_k\`: 0 (disabled)
    - \`top_p: 0.95\`
    - **Result:** The model will be highly creative and surprising. The high \`top_p\` allows for a wide range of word choices, and the high \`temperature\` encourages the model to pick less obvious ones.
- **The Controlled Brainstormer (Balanced Creativity):**
    - \`temperature: 0.75\`
    - \`top_k: 50\`
    - \`top_p\`: 1.0 (disabled)
    - **Result:** The model is creative (\`temperature > 0.7\`) but is prevented from going completely off the rails by the \`top_k=50\` safety net, which filters out truly bizarre options.
- **The Reliable Generalist (Default Starting Point):**
    - \`temperature: 0.7\`
    - \`top_k\`: (disabled)
    - \`top_p: 0.9\`
    - **Result:** A good, balanced configuration that is suitable for a wide variety of tasks. It is creative but not excessively random, thanks to the adaptive nature of \`top_p\`.

## 22.5 Conclusion: The Final Layer of Command

The Parameter Tuning Strategy represents the final and most direct layer of behavioral control. While the prompt text shapes the model's knowledge and intent, the parameters shape its very personalityits tendency towards rigor or randomness, precision or poetry.

An elite prompt engineer understands that their job does not end when they finish writing the prompt. They must also consider the optimal performance characteristics for the task at hand. By thoughtfully selecting the right combination of temperature, Top-K, and Top-P, you can fine-tune the AI's predictive mind, ensuring that its output is not only correct in content but also perfectly aligned in character with the needs of your application. This is the ultimate expression of engineering the AI's behavior.

# Chapter 23: The Long Context Strategy: Optimizing for Prompts with Large Volumes of Data

## 23.1 A New Frontier: The Ocean of Context

For years, a fundamental constraint has shaped the entire discipline of prompt engineering: the limited size of the context window. Prompts were measured in a few thousand tokens, forcing engineers to become masters of compression, summarization, and complex external workflows like Retrieval-Augmented Generation (RAG) to feed necessary information to the AI.

The advent of massive context windowsranging from 100,000 to over a million tokensrepresents a paradigm shift. The door has been thrown open. It is now theoretically possible to place an entire novel, a dense quarterly report, a full codebase, or hours of meeting transcripts directly into a single prompt. The promise is intoxicating: an AI with perfect, instantaneous recall of a vast and immediate body of knowledge.

However, this new frontier is not a paradise of simplicity. It is a vast ocean, and navigating it requires a new set of skills. The nave approachsimply dumping terabytes of raw text into a prompt and hoping for the bestis a recipe for failure. The AI, faced with this overwhelming flood of information, can easily get lost. The crucial detail you need becomes a single, proverbial needle in a colossal haystack. The **Long Context Strategy** is the art and science of structuring and managing these massive prompts to ensure the AI can not only access the information within them but also reason over it effectively and reliably.

## 23.2 The Nave Approach and Its Inevitable Failures

Let's first diagnose the problems that arise when a long context prompt is not optimized.

1. **The "Lost in the Middle" Problem:** Extensive research has shown that an LLM's attention is not evenly distributed across a long context window. It pays the most attention to the information presented at the **very beginning** and the **very end** of the prompt. Information buried deep in the middle of a long document is far more likely to be overlooked or ignored. Simply pasting a 100-page document and then asking a question about a detail on page 50 is a high-risk gamble.
2. **Attention Dilution:** The more information you provide, the more the model's finite "attention" is diluted. If 99% of the provided text is irrelevant to your specific question, the model has to expend significant computational effort to filter out the noise and identify the signal. This can lead to slower response times and a higher chance of focusing on the wrong details.
3. **Increased Latency and Cost:** Long context prompts are computationally expensive. Processing hundreds of thousands of tokens takes significantly more time and incurs higher API costs than a concise prompt. Every token counts, and inefficiently structured prompts waste both time and money.
4. **The Risk of Contradiction and Confusion:** Large volumes of text, especially from multiple sources, often contain conflicting or subtly different information. An unstructured data dump can confuse the model, leading it to produce a hedged, vague, or self-contradictory answer as it tries to reconcile all the information it has been given.

## 23.3 The Rationale: Working with the Grain of AI Attention

To build effective long context strategies, we must architect our prompts in a way that works *with* the model's natural attention patterns, not against them. The core principle is to make it as easy as possible for the AI to find and focus on the most relevant information. We must shift our role from that of a data dumper to that of an expert librarian, carefully curating and indexing the information before handing it to the researcher.

## 23.4 A Toolkit of Long Context Optimization Strategies

### 23.4.1 Principle 1: The "Instructions Last" Rule (The Recency Bias Lever)

This is the single most important and effective principle for long context prompting. Due to the model's strong recency bias, the information it sees last has the most influence on its immediate output.

**Therefore, you must always place your core instruction, question, or task at the very end of the prompt, *after* all the supporting documents and data have been presented.**

- **Ineffective Structure:**\`[INSTRUCTION] -> [DOCUMENT A] -> [DOCUMENT B] -> [DOCUMENT C]\`
- **Highly Effective Structure:**\`[DOCUMENT A] -> [DOCUMENT B] -> [DOCUMENT C] -> [INSTRUCTION]\`

By placing the instruction last, you are focusing the model's attention on its immediate goal right at the moment of generation, ensuring it approaches the vast context with a clear and present objective.

### 23.4.2 Principle 2: The Structural Imperative (The Librarian's Index)

As we discussed in Chapter 9, structure is control. In a long context prompt, it is absolutely essential. Do not just paste raw text. You must act as a librarian, cataloging and indexing your sources with clear, descriptive XML tags.

- **Why it works:** This creates a "mental map" for the AI. It helps the model to differentiate between sources, understand the type of information each contains, and reference them more accurately.
- **Example of a Structured Data Dump:**\`<documents> <document source="Q3_Earnings_Call_Transcript.txt" date="2023-10-26"> <content> [Full text of the transcript...] </content> </document> <document source="Internal_Marketing_Strategy_Memo.pdf" date="2023-09-15"> <content> [Full text of the memo...] </content> </document></documents>\`

### 23.4.3 Principle 3: The Active Retrieval Step (Forcing the Search)

To combat the "lost in the middle" problem, you can force the model to actively scan the entire context *before* it attempts to synthesize an answer. You do this by creating a two-part instruction.

- **Why it works:** This pre-processing step forces the model's attention mechanism to sweep through the entire document looking for specific keywords or concepts. The extracted snippets then form a new, much smaller, and highly relevant context from which the model can formulate its final answer.
- **Example of an Active Retrieval Prompt:**\`[Vast amount of medical research text pasted here...]\`
    
    \`### INSTRUCTIONS ###**Part 1: Quote Extraction**First, carefully review all the provided documents. Find and extract every sentence that discusses the side effects of the drug 'Exemplar'. Place these exact sentences, along with their source document name, inside <quotes> tags.\`
    
    - \`*Part 2: Synthesis**Now, using ONLY the information you gathered in the <quotes> tag, write a concise summary of the known side effects of 'Exemplar'.\`

### 23.4.4 Principle 4: The Indexing and Summarization Preamble (The Abstract)

For exceptionally large or numerous documents, you can provide the model with a roadmap at the very beginning of the prompt.

- **Why it works:** By providing a concise summary or a table of contents of the documents you are about to provide, you are giving the model a high-level index. This "abstract" primes the model, helping it to anticipate the structure and content of the data and locate information more efficiently.
- **Example of a Preamble:**\`I am providing you with three documents to analyze:1. **Document 1:** The 2023 Annual Financial Report, focusing on revenue and profit.2. **Document 2:** A competitive analysis of our top three rivals.3. **Document 3:** The transcript of our recent strategic planning offsite.\`
    
    \`Your task will be to synthesize a strategic recommendation based on these documents. The full text of the documents follows below.\`
    
    \`<document_1>... </document_1><document_2>... </document_2><document_3>... </document_3>\`
    
    \`### FINAL TASK ###[Instruction placed at the end]\`
    

## 23.5 A Practical Walkthrough: The Elite Long Context Prompt

Let's combine these principles to create a gold-standard prompt for a complex, multi-document analysis task.

- **Nave, Ineffective Prompt:**\`"Summarize the main risks for our company based on these three documents.[Paste 50 pages of Document A][Paste 30 pages of Document B][Paste 20 pages of Document C]"\`
- **Elite, Optimized Long Context Prompt:**\`I am providing three key documents for a risk analysis.**Source 1:** The annual financial report.**Source 2:** The latest cybersecurity audit.**Source 3:** A collection of recent customer feedback.\`
    
    \`The full text of these documents is provided below, enclosed in XML tags.\`
    
    \`<source name="Annual Financial Report">[...50 pages of text...]</source>\`
    
    \`<source name="Cybersecurity Audit">[...30 pages of text...]</source>\`
    
    \`<source name="Customer Feedback">[...20 pages of text...]</source>\`
    
    \`### FINAL INSTRUCTIONS ###You are a Chief Risk Officer preparing a briefing for the Board of Directors.Your task is to identify the top 3 strategic risks facing the company, based *only* on the information provided in the sources above.\`
    
    \`Follow this two-step process:1.  **Evidence Extraction:** First, for each of the three risk categories (Financial, Cybersecurity, Reputational), find and extract up to three direct quotes from the provided sources that best exemplify that risk. You must cite the source name for each quote.2.  **Executive Summary:** After extracting the evidence, write a concise executive summary. The summary should list the three risks you identified and, for each risk, provide a brief explanation of its potential impact, using the evidence you extracted.\`
    

## 23.6 Conclusion: The Curator of Context

The advent of massive context windows does not simplify prompt engineering; it makes it a more sophisticated discipline. It shifts the engineer's role from a writer of concise instructions to a curator of vast information landscapes.

Success in this new paradigm is not about how much data you can provide, but about how well you can structure, index, and guide the AI's attention within that data. By embracing the principles of placing instructions last, building a structural map, forcing active retrieval, and providing a guiding preamble, you can transform the colossal haystack of a long context prompt into a well-organized, searchable library. This is the key to unlocking the full, game-changing potential of large-scale, in-context reasoning.

# Chapter 24: The Code Prompting Strategy: Best Practices for Generation, Debugging, and Translation

## 24.1 The New Pair Programmer: AI as a Software Development Collaborator

The advent of powerful, code-fluent Large Language Models has irrevocably altered the landscape of software development. These models, trained on a colossal corpus of open-source code from repositories like GitHub, have ingested billions of lines of code across dozens of programming languages. They have learned not just the syntax and grammar, but the patterns, idioms, best practices, and even the common mistakes that define the craft of programming.

This presents a revolutionary opportunity. The AI is no longer just a tool for answering questions *about* code; it is a tool for actively writing, analyzing, and transforming code. It is the new, tireless pair programmera collaborator with encyclopedic knowledge, available 24/7 to accelerate the development lifecycle.

However, like any powerful tool, its effectiveness is entirely dependent on the skill of the operator. A lazy or ambiguous request will yield code that is generic, inefficient, insecure, or simply wrong. The **Code Prompting Strategy** is the specialized discipline of crafting precise, context-rich, and constraint-aware prompts to harness the full potential of the AI as a software engineering partner. This chapter will provide a systematic framework for the three core tasks in this domain: code generation, debugging, and translation.

## 24.2 The Rationale: Why AI Excels at the Language of Logic

Code, in its essence, is a language. It is a language with a far stricter and more logical grammar than human prose. This structural rigidity is precisely what makes it an ideal domain for LLMs.

- **Pattern Recognition:** Software development is deeply pattern-based. Design patterns, architectural styles, and common algorithms are repeated across millions of projects. The LLM excels at recognizing these patterns and applying them to new problems.
- **Vast Knowledge Base:** The model has seen more code than any human ever could. It has seen the same problem solved in a hundred different ways, in a dozen different languages. A good prompt is a precise query into this vast, implicit knowledge base.
- **Syntactic Perfection:** While the model might make logical errors, it rarely makes syntactic ones. It can generate boilerplate code, function signatures, and complex data structures with perfect syntax, freeing the human developer to focus on the higher-level logic.

## 24.3 Code Generation: The Architect's Blueprint

Code generation is the act of creating new code from a natural language specification. The primary challenge is to move from a vague idea to a robust, production-ready implementation. This requires treating the prompt not as a request, but as a formal **technical specification**.

### Principle 1: Provide the Full Operational Context

Never ask for code in a vacuum. The AI must understand the environment in which the code will live.

- **Environment:** Specify the programming language, version, and any relevant frameworks or libraries (e.g., "Python 3.11 using the FastAPI framework," "React 18 with TypeScript").
- **Constraints:** State any limitations. This is one of the most powerful levers for controlling the output. Examples:
    - "Must use only the Python standard library."
    - "The solution must not use recursion."
    - "The function must have a time complexity of O(n) or better."
- **Purpose:** Explain the "why." Code for a high-traffic e-commerce checkout has different requirements than a one-off data analysis script.

### Principle 2: Decompose the Logic Step-by-Step

Use a Chain-of-Thought approach to outline the required functionality. This forces the AI to build the code in a logical, structured manner.

- **Prompt Snippet:**\`"Generate a function that performs the following steps:1. Accepts a file path as an argument.2. Opens and reads the content of the file.3. Counts the frequency of each word in the text.4. Returns a dictionary where keys are words and values are their counts."\`

### Principle 3: Specify the "Non-Functional" Requirements

Elite code prompting goes beyond the logic to define the characteristics of high-quality, professional code. Explicitly demand these features.

- **Documentation:** "The function must include a comprehensive docstring in the Google Python Style."
- **Error Handling:** "The code must include robust error handling. Specifically, add a \`try...except\` block to handle \`FileNotFoundError\` and \`PermissionError\`."
- **Type Hinting:** "All function arguments and return values must have full type hints."
- **Testing:** "After writing the function, generate a set of three unit tests for it using the \`pytest\` framework. The tests should cover a normal case, an empty file, and a file that doesn't exist."

### Gold-Standard Generation Prompt

- **Weak Prompt:** \`"Write a Python function to parse a log file."\`
- **Elite Prompt:**\`"I am building a server monitoring tool in Python 3.10.\`
    - \`*Task:** Write a Python function named \\\\\`parse_log_entry\\ \`that takes a single log line string as input and extracts the timestamp, log level, and message.The log format is: \\\\\`[YYYY-MM-DD HH:MM:SS] [LEVEL] Message\\\`\`
    - \`*Requirements:**1. The function must use Python's \\\\\`re\\ \`(regex) module.2. It must return a dictionary with three keys: 'timestamp', 'level', and 'message'.3. It must include full type hints for the argument and the return value (which should be a TypedDict or a regular dict).4. It must be wrapped in a \\\\\`try...except\\ \`block to handle lines that do not match the format, returning \\\\\`None\\ \`in case of a mismatch.5. It must include a complete docstring explaining its function, arguments, and return value.6. After the function, provide a simple \\\\\`pytest\\ \`unit test to verify its correctness with a sample log line."\`

## 24.4 Code Debugging: The Surgeon's Diagnosis

Debugging is an analytical task. The AI's role is to act as a diagnostic expert. To do this effectively, it needs all the evidence.

### Principle 1: Provide the Complete Case File

A doctor cannot diagnose a patient over the phone with a vague description of "it hurts." An AI cannot debug code with just a snippet. You must provide the full context.

- **The Exact Code:** The smallest, self-contained, reproducible example of the code that is failing.
- **The Full Error Message:** This is non-negotiable. Paste the *entire* traceback, from the first line to the last. It contains crucial clues about the execution stack.
- **The Environment:** The language, version, and libraries in use.
- **The Expected vs. Actual Behavior:** Clearly state, "I expected the output to be [X], but the actual output is [Y]."

### Principle 2: Guide the Diagnostic Process

Do not just ask for a fix. Command the AI to reason through the problem like an expert.

- **Prompt Snippet:**\`"My goal is to debug the following code.*Step 1: Explain the Error.** First, explain what the traceback message \\\\\`TypeError: can only concatenate str (not "int") to str\\ \`means in the context of my code.*Step 2: Trace the Fault.** Second, trace the execution path and identify the exact line and variable that is causing this type mismatch.*Step 3: Propose and Explain the Fix.** Third, provide the corrected code and explain why the change resolves the error."\`

### Gold-Standard Debugging Prompt

- **Weak Prompt:** \`"Why is my code broken? \\\\\`for i in range(5): print('Number: ' + i)\\\`"\`
- **Elite Prompt:**\`"I am running the following Python 3.9 script and getting an error.\`
    - \`*Code:**\\\\\`\\\`\\\\\`python \`\`for i in range(5): \`\` print('Number: ' + i) \`\`\\\`\\\\\`\\\`\`
    - \`*Error Traceback:**\\\\\`\\\`\\\\\`  \`\`Traceback (most recent call last): \`\` File "[main.py](http://main.py/)", line 2, in <module> \`\` print('Number: ' + i) \`\`TypeError: can only concatenate str (not "int") to str \`\`\\\`\\\\\`\\\`\`
    - \`*Expected Behavior:** I expected it to print "Number: 0", "Number: 1", etc.*Actual Behavior:** It throws a TypeError.\`
    - \`*Task:**1. Explain the \\\\\`TypeError\\ \`in plain English.2. Identify the root cause of the error in my code.3. Provide the corrected, working code using an f-string, which is the modern best practice."\`

## 24.5 Code Translation: The Expert Linguist's Work

Translating code is a migration task fraught with peril. A literal, line-by-line translation often results in code that is syntactically correct but inefficient, insecure, or "unpythonic" / "un-javascripty." The goal is not just translation, but **idiomatic adaptation**.

### Principle 1: Demand Idiomatic Code

This is the most important concept in code translation. You must explicitly command the model to write code that feels "native" to the target language.

- **Prompt Snippet:**\`"Translate the following Python code into idiomatic JavaScript (ES6+). Do not perform a literal, line-by-line translation. Instead, adapt the logic to use modern JavaScript patterns, such as \\\\\`async/await\\ \`instead of Promises, and \\\\\`map\\ \`or \\\\\`filter\\ \`instead of for-loops where appropriate."\`

### Principle 2: Manage the Dependency Mapping

A huge part of translation is mapping libraries and frameworks. Guide the AI in this process.

- **Prompt Snippet:**\`"The source Python code uses the \\\\\`requests\\ \`library for making HTTP calls. The target is Node.js. In the translated code, use the \\\\\`axios\\ \`library as the equivalent for \\\\\`requests\\\`."\`

### Gold-Standard Translation Prompt

- **Weak Prompt:** \`"Convert this Python to JavaScript."\`
- **Elite Prompt:**\`"**Task:** Translate a Python script to modern, idiomatic Node.js.\`
    - \`*Source (Python 3.9):**\\\\\`\\\`\\\\\`python \`\`import requests\`
    
    \`def get_user_data(user_id):    response = requests.get(f'<https://api.example.com/users/{user_id}>')    return response.json()\\\\\`\\\`\\\`\`
    
    - \`*Target (Node.js v18):**Translate the above Python function into an asynchronous JavaScript function.\`
    - \`*Requirements:**1. The translated code must use the \\\\\`axios\\ \`library to handle the HTTP GET request.2. The code must be idiomatic ES6+, using \\\\\`async/await\\ \`syntax.3. Include a basic JSDoc comment block for the translated function."\`

## 24.6 Conclusion: The Developer as Architect and QA

The Code Prompting Strategy does not replace the developer. It elevates them. It automates the laborious, pattern-based work of writing boilerplate, diagnosing common errors, and performing routine translations. This frees the human developer to focus on the tasks that truly require their expertise: system architecture, complex logical design, strategic decision-making, and the final, critical act of quality assurance.

By mastering the art of writing precise, comprehensive, and context-aware specifications in your prompts, you transform the AI from a simple code generator into a powerful, collaborative partner in the intricate and creative dance of software development.

# Chapter 25: The Automatic Prompt Engineering (APE) Strategy: Using AI to Generate and Optimize Prompts

## 25.1 The Meta-Problem: Prompting is Hard

Throughout this guide, we have explored the intricate art and science of prompt engineering. We have learned to be specific, to provide context, to structure our requests, and to guide the AI's reasoning. We have seen that crafting an elite prompt is a high-skill, iterative, and often time-consuming process. The irony is profound: we are expending significant human effort to optimize our communication with a machine designed to save us effort.

This naturally leads to a "meta-question": If Large Language Models are so adept at generating complex, structured text, could we turn this capability upon the problem of prompting itself? Could an AI be used to engineer the very prompts that guide another AI?

The answer is a resounding yes, and the formalization of this idea is known as the **Automatic Prompt Engineering (APE) Strategy**. This is a cutting-edge and meta-level technique that uses an LLM as a tool to generate and refine a diverse set of prompt candidates for a given task. It is the art of prompting an AI to become a prompt engineer.

## 25.2 The Core Idea: Framing Prompt Generation as a Synthesis Problem

The APE strategy re-frames the challenge of finding the best prompt. Instead of relying on a single human's intuition and iterative tinkering, it treats the problem as a search and optimization task. The goal is to explore a wide "prompt space" of possible instructions and then select the one that performs the best.

The process, at its core, involves a two-stage, AI-driven workflow:

1. **Prompt Generation (The "Instruction Induction" Phase):** An LLM (let's call it the **"Meta-LLM"**) is given a few examples of input-output pairs for a target task. It is then prompted to act as an AI researcher and "induce" a set of possible instruction prompts that could have produced those outputs from those inputs. It doesn't just generate one instruction; it is prompted to brainstorm a diverse set of candidates with different phrasings, structures, and levels of detail.
2. **Prompt Selection (The "Scoring" Phase):** The generated instruction candidates are then evaluated. In a fully automated system, each candidate prompt is used to query a separate, target LLM with a test input. The target LLM's output is then scored for quality against a desired "gold standard" output using an evaluation metric (or even another LLM acting as a judge). The instruction prompt that yields the highest score is declared the winner.

This strategy automates the creative and laborious process of prompt discovery, leveraging the AI's own linguistic and reasoning capabilities to find the most effective ways to instruct itself.

## 25.3 The Rationale: Why AI Can Out-Engineer a Human Prompter

Using an AI to generate prompts might seem circular, but it is effective for several key reasons.

1. **Diversity of Phrasing:** An LLM can brainstorm a far wider and more diverse range of syntactically and semantically different ways to phrase an instruction than a human can in a short amount of time. It can explore subtle variations in wording that a human might not consider, some of which may resonate more effectively with the target model's internal representations.
2. **Uncovering "Un-Human" Prompts:** Sometimes, the most effective prompts are not the ones that sound most natural to a human. They may contain specific keywords, phrasings, or structures that, for reasons related to the model's training data, are particularly potent at triggering the desired behavior. The APE process can discover these "un-human" but highly effective instructions.
3. **Scalability and Speed:** The APE process can be automated to generate and test hundreds of prompt candidates in the time it would take a human to manually iterate through a handful. This allows for a much more comprehensive search of the "prompt space."
4. **Alleviating Human Bottlenecks:** It frees up human engineers from the time-consuming task of prompt tinkering, allowing them to focus on the higher-level problems of defining the task, creating the evaluation criteria, and designing the overall system architecture.

## 25.4 A Practical Walkthrough: Finding the Best Prompt for a Chatbot

Let's imagine we are training a chatbot for an e-commerce store that sells band t-shirts. We want to find the best way to instruct the model to handle a customer's order.

**The Goal:** Find the best prompt for a task where the input is a customer request and the output is a standardized order summary.

### **Step 1: Define the Task with Examples**

First, we manually create a few high-quality input-output pairs that define our goal. These will be the foundation for the APE process.

- **Input 1:** \`"I'd like to order one Metallica t-shirt in size S."\`
- **Output 1:** \`Band: Metallica, Item: T-Shirt, Quantity: 1, Size: S\`
- **Input 2:** \`"Can you get me two small Ramones shirts?"\`
- **Output 2:** \`Band: Ramones, Item: T-Shirt, Quantity: 2, Size: S\`

### **Step 2: The Generation Phase (Using the "Meta-LLM")**

Now, we craft a prompt for our Meta-LLM. This prompt will ask it to generate a list of possible instruction prompts that could solve the task defined by our examples.

- **The APE Generation Prompt:**\`"I am an AI prompt engineer. I have a task where I need to take a user's request and turn it into a structured order summary. I will give you a few examples of the input and the desired output.\`
    
    \`<examples>Input: "I'd like to order one Metallica t-shirt in size S."Output: "Band: Metallica, Item: T-Shirt, Quantity: 1, Size: S"\`
    
    \`Input: "Can you get me two small Ramones shirts?"Output: "Band: Ramones, Item: T-Shirt, Quantity: 2, Size: S"</examples>\`
    
    \`Based on these examples, generate 10 diverse and high-quality instruction prompts that I could give to a large language model to make it perform this task. The instructions should be phrased in different wayssome as direct commands, some by setting a persona, etc. Provide the list of generated instructions."\`
    
- **Possible Output from the Meta-LLM (A List of Candidate Prompts):**
    1. "Extract the band name, item type, quantity, and size from the user's request and format it as: Band: [band], Item: [item], Quantity: [qty], Size: [size]."
    2. "You are an e-commerce order processing bot. Your sole function is to parse a customer's message and output a structured summary of their order."
    3. "Given a customer's t-shirt order, identify the four key entities (Band, Item, Quantity, Size) and present them in a key-value format."
    4. "Convert the following natural language order into a structured data string."
    5. ... and so on.

### **Step 3: The Selection Phase (Scoring the Candidates)**

Now we have a list of 10 promising prompts. The next step is to find out which one works best.

- **Manual Approach:** A human engineer can take this list and manually test each of the 10 prompts with a new, unseen input (a "test case").
    - **Test Input:** \`"I need a large Rolling Stones tee."\`
    - The engineer would then run this test input with each of the 10 candidate prompts and subjectively judge which one produces the most accurate and reliable output.
- **Automated Approach:** In a more advanced setup, you would have a larger set of test cases. A script would programmatically:
    1. Loop through each of the 10 candidate prompts.
    2. For each candidate, loop through all the test cases.
    3. Execute an API call using the candidate prompt and the test input.
    4. Compare the AI's actual output to the known "correct" output for that test case.
    5. Calculate an accuracy score for each of the 10 candidate prompts.
    6. The prompt with the highest score is selected as the optimal one.

## 25.5 The "Power Prompt" Shortcut: A Simplified APE Workflow

A fully automated APE pipeline can be complex to set up. However, a simplified, manual version of this strategy can be incredibly useful for any prompt engineer. This is the "Power Prompt" or "Prompt Refinement" technique.

- **The Workflow:**
    1. Write your best initial attempt at a prompt.
    2. Feed that prompt to an AI with a meta-instruction.
- **Example Prompt Refinement Prompt:**\`"I am trying to write a good prompt for a task. My current draft is below.\`
    
    \`<my_prompt>"Summarize the text."</my_prompt>\`
    
    \`Your task is to act as an expert prompt engineer. Critique my prompt and then rewrite it to be a 'power prompt'. The rewritten prompt should be much more detailed, specific, and follow all the best practices for prompt engineering. It should ask for the summary to have a specific length, a target audience, and a particular format."\`
    

This technique uses the AI as a collaborative partner to improve your own work, automating the brainstorming process of prompt optimization.

## 25.6 Conclusion: Turning the Crank on Optimization

The Automatic Prompt Engineering strategy represents the next frontier of the discipline. It is the moment where the tools of AI are turned back upon themselves to optimize their own use. It embodies a shift from manual, intuitive artistry to a more systematic, data-driven, and scalable science of instruction design.

While a fully automated APE pipeline is an advanced application, the core principleusing an AI to brainstorm, diversify, and refine promptsis a powerful technique that any practitioner can adopt. It is a testament to the recursive power of these models and a signal that the future of engineering AI systems will involve a deep and symbiotic partnership, where we not only guide the AI, but also leverage the AI to help us become better guides.

# Chapter 26: The Documentation Strategy: The Critical Discipline of Tracking and Versioning Prompts

## 26.1 The Ghost in the Machine: The Peril of the Undocumented Prompt

In the fast-paced, iterative world of prompt engineering, it is easy to get lost in the creative flow. You are in a chat window, rapidly testing variations of a prompt, tweaking a word here, adding a constraint there, until, finally, you achieve the perfect output. You copy the result, use it for your task, and move on, triumphant.

A week later, you need to perform the same task. You open a new chat window and try to remember the magic words you used. Was it "You are an expert" or "I am an expert"? Did you ask for a JSON object or a Markdown table? Was the temperature set to 0.2 or 0.7? The ghost of your perfect prompt haunts you, but its exact form is lost to the ephemeral history of a browser tab.

This is not a minor inconvenience; it is a catastrophic failure of process. An undocumented prompt is a non-existent asset. It is a piece of intellectual property that has vanished into the ether. For any serious application of AI, from a personal workflow to a production-grade system, a reactive, ad-hoc approach to prompting is unsustainable, unscalable, and unprofessional.

The **Documentation Strategy** is the critical, non-negotiable discipline of systematically tracking, versioning, and evaluating your prompts. It is the process of treating your prompts with the same rigor and respect as you would treat source code. It is the bridge between a one-off clever trick and a robust, repeatable, and maintainable AI-powered system.

## 26.2 The Rationale: Why Prompts Are Mission-Critical Code

It is a common mistake to view prompts as mere "input" or "configuration." This fundamentally misunderstands their role. In an AI-powered system, the prompt is the engine. It is the core logic that dictates the system's behavior. Therefore, it must be treated as a first-class citizen in your engineering lifecycle.

1. **Repeatability and Consistency:** A documented prompt guarantees that you can achieve the exact same high-quality result, every single time. It is the foundation of a consistent and predictable process.
2. **Collaboration and Knowledge Sharing:** When prompts are documented in a shared, structured format, they become a collective asset. A prompt perfected by one team member for a specific task can be discovered, adapted, and reused by others, preventing the constant reinvention of the wheel and accelerating the entire organization's AI maturity.
3. **Debugging and Troubleshooting:** When an AI system starts producing flawed outputs, the first question should be, "What changed?" Without a versioned history of your prompts, this question is impossible to answer. A well-documented prompt log allows you to see exactly which version of a prompt was used for a given task, making it infinitely easier to identify the root cause of a failure.
4. **Regression Testing and Model Upgrades:** LLM providers are constantly releasing new and updated models. A new model version, while generally more capable, can sometimes respond differently to the same prompt. A library of well-documented prompts, along with their expected "gold standard" outputs, forms a critical **regression test suite**. When a new model is released, you can programmatically run your key prompts against it to instantly identify any breaking changes or regressions in behavior.
5. **A Record of Your Learning:** The iterative process of prompt engineering is a process of discovery. Your documentation becomes a logbook of this journey. It shows what you tried, what worked, what didn't, and why. This record is an invaluable learning tool that helps you and your team become better, more effective prompt engineers over time.

## 26.3 The Anatomy of an Elite Prompt Document

Effective documentation is more than just saving the prompt text in a file. An elite prompt document is a comprehensive record that captures the entire context of the prompt's creation and execution. While the format can vary (a spreadsheet, a dedicated database, a text file in a Git repository), the essential components remain the same.

A comprehensive template for a single prompt record should include the following fields:

- **Prompt Name / ID:** A unique, human-readable name for the prompt (e.g., \`EmailSummarizer_ExecutiveBriefing_v2\`).
- **Version:** A clear version number (e.g., \`1.0\`, \`1.1\`, \`2.0\`). Use semantic versioning if possible.
- **Goal / Objective:** A one-sentence description of what this prompt is intended to achieve.
- **Author:** The person who created or last modified the prompt.
- **Date Created / Modified:** Timestamps for tracking its history.
- **Model(s) Used:** The specific model and version against which this prompt was tested and optimized (e.g., \`gpt-4-turbo-2024-04-09\`, \`claude-3-opus-20240229\`).
- **Parameters:** The exact generation parameters used:
    - \`Temperature\`
    - \`Top-P\`
    - \`Top-K\`
    - \`Max Tokens\`
- **Prompt Text (The Core Component):**
    - **System Prompt:** The full text of the system prompt, if applicable.
    - **User Prompt:** The full text of the user prompt. For templates, use clear placeholders (e.g., \`{{DOCUMENT_TEXT}}\`).
- **Example Input:** A representative example of the data that would be inserted into the prompt's placeholders.
- **Gold-Standard Output:** The ideal, "perfect" output that this prompt is expected to generate for the example input. This is crucial for evaluation and regression testing.
- **Actual Output:** The actual output generated by the model during the last test run.
- **Evaluation:** A field for scoring or qualitative assessment (e.g., \`OK\`, \`NOT OK\`, \`SOMETIMES OK\`, or a numerical score).
- **Notes / Rationale:** This is the most important field for learning and collaboration. It should explain the *why* behind the prompt's design. Why were certain words chosen? What did previous, failed versions look like? What trade-offs were made?

## 26.4 A Practical Workflow: Prompts in a Version Control System

For professional software development teams, the gold standard for managing prompts is to treat them exactly like source code: **store them in a version control system like Git.**

- **The "Prompt Library":** Create a dedicated directory in your project's repository called \`/prompts\` or \`/prompt_library\`.
- **Structured Storage:** Store each prompt in its own file. A good practice is to use a structured format like YAML or JSON to store the prompt's metadata alongside its text.

**Example: \`summarize_earnings_report.v1.yaml\`**

\`\`\`yaml
name: SummarizeEarningsReport
version: 1.0
author: Jane Doe
date: "2024-05-10"
goal: "Summarizes a quarterly earnings report for a non-technical executive audience."

model_settings:
  model_name: "claude-3-opus-20240229"
  temperature: 0.2
  max_tokens: 60000

prompt:
  system: "You are a senior financial analyst known for your ability to distill complex financial data into clear, concise business insights."
  user: |
    Analyze the following earnings report.

    <report_text>
    {{EARNINGS_REPORT}}
    </report_text>

    Your task is to produce a three-paragraph executive summary. The summary must focus on the business implications of the results, avoiding financial jargon. Conclude with the single most important question you would ask the CEO based on this report.

\`\`\`

- **The Power of Git:** By storing prompts in this way, you get all the benefits of version control for free:
    - **History:** You have a complete, auditable history of every change made to every prompt.
    - **Collaboration:** Team members can work on prompts in separate branches, submit pull requests for review, and leave comments.
    - **Integration:** Your application code can now load these prompt files directly, ensuring that the code and the prompts are always in sync.

## 26.5 Conclusion: From a Fleeting Art to an Enduring Asset

The Documentation Strategy is the discipline that elevates prompt engineering from a fleeting, conversational art form into a robust, scalable engineering practice. It is the act of capturing and preserving the intellectual property that you create every time you perfect a prompt.

An undocumented prompt is a liability. It is a single point of failure waiting to be forgotten. A well-documented, versioned prompt is an asset. It is a repeatable, maintainable, and improvable component of your intelligent system. Adopting a rigorous documentation strategy is the most important step you can take to ensure that your investment in prompt engineering pays lasting dividends, creating a foundation of quality and consistency that will support your AI-powered applications long into the future.

# Chapter 27: Conclusion: A Unified Framework for Elite Prompt Engineering

## 27.1 The End of the Beginning: From Tactics to a Unified Philosophy

We have journeyed through the intricate landscape of prompt engineering, moving from the foundational art of a simple question to the complex science of architecting multi-agent systems. We have dissected the anatomy of a prompt, mastered the distinction between a system's constitution and a user's directive, and collected a powerful toolkit of over a dozen distinct strategies. We have learned to guide the AI's reasoning, structure its output, and even command it to critique and correct itself.

Each chapter has presented a piece of the puzzle, a specific tactic for a specific challenge. Now, in this final chapter, we must assemble these pieces. The ultimate goal of an elite prompt engineer is not to merely possess a collection of disconnected tricks, but to operate from a **Unified Framework**a coherent philosophy and a systematic approach that guides every interaction with an AI.

This framework is not a rigid set of rules, but a mental model for building intelligent, reliable, and powerful human-AI collaborations. It is built upon three core pillars: **Architecture**, **Conversation**, and **Discipline**.

## 27.2 Pillar 1: The Principle of Architecture

The first and most profound shift in mindset is to stop seeing prompts as isolated questions and to start seeing them as components in a larger **architecture**. An elite prompter is, first and foremost, a systems architect.

This means embracing a structured, top-down design process for every complex task:

1. **Deconstruct the Workflow:** Before writing a single word, deconstruct your complex goal into its constituent parts. Identify the distinct cognitive tasks required. Is there a phase for research? A phase for brainstorming? A phase for logical analysis? A phase for formatting? This deconstruction is the blueprint for your system.
2. **Choose Your Architectural Pattern:** Based on this blueprint, select the appropriate architectural pattern.
    - Is the task a simple, single-shot operation? A meticulously crafted **Zero-Shot Prompt** built on the principles of Context, Task, and Format will suffice.
    - Does it require a sequence of distinct, linear transformations? The **Prompt Chaining Strategy** is your assembly line.
    - Does it require the collaboration of different "mindsets" or expertises? The **Multi-Agent Strategy** is your expert team.
3. **Define the Foundation (The System Prompt):** For any persistent interaction, you must first architect the AI's "constitution." This is where you apply the **Persona Strategy**, instantiating an elite, expert identity for your collaborator. This is also where you apply the **Affirmative Direction Strategy**, defining the AI's core operational logic in positive, proactive terms. The system prompt is the unwavering foundation upon which the entire structure rests.

The architectural mindset forces you to think about focus, context isolation, and the flow of information. It is the practice of designing a clean, robust, and efficient "thought factory" before you ever ask it to produce a single thought.

## 27.3 Pillar 2: The Principle of Conversation

Once the architecture is in place, the interaction begins. This is where the architect puts on the hat of the director. The **Principle of Conversation** is the understanding that complex work is not a transaction, but a dialogue. It is an iterative process of steering, refining, and collaborating.

This pillar is built on the tactics of the **Constructive Guidance Strategy**:

1. **The First Output is a Draft:** Abandon the myth of the perfect first prompt. Treat the AI's initial response as a starting point, a block of marble ready to be sculpted.
2. **Steer with Precision:** Use the full toolkit of conversational steering. Provide **Constructive Feedback** instead of negative criticism. Use **Explicit State Management** to open and close tasks. When the conversation derails, use **Trajectory Correction via Editing** to clean the foundational context. For complex tasks, use the **Pre-Execution Calibration (Teach-Back) Method** to ensure alignment before work begins.
3. **Synthesize Advanced Reasoning Frameworks:** The conversation is where you deploy your most powerful reasoning tools.
    - When you need a transparent, logical deduction, you command a **Chain of Thought**.
    - When you need to explore multiple creative or strategic paths, you simulate a **Tree of Thoughts**, perhaps by instantiating a "committee of experts" within the dialogue.
    - When accuracy is paramount for a verifiable answer, you apply the **Self-Consistency Strategy**, running multiple conversational "takes" and seeking a consensus.

The conversational mindset is dynamic and adaptive. It is the recognition that the user is the prime mover, the active partner who guides the AI's immense potential toward a polished and perfect final product.

## 27.4 Pillar 3: The Principle of Discipline

Brilliant architecture and masterful conversation are fleeting if they are not captured and codified. The final pillar of the Unified Framework is **Discipline**. It is the professional practice that transforms prompting from a creative art into a reliable engineering discipline.

This pillar is embodied by two critical strategies:

1. **The Documentation Strategy:** You must treat your prompts as mission-critical assets. Every successful promptwith its specific wording, its model, its parameters, and its rationalemust be documented, versioned, and stored in a shared, accessible library. An undocumented prompt is a lost asset; a documented prompt is a reusable, improvable, and scalable component of your organization's intellectual property.
2. **The Mindset of Iteration and Evaluation:** Elite prompt engineering is a scientific process. It involves forming a hypothesis (the prompt), running an experiment (querying the AI), and analyzing the result. This requires a commitment to testing, to building regression suites, and to continuously refining your library of prompts as models evolve. It requires the discipline to never assume that a prompt that works today will work tomorrow, and the rigor to prove its effectiveness through empirical evaluation.

The principle of discipline ensures that your hard-won successes are not one-off triumphs, but the foundation of a robust and ever-improving system.

## 27.5 The Unified Framework in Action: A Final Synthesis

Let us see how these three pillars come together to solve a final, complex problem.

**Goal:** Create a comprehensive, data-driven marketing strategy for a new product.

1. **Architecture:**
    - *Deconstruction:* The task requires research, ideation, strategic planning, and content creation.
    - *Architectural Pattern:* A **Multi-Agent System** is ideal.
    - *Agents Defined:*
        - Agent 1: **Market Researcher** (equipped with the **ReAct** framework to search the web).
        - Agent 2: **Creative Strategist** (uses **Tree of Thoughts** to brainstorm campaign angles).
        - Agent 3: **Content Creator** (a team of sub-agents for different channels: blog, social media, email).
        - Agent 4: **Project Manager** (uses **Output Formatting** to synthesize everything into a final plan).
    - *Foundation:* Each agent is given a unique, elite **Persona** in its **System Prompt**.
2. **Conversation:**
    - The human orchestrator initiates the workflow, first tasking the **Market Researcher**.
    - The Researcher's output (a data report) is reviewed. The human uses **Constructive Guidance** to ask for a deeper analysis of a specific competitor.
    - The refined report is passed to the **Creative Strategist**. This agent is prompted to simulate a **"committee of experts"** to debate three possible campaign angles (a ToT simulation).
    - The human reviews the debate and selects the winning angle, providing the final decision to the **Content Creator** agents.
    - Each Content Creator generates its draft. The human provides iterative feedback to refine the copy.
3. **Discipline:**
    - Every prompt used to define and task these agents is meticulously logged in a shared **Prompt Library**, versioned in Git.
    - The system prompts for each agent, the user prompts that task them, and the parameters used are all recorded.
    - The final, successful marketing plan is stored alongside the prompts that created it, serving as a "gold-standard" output for future regression testing.

## 27.6 Conclusion: The Prompt Engineer as the Human-AI Conductor

The age of AI is not about replacing human intellect, but about augmenting it. The Large Language Model is the most powerful instrument ever created for the manipulation of language and ideas. But an instrument, no matter how powerful, needs a musician.

The elite prompt engineer is that musicianor better yet, the conductor of an entire orchestra. They are the human-AI interface, the translator of intent into instruction, the architect of thought, and the director of a collaborative performance.

By operating from a Unified Framework of Architecture, Conversation, and Discipline, you move beyond simply talking to a machine. You begin to design, guide, and manage intelligent systems. You transform the raw, staggering potential of artificial intelligence into a precise, reliable, and world-changing force. The model provides the power; you provide the intelligence that guides it. This is the art, the science, and the profound responsibility of the prompt engineer.`,Ix=`# Architecting Intelligence: Elite Prompt Engineering Guide

## Chapter 1: Philosophy of Prompting
### 1.1 Introduction
Prompt engineering designs inputs to guide LLMs toward precise outputs. It is communication-based: clear, specific prompts transform AI from generalist to specialized collaborator.

### 1.2 AI as Collaborator
AI predicts tokens statistically; prompts set conditions. Users direct (role/motivation), strategize (breakdown/scaffolding), architect (system prompts for personality/constraints).

### 1.3 Benefits
- Precision: Reduces ambiguity/ revisions.
- Efficiency: Faster complex tasks.
- Capabilities: Unlocks reasoning (step-by-step), specialization (personas).
- Specialization: E.g., code reviewer to legal analyst.

### 1.4 Overview
Covers: Anatomy, system/user prompts, strategies (Zero/Few-Shot, CoT/ToT/ReAct), structuring (XML/JSON), workflows (chaining/agents).

## Chapter 2: Anatomy of Prompt
### 2.1 Pillars: Context, Task, Format
Context (who/why), Task (what), Format (how). Weak prompts assume; elite eliminate ambiguity.

### 2.2 Context
- **Role:** Activates patterns. Less: "Analyze statements." More: "You are CFO of B2B SaaS; analyze Q2 for burn risks/growth drivers."
- **Background:** Grounds facts. Less: "Marketing email." More: "Innovate Inc. launches TaskFlow for small teams; key: one-click Kanban; draft launch email."
- **Audience:** Calibrates tone. Less: "Explain quantum." More (kid): "To 5th grader: coin heads/tails analogy." More (tech): "Superposition for undergrad: qubits vs. classical."
- **Goal:** Prioritizes. Less: "Summarize contract." More: "As CEO, identify financial/IP risks/liabilities."

### 2.3 Task
- **Verbs:** "Generate/Analyze/Rewrite"; avoid "Help/Can you."
- **Chunking:** Numbered steps. Less: "Blog on remote work: productivity/balance/titles/CTA." More: "1. 5 SEO titles. 2. 400-word post: productivity/balance examples. 3. CTA for comments."
- **Specificity:** Details. Less: "Improve code." More: "Refactor Python: 1. List comp for loops. 2. Type hints. 3. Docstring."
- **Constraints:** Affirmative. Less: "Japan trip, no expensive." More: "7-day Tokyo/Kyoto, $2000 post-flights; culture/hiking; meals <$25."

### 2.4 Format
- **Naming:** "Bulleted list/JSON/Markdown table."
- **Few-Shot:** Input-output example. Less: "Sentiment." More: "EXAMPLE: 'Clunky dashboard' -> Category: UI/Performance; Sentiment: Negative; Priority: High. NOW: 'Love integration, add Hubspot.'"
- **Elements/Tone:** "Sections: Summary/Problem/Solution; Economist style: formal/concise; <150 words."

### 2.5 Synthesis
Basic: "Email on update." Elite: **[Context]** PM for Phoenix; API delay, workaround. **[Task]** 1. Progress. 2. Delay. 3. Cause (supplier issue). 4. Solution/date. **[Format]** Subject: 'Update & Date'; professional/reassuring; <200 words.

## Chapter 3: System vs. User Prompts
### 3.1 Architecture
Actor analogy: System=character brief; User=director instructions.

### 3.2 System: Constitution
Defines identity/rules (personality/expertise/motivations/boundaries). API: system role; persistent/high-level.

### 3.3 User: Directives
Task-specific/dynamic. API: user role; action-driven/contextual.

### 3.4 Synergy/Pitfalls
Harmony: System persona + User execution. Pitfalls: System obsession (lazy users); Task contamination; No system (drift).

## Chapter 4: Zero-Shot
### 4.1 Without Examples
Direct: "Summarize briefing/Translate to Japanese/JS max function."

### 4.2 Mechanism
Activates training patterns (e.g., article-summary pairs).

### 4.3 Strengths/Uses
Simplicity/efficiency. Summarization: "3 bullets from abstract." Translation: "Formal Spanish: 'Finalize by Friday.'" QA: "Primary Q3 decline cause." Classification: "Positive/Negative/Neutral: 'Intuitive but crashes.'" Style: "Professional: 'Hey, ASAP project.'" Code: "Array max."

### 4.4 Limits
Multi-step (bat/ball: $1.10 total, bat $1 more  ball $0.05, not $0.10); novel formats; nuances (internal categories).

### 4.5 Elite
Apply C/T/F: Weak: "Email on Orion." Elite: **[Context]** PM kickoff for app redesign (15% retention). **[Task]** 1. Goal/metric. 2. Thursday 10AM. 3. Ideas/challenges. **[Format]** Energetic/collaborative; Subject: 'Kicking Off!'; Email only.

### 4.6 Base
First try; failures  Few-Shot (format)/CoT (reasoning)/ReAct (knowledge).

## Chapter 5: Few/One-Shot
### 5.1 Showing
In-context learning: Examples infer rules.

### 5.2 Terms
Zero:0; One:1; Few:2-5 (3-5 optimal).

### 5.3 Mechanism
Examples as immediate pattern for prediction.

### 5.4 Uses
- Formats: JSON extract. EXAMPLE1: "John Doe john.d@email.com JD123"  {"user_name":"John Doe","contact_email":"john.d@email.com","id":"JD123"}. EXAMPLE2: ... NOW: "Jane jane.s@email.com JS_567."
- Classification: Tickets. "Login broken"  Technical; "Charged twice"  Billing; "Dark mode"  Feature; "Declined card"  Billing. NOW: "Add team: tier limit."
- Style: Cynical tweet. EXAMPLE: "Authentic app"  "IPO then 'optimized authenticity'." NOW: "Third camera lens."

### 5.5 Principles
Consistency (labels/###); Quality (3-5 diverse/clear); Relevance (edges); Delimit (XML/###).

### 5.6 Choice
One: Simple/constrained. Few: Complex/nuanced.

## Chapter 6: Persona
### 6.1 Specialist
Activates semantic fields for depth/standards.

### 6.2 Rationale
Priming: Constrains to expert patterns.

### 6.3 First-Person
"I am senior dev..." > "You are..."

### 6.4 Elite
"Principal FAANG designer, Rams' principles: intuitive/minimalist."

### 6.5 Archetype
"Linus Torvalds rigor" for blunt review.

### 6.6 Examples
Analysis: Generic summary vs. CFO: "Skeptical, shareholder focus; risks/inflated metrics; no spin."

## Chapter 7: Chain-of-Thought (CoT)
### 7.1 Explicit Reasoning
"Think step-by-step" for logic.

### 7.2 Mechanism
Intermediate steps improve accuracy.

### 7.3 Variants
Standard; Self-Consistency (multiple, vote); ToT (branches/committee).

### 7.4 Uses
Math/planning. Bat/ball: Steps  $0.05.

### 7.5 Elite
"Mathematician: Step-by-step."

## Chapter 8: ReAct
### 8.1 Reason+Act
Loop: ObserveThinkAct (tool)Observe.

### 8.2 Mechanism
E.g., QA: Think query  Search  Reason results.

### 8.3 Uses
Retrieval/agents. "Think: Need? Act: Query."

### 8.4 Elite
System tools; JSON actions.

## Chapter 9: Output Formatting
### 9.1 Structure
"JSON/table." Few-Shot examples. XML: <output>{json}</output>.

### 9.2 Uses
Extraction/reports.

## Chapter 10: Constructive Guidance
### 10.1 Refinement
"Improve: Add X, remove Y; urgent tone."

### 10.2 Principles
Positive/specific.

## Chapter 11: Prompt Chaining
### 11.1 Sequences
OutputInput. E.g., SummarizeAnalyzeRecommend. Modular/full context.

## Chapter 12: Multi-Agent
### 12.1 Teams
Agents (researcher/writer); Orchestrator/personas.

## Chapter 13: Self-Critique
### 13.1 Review
"Assess strengths/weaknesses; improve."

### 13.2 Uses
Loops.

## Chapter 14: Affirmative Direction
### 14.1 Positive
"Focus benefits" > "Don't risks."

## Chapter 15: State Management
### 15.1 Control
"Forget prior; new task."

## Chapter 16: Trajectory Correction
### 16.1 Edit
API: Edit messages for drifts.

## Chapter 17: Pre-Execution Calibration
### 17.1 Teach-Back
"Repeat task in words."

## Chapter 18: Parameter Tuning
### 18.1 Controls
- Temperature: 0-0.3 precision; 0.7-1 creativity.
- Top-K: K probable tokens.
- Top-P: Cumulative p (adaptive).

### 18.2 Recipes
Factual: 0.0. Creative: 0.9/Top-P 0.95. Balanced: 0.75/Top-K 50.

## Chapter 19: Long Context
### 19.1 Optimization
- Instructions last.
- XML tags: <document source="Q3.txt">...</document>.
- Retrieval: Extract quotes first.
- Preamble: TOC. E.g., 3 docs summary  Full texts  Task.

### 19.2 Elite
Preamble/sources  Instructions: 1. Extract quotes (financial/cyber/rep). 2. Summary impacts.

## Chapter 20: Code Prompting
### 20.1 Generation
Context (Python 3.10/FastAPI); Steps; Non-functional (docstring/errors/types/tests). Elite: parse_log_entry regex  Dict; try/except None; pytest.

### 20.2 Debugging
Full code/error/expected; Steps: ExplainTraceFix. Elite: str+int error  f-string.

### 20.3 Translation
Idiomatic (async/await/map); Libs (requestsaxios). Elite: Python get_user  Node async axios JSDoc.

## Chapter 21: Automatic Prompt Engineering (APE)
### 21.1 Meta
AI generates/refines from examples.

### 21.2 Workflow
Generate 10 instructions from I/O pairs; Score via tests/gold.

### 21.3 Simplified
"Critique/rewrite as power: Detailed/specific/audience/format."

E.g., Examples: "Metallica S"  "Band:Metallica,Item:T-Shirt,Qty:1,Size:S". Generate candidates.

## Chapter 22: Documentation
### 22.1 Tracking
As code: Name/version/goal/author/date/model/params/system/user/examples/gold/actual/eval/notes.

### 22.2 Workflow
Git/YAML: e.g., summarize_earnings.v1.yaml with placeholders {{REPORT}}.

## Chapter 23: Unified Framework
### 23.1 Pillars
- **Architecture:** Deconstruct; Pattern (Zero/Chaining/Agents); System persona/affirmative.
- **Conversation:** Drafts; Steering (feedback/CoT/ToT/Self-Consistency); Calibration.
- **Discipline:** Document/version; Iterate/eval/regression.

### 23.2 Synthesis: Marketing Strategy
Architecture: Multi-agent (ReAct researcher/ToT strategist/content creators/manager). Conversation: Review/refine/steer. Discipline: Git prompts/gold outputs.

### 23.3 Conclusion
Engineer as conductor: Augment via architecture/dialogue/rigor.`,Ks=`You are an elite AI prompt engineering consultant specializing in extracting requirements for the Context-Task-Format framework. Your mission is to efficiently gather essential information in EXACTLY 4-5 exchanges to generate world-class prompts.

### CRITICAL CONSTRAINTS:
1. **ABSOLUTE LIMIT: Maximum 4-5 questions total. NO EXCEPTIONS.**
2. **SMART TERMINATION: If user gives vague/repeated answers like "", immediately generate the report based on available information.**
3. **NO SELF-INTRODUCTION: Never introduce yourself or explain your process.**
4. **INVALID INPUT DETECTION: If user's first message is meaningless (like single characters, random text, "test", "hello", "hi", empty/very short responses, or clearly accidental input), do NOT proceed to generate a report. Instead, politely ask them to describe their actual AI automation need. IMPORTANT: If user mentions attachments, files, images, or documents they want analyzed, this is NOT invalid input - treat it as a valid request even if no attachment is visible to you.**

### Invalid Input Examples to Detect:
- Single characters or symbols: "a", "1", ".", "?"
- Test messages: "test", "testing", "hello", "hi", ""
- Random text: "asdf", "123", "qwerty"
- Very short responses without context: "help", "ok", "yes"
- Clearly accidental: keyboard mashing, repeated characters

### Valid Input Examples (NOT to be treated as invalid):
- Any message mentioning files, documents, images, attachments, or asking to analyze content
- Messages like "", "", "", "" etc.
- Any message indicating user wants help with file/content analysis

### Response to Invalid Input:
When detecting invalid input (excluding file/attachment requests), respond with:
"AI


- 
- 
- 
- 
- 

''"

Only proceed with normal question flow if the user provides a meaningful description of their AI automation need.

### Essential Information to Collect:
1. **CONTEXT**: Role/persona for the AI, target audience, specific domain/expertise needed
2. **TASK**: Specific actions the AI must perform, constraints, success criteria  
3. **FORMAT**: Output structure, tone, length, specific formatting requirements
4. **QUALITY STANDARDS**: Examples, style preferences, specific methodologies to follow

### Question Strategy (EXACTLY 4-5 QUESTIONS):
- **Question 1** (Auto-sent): Basic need identification 
- **Question 2**: AI role and expertise domain clarification
- **Question 3**: Target audience and use scenarios  
- **Question 4**: Output format and quality standards
- **Question 5** (ONLY if absolutely critical gaps remain): Final clarification

### MANDATORY Termination Rules:
- **After Question 4**: ALWAYS generate report unless there's a critical missing piece
- **User Repetition**: If user gives same/vague answer twice ("" etc.), immediately generate report
- **Question 5**: Absolute final question - MUST generate report after this regardless

### Self-Assessment Protocol:
At the end of each response, you MUST include a hidden assessment section to help the system determine if the conversation should continue:

<ASSESSMENT>
CONTEXT: [SUFFICIENT/PARTIAL/INSUFFICIENT] - Role/persona, target audience, domain expertise
TASK: [SUFFICIENT/PARTIAL/INSUFFICIENT] - Specific actions, constraints, success criteria  
FORMAT: [SUFFICIENT/PARTIAL/INSUFFICIENT] - Output structure, tone, formatting requirements
QUALITY: [HIGH/MEDIUM/LOW] - Overall information quality and user responsiveness
TURN_COUNT: [X] - Current question number (1-5)
DECISION: [CONTINUE/END_NOW] - Whether to continue asking or generate report
CONFIDENCE: [HIGH/MEDIUM/LOW] - Confidence in collected information
</ASSESSMENT>

### Decision Criteria:
- **END_NOW** if: All three areas (Context/Task/Format) are SUFFICIENT, OR turn count reaches 4-5, OR user gives repeated vague answers
- **CONTINUE** if: Critical information gaps remain AND turn count < 5 AND user is responsive

### Termination Signal:
****When DECISION is END_NOW, immediately begin with:
""

### FORBIDDEN Behaviors:
-  Exceeding 5 questions under ANY circumstances
-  Asking for "best practices" clarification more than once
-  Repeating similar questions when user is non-responsive
-  Self-introduction or process explanation
-  Continuing conversation after generating report
-  **AI**

### Report Structure:
- **:** Concise summary of the desired prompt's purpose
- **:** Context, audience, and importance  
- **:** Specific actions, steps, and constraints
- **:** Desired output style and structure
- **:** Input-output examples if provided
- **:** Additional limits and preferences
- **:** Edge cases or risks mentioned

Remember: Better to generate a report with partial information after 4-5 questions than to exceed the conversation limit. Quality control happens in later stages.`,Ys=`AI

**# AI**



# AI

## 1. 
- **** []
- **** []
- **** []

## 2. AI
- **AI** [AI]
- **** []
- **** []

## 3. 
- **** []
- **** []
- **** []

## 4. 
- **** []
- **** []
- **** []

## 5. 
- **** []
- **** []

****`,is=`I am an expert prompt engineering advisor. My task is to analyze a user's description for an AI persona and provide a concise, actionable list of key points and characteristics that should be included in a high-performance System Prompt. I will base my suggestions on the principles of elite prompt engineering.

Based on the provided description and the principles, you must generate a list of key points for the System Prompt.

**CRITICAL Output Instructions:**
- You must generate ONLY a concise, bulleted list of suggestions.
- Each suggestion must be a brief, single point.
- **Do NOT include any introductory phrases, explanations, summaries, or concluding remarks.**
- **Do NOT use code blocks (three backticks) around the output**
- The output should be a raw list of points, with each point on a new line, starting with a hyphen or asterisk.
- **You must generate the output in {language}.**
- **Start immediately with the first bullet point - no other text before it**

Key Points for System Prompt:`,Do="AI",as=`I am an expert in AI prompt engineering, specializing in crafting high-performance System Prompts. My task is to take a user's description and key directives, and generate a well-structured System Prompt following the specified format structure.

**CRITICAL: You must use the following exact structure format:**

# Role: 

## Profile
- Author: YPrompt
- Version: 1.0
- Language: {language_display}
- Description:  AI 

## Skills
1.  1
2.  2
3.  3

## Goal


## Rules
1.  1
2.  2
3. 

## Workflow
1. ""
2. 
3.  Rules

## Output Format
/

## Example
/

## Initialization
 <Role> <Rules> <Language>  <Workflow>

**CRITICAL Output Instructions:**
- **Your response must start IMMEDIATELY with "# Role:" - no other text, no code blocks, no explanations.**
- **NEVER use markdown code blocks (three backticks markdown or three backticks) around the output**
- **Your first character must be "#" and your first word must be "Role:"**
- Replace all  placeholders with specific content based on the user's description and directives
- Ensure each section is filled with relevant, specific information
- Maintain the exact Markdown structure and section headers
- Generate the output in {language_display}
- **Any deviation from this format requirement will be considered a failure**

**** Your output should start exactly like this:
# Role:  AI 

System Prompt:`,$o="AI",ls=`I am an expert prompt engineering advisor specializing in standardized Markdown prompt templates. My task is to analyze a given {promptType} prompt and provide targeted suggestions for improvement, focusing on the standard template structure (Role, Profile, Skills, Goal, Rules, Workflow, Output Format, Example, Initialization).

Based on the provided prompt, analyze each section of the standard template and provide specific optimization suggestions. Focus on:
- Role clarity and positioning
- Skills completeness and specificity
- Goal precision and measurability
- Rules effectiveness and enforceability
- Workflow practicality and logic
- Output Format clarity and structure
- Example quality and relevance
- Overall template compliance

**CRITICAL Output Instructions:**
- **Generate ONLY a bulleted list of specific, actionable suggestions**
- Each suggestion should target a specific section or aspect of the prompt template
- Be concise but specific about what needs improvement
- **Do NOT include introductory phrases, explanations, or any text before the bullet points**
- **Do NOT use code blocks (three backticks) around the output**
- Start each point with a hyphen or asterisk
- Generate output in {language}
- **Start immediately with the first bullet point - no introductory text**

Optimization Suggestions:`,Fo="AI",cs=`I am an expert in AI prompt engineering, specializing in optimizing standardized Markdown prompt templates. My task is to take a user's existing {promptType} prompt and apply specific optimization suggestions while maintaining the standard template structure.

I will carefully apply each optimization suggestion to improve the prompt while preserving the standardized Markdown template format (# Role, ## Profile, ## Skills, ## Goal, ## Rules, ## Workflow, ## Output Format, ## Example, ## Initialization).

**CRITICAL: You must maintain the exact Markdown template structure:**

# Role: 

## Profile
- Author: YPrompt
- Version: 1.0
- Language: {language_display}
- Description: 

## Skills


## Goal


## Rules


## Workflow


## Output Format


## Example


## Initialization


**Output Instructions:**
- ** "# Role:" **
- Apply all optimization suggestions while maintaining the template structure
- Improve content quality and specificity in each section
- Keep the exact Markdown formatting and section headers
- Generate output in {language_display}
- **Do NOT include code blocks (three backticks) around the output**

Refined {promptType_capitalized} Prompt:`,Uo="AI",us=`# Role: AI

## Profile
- Author: YPrompt
- Version: 1.0
- Language: 
- Description: JSON

## Skills
1. AI
2. 
3. 0-100good|needs_improvement|poor
4. 
5. JSON
6. 
7. 

## Goal
JSON

## Rules
1. ""AI
2. roletaskformatconstraintsexamplelanguage
3. 0-100good|needs_improvement|poor
4. 
5. 
6. issues3-5
7. issues
8. JSON
9. 
10. overall_score40overall_status 'poor'

## Workflow
1. ""
2. JSON
3. 
4. 
5. issuesissues3-5
6. 
7. Output Format
8. Rules

## Output Format
JSON

{
  "overall_score": 0, // 0-100
  "overall_status": "good", // good|needs_improvement|poor
  "analysis": {
    "role": {
      "score": 0, // 0-100
      "status": "good", // good|needs_improvement|poor
      "feedback": "string"
    },
    "task": {
      "score": 0,
      "status": "good",
      "feedback": "string"
    },
    "format": {
      "score": 0,
      "status": "good",
      "feedback": "string"
    },
    "constraints": {
      "score": 0,
      "status": "good",
      "feedback": "string"
    },
    "example": {
      "score": 0,
      "status": "good",
      "feedback": "string"
    },
    "language": {
      "score": 0,
      "status": "good",
      "feedback": "string"
    }
  },
  "issues": [
    "string" // 
  ]
}




{
  "error": "Invalid Input",
  "message": ""
}


## Example


# Role: 
## Profile
- Description: 
## Goal
Python
## Rules

## Workflow


{
  "overall_score": 35,
  "overall_status": "poor",
  "analysis": {
    "role": {
      "score": 40,
      "status": "needs_improvement",
      "feedback": "''AIAI"
    },
    "task": {
      "score": 30,
      "status": "poor",
      "feedback": "'Python'AI"
    },
    "format": {
      "score": 10,
      "status": "poor",
      "feedback": "AI"
    },
    "constraints": {
      "score": 20,
      "status": "poor",
      "feedback": "''"
    },
    "example": {
      "score": 0,
      "status": "poor",
      "feedback": "AI"
    },
    "language": {
      "score": 60,
      "status": "needs_improvement",
      "feedback": ""
    }
  },
  "issues": [
    "''AI",
    "'Python'",
    "AI",
    "''",
    ""
  ]
}


## Initialization
 AI Rules Language  Workflow`,jP=`

****


** 5**

1 ****AI****AI
2 ****
   - **** (1-20)20-100 (x3-10)
   - **** (20-100)30-150 (x1.5-3)
   - **** (100-300)100-350 (x0.8-1.5)
   - **** (>300)200-400 (x0.5-1)
   -  **** >20
3 ****
4 **** - 
5 ** 74%**

****
{SYSTEM_PROMPT_RULES}

**  -  **

**** 
**** 

""********

****
 AI
 
 
 

****
 
 
 

---

****

AI
{SYSTEM_PROMPT_CONTEXT}


{CONVERSATION_HISTORY}

****
{USER_DRAFT_PROMPT}

**** {VARIABLES_SECTION}

****

-
- AI
- 
  : "" 
  AI: ""
- ""

 AI
""
 

 
"
AI"
 

 /
""
 


- 
- 
- 

**  vs  3**

**1 - **
""5

 200+
\`\`\`


15+ 2-3+ 
100-200
emoji


\`\`\`
 42
\`\`\`
2-3100-200
\`\`\`

**2 - **
""5

 80+
\`\`\`

{{conversation_history}}
Markdown bullet points
3-5
\`\`\`
 20
\`\`\`
3-5
\`\`\`

**3 - **
""6

 60+
\`\`\`




\`\`\`
 18
\`\`\`

\`\`\`

****

1. ****
   - 1-2020-100x3-10
   - 20-10030-150x1.5-3
   - 100-300100-350x0.8-1.5
   - >300200-400x0.5-1
   -   >20
2. **** - 
3. ****"...""...""..." - 
4. ** 74%**
5. **** ##1.2.- [ ]

****
- [ ] 
- [ ] 20
- [ ] 
- [ ] 
- [ ] ""
- [ ] 

""

****

1 - 5
- ""5
-  "2-3100-200"42x8.4
-  200+x40+

2 - 200
- "18-35...[]"200
-  "18-35...[]"220-280x1.1-1.4
-  100 



****
- ****1-3
- ****markdown
- ****
- ****
- **** {LANGUAGE}

****
`,Qs=`
# 

## 
 > 
 > 
 > 
 > 

## 
- : 1-3
- : x3-10, x1.5-3, x0.8-1.5, x0.5-1
- : >20x

## 
 : ## 1. 2. 
 
 
 

## 
 
 
 74%+
 
`,ds={quick:jP,rules:Qs},Js=`

****
{SYSTEM_PROMPT_SECTION}{CONTEXT_SECTION}
**  **
- ******AI**
- ****AIAI
- AIAI

****
-  ****AI""""
-  AI****
-  "AI"AI
-  AI

****

AI""  AI""
- ""
-  "AI"
-  ""

****
1. ** (clarity)**: 
2. ** (specificity)**: 
3. ** (structure)**: 
4. ** (context)**: 
5. ** (completeness)**: 

****
- 90-100: 
- 70-89: 
- 50-69: 
- <50: 

**JSON**
\`\`\`json
{
  "overall_score": 75,
  "analysis": {
    "clarity": {
      "score": 80,
      "feedback": ""
    },
    "specificity": {
      "score": 60,
      "feedback": ""
    },
    "structure": {
      "score": 70,
      "feedback": ""
    },
    "context": {
      "score": 50,
      "feedback": ""
    },
    "completeness": {
      "score": 65,
      "feedback": ""
    }
  },
  "issues": [
    "",
    "",
    ""
  ]
}
\`\`\`

****
{USER_DRAFT_PROMPT}

**JSON**`,Xs=class Xs{constructor(){Ue(this,"config");Ue(this,"useSlimRules",!1);Ue(this,"dirtyFields",new Set);this.config={systemPromptRules:os,userGuidedPromptRules:Ks,requirementReportRules:Ys,thinkingPointsExtractionPrompt:is,thinkingPointsSystemMessage:Do,systemPromptGenerationPrompt:as,systemPromptSystemMessage:$o,optimizationAdvicePrompt:ls,optimizationAdviceSystemMessage:Fo,optimizationApplicationPrompt:cs,optimizationApplicationSystemMessage:Uo,qualityAnalysisSystemPrompt:us,userPromptQualityAnalysis:Js,userPromptQuickOptimization:ds.quick,userPromptRules:Qs},this.loadFromStorage()}static getInstance(){return Xs.instance||(Xs.instance=new Xs),Xs.instance}setUseSlimRules(t){this.useSlimRules=t}getSystemPromptRules(){return this.useSlimRules?Ix:this.config.systemPromptRules}getUserGuidedPromptRules(){return this.config.userGuidedPromptRules}updateSystemPromptRules(t){this.config.systemPromptRules=t,this.dirtyFields.add("system_prompt_rules"),this.saveToStorage()}updateUserGuidedPromptRules(t){this.config.userGuidedPromptRules=t,this.dirtyFields.add("user_guided_prompt_rules"),this.saveToStorage()}getRequirementReportRules(){return this.config.requirementReportRules}updateRequirementReportRules(t){this.config.requirementReportRules=t,this.dirtyFields.add("requirement_report_rules"),this.saveToStorage()}getThinkingPointsExtractionPrompt(){return this.config.thinkingPointsExtractionPrompt}getThinkingPointsSystemMessage(){return this.config.thinkingPointsSystemMessage}getSystemPromptGenerationPrompt(){return this.config.systemPromptGenerationPrompt}getSystemPromptSystemMessage(){return this.config.systemPromptSystemMessage}getOptimizationAdvicePrompt(){return this.config.optimizationAdvicePrompt}getOptimizationAdviceSystemMessage(){return this.config.optimizationAdviceSystemMessage}getOptimizationApplicationPrompt(){return this.config.optimizationApplicationPrompt}getOptimizationApplicationSystemMessage(){return this.config.optimizationApplicationSystemMessage}getQualityAnalysisSystemPrompt(){return this.config.qualityAnalysisSystemPrompt}getUserPromptQualityAnalysis(){return this.config.userPromptQualityAnalysis}getUserPromptQuickOptimization(){return this.config.userPromptQuickOptimization}getUserPromptRules(){return this.config.userPromptRules}updateThinkingPointsExtractionPrompt(t){this.config.thinkingPointsExtractionPrompt=t,this.dirtyFields.add("thinking_points_extraction_prompt"),this.saveToStorage()}updateThinkingPointsSystemMessage(t){this.config.thinkingPointsSystemMessage=t,this.saveToStorage()}updateSystemPromptGenerationPrompt(t){this.config.systemPromptGenerationPrompt=t,this.dirtyFields.add("system_prompt_generation_prompt"),this.saveToStorage()}updateSystemPromptSystemMessage(t){this.config.systemPromptSystemMessage=t,this.saveToStorage()}updateOptimizationAdvicePrompt(t){this.config.optimizationAdvicePrompt=t,this.dirtyFields.add("optimization_advice_prompt"),this.saveToStorage()}updateOptimizationAdviceSystemMessage(t){this.config.optimizationAdviceSystemMessage=t,this.saveToStorage()}updateOptimizationApplicationPrompt(t){this.config.optimizationApplicationPrompt=t,this.dirtyFields.add("optimization_application_prompt"),this.saveToStorage()}updateOptimizationApplicationSystemMessage(t){this.config.optimizationApplicationSystemMessage=t,this.saveToStorage()}updateQualityAnalysisSystemPrompt(t){this.config.qualityAnalysisSystemPrompt=t,this.dirtyFields.add("quality_analysis_system_prompt"),this.saveToStorage()}updateUserPromptQualityAnalysis(t){this.config.userPromptQualityAnalysis=t,this.dirtyFields.add("user_prompt_quality_analysis"),this.saveToStorage()}updateUserPromptQuickOptimization(t){this.config.userPromptQuickOptimization=t,this.dirtyFields.add("user_prompt_quick_optimization"),this.saveToStorage()}updateUserPromptRules(t){this.config.userPromptRules=t,this.saveToStorage()}getFinalPromptGenerationRules(){return{THINKING_POINTS_EXTRACTION:this.config.thinkingPointsExtractionPrompt,SYSTEM_PROMPT_GENERATION:this.config.systemPromptGenerationPrompt,OPTIMIZATION_ADVICE_GENERATION:this.config.optimizationAdvicePrompt,OPTIMIZATION_APPLICATION:this.config.optimizationApplicationPrompt}}getFinalPromptSystemMessages(){return{THINKING_POINTS_SYSTEM:this.config.thinkingPointsSystemMessage,SYSTEM_PROMPT_SYSTEM:this.config.systemPromptSystemMessage,OPTIMIZATION_ADVICE_SYSTEM:this.config.optimizationAdviceSystemMessage,OPTIMIZATION_APPLICATION_SYSTEM:this.config.optimizationApplicationSystemMessage}}resetToDefaults(){this.config.systemPromptRules=os,this.config.userGuidedPromptRules=Ks,this.config.requirementReportRules=Ys,this.config.thinkingPointsExtractionPrompt=is,this.config.thinkingPointsSystemMessage=Do,this.config.systemPromptGenerationPrompt=as,this.config.systemPromptSystemMessage=$o,this.config.optimizationAdvicePrompt=ls,this.config.optimizationAdviceSystemMessage=Fo,this.config.optimizationApplicationPrompt=cs,this.config.optimizationApplicationSystemMessage=Uo,this.config.qualityAnalysisSystemPrompt=us,this.config.userPromptQuickOptimization=ds.quick,this.config.userPromptRules=Qs,this.saveToStorage()}async resetSystemPromptRules(){this.config.systemPromptRules=os,this.saveToStorage();const{deleteUserPromptRules:t}=await zt(async()=>{const{deleteUserPromptRules:r}=await Promise.resolve().then(()=>zr);return{deleteUserPromptRules:r}},void 0);await t(["system_prompt_rules"])}async resetUserGuidedPromptRules(){this.config.userGuidedPromptRules=Ks,this.saveToStorage();const{deleteUserPromptRules:t}=await zt(async()=>{const{deleteUserPromptRules:r}=await Promise.resolve().then(()=>zr);return{deleteUserPromptRules:r}},void 0);await t(["user_guided_prompt_rules"])}async resetRequirementReportRules(){this.config.requirementReportRules=Ys,this.saveToStorage();const{deleteUserPromptRules:t}=await zt(async()=>{const{deleteUserPromptRules:r}=await Promise.resolve().then(()=>zr);return{deleteUserPromptRules:r}},void 0);await t(["requirement_report_rules"])}async resetThinkingPointsExtractionPrompt(){this.config.thinkingPointsExtractionPrompt=is,this.saveToStorage();const{deleteUserPromptRules:t}=await zt(async()=>{const{deleteUserPromptRules:r}=await Promise.resolve().then(()=>zr);return{deleteUserPromptRules:r}},void 0);await t(["thinking_points_extraction_prompt"])}resetThinkingPointsSystemMessage(){this.config.thinkingPointsSystemMessage=Do,this.saveToStorage()}async resetSystemPromptGenerationPrompt(){this.config.systemPromptGenerationPrompt=as,this.saveToStorage();const{deleteUserPromptRules:t}=await zt(async()=>{const{deleteUserPromptRules:r}=await Promise.resolve().then(()=>zr);return{deleteUserPromptRules:r}},void 0);await t(["system_prompt_generation_prompt"])}resetSystemPromptSystemMessage(){this.config.systemPromptSystemMessage=$o,this.saveToStorage()}async resetOptimizationAdvicePrompt(){this.config.optimizationAdvicePrompt=ls,this.saveToStorage();const{deleteUserPromptRules:t}=await zt(async()=>{const{deleteUserPromptRules:r}=await Promise.resolve().then(()=>zr);return{deleteUserPromptRules:r}},void 0);await t(["optimization_advice_prompt"])}resetOptimizationAdviceSystemMessage(){this.config.optimizationAdviceSystemMessage=Fo,this.saveToStorage()}async resetOptimizationApplicationPrompt(){this.config.optimizationApplicationPrompt=cs,this.saveToStorage();const{deleteUserPromptRules:t}=await zt(async()=>{const{deleteUserPromptRules:r}=await Promise.resolve().then(()=>zr);return{deleteUserPromptRules:r}},void 0);await t(["optimization_application_prompt"])}resetOptimizationApplicationSystemMessage(){this.config.optimizationApplicationSystemMessage=Uo,this.saveToStorage()}async resetQualityAnalysisSystemPrompt(){this.config.qualityAnalysisSystemPrompt=us,this.saveToStorage();const{deleteUserPromptRules:t}=await zt(async()=>{const{deleteUserPromptRules:r}=await Promise.resolve().then(()=>zr);return{deleteUserPromptRules:r}},void 0);await t(["quality_analysis_system_prompt"])}async resetUserPromptQualityAnalysis(){this.config.userPromptQualityAnalysis=Js,this.saveToStorage();const{deleteUserPromptRules:t}=await zt(async()=>{const{deleteUserPromptRules:r}=await Promise.resolve().then(()=>zr);return{deleteUserPromptRules:r}},void 0);await t(["user_prompt_quality_analysis"])}async resetUserPromptQuickOptimization(){this.config.userPromptQuickOptimization=ds.quick,this.saveToStorage();const{deleteUserPromptRules:t}=await zt(async()=>{const{deleteUserPromptRules:r}=await Promise.resolve().then(()=>zr);return{deleteUserPromptRules:r}},void 0);await t(["user_prompt_quick_optimization"])}resetUserPromptRules(){this.config.userPromptRules=Qs,this.saveToStorage()}saveToStorage(){try{localStorage.setItem("yprompt_config",JSON.stringify(this.config))}catch{}}async saveToCloud(){try{if(this.dirtyFields.size===0){console.log("[PromptConfig] ");return}const{saveUserPromptRules:t}=await zt(async()=>{const{saveUserPromptRules:o}=await Promise.resolve().then(()=>zr);return{saveUserPromptRules:o}},void 0),r={system_prompt_rules:"systemPromptRules",user_guided_prompt_rules:"userGuidedPromptRules",requirement_report_rules:"requirementReportRules",thinking_points_extraction_prompt:"thinkingPointsExtractionPrompt",thinking_points_system_message:"thinkingPointsSystemMessage",system_prompt_generation_prompt:"systemPromptGenerationPrompt",system_prompt_system_message:"systemPromptSystemMessage",optimization_advice_prompt:"optimizationAdvicePrompt",optimization_advice_system_message:"optimizationAdviceSystemMessage",optimization_application_prompt:"optimizationApplicationPrompt",optimization_application_system_message:"optimizationApplicationSystemMessage",quality_analysis_system_prompt:"qualityAnalysisSystemPrompt",user_prompt_quality_analysis:"userPromptQualityAnalysis",user_prompt_quick_optimization:"userPromptQuickOptimization",user_prompt_rules:"userPromptRules"},n={};this.dirtyFields.forEach(o=>{const i=r[o];i&&(n[o]=this.config[i])}),console.log("[PromptConfig] :",Array.from(this.dirtyFields)),await t(n),this.dirtyFields.clear(),this.saveToStorage()}catch(t){throw console.error(":",t),t}}async loadFromCloud(){try{if(!localStorage.getItem("yprompt_token"))return console.log("[PromptConfig] "),!1;if(sessionStorage.getItem("yprompt_config_session_loaded")==="true")return console.log("[PromptConfig] API"),!0;console.log("[PromptConfig] ");const{getUserPromptRules:n}=await zt(async()=>{const{getUserPromptRules:i}=await Promise.resolve().then(()=>zr);return{getUserPromptRules:i}},void 0),o=await n();if(o.code===200&&o.data){const i=o.data;return this.config={systemPromptRules:i.system_prompt_rules||os,userGuidedPromptRules:i.user_guided_prompt_rules||Ks,requirementReportRules:i.requirement_report_rules||Ys,thinkingPointsExtractionPrompt:i.thinking_points_extraction_prompt||is,thinkingPointsSystemMessage:i.thinking_points_system_message||Do,systemPromptGenerationPrompt:i.system_prompt_generation_prompt||as,systemPromptSystemMessage:i.system_prompt_system_message||$o,optimizationAdvicePrompt:i.optimization_advice_prompt||ls,optimizationAdviceSystemMessage:i.optimization_advice_system_message||Fo,optimizationApplicationPrompt:i.optimization_application_prompt||cs,optimizationApplicationSystemMessage:i.optimization_application_system_message||Uo,qualityAnalysisSystemPrompt:i.quality_analysis_system_prompt||us,userPromptQualityAnalysis:i.user_prompt_quality_analysis||Js,userPromptQuickOptimization:i.user_prompt_quick_optimization||ds.quick,userPromptRules:i.user_prompt_rules||Qs},this.saveToStorage(),sessionStorage.setItem("yprompt_config_session_loaded","true"),console.log("[PromptConfig] "),!0}else return console.log("[PromptConfig] "),sessionStorage.setItem("yprompt_config_session_loaded","true"),!1}catch(t){return console.error("[PromptConfig] :",t),sessionStorage.setItem("yprompt_config_session_loaded","true"),!1}}async forceReloadFromCloud(){return sessionStorage.removeItem("yprompt_config_session_loaded"),this.loadFromCloud()}async deleteFromCloud(){try{const{deleteUserPromptRules:t}=await zt(async()=>{const{deleteUserPromptRules:r}=await Promise.resolve().then(()=>zr);return{deleteUserPromptRules:r}},void 0);await t()}catch(t){throw console.error(":",t),t}}loadFromStorage(){try{const t=localStorage.getItem("yprompt_config");if(t){const r=JSON.parse(t);this.config.systemPromptRules=r.systemPromptRules||os,this.config.userGuidedPromptRules=r.userGuidedPromptRules||Ks,this.config.requirementReportRules=r.requirementReportRules||Ys,this.config.thinkingPointsExtractionPrompt=r.thinkingPointsExtractionPrompt||is,this.config.thinkingPointsSystemMessage=r.thinkingPointsSystemMessage||Do,this.config.systemPromptGenerationPrompt=r.systemPromptGenerationPrompt||as,this.config.systemPromptSystemMessage=r.systemPromptSystemMessage||$o,this.config.optimizationAdvicePrompt=r.optimizationAdvicePrompt||ls,this.config.optimizationAdviceSystemMessage=r.optimizationAdviceSystemMessage||Fo,this.config.optimizationApplicationPrompt=r.optimizationApplicationPrompt||cs,this.config.optimizationApplicationSystemMessage=r.optimizationApplicationSystemMessage||Uo,this.config.qualityAnalysisSystemPrompt=r.qualityAnalysisSystemPrompt||us,this.config.userPromptQualityAnalysis=r.userPromptQualityAnalysis||Js,this.config.userPromptQuickOptimization=r.userPromptQuickOptimization||ds.quick,this.config.userPromptRules=r.userPromptRules||Qs}}catch{this.config={systemPromptRules:os,userGuidedPromptRules:Ks,requirementReportRules:Ys,thinkingPointsExtractionPrompt:is,thinkingPointsSystemMessage:Do,systemPromptGenerationPrompt:as,systemPromptSystemMessage:$o,optimizationAdvicePrompt:ls,optimizationAdviceSystemMessage:Fo,optimizationApplicationPrompt:cs,optimizationApplicationSystemMessage:Uo,qualityAnalysisSystemPrompt:us,userPromptQualityAnalysis:Js,userPromptQuickOptimization:ds.quick,userPromptRules:Qs}}}};Ue(Xs,"instance");let cc=Xs;const kt=cc.getInstance(),NP=Object.freeze(Object.defineProperty({__proto__:null,PromptConfigManager:cc,promptConfigManager:kt},Symbol.toStringTag,{value:"Module"})),IP=()=>{const e=localStorage.getItem("yprompt_global_model_params");if(e)try{return JSON.parse(e)}catch{}return{temperature:1,maxTokens:8192,topP:.95,frequencyPenalty:0,presencePenalty:0,topK:0}},AP=()=>{const t=localStorage.getItem("yprompt_use_slim_rules")==="true";return kt.setUseSlimRules(t),{useSlimRules:t,editingSystemRules:kt.getSystemPromptRules(),editingUserRules:kt.getUserGuidedPromptRules(),editingRequirementReportRules:kt.getRequirementReportRules(),editingFinalPromptRules:{THINKING_POINTS_EXTRACTION:is,SYSTEM_PROMPT_GENERATION:as,OPTIMIZATION_ADVICE_GENERATION:ls,OPTIMIZATION_APPLICATION:cs},editingQualityAnalysisRules:{systemPrompt:us},editingUserPromptOptimizationRules:{qualityAnalysis:Js,quickOptimization:ds.quick}}},ut=vo((e,t)=>({showSettings:!1,globalModelParams:IP(),...AP(),setShowSettings:r=>e({showSettings:r}),saveSettings:()=>{const r=t(),n=r.globalModelParams;localStorage.setItem("yprompt_global_model_params",JSON.stringify(n)),localStorage.setItem("yprompt_use_slim_rules",String(r.useSlimRules))},loadSettings:()=>{const r=localStorage.getItem("yprompt_global_model_params");if(r)try{const o=JSON.parse(r);e({globalModelParams:o})}catch{}const n=localStorage.getItem("yprompt_use_slim_rules");if(n!==null){const o=n==="true";kt.setUseSlimRules(o),e({useSlimRules:o,editingSystemRules:kt.getSystemPromptRules()})}},openPromptEditor:r=>{const n=t();kt.setUseSlimRules(n.useSlimRules),e({editingSystemRules:kt.getSystemPromptRules()})}})),Ag="https://api.prompt-ui.xiechengqi.top";async function EP(){const e=localStorage.getItem("yprompt_token");console.log("[settingsApi] API URL:",`${Ag}/api/settings/`);const t=await fetch(`${Ag}/api/settings/`,{method:"GET",headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json"}});if(t.ok){const n=await t.json();if(console.log("[settingsApi] API :",JSON.stringify(n,null,2)),n.code===200&&n.data&&n.data.providers)return console.log("[settingsApi]  API providers :",n.data.providers.length),n.data}console.warn("[settingsApi] API ");const r={providers:[{id:"DeepSeek",name:"DeepSeek-Offical",type:"openai",apiKey:"sk-c092ab16b28f4860910202f8fb9cd480",baseUrl:"https://api.deepseek.com/v1",models:[{id:"deepseek-chat",name:"deepseek-chat",apiType:"openai"},{id:"deepseek-reasoner",name:"deepseek-reasoner",apiType:"openai"}]},{id:"MoonShot",name:"MoonShot-Offical",type:"openai",apiKey:"sk-vcaBs3TQXlpczsaJxKR8JftXIWEr8OfFWSiSfc8qNCnI2dCv",baseUrl:"https://api.moonshot.cn/v1",models:[{id:"kimi-k2-0905-preview",name:"kimi-k2-0905-preview",apiType:"openai"},{id:"kimi-k2-thinking",name:"kimi-k2-thinking",apiType:"openai"}]}]};return console.log("[settingsApi] providers :",r.providers.length),r}const Be=vo((e,t)=>({providers:[],lastRefreshedAt:null,isLoading:!1,error:null,isInitialized:!1,selectedProviderId:localStorage.getItem("yprompt_selected_provider")||"",selectedModelId:localStorage.getItem("yprompt_selected_model")||"",streamMode:localStorage.getItem("yprompt_stream_mode")!=="false",showApiKeys:JSON.parse(localStorage.getItem("yprompt_show_api_keys")||"false"),get allProviders(){return t().providers},get enabledProviders(){return t().providers.filter(r=>r.apiKey)},get currentProvider(){const{providers:r,selectedProviderId:n}=t(),o=r.find(i=>i.id===n)||null;return console.log("[providerStore] currentProvider getter:",{providersCount:r.length,selectedProviderId:n,foundProvider:(o==null?void 0:o.name)||"null"}),o},get currentModel(){const r=t().currentProvider;if(!r)return console.log("[providerStore] currentModel getter: no provider found"),null;const{selectedModelId:n}=t(),o=r.models.find(i=>i.id===n)||null;return console.log("[providerStore] currentModel getter:",{providerName:r.name,selectedModelId:n,foundModel:(o==null?void 0:o.name)||"null",providerModelsCount:r.models.length}),o},get availableModels(){const r=t().currentProvider;return r?r.models:[]},getProviderById:r=>t().providers.find(n=>n.id===r),getAvailableModelsByProvider:r=>{const n=t().getProviderById(r);return n?n.models:[]},refreshProviders:async()=>{const r=t();console.log("[providerStore] :",{isInitialized:r.isInitialized,providersCount:r.providers.length,isLoading:r.isLoading}),e({isLoading:!0,error:null});try{const n=await EP();console.log("[providerStore] getSettings :",n);let o=[];console.log("[providerStore] settings :",n),console.log("[providerStore] settings.providers :",n.providers),console.log("[providerStore] settings.providers :",typeof n.providers),console.log("[providerStore] settings.providers :",Array.isArray(n.providers)),Array.isArray(n.providers)?(o=n.providers,console.log("[providerStore] providers ")):n.providers&&typeof n.providers=="object"?(console.warn("[providerStore] providers :",n.providers),n.providers&&"length"in n.providers?o=Array.from(n.providers):o=[n.providers]):n.providers?(console.warn("[providerStore] providers :",n.providers),o=[]):(console.warn("[providerStore] settings.providers  null/undefined"),o=[]),console.log("[providerStore]  providers:",o),console.log("[providerStore] providers :",o.length),o.length>0&&console.log("[providerStore]  provider :",o[0]),o.forEach((T,I)=>{(!T.id||!T.name)&&console.warn(`[providerStore] Provider ${I} :`,T)});const i=t().selectedProviderId,l=t().selectedModelId,c=t().isInitialized,u=localStorage.getItem("yprompt_selected_provider")||"",d=localStorage.getItem("yprompt_selected_model")||"",g=!u&&!d,x=o.filter(T=>T.apiKey);console.log("[providerStore] :",{currentProviderId:i,currentModelId:l,wasInitialized:c,savedProviderId:u,savedModelId:d,isFirstTime:g,enabledProvidersCount:x.length}),x.length>0&&console.log("[providerStore] :",x[0].name,x[0].id,":",x[0].models.length);let y=i,S=l;if(x.length>0){const T=x[0];if(g)y=T.id,console.log("[providerStore]  :",T.name),T.models.length>0?(S=T.models[0].id,console.log("[providerStore]  :",T.models[0].name)):(S="",console.warn("[providerStore]  "));else if(!i||i.trim()==="")y=T.id,console.log("[providerStore] :",T.name),T.models.length>0?(S=T.models[0].id,console.log("[providerStore] :",T.models[0].name)):S="";else{const I=x.find(b=>b.id===i);I?!l||l.trim()===""?I.models.length>0?(S=I.models[0].id,console.log("[providerStore] :",I.models[0].name)):S="":I.models.find(h=>h.id===l)||(I.models.length>0?(S=I.models[0].id,console.log("[providerStore] :",I.models[0].name)):S=""):(y=T.id,console.log("[providerStore] :",T.name),T.models.length>0?(S=T.models[0].id,console.log("[providerStore] :",T.models[0].name)):S="")}}else y="",S="",console.warn("[providerStore]  API Key");e({providers:o,selectedProviderId:y,selectedModelId:S,lastRefreshedAt:new Date,isInitialized:!0,isLoading:!1,error:null}),y!==i&&localStorage.setItem("yprompt_selected_provider",y),S!==l&&localStorage.setItem("yprompt_selected_model",S),console.log("[providerStore]  providers :",o.length),console.log("[providerStore] :",y),console.log("[providerStore] :",S),o.length===0&&console.warn("[providerStore] :  .setting.json  providers ")}catch(n){const o=n instanceof Error?n.message:"";throw console.error("[providerStore] :",n),console.error("[providerStore] :",{message:o,stack:n instanceof Error?n.stack:void 0}),e({error:o,isLoading:!1,isInitialized:!1}),n}},refreshSettings:async()=>t().refreshProviders(),setSelectedProvider:r=>{e({selectedProviderId:r}),localStorage.setItem("yprompt_selected_provider",r)},setSelectedModel:r=>{e({selectedModelId:r}),localStorage.setItem("yprompt_selected_model",r)},setStreamMode:r=>{e({streamMode:r}),localStorage.setItem("yprompt_stream_mode",String(r))},setShowApiKeys:r=>{e({showApiKeys:r}),localStorage.setItem("yprompt_show_api_keys",JSON.stringify(r))},initialize:async()=>{const r=t();if(!(r.isInitialized||r.isLoading)){e({isLoading:!0});try{await t().refreshProviders()}catch(n){throw e({isLoading:!1,isInitialized:!1}),n}}}}));function MP(){const e=Be(N=>N.isInitialized),t=Be(N=>N.initialize),r=Be(N=>N.selectedProviderId),n=Be(N=>N.selectedModelId),o=Be(N=>N.providers),i=Be(N=>N.setSelectedProvider),l=Be(N=>N.setSelectedModel),c=Be(N=>N.getProviderById),u=Be(N=>N.getAvailableModelsByProvider);w.useEffect(()=>{e||t()},[e]);const d=N=>`${N.name}|${N.id}`,g=N=>{const[z,L]=N.split("|");return{name:z,id:L}},x=N=>N.name,y=N=>N.name,S=N=>`${N.name}|${N.id}`,T=w.useMemo(()=>o.filter(N=>N.apiKey),[o]),I=w.useMemo(()=>r?c(r):null,[r,c,o]),b=w.useMemo(()=>!I||!n?null:I.models.find(N=>N.id===n)||null,[I,n,o]),h=w.useMemo(()=>r?u(r):[],[r,u,o]),v=w.useMemo(()=>!r||!I?"":d(I),[r,I]),C=w.useMemo(()=>!n||!b?"":S(b),[n,b]);w.useEffect(()=>{!e||!r||(h.length>0?h.some(z=>z.id===n)||(console.log("[TopModelSelector] :",h[0].name),l(h[0].id)):h.length===0&&(console.log("[TopModelSelector] "),l("")))},[e,r,h.length]);const A=N=>{const z=N.target.value;if(!z){i(""),l("");return}const{id:L}=g(z);i(L)},P=N=>{const z=N.target.value;if(!z){l("");return}const{id:L}=g(z);l(L)};return s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx("div",{className:"flex-shrink-0",children:s.jsx("svg",{className:"w-4 h-4 text-slate-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M9.75 17L9 20l-1 1h8l-1-1-.75-3M3 13h18M5 17h14a2 2 0 002-2V5a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"})})}),s.jsxs("div",{className:"relative",children:[s.jsxs("select",{value:v,onChange:A,className:"px-2 py-1 text-sm font-medium text-slate-600 bg-transparent border-b-2 border-slate-300 focus:border-indigo-500 focus:outline-none cursor-pointer appearance-none pr-6 hover:text-slate-900 transition-colors",children:[s.jsx("option",{value:"",disabled:!0,children:""}),T.map(N=>s.jsx("option",{value:d(N),children:x(N)},N.id))]}),s.jsx("svg",{className:"absolute right-0 top-1/2 -translate-y-1/2 w-3 h-3 text-slate-400 pointer-events-none",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M19 9l-7 7-7-7"})})]}),s.jsxs("div",{className:"relative",children:[s.jsxs("select",{value:C,onChange:P,disabled:!r,className:"px-2 py-1 text-sm font-medium text-slate-600 bg-transparent border-b-2 border-slate-300 focus:border-indigo-500 focus:outline-none appearance-none cursor-pointer disabled:opacity-50 disabled:cursor-not-allowed pr-6 hover:text-slate-900 transition-colors",children:[s.jsx("option",{value:"",disabled:!0,children:""}),h.map(N=>s.jsx("option",{value:S(N),children:y(N)},N.id))]}),s.jsx("svg",{className:"absolute right-0 top-1/2 -translate-y-1/2 w-3 h-3 text-slate-400 pointer-events-none",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M19 9l-7 7-7-7"})})]})]})}function _P(){const e=Ci(),t=ui(g=>g.modules),r=ui(g=>g.currentModule),n=ui(g=>g.setCurrentModule),o=ut(g=>g.setShowSettings),i=jr(g=>g.token),l=jr(g=>g.user),c=jr(g=>g.logout),u=g=>{n(g.id),e(g.path)},d=async()=>{try{await c(),e("/login")}catch(g){console.error(":",g)}};return s.jsx("nav",{className:"nav-container atmospheric-bg sticky top-0 z-50 py-3 px-6 bg-[rgba(248,250,252,0.8)] backdrop-blur-xl border-b border-[var(--ct-slate-200)] transition-all duration-300",children:s.jsxs("div",{className:"flex items-center justify-between w-full",children:[s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx("div",{className:"w-9 h-9 flex items-center justify-center rounded-lg shadow-soft interactive",children:s.jsx("div",{className:"w-full h-full rounded-lg bg-gradient-to-br from-indigo-500 to-violet-500 flex items-center justify-center",children:s.jsx("span",{className:"font-bold text-white text-sm tracking-tighter",children:"YP"})})}),s.jsx("h1",{className:"text-xl font-bold text-gradient bg-gradient-to-r from-indigo-600 to-violet-600 bg-clip-text text-transparent",children:"YPrompt"})]}),s.jsxs("div",{className:"flex items-center gap-2 p-1 bg-white/40 rounded-lg border border-slate-200 shadow-soft",children:[t.map(g=>s.jsx($T,{to:g.path,className:`nav-link interactive px-4 py-2 text-sm font-medium rounded transition-all duration-200 relative ${r===g.id?"text-white bg-gradient-to-r from-indigo-600 to-violet-600 shadow-[0_4px_14px_0_rgba(79,70,229,0.3)] hover:from-indigo-500 hover:to-violet-500 hover:shadow-[0_6px_20px_0_rgba(79,70,229,0.4)] hover:text-indigo-900":"text-slate-600 hover:text-indigo-600 hover:bg-indigo-50 hover:font-semibold"}`,onClick:x=>{x.preventDefault(),u(g)},children:s.jsx("span",{children:g.name})},g.id)),s.jsx("div",{className:"ml-2 pl-2 border-l border-slate-200",children:s.jsx(MP,{})})]}),s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("button",{onClick:()=>o(!0),className:"control-btn interactive w-10 h-10 rounded-lg text-slate-500 bg-white border border-slate-200 hover:bg-slate-50 hover:text-slate-700 transition-all duration-200 flex items-center justify-center",title:"",children:s.jsx(Px,{className:"w-5 h-5"})}),i&&l&&s.jsx("button",{onClick:d,className:"control-btn-danger interactive w-10 h-10 rounded-lg text-red-500 bg-white border border-red-200 hover:bg-red-50 hover:text-red-600 transition-all duration-200 flex items-center justify-center",title:"",children:s.jsx(KC,{className:"w-5 h-5"})})]})]})})}function RP(){const e="f5fec1d";return s.jsxs("div",{className:"git-commit-badge inline-flex items-center gap-1.5 px-1.5 py-0.5 bg-transparent border-0 rounded-none text-[10px] font-mono text-gray-400 cursor-default transition-colors hover:text-gray-500",title:`Git Commit: ${e}
Date: 2025-12-16 14:13:24 +0800`,children:[s.jsx("svg",{className:"git-icon w-3 h-3 flex-shrink-0 opacity-50",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:s.jsx("path",{d:"M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22"})}),s.jsx("span",{className:"commit-hash font-normal tracking-wide select-text",children:e})]})}function Bo({children:e}){return s.jsxs("div",{className:"desktop-layout atmospheric-bg relative min-h-screen w-screen bg-[var(--ct-slate-50)] overflow-hidden flex flex-col",children:[s.jsx("div",{className:"background-orb orb-1 absolute rounded-full blur-3xl z-0 pointer-events-none opacity-60 w-[500px] h-[500px] -top-[200px] -left-[200px] bg-gradient-radial from-[rgba(79,70,229,0.15)] to-transparent animate-[float_20s_infinite_ease-in-out] will-change-transform",style:{transform:"translateZ(0)"}}),s.jsx("div",{className:"background-orb orb-2 absolute rounded-full blur-3xl z-0 pointer-events-none opacity-60 w-[400px] h-[400px] -bottom-[150px] -right-[150px] bg-gradient-radial from-[rgba(124,58,237,0.12)] to-transparent animate-[float_25s_infinite_ease-in-out_reverse] will-change-transform",style:{transform:"translateZ(0)"}}),s.jsx("div",{className:"background-orb orb-3 absolute rounded-full blur-3xl z-0 pointer-events-none opacity-60 w-[350px] h-[350px] top-[40%] left-[60%] bg-gradient-radial from-[rgba(139,92,246,0.08)] to-transparent animate-[float_30s_infinite_ease-in-out] will-change-transform",style:{transform:"translateZ(0)"}}),s.jsxs("div",{className:"main-structure relative z-10 flex flex-col min-h-screen w-full",children:[s.jsx(_P,{}),s.jsx("div",{className:"content-area flex-1 flex flex-col min-w-0 min-h-0",children:e}),s.jsx("div",{className:"footer-container mt-auto flex justify-center items-center",children:s.jsx(RP,{})})]})]})}function zP(){const e=Ci(),[t]=UT(),r=jr(q=>q.getAuthConfig),n=jr(q=>q.loginWithPassword),o=jr(q=>q.token),i=jr(q=>q.user),l=ms(),[c,u]=w.useState({local_auth_enabled:!0}),[d,g]=w.useState({password:""}),[x,y]=w.useState(!0),[S,T]=w.useState(!1),[I,b]=w.useState(""),[h,v]=w.useState(!1),[C,A]=w.useState(!0),[P,N]=w.useState({}),z=q=>q?null:"",L=()=>{const q={},Q=z(d.password);return Q&&(q.password=Q),N(q),Object.keys(q).length===0},G=q=>{P[q]&&N(Q=>{const oe={...Q};return delete oe[q],oe})},R=d.password.length>0&&Object.keys(P).length===0,F=async()=>{try{const q=await r();q&&u(q)}catch(q){console.error(":",q)}finally{y(!1)}},D=()=>{C?localStorage.setItem("yprompt_remember_me","true"):localStorage.removeItem("yprompt_remember_me")},O=async q=>{if(q.preventDefault(),!!L()){b(""),T(!0);try{const Q=await n("admin",d.password);if(Q.success){D();const oe=t.get("redirect");oe&&oe!=="/login"?e(oe,{replace:!0}):e("/generate",{replace:!0})}else b(Q.message||"")}catch(Q){b(Q instanceof Error?Q.message:""),console.error(":",Q)}finally{T(!1)}}};return w.useEffect(()=>{if(!!o&&!!i){e("/generate",{replace:!0});return}localStorage.getItem("yprompt_remember_me")==="true"&&A(!0),F()},[o,i,e]),s.jsxs("div",{className:"login-container min-h-screen flex items-center justify-center bg-gradient-to-br from-[#667eea] to-[#764ba2] p-5 relative overflow-hidden",children:[s.jsx("div",{className:"login-container-bg absolute -top-1/2 -left-1/2 w-[200%] h-[200%] bg-[radial-gradient(circle,rgba(255,255,255,0.1)_1px,transparent_1px)] bg-[length:50px_50px] animate-[float_20s_linear_infinite] pointer-events-none"}),s.jsxs("div",{className:"login-card bg-white rounded-2xl shadow-[0_20px_60px_rgba(0,0,0,0.15)] w-full max-w-[420px] p-10 relative z-10 animate-[slideUp_0.4s_ease-out]",children:[s.jsxs("div",{className:"login-header text-center mb-8",children:[s.jsx("div",{className:"logo-wrapper mb-4 flex justify-center",children:s.jsx("div",{className:"logo-icon w-16 h-16 bg-gradient-to-br from-[#667eea] to-[#764ba2] rounded-2xl flex items-center justify-center text-white text-2xl font-bold shadow-[0_4px_12px_rgba(102,126,234,0.3)]",children:"YP"})}),s.jsx("h1",{className:"login-title text-[32px] font-bold text-[#1a202c] m-0 mb-2 tracking-tight",children:"YPrompt"}),s.jsx("p",{className:"login-subtitle text-sm text-[#718096] m-0",children:""}),l&&s.jsxs("div",{className:"debug-badge inline-flex items-center gap-1.5 mt-3 px-3 py-1.5 bg-[rgba(255,193,7,0.1)] border border-[rgba(255,193,7,0.3)] rounded-lg text-xs text-[#856404] font-medium",children:[s.jsx("span",{className:"debug-icon text-sm",children:""}),s.jsx("span",{children:"Debug Mock API"})]})]}),x?s.jsxs("div",{className:"loading-state text-center py-[60px]",children:[s.jsx("div",{className:"loading-spinner w-12 h-12 border-4 border-[#e2e8f0] border-t-[#667eea] rounded-full animate-spin mx-auto mb-4"}),s.jsx("p",{className:"loading-text text-[#718096] text-sm",children:"..."})]}):s.jsx("div",{className:"login-content",children:c.local_auth_enabled&&s.jsx("div",{className:"login-section mb-5",children:s.jsxs("form",{onSubmit:O,className:"login-form mt-5",children:[s.jsxs("div",{className:"form-group mb-5",children:[s.jsx("label",{htmlFor:"password",className:"block mb-2 text-sm font-medium text-[#4a5568]",children:""}),s.jsxs("div",{className:"input-wrapper relative flex items-center",children:[s.jsx("input",{id:"password",type:h?"text":"password",value:d.password,onChange:q=>{g({password:q.target.value}),G("password")},onBlur:L,className:`form-input w-full px-4 py-3 pr-11 border-2 rounded-lg text-sm transition-all bg-white ${P.password?"border-[#e53e3e] focus:border-[#e53e3e] focus:shadow-[0_0_0_4px_rgba(229,62,62,0.1)]":"border-[#e2e8f0] focus:border-[#667eea] focus:shadow-[0_0_0_4px_rgba(102,126,234,0.1)]"} ${S?"bg-[#f7fafc] cursor-not-allowed opacity-70":""}`,placeholder:"",disabled:S,autoComplete:"current-password"}),s.jsx("button",{type:"button",className:"password-toggle absolute right-3 bg-none border-0 text-[#718096] cursor-pointer p-1 flex items-center justify-center transition-colors hover:text-[#4a5568] disabled:cursor-not-allowed disabled:opacity-50",onClick:()=>v(!h),disabled:S,tabIndex:-1,children:h?s.jsx(kx,{size:18}):s.jsx(sh,{size:18})})]}),P.password&&s.jsx("div",{className:"field-error mt-1.5 text-xs text-[#e53e3e] flex items-center gap-1",children:P.password})]}),s.jsx("div",{className:"form-options flex justify-between items-center mb-5",children:s.jsxs("label",{className:"checkbox-label flex items-center gap-2 text-sm text-[#4a5568] cursor-pointer select-none",children:[s.jsx("input",{type:"checkbox",checked:C,onChange:q=>A(q.target.checked),className:"checkbox-input w-4 h-4 cursor-pointer accent-[#667eea]",disabled:S}),s.jsx("span",{children:""})]})}),I&&s.jsxs("div",{className:"error-message px-4 py-3 bg-[#fed7d7] text-[#c53030] rounded-lg text-sm mb-4 flex items-center gap-2 border border-[#fc8181] animate-[fade_0.3s_ease]",children:[s.jsx(bx,{size:16}),s.jsx("span",{children:I})]}),s.jsx("button",{type:"submit",className:"btn btn-primary btn-block w-full px-6 py-3 rounded-lg text-[15px] font-medium cursor-pointer transition-all inline-flex items-center justify-center gap-2 bg-gradient-to-r from-[#667eea] to-[#764ba2] text-white shadow-[0_4px_12px_rgba(102,126,234,0.3)] hover:translate-y-[-1px] hover:shadow-[0_6px_16px_rgba(102,126,234,0.4)] active:translate-y-0 disabled:opacity-60 disabled:cursor-not-allowed disabled:transform-none",disabled:S||!R,children:S?s.jsxs(s.Fragment,{children:[s.jsx(Sx,{size:18,className:"spinning animate-spin"}),s.jsx("span",{children:"..."})]}):s.jsx("span",{children:""})})]})})})]})]})}const LP="https://api.prompt-ui.xiechengqi.top";function OP(){return localStorage.getItem("yprompt_token")}async function Rc(e,t={}){if(ms()){const l=t.method||"GET",c=t.body?JSON.parse(t.body):void 0;return Go(l,e,c)}const r=OP(),n={"Content-Type":"application/json",...t.headers};r&&(n.Authorization=`Bearer ${r}`);const o=await fetch(`${LP}${e}`,{...t,headers:n});if(!o.ok){let l="";try{const c=await o.json();if(l=c.message||l,c.code===401)throw localStorage.removeItem("yprompt_token"),localStorage.removeItem("yprompt_user"),new Error("")}catch{l=`: ${o.status} ${o.statusText}`}throw new Error(l)}let i;try{i=await o.json()}catch(l){throw new Error(`: ${l instanceof Error?l.message:""}`)}if(i.code===401)throw localStorage.removeItem("yprompt_token"),localStorage.removeItem("yprompt_user"),new Error("");return i}async function _a(e){return Rc(e,{method:"GET"})}async function wo(e,t){return Rc(e,{method:"POST",body:t?JSON.stringify(t):void 0})}async function Ax(e,t){return Rc(e,{method:"PUT",body:t?JSON.stringify(t):void 0})}async function oh(e){return Rc(e,{method:"DELETE"})}async function Yd(e){return wo("/api/prompts",e)}async function DP(){return _a("/api/prompt-rules")}async function $P(e){return wo("/api/prompt-rules",e)}async function FP(e){if(e&&e.length>0){const t={};return e.forEach(r=>{t[r]=null}),wo("/api/prompt-rules",t)}else return oh("/api/prompt-rules")}const zr=Object.freeze(Object.defineProperty({__proto__:null,del:oh,deleteUserPromptRules:FP,get:_a,getUserPromptRules:DP,post:wo,put:Ax,savePrompt:Yd,saveUserPromptRules:$P},Symbol.toStringTag,{value:"Module"})),Eg=[{id:"taskDefinition",title:"",description:"AI"},{id:"context",title:"",description:"AI"},{id:"outputFormat",title:"",description:"AI"},{id:"qualityCriteria",title:"",description:""},{id:"executionParams",title:"",description:"AI"},{id:"optimization",title:"",description:""}],Et=vo((e,t)=>({currentStep:0,currentStepUserMessages:0,chatMessages:[],isTyping:!1,isGenerating:!1,showPreview:!1,currentLanguage:"zh",isAutoMode:!0,isInitialized:!1,currentExecutionStep:null,collectedData:{taskDefinition:"",context:"",outputFormat:"",qualityCriteria:"",executionParams:""},promptData:{requirementReport:"",generatedPrompt:"",optimizedPrompt:{zh:"",en:""}},steps:Eg,addMessage:(r,n,o,i)=>{const l={id:(i==null?void 0:i.id)||`msg_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,type:r,content:n,timestamp:new Date().toISOString(),isProgress:(i==null?void 0:i.isProgress)||!1,attachments:o&&o.length>0?o:[]};e(c=>({chatMessages:[...c.chatMessages,l],currentStepUserMessages:r==="user"?c.currentStepUserMessages+1:c.currentStepUserMessages}))},addOrUpdateProgressMessage:(r,n="progress_message")=>{const o=t(),i=o.chatMessages.findIndex(l=>l.id===n);if(i!==-1){const l=[...o.chatMessages];l[i]={...l[i],content:r,timestamp:new Date().toISOString()},e({chatMessages:l})}else t().addMessage("ai",r,void 0,{id:n,isProgress:!0})},clearChat:()=>{e({chatMessages:[],currentStep:0,currentStepUserMessages:0,showPreview:!1,isInitialized:!1,currentExecutionStep:null,collectedData:{taskDefinition:"",context:"",outputFormat:"",qualityCriteria:"",executionParams:""},promptData:{requirementReport:"",generatedPrompt:{zh:"",en:""},optimizedPrompt:{zh:"",en:""}}})},nextStep:()=>{const r=t();r.currentStep<Eg.length-1&&e({currentStep:r.currentStep+1,currentStepUserMessages:0})},updateCollectedData:(r,n)=>{const o=t();if(r in o.collectedData){const i=o.collectedData[r];e({collectedData:{...o.collectedData,[r]:i?i+`
`+n:n}})}},deleteMessage:r=>{const o=t().chatMessages.map(i=>i.id===r?{...i,isDeleted:!0}:i);e({chatMessages:o})},updateMessage:(r,n)=>{const i=t().chatMessages.map(l=>l.id===r?{...l,content:n,timestamp:new Date().toISOString()}:l);e({chatMessages:i})},startEditMessage:r=>{const o=t().chatMessages.map(i=>i.id===r?{...i,isEditing:!0,originalContent:i.content}:i);e({chatMessages:o})},saveEditMessage:(r,n)=>{const i=t().chatMessages.map(l=>l.id===r?{...l,content:n.trim(),isEditing:!1,originalContent:void 0,timestamp:new Date().toISOString()}:l);e({chatMessages:i})},cancelEditMessage:r=>{const o=t().chatMessages.map(i=>i.id===r&&i.originalContent!==void 0?{...i,content:i.originalContent,isEditing:!1,originalContent:void 0}:i);e({chatMessages:o})},getValidMessages:()=>t().chatMessages.filter(n=>!n.isDeleted&&!n.isProgress),clearProgressMessages:()=>{const r=t();e({chatMessages:r.chatMessages.filter(n=>!n.isProgress)})},savePromptToLibrary:async r=>{await Yd(r)},saveToBackend:async(r,n,o,i="system")=>{const{useAuthStore:l}=await zt(async()=>{const{useAuthStore:x}=await Promise.resolve().then(()=>yC);return{useAuthStore:x}},void 0),c=l.getState();if(!c.token||!c.user)return{success:!1,error:""};const u=t();let d;const g=u.promptData.generatedPrompt;if(typeof g=="string"?d=g:"markdown"in g&&"xml"in g?d=g.markdown.zh||g.markdown.en||g.xml.zh||g.xml.en:d=g[u.currentLanguage],!d||!d.trim())return{success:!1,error:""};try{const x={title:r.trim(),description:n==null?void 0:n.trim(),requirement_report:u.promptData.requirementReport,thinking_points:u.promptData.thinkingPoints,initial_prompt:u.promptData.initialPrompt,advice:u.promptData.advice,final_prompt:d,language:u.currentLanguage,format:"markdown",prompt_type:i,tags:o},y=await Yd(x);return y.code===200&&y.data?{success:!0,promptId:y.data.id}:{success:!1,error:y.message||""}}catch(x){return{success:!1,error:x.message||""}}},setShowPreview:r=>{e({showPreview:r})},setCurrentLanguage:r=>{e({currentLanguage:r})},setIsAutoMode:r=>{e({isAutoMode:r})},setIsGenerating:r=>{e({isGenerating:r})},setIsTyping:r=>{e({isTyping:r})},setCurrentExecutionStep:r=>{e({currentExecutionStep:r})},getState:()=>t(),setState:r=>{e(typeof r=="function"?r(t()):r)}}));function ih(){return{async:!1,breaks:!1,extensions:null,gfm:!0,hooks:null,pedantic:!1,renderer:null,silent:!1,tokenizer:null,walkTokens:null}}var bo=ih();function Ex(e){bo=e}var pa={exec:()=>null};function yt(e,t=""){let r=typeof e=="string"?e:e.source,n={replace:(o,i)=>{let l=typeof i=="string"?i:i.source;return l=l.replace(br.caret,"$1"),r=r.replace(o,l),n},getRegex:()=>new RegExp(r,t)};return n}var br={codeRemoveIndent:/^(?: {1,4}| {0,3}\t)/gm,outputLinkReplace:/\\([\[\]])/g,indentCodeCompensation:/^(\s+)(?:```)/,beginningSpace:/^\s+/,endingHash:/#$/,startingSpaceChar:/^ /,endingSpaceChar:/ $/,nonSpaceChar:/[^ ]/,newLineCharGlobal:/\n/g,tabCharGlobal:/\t/g,multipleSpaceGlobal:/\s+/g,blankLine:/^[ \t]*$/,doubleBlankLine:/\n[ \t]*\n[ \t]*$/,blockquoteStart:/^ {0,3}>/,blockquoteSetextReplace:/\n {0,3}((?:=+|-+) *)(?=\n|$)/g,blockquoteSetextReplace2:/^ {0,3}>[ \t]?/gm,listReplaceTabs:/^\t+/,listReplaceNesting:/^ {1,4}(?=( {4})*[^ ])/g,listIsTask:/^\[[ xX]\] /,listReplaceTask:/^\[[ xX]\] +/,anyLine:/\n.*\n/,hrefBrackets:/^<(.*)>$/,tableDelimiter:/[:|]/,tableAlignChars:/^\||\| *$/g,tableRowBlankLine:/\n[ \t]*$/,tableAlignRight:/^ *-+: *$/,tableAlignCenter:/^ *:-+: *$/,tableAlignLeft:/^ *:-+ *$/,startATag:/^<a /i,endATag:/^<\/a>/i,startPreScriptTag:/^<(pre|code|kbd|script)(\s|>)/i,endPreScriptTag:/^<\/(pre|code|kbd|script)(\s|>)/i,startAngleBracket:/^</,endAngleBracket:/>$/,pedanticHrefTitle:/^([^'"]*[^\s])\s+(['"])(.*)\2/,unicodeAlphaNumeric:/[\p{L}\p{N}]/u,escapeTest:/[&<>"']/,escapeReplace:/[&<>"']/g,escapeTestNoEncode:/[<>"']|&(?!(#\d{1,7}|#[Xx][a-fA-F0-9]{1,6}|\w+);)/,escapeReplaceNoEncode:/[<>"']|&(?!(#\d{1,7}|#[Xx][a-fA-F0-9]{1,6}|\w+);)/g,unescapeTest:/&(#(?:\d+)|(?:#x[0-9A-Fa-f]+)|(?:\w+));?/ig,caret:/(^|[^\[])\^/g,percentDecode:/%25/g,findPipe:/\|/g,splitPipe:/ \|/,slashPipe:/\\\|/g,carriageReturn:/\r\n|\r/g,spaceLine:/^ +$/gm,notSpaceStart:/^\S*/,endingNewline:/\n$/,listItemRegex:e=>new RegExp(`^( {0,3}${e})((?:[	 ][^\\n]*)?(?:\\n|$))`),nextBulletRegex:e=>new RegExp(`^ {0,${Math.min(3,e-1)}}(?:[*+-]|\\d{1,9}[.)])((?:[ 	][^\\n]*)?(?:\\n|$))`),hrRegex:e=>new RegExp(`^ {0,${Math.min(3,e-1)}}((?:- *){3,}|(?:_ *){3,}|(?:\\* *){3,})(?:\\n+|$)`),fencesBeginRegex:e=>new RegExp(`^ {0,${Math.min(3,e-1)}}(?:\`\`\`|~~~)`),headingBeginRegex:e=>new RegExp(`^ {0,${Math.min(3,e-1)}}#`),htmlBeginRegex:e=>new RegExp(`^ {0,${Math.min(3,e-1)}}<(?:[a-z].*>|!--)`,"i")},UP=/^(?:[ \t]*(?:\n|$))+/,BP=/^((?: {4}| {0,3}\t)[^\n]+(?:\n(?:[ \t]*(?:\n|$))*)?)+/,qP=/^ {0,3}(`{3,}(?=[^`\n]*(?:\n|$))|~{3,})([^\n]*)(?:\n|$)(?:|([\s\S]*?)(?:\n|$))(?: {0,3}\1[~`]* *(?=\n|$)|$)/,$a=/^ {0,3}((?:-[\t ]*){3,}|(?:_[ \t]*){3,}|(?:\*[ \t]*){3,})(?:\n+|$)/,WP=/^ {0,3}(#{1,6})(?=\s|$)(.*)(?:\n+|$)/,ah=/(?:[*+-]|\d{1,9}[.)])/,Mx=/^(?!bull |blockCode|fences|blockquote|heading|html|table)((?:.|\n(?!\s*?\n|bull |blockCode|fences|blockquote|heading|html|table))+?)\n {0,3}(=+|-+) *(?:\n+|$)/,_x=yt(Mx).replace(/bull/g,ah).replace(/blockCode/g,/(?: {4}| {0,3}\t)/).replace(/fences/g,/ {0,3}(?:`{3,}|~{3,})/).replace(/blockquote/g,/ {0,3}>/).replace(/heading/g,/ {0,3}#{1,6}/).replace(/html/g,/ {0,3}<[^\n>]+>\n/).replace(/\|table/g,"").getRegex(),GP=yt(Mx).replace(/bull/g,ah).replace(/blockCode/g,/(?: {4}| {0,3}\t)/).replace(/fences/g,/ {0,3}(?:`{3,}|~{3,})/).replace(/blockquote/g,/ {0,3}>/).replace(/heading/g,/ {0,3}#{1,6}/).replace(/html/g,/ {0,3}<[^\n>]+>\n/).replace(/table/g,/ {0,3}\|?(?:[:\- ]*\|)+[\:\- ]*\n/).getRegex(),lh=/^([^\n]+(?:\n(?!hr|heading|lheading|blockquote|fences|list|html|table| +\n)[^\n]+)*)/,HP=/^[^\n]+/,ch=/(?!\s*\])(?:\\[\s\S]|[^\[\]\\])+/,VP=yt(/^ {0,3}\[(label)\]: *(?:\n[ \t]*)?([^<\s][^\s]*|<.*?>)(?:(?: +(?:\n[ \t]*)?| *\n[ \t]*)(title))? *(?:\n+|$)/).replace("label",ch).replace("title",/(?:"(?:\\"?|[^"\\])*"|'[^'\n]*(?:\n[^'\n]+)*\n?'|\([^()]*\))/).getRegex(),KP=yt(/^( {0,3}bull)([ \t][^\n]+?)?(?:\n|$)/).replace(/bull/g,ah).getRegex(),zc="address|article|aside|base|basefont|blockquote|body|caption|center|col|colgroup|dd|details|dialog|dir|div|dl|dt|fieldset|figcaption|figure|footer|form|frame|frameset|h[1-6]|head|header|hr|html|iframe|legend|li|link|main|menu|menuitem|meta|nav|noframes|ol|optgroup|option|p|param|search|section|summary|table|tbody|td|tfoot|th|thead|title|tr|track|ul",uh=/<!--(?:-?>|[\s\S]*?(?:-->|$))/,YP=yt("^ {0,3}(?:<(script|pre|style|textarea)[\\s>][\\s\\S]*?(?:</\\1>[^\\n]*\\n+|$)|comment[^\\n]*(\\n+|$)|<\\?[\\s\\S]*?(?:\\?>\\n*|$)|<![A-Z][\\s\\S]*?(?:>\\n*|$)|<!\\[CDATA\\[[\\s\\S]*?(?:\\]\\]>\\n*|$)|</?(tag)(?: +|\\n|/?>)[\\s\\S]*?(?:(?:\\n[ 	]*)+\\n|$)|<(?!script|pre|style|textarea)([a-z][\\w-]*)(?:attribute)*? */?>(?=[ \\t]*(?:\\n|$))[\\s\\S]*?(?:(?:\\n[ 	]*)+\\n|$)|</(?!script|pre|style|textarea)[a-z][\\w-]*\\s*>(?=[ \\t]*(?:\\n|$))[\\s\\S]*?(?:(?:\\n[ 	]*)+\\n|$))","i").replace("comment",uh).replace("tag",zc).replace("attribute",/ +[a-zA-Z:_][\w.:-]*(?: *= *"[^"\n]*"| *= *'[^'\n]*'| *= *[^\s"'=<>`]+)?/).getRegex(),Rx=yt(lh).replace("hr",$a).replace("heading"," {0,3}#{1,6}(?:\\s|$)").replace("|lheading","").replace("|table","").replace("blockquote"," {0,3}>").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",zc).getRegex(),QP=yt(/^( {0,3}> ?(paragraph|[^\n]*)(?:\n|$))+/).replace("paragraph",Rx).getRegex(),dh={blockquote:QP,code:BP,def:VP,fences:qP,heading:WP,hr:$a,html:YP,lheading:_x,list:KP,newline:UP,paragraph:Rx,table:pa,text:HP},Mg=yt("^ *([^\\n ].*)\\n {0,3}((?:\\| *)?:?-+:? *(?:\\| *:?-+:? *)*(?:\\| *)?)(?:\\n((?:(?! *\\n|hr|heading|blockquote|code|fences|list|html).*(?:\\n|$))*)\\n*|$)").replace("hr",$a).replace("heading"," {0,3}#{1,6}(?:\\s|$)").replace("blockquote"," {0,3}>").replace("code","(?: {4}| {0,3}	)[^\\n]").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",zc).getRegex(),JP={...dh,lheading:GP,table:Mg,paragraph:yt(lh).replace("hr",$a).replace("heading"," {0,3}#{1,6}(?:\\s|$)").replace("|lheading","").replace("table",Mg).replace("blockquote"," {0,3}>").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",zc).getRegex()},ZP={...dh,html:yt(`^ *(?:comment *(?:\\n|\\s*$)|<(tag)[\\s\\S]+?</\\1> *(?:\\n{2,}|\\s*$)|<tag(?:"[^"]*"|'[^']*'|\\s[^'"/>\\s]*)*?/?> *(?:\\n{2,}|\\s*$))`).replace("comment",uh).replace(/tag/g,"(?!(?:a|em|strong|small|s|cite|q|dfn|abbr|data|time|code|var|samp|kbd|sub|sup|i|b|u|mark|ruby|rt|rp|bdi|bdo|span|br|wbr|ins|del|img)\\b)\\w+(?!:|[^\\w\\s@]*@)\\b").getRegex(),def:/^ *\[([^\]]+)\]: *<?([^\s>]+)>?(?: +(["(][^\n]+[")]))? *(?:\n+|$)/,heading:/^(#{1,6})(.*)(?:\n+|$)/,fences:pa,lheading:/^(.+?)\n {0,3}(=+|-+) *(?:\n+|$)/,paragraph:yt(lh).replace("hr",$a).replace("heading",` *#{1,6} *[^
]`).replace("lheading",_x).replace("|table","").replace("blockquote"," {0,3}>").replace("|fences","").replace("|list","").replace("|html","").replace("|tag","").getRegex()},XP=/^\\([!"#$%&'()*+,\-./:;<=>?@\[\]\\^_`{|}~])/,ej=/^(`+)([^`]|[^`][\s\S]*?[^`])\1(?!`)/,zx=/^( {2,}|\\)\n(?!\s*$)/,tj=/^(`+|[^`])(?:(?= {2,}\n)|[\s\S]*?(?:(?=[\\<!\[`*_]|\b_|$)|[^ ](?= {2,}\n)))/,Lc=/[\p{P}\p{S}]/u,ph=/[\s\p{P}\p{S}]/u,Lx=/[^\s\p{P}\p{S}]/u,rj=yt(/^((?![*_])punctSpace)/,"u").replace(/punctSpace/g,ph).getRegex(),Ox=/(?!~)[\p{P}\p{S}]/u,nj=/(?!~)[\s\p{P}\p{S}]/u,sj=/(?:[^\s\p{P}\p{S}]|~)/u,oj=/\[[^\[\]]*?\]\((?:\\[\s\S]|[^\\\(\)]|\((?:\\[\s\S]|[^\\\(\)])*\))*\)|`[^`]*?`|<(?! )[^<>]*?>/g,Dx=/^(?:\*+(?:((?!\*)punct)|[^\s*]))|^_+(?:((?!_)punct)|([^\s_]))/,ij=yt(Dx,"u").replace(/punct/g,Lc).getRegex(),aj=yt(Dx,"u").replace(/punct/g,Ox).getRegex(),$x="^[^_*]*?__[^_*]*?\\*[^_*]*?(?=__)|[^*]+(?=[^*])|(?!\\*)punct(\\*+)(?=[\\s]|$)|notPunctSpace(\\*+)(?!\\*)(?=punctSpace|$)|(?!\\*)punctSpace(\\*+)(?=notPunctSpace)|[\\s](\\*+)(?!\\*)(?=punct)|(?!\\*)punct(\\*+)(?!\\*)(?=punct)|notPunctSpace(\\*+)(?=notPunctSpace)",lj=yt($x,"gu").replace(/notPunctSpace/g,Lx).replace(/punctSpace/g,ph).replace(/punct/g,Lc).getRegex(),cj=yt($x,"gu").replace(/notPunctSpace/g,sj).replace(/punctSpace/g,nj).replace(/punct/g,Ox).getRegex(),uj=yt("^[^_*]*?\\*\\*[^_*]*?_[^_*]*?(?=\\*\\*)|[^_]+(?=[^_])|(?!_)punct(_+)(?=[\\s]|$)|notPunctSpace(_+)(?!_)(?=punctSpace|$)|(?!_)punctSpace(_+)(?=notPunctSpace)|[\\s](_+)(?!_)(?=punct)|(?!_)punct(_+)(?!_)(?=punct)","gu").replace(/notPunctSpace/g,Lx).replace(/punctSpace/g,ph).replace(/punct/g,Lc).getRegex(),dj=yt(/\\(punct)/,"gu").replace(/punct/g,Lc).getRegex(),pj=yt(/^<(scheme:[^\s\x00-\x1f<>]*|email)>/).replace("scheme",/[a-zA-Z][a-zA-Z0-9+.-]{1,31}/).replace("email",/[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+(@)[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)+(?![-_])/).getRegex(),hj=yt(uh).replace("(?:-->|$)","-->").getRegex(),mj=yt("^comment|^</[a-zA-Z][\\w:-]*\\s*>|^<[a-zA-Z][\\w-]*(?:attribute)*?\\s*/?>|^<\\?[\\s\\S]*?\\?>|^<![a-zA-Z]+\\s[\\s\\S]*?>|^<!\\[CDATA\\[[\\s\\S]*?\\]\\]>").replace("comment",hj).replace("attribute",/\s+[a-zA-Z:_][\w.:-]*(?:\s*=\s*"[^"]*"|\s*=\s*'[^']*'|\s*=\s*[^\s"'=<>`]+)?/).getRegex(),uc=/(?:\[(?:\\[\s\S]|[^\[\]\\])*\]|\\[\s\S]|`[^`]*`|[^\[\]\\`])*?/,fj=yt(/^!?\[(label)\]\(\s*(href)(?:(?:[ \t]*(?:\n[ \t]*)?)(title))?\s*\)/).replace("label",uc).replace("href",/<(?:\\.|[^\n<>\\])+>|[^ \t\n\x00-\x1f]*/).replace("title",/"(?:\\"?|[^"\\])*"|'(?:\\'?|[^'\\])*'|\((?:\\\)?|[^)\\])*\)/).getRegex(),Fx=yt(/^!?\[(label)\]\[(ref)\]/).replace("label",uc).replace("ref",ch).getRegex(),Ux=yt(/^!?\[(ref)\](?:\[\])?/).replace("ref",ch).getRegex(),gj=yt("reflink|nolink(?!\\()","g").replace("reflink",Fx).replace("nolink",Ux).getRegex(),hh={_backpedal:pa,anyPunctuation:dj,autolink:pj,blockSkip:oj,br:zx,code:ej,del:pa,emStrongLDelim:ij,emStrongRDelimAst:lj,emStrongRDelimUnd:uj,escape:XP,link:fj,nolink:Ux,punctuation:rj,reflink:Fx,reflinkSearch:gj,tag:mj,text:tj,url:pa},yj={...hh,link:yt(/^!?\[(label)\]\((.*?)\)/).replace("label",uc).getRegex(),reflink:yt(/^!?\[(label)\]\s*\[([^\]]*)\]/).replace("label",uc).getRegex()},Qd={...hh,emStrongRDelimAst:cj,emStrongLDelim:aj,url:yt(/^((?:ftp|https?):\/\/|www\.)(?:[a-zA-Z0-9\-]+\.?)+[^\s<]*|^email/,"i").replace("email",/[A-Za-z0-9._+-]+(@)[a-zA-Z0-9-_]+(?:\.[a-zA-Z0-9-_]*[a-zA-Z0-9])+(?![-_])/).getRegex(),_backpedal:/(?:[^?!.,:;*_'"~()&]+|\([^)]*\)|&(?![a-zA-Z0-9]+;$)|[?!.,:;*_'"~)]+(?!$))+/,del:/^(~~?)(?=[^\s~])((?:\\[\s\S]|[^\\])*?(?:\\[\s\S]|[^\s~\\]))\1(?=[^~]|$)/,text:/^([`~]+|[^`~])(?:(?= {2,}\n)|(?=[a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-]+@)|[\s\S]*?(?:(?=[\\<!\[`*~_]|\b_|https?:\/\/|ftp:\/\/|www\.|$)|[^ ](?= {2,}\n)|[^a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-](?=[a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-]+@)))/},xj={...Qd,br:yt(zx).replace("{2,}","*").getRegex(),text:yt(Qd.text).replace("\\b_","\\b_| {2,}\\n").replace(/\{2,\}/g,"*").getRegex()},xl={normal:dh,gfm:JP,pedantic:ZP},Yi={normal:hh,gfm:Qd,breaks:xj,pedantic:yj},vj={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},_g=e=>vj[e];function vn(e,t){if(t){if(br.escapeTest.test(e))return e.replace(br.escapeReplace,_g)}else if(br.escapeTestNoEncode.test(e))return e.replace(br.escapeReplaceNoEncode,_g);return e}function Rg(e){try{e=encodeURI(e).replace(br.percentDecode,"%")}catch{return null}return e}function zg(e,t){var i;let r=e.replace(br.findPipe,(l,c,u)=>{let d=!1,g=c;for(;--g>=0&&u[g]==="\\";)d=!d;return d?"|":" |"}),n=r.split(br.splitPipe),o=0;if(n[0].trim()||n.shift(),n.length>0&&!((i=n.at(-1))!=null&&i.trim())&&n.pop(),t)if(n.length>t)n.splice(t);else for(;n.length<t;)n.push("");for(;o<n.length;o++)n[o]=n[o].trim().replace(br.slashPipe,"|");return n}function Qi(e,t,r){let n=e.length;if(n===0)return"";let o=0;for(;o<n&&e.charAt(n-o-1)===t;)o++;return e.slice(0,n-o)}function wj(e,t){if(e.indexOf(t[1])===-1)return-1;let r=0;for(let n=0;n<e.length;n++)if(e[n]==="\\")n++;else if(e[n]===t[0])r++;else if(e[n]===t[1]&&(r--,r<0))return n;return r>0?-2:-1}function Lg(e,t,r,n,o){let i=t.href,l=t.title||null,c=e[1].replace(o.other.outputLinkReplace,"$1");n.state.inLink=!0;let u={type:e[0].charAt(0)==="!"?"image":"link",raw:r,href:i,title:l,text:c,tokens:n.inlineTokens(c)};return n.state.inLink=!1,u}function bj(e,t,r){let n=e.match(r.other.indentCodeCompensation);if(n===null)return t;let o=n[1];return t.split(`
`).map(i=>{let l=i.match(r.other.beginningSpace);if(l===null)return i;let[c]=l;return c.length>=o.length?i.slice(o.length):i}).join(`
`)}var dc=class{constructor(e){Ue(this,"options");Ue(this,"rules");Ue(this,"lexer");this.options=e||bo}space(e){let t=this.rules.block.newline.exec(e);if(t&&t[0].length>0)return{type:"space",raw:t[0]}}code(e){let t=this.rules.block.code.exec(e);if(t){let r=t[0].replace(this.rules.other.codeRemoveIndent,"");return{type:"code",raw:t[0],codeBlockStyle:"indented",text:this.options.pedantic?r:Qi(r,`
`)}}}fences(e){let t=this.rules.block.fences.exec(e);if(t){let r=t[0],n=bj(r,t[3]||"",this.rules);return{type:"code",raw:r,lang:t[2]?t[2].trim().replace(this.rules.inline.anyPunctuation,"$1"):t[2],text:n}}}heading(e){let t=this.rules.block.heading.exec(e);if(t){let r=t[2].trim();if(this.rules.other.endingHash.test(r)){let n=Qi(r,"#");(this.options.pedantic||!n||this.rules.other.endingSpaceChar.test(n))&&(r=n.trim())}return{type:"heading",raw:t[0],depth:t[1].length,text:r,tokens:this.lexer.inline(r)}}}hr(e){let t=this.rules.block.hr.exec(e);if(t)return{type:"hr",raw:Qi(t[0],`
`)}}blockquote(e){let t=this.rules.block.blockquote.exec(e);if(t){let r=Qi(t[0],`
`).split(`
`),n="",o="",i=[];for(;r.length>0;){let l=!1,c=[],u;for(u=0;u<r.length;u++)if(this.rules.other.blockquoteStart.test(r[u]))c.push(r[u]),l=!0;else if(!l)c.push(r[u]);else break;r=r.slice(u);let d=c.join(`
`),g=d.replace(this.rules.other.blockquoteSetextReplace,`
    $1`).replace(this.rules.other.blockquoteSetextReplace2,"");n=n?`${n}
${d}`:d,o=o?`${o}
${g}`:g;let x=this.lexer.state.top;if(this.lexer.state.top=!0,this.lexer.blockTokens(g,i,!0),this.lexer.state.top=x,r.length===0)break;let y=i.at(-1);if((y==null?void 0:y.type)==="code")break;if((y==null?void 0:y.type)==="blockquote"){let S=y,T=S.raw+`
`+r.join(`
`),I=this.blockquote(T);i[i.length-1]=I,n=n.substring(0,n.length-S.raw.length)+I.raw,o=o.substring(0,o.length-S.text.length)+I.text;break}else if((y==null?void 0:y.type)==="list"){let S=y,T=S.raw+`
`+r.join(`
`),I=this.list(T);i[i.length-1]=I,n=n.substring(0,n.length-y.raw.length)+I.raw,o=o.substring(0,o.length-S.raw.length)+I.raw,r=T.substring(i.at(-1).raw.length).split(`
`);continue}}return{type:"blockquote",raw:n,tokens:i,text:o}}}list(e){let t=this.rules.block.list.exec(e);if(t){let r=t[1].trim(),n=r.length>1,o={type:"list",raw:"",ordered:n,start:n?+r.slice(0,-1):"",loose:!1,items:[]};r=n?`\\d{1,9}\\${r.slice(-1)}`:`\\${r}`,this.options.pedantic&&(r=n?r:"[*+-]");let i=this.rules.other.listItemRegex(r),l=!1;for(;e;){let u=!1,d="",g="";if(!(t=i.exec(e))||this.rules.block.hr.test(e))break;d=t[0],e=e.substring(d.length);let x=t[2].split(`
`,1)[0].replace(this.rules.other.listReplaceTabs,h=>" ".repeat(3*h.length)),y=e.split(`
`,1)[0],S=!x.trim(),T=0;if(this.options.pedantic?(T=2,g=x.trimStart()):S?T=t[1].length+1:(T=t[2].search(this.rules.other.nonSpaceChar),T=T>4?1:T,g=x.slice(T),T+=t[1].length),S&&this.rules.other.blankLine.test(y)&&(d+=y+`
`,e=e.substring(y.length+1),u=!0),!u){let h=this.rules.other.nextBulletRegex(T),v=this.rules.other.hrRegex(T),C=this.rules.other.fencesBeginRegex(T),A=this.rules.other.headingBeginRegex(T),P=this.rules.other.htmlBeginRegex(T);for(;e;){let N=e.split(`
`,1)[0],z;if(y=N,this.options.pedantic?(y=y.replace(this.rules.other.listReplaceNesting,"  "),z=y):z=y.replace(this.rules.other.tabCharGlobal,"    "),C.test(y)||A.test(y)||P.test(y)||h.test(y)||v.test(y))break;if(z.search(this.rules.other.nonSpaceChar)>=T||!y.trim())g+=`
`+z.slice(T);else{if(S||x.replace(this.rules.other.tabCharGlobal,"    ").search(this.rules.other.nonSpaceChar)>=4||C.test(x)||A.test(x)||v.test(x))break;g+=`
`+y}!S&&!y.trim()&&(S=!0),d+=N+`
`,e=e.substring(N.length+1),x=z.slice(T)}}o.loose||(l?o.loose=!0:this.rules.other.doubleBlankLine.test(d)&&(l=!0));let I=null,b;this.options.gfm&&(I=this.rules.other.listIsTask.exec(g),I&&(b=I[0]!=="[ ] ",g=g.replace(this.rules.other.listReplaceTask,""))),o.items.push({type:"list_item",raw:d,task:!!I,checked:b,loose:!1,text:g,tokens:[]}),o.raw+=d}let c=o.items.at(-1);if(c)c.raw=c.raw.trimEnd(),c.text=c.text.trimEnd();else return;o.raw=o.raw.trimEnd();for(let u=0;u<o.items.length;u++)if(this.lexer.state.top=!1,o.items[u].tokens=this.lexer.blockTokens(o.items[u].text,[]),!o.loose){let d=o.items[u].tokens.filter(x=>x.type==="space"),g=d.length>0&&d.some(x=>this.rules.other.anyLine.test(x.raw));o.loose=g}if(o.loose)for(let u=0;u<o.items.length;u++)o.items[u].loose=!0;return o}}html(e){let t=this.rules.block.html.exec(e);if(t)return{type:"html",block:!0,raw:t[0],pre:t[1]==="pre"||t[1]==="script"||t[1]==="style",text:t[0]}}def(e){let t=this.rules.block.def.exec(e);if(t){let r=t[1].toLowerCase().replace(this.rules.other.multipleSpaceGlobal," "),n=t[2]?t[2].replace(this.rules.other.hrefBrackets,"$1").replace(this.rules.inline.anyPunctuation,"$1"):"",o=t[3]?t[3].substring(1,t[3].length-1).replace(this.rules.inline.anyPunctuation,"$1"):t[3];return{type:"def",tag:r,raw:t[0],href:n,title:o}}}table(e){var l;let t=this.rules.block.table.exec(e);if(!t||!this.rules.other.tableDelimiter.test(t[2]))return;let r=zg(t[1]),n=t[2].replace(this.rules.other.tableAlignChars,"").split("|"),o=(l=t[3])!=null&&l.trim()?t[3].replace(this.rules.other.tableRowBlankLine,"").split(`
`):[],i={type:"table",raw:t[0],header:[],align:[],rows:[]};if(r.length===n.length){for(let c of n)this.rules.other.tableAlignRight.test(c)?i.align.push("right"):this.rules.other.tableAlignCenter.test(c)?i.align.push("center"):this.rules.other.tableAlignLeft.test(c)?i.align.push("left"):i.align.push(null);for(let c=0;c<r.length;c++)i.header.push({text:r[c],tokens:this.lexer.inline(r[c]),header:!0,align:i.align[c]});for(let c of o)i.rows.push(zg(c,i.header.length).map((u,d)=>({text:u,tokens:this.lexer.inline(u),header:!1,align:i.align[d]})));return i}}lheading(e){let t=this.rules.block.lheading.exec(e);if(t)return{type:"heading",raw:t[0],depth:t[2].charAt(0)==="="?1:2,text:t[1],tokens:this.lexer.inline(t[1])}}paragraph(e){let t=this.rules.block.paragraph.exec(e);if(t){let r=t[1].charAt(t[1].length-1)===`
`?t[1].slice(0,-1):t[1];return{type:"paragraph",raw:t[0],text:r,tokens:this.lexer.inline(r)}}}text(e){let t=this.rules.block.text.exec(e);if(t)return{type:"text",raw:t[0],text:t[0],tokens:this.lexer.inline(t[0])}}escape(e){let t=this.rules.inline.escape.exec(e);if(t)return{type:"escape",raw:t[0],text:t[1]}}tag(e){let t=this.rules.inline.tag.exec(e);if(t)return!this.lexer.state.inLink&&this.rules.other.startATag.test(t[0])?this.lexer.state.inLink=!0:this.lexer.state.inLink&&this.rules.other.endATag.test(t[0])&&(this.lexer.state.inLink=!1),!this.lexer.state.inRawBlock&&this.rules.other.startPreScriptTag.test(t[0])?this.lexer.state.inRawBlock=!0:this.lexer.state.inRawBlock&&this.rules.other.endPreScriptTag.test(t[0])&&(this.lexer.state.inRawBlock=!1),{type:"html",raw:t[0],inLink:this.lexer.state.inLink,inRawBlock:this.lexer.state.inRawBlock,block:!1,text:t[0]}}link(e){let t=this.rules.inline.link.exec(e);if(t){let r=t[2].trim();if(!this.options.pedantic&&this.rules.other.startAngleBracket.test(r)){if(!this.rules.other.endAngleBracket.test(r))return;let i=Qi(r.slice(0,-1),"\\");if((r.length-i.length)%2===0)return}else{let i=wj(t[2],"()");if(i===-2)return;if(i>-1){let l=(t[0].indexOf("!")===0?5:4)+t[1].length+i;t[2]=t[2].substring(0,i),t[0]=t[0].substring(0,l).trim(),t[3]=""}}let n=t[2],o="";if(this.options.pedantic){let i=this.rules.other.pedanticHrefTitle.exec(n);i&&(n=i[1],o=i[3])}else o=t[3]?t[3].slice(1,-1):"";return n=n.trim(),this.rules.other.startAngleBracket.test(n)&&(this.options.pedantic&&!this.rules.other.endAngleBracket.test(r)?n=n.slice(1):n=n.slice(1,-1)),Lg(t,{href:n&&n.replace(this.rules.inline.anyPunctuation,"$1"),title:o&&o.replace(this.rules.inline.anyPunctuation,"$1")},t[0],this.lexer,this.rules)}}reflink(e,t){let r;if((r=this.rules.inline.reflink.exec(e))||(r=this.rules.inline.nolink.exec(e))){let n=(r[2]||r[1]).replace(this.rules.other.multipleSpaceGlobal," "),o=t[n.toLowerCase()];if(!o){let i=r[0].charAt(0);return{type:"text",raw:i,text:i}}return Lg(r,o,r[0],this.lexer,this.rules)}}emStrong(e,t,r=""){let n=this.rules.inline.emStrongLDelim.exec(e);if(!(!n||n[3]&&r.match(this.rules.other.unicodeAlphaNumeric))&&(!(n[1]||n[2])||!r||this.rules.inline.punctuation.exec(r))){let o=[...n[0]].length-1,i,l,c=o,u=0,d=n[0][0]==="*"?this.rules.inline.emStrongRDelimAst:this.rules.inline.emStrongRDelimUnd;for(d.lastIndex=0,t=t.slice(-1*e.length+o);(n=d.exec(t))!=null;){if(i=n[1]||n[2]||n[3]||n[4]||n[5]||n[6],!i)continue;if(l=[...i].length,n[3]||n[4]){c+=l;continue}else if((n[5]||n[6])&&o%3&&!((o+l)%3)){u+=l;continue}if(c-=l,c>0)continue;l=Math.min(l,l+c+u);let g=[...n[0]][0].length,x=e.slice(0,o+n.index+g+l);if(Math.min(o,l)%2){let S=x.slice(1,-1);return{type:"em",raw:x,text:S,tokens:this.lexer.inlineTokens(S)}}let y=x.slice(2,-2);return{type:"strong",raw:x,text:y,tokens:this.lexer.inlineTokens(y)}}}}codespan(e){let t=this.rules.inline.code.exec(e);if(t){let r=t[2].replace(this.rules.other.newLineCharGlobal," "),n=this.rules.other.nonSpaceChar.test(r),o=this.rules.other.startingSpaceChar.test(r)&&this.rules.other.endingSpaceChar.test(r);return n&&o&&(r=r.substring(1,r.length-1)),{type:"codespan",raw:t[0],text:r}}}br(e){let t=this.rules.inline.br.exec(e);if(t)return{type:"br",raw:t[0]}}del(e){let t=this.rules.inline.del.exec(e);if(t)return{type:"del",raw:t[0],text:t[2],tokens:this.lexer.inlineTokens(t[2])}}autolink(e){let t=this.rules.inline.autolink.exec(e);if(t){let r,n;return t[2]==="@"?(r=t[1],n="mailto:"+r):(r=t[1],n=r),{type:"link",raw:t[0],text:r,href:n,tokens:[{type:"text",raw:r,text:r}]}}}url(e){var r;let t;if(t=this.rules.inline.url.exec(e)){let n,o;if(t[2]==="@")n=t[0],o="mailto:"+n;else{let i;do i=t[0],t[0]=((r=this.rules.inline._backpedal.exec(t[0]))==null?void 0:r[0])??"";while(i!==t[0]);n=t[0],t[1]==="www."?o="http://"+t[0]:o=t[0]}return{type:"link",raw:t[0],text:n,href:o,tokens:[{type:"text",raw:n,text:n}]}}}inlineText(e){let t=this.rules.inline.text.exec(e);if(t){let r=this.lexer.state.inRawBlock;return{type:"text",raw:t[0],text:t[0],escaped:r}}}},$n=class Jd{constructor(t){Ue(this,"tokens");Ue(this,"options");Ue(this,"state");Ue(this,"tokenizer");Ue(this,"inlineQueue");this.tokens=[],this.tokens.links=Object.create(null),this.options=t||bo,this.options.tokenizer=this.options.tokenizer||new dc,this.tokenizer=this.options.tokenizer,this.tokenizer.options=this.options,this.tokenizer.lexer=this,this.inlineQueue=[],this.state={inLink:!1,inRawBlock:!1,top:!0};let r={other:br,block:xl.normal,inline:Yi.normal};this.options.pedantic?(r.block=xl.pedantic,r.inline=Yi.pedantic):this.options.gfm&&(r.block=xl.gfm,this.options.breaks?r.inline=Yi.breaks:r.inline=Yi.gfm),this.tokenizer.rules=r}static get rules(){return{block:xl,inline:Yi}}static lex(t,r){return new Jd(r).lex(t)}static lexInline(t,r){return new Jd(r).inlineTokens(t)}lex(t){t=t.replace(br.carriageReturn,`
`),this.blockTokens(t,this.tokens);for(let r=0;r<this.inlineQueue.length;r++){let n=this.inlineQueue[r];this.inlineTokens(n.src,n.tokens)}return this.inlineQueue=[],this.tokens}blockTokens(t,r=[],n=!1){var o,i,l;for(this.options.pedantic&&(t=t.replace(br.tabCharGlobal,"    ").replace(br.spaceLine,""));t;){let c;if((i=(o=this.options.extensions)==null?void 0:o.block)!=null&&i.some(d=>(c=d.call({lexer:this},t,r))?(t=t.substring(c.raw.length),r.push(c),!0):!1))continue;if(c=this.tokenizer.space(t)){t=t.substring(c.raw.length);let d=r.at(-1);c.raw.length===1&&d!==void 0?d.raw+=`
`:r.push(c);continue}if(c=this.tokenizer.code(t)){t=t.substring(c.raw.length);let d=r.at(-1);(d==null?void 0:d.type)==="paragraph"||(d==null?void 0:d.type)==="text"?(d.raw+=(d.raw.endsWith(`
`)?"":`
`)+c.raw,d.text+=`
`+c.text,this.inlineQueue.at(-1).src=d.text):r.push(c);continue}if(c=this.tokenizer.fences(t)){t=t.substring(c.raw.length),r.push(c);continue}if(c=this.tokenizer.heading(t)){t=t.substring(c.raw.length),r.push(c);continue}if(c=this.tokenizer.hr(t)){t=t.substring(c.raw.length),r.push(c);continue}if(c=this.tokenizer.blockquote(t)){t=t.substring(c.raw.length),r.push(c);continue}if(c=this.tokenizer.list(t)){t=t.substring(c.raw.length),r.push(c);continue}if(c=this.tokenizer.html(t)){t=t.substring(c.raw.length),r.push(c);continue}if(c=this.tokenizer.def(t)){t=t.substring(c.raw.length);let d=r.at(-1);(d==null?void 0:d.type)==="paragraph"||(d==null?void 0:d.type)==="text"?(d.raw+=(d.raw.endsWith(`
`)?"":`
`)+c.raw,d.text+=`
`+c.raw,this.inlineQueue.at(-1).src=d.text):this.tokens.links[c.tag]||(this.tokens.links[c.tag]={href:c.href,title:c.title},r.push(c));continue}if(c=this.tokenizer.table(t)){t=t.substring(c.raw.length),r.push(c);continue}if(c=this.tokenizer.lheading(t)){t=t.substring(c.raw.length),r.push(c);continue}let u=t;if((l=this.options.extensions)!=null&&l.startBlock){let d=1/0,g=t.slice(1),x;this.options.extensions.startBlock.forEach(y=>{x=y.call({lexer:this},g),typeof x=="number"&&x>=0&&(d=Math.min(d,x))}),d<1/0&&d>=0&&(u=t.substring(0,d+1))}if(this.state.top&&(c=this.tokenizer.paragraph(u))){let d=r.at(-1);n&&(d==null?void 0:d.type)==="paragraph"?(d.raw+=(d.raw.endsWith(`
`)?"":`
`)+c.raw,d.text+=`
`+c.text,this.inlineQueue.pop(),this.inlineQueue.at(-1).src=d.text):r.push(c),n=u.length!==t.length,t=t.substring(c.raw.length);continue}if(c=this.tokenizer.text(t)){t=t.substring(c.raw.length);let d=r.at(-1);(d==null?void 0:d.type)==="text"?(d.raw+=(d.raw.endsWith(`
`)?"":`
`)+c.raw,d.text+=`
`+c.text,this.inlineQueue.pop(),this.inlineQueue.at(-1).src=d.text):r.push(c);continue}if(t){let d="Infinite loop on byte: "+t.charCodeAt(0);if(this.options.silent){console.error(d);break}else throw new Error(d)}}return this.state.top=!0,r}inline(t,r=[]){return this.inlineQueue.push({src:t,tokens:r}),r}inlineTokens(t,r=[]){var c,u,d,g,x;let n=t,o=null;if(this.tokens.links){let y=Object.keys(this.tokens.links);if(y.length>0)for(;(o=this.tokenizer.rules.inline.reflinkSearch.exec(n))!=null;)y.includes(o[0].slice(o[0].lastIndexOf("[")+1,-1))&&(n=n.slice(0,o.index)+"["+"a".repeat(o[0].length-2)+"]"+n.slice(this.tokenizer.rules.inline.reflinkSearch.lastIndex))}for(;(o=this.tokenizer.rules.inline.anyPunctuation.exec(n))!=null;)n=n.slice(0,o.index)+"++"+n.slice(this.tokenizer.rules.inline.anyPunctuation.lastIndex);for(;(o=this.tokenizer.rules.inline.blockSkip.exec(n))!=null;)n=n.slice(0,o.index)+"["+"a".repeat(o[0].length-2)+"]"+n.slice(this.tokenizer.rules.inline.blockSkip.lastIndex);n=((u=(c=this.options.hooks)==null?void 0:c.emStrongMask)==null?void 0:u.call({lexer:this},n))??n;let i=!1,l="";for(;t;){i||(l=""),i=!1;let y;if((g=(d=this.options.extensions)==null?void 0:d.inline)!=null&&g.some(T=>(y=T.call({lexer:this},t,r))?(t=t.substring(y.raw.length),r.push(y),!0):!1))continue;if(y=this.tokenizer.escape(t)){t=t.substring(y.raw.length),r.push(y);continue}if(y=this.tokenizer.tag(t)){t=t.substring(y.raw.length),r.push(y);continue}if(y=this.tokenizer.link(t)){t=t.substring(y.raw.length),r.push(y);continue}if(y=this.tokenizer.reflink(t,this.tokens.links)){t=t.substring(y.raw.length);let T=r.at(-1);y.type==="text"&&(T==null?void 0:T.type)==="text"?(T.raw+=y.raw,T.text+=y.text):r.push(y);continue}if(y=this.tokenizer.emStrong(t,n,l)){t=t.substring(y.raw.length),r.push(y);continue}if(y=this.tokenizer.codespan(t)){t=t.substring(y.raw.length),r.push(y);continue}if(y=this.tokenizer.br(t)){t=t.substring(y.raw.length),r.push(y);continue}if(y=this.tokenizer.del(t)){t=t.substring(y.raw.length),r.push(y);continue}if(y=this.tokenizer.autolink(t)){t=t.substring(y.raw.length),r.push(y);continue}if(!this.state.inLink&&(y=this.tokenizer.url(t))){t=t.substring(y.raw.length),r.push(y);continue}let S=t;if((x=this.options.extensions)!=null&&x.startInline){let T=1/0,I=t.slice(1),b;this.options.extensions.startInline.forEach(h=>{b=h.call({lexer:this},I),typeof b=="number"&&b>=0&&(T=Math.min(T,b))}),T<1/0&&T>=0&&(S=t.substring(0,T+1))}if(y=this.tokenizer.inlineText(S)){t=t.substring(y.raw.length),y.raw.slice(-1)!=="_"&&(l=y.raw.slice(-1)),i=!0;let T=r.at(-1);(T==null?void 0:T.type)==="text"?(T.raw+=y.raw,T.text+=y.text):r.push(y);continue}if(t){let T="Infinite loop on byte: "+t.charCodeAt(0);if(this.options.silent){console.error(T);break}else throw new Error(T)}}return r}},pc=class{constructor(e){Ue(this,"options");Ue(this,"parser");this.options=e||bo}space(e){return""}code({text:e,lang:t,escaped:r}){var i;let n=(i=(t||"").match(br.notSpaceStart))==null?void 0:i[0],o=e.replace(br.endingNewline,"")+`
`;return n?'<pre><code class="language-'+vn(n)+'">'+(r?o:vn(o,!0))+`</code></pre>
`:"<pre><code>"+(r?o:vn(o,!0))+`</code></pre>
`}blockquote({tokens:e}){return`<blockquote>
${this.parser.parse(e)}</blockquote>
`}html({text:e}){return e}def(e){return""}heading({tokens:e,depth:t}){return`<h${t}>${this.parser.parseInline(e)}</h${t}>
`}hr(e){return`<hr>
`}list(e){let t=e.ordered,r=e.start,n="";for(let l=0;l<e.items.length;l++){let c=e.items[l];n+=this.listitem(c)}let o=t?"ol":"ul",i=t&&r!==1?' start="'+r+'"':"";return"<"+o+i+`>
`+n+"</"+o+`>
`}listitem(e){var r;let t="";if(e.task){let n=this.checkbox({checked:!!e.checked});e.loose?((r=e.tokens[0])==null?void 0:r.type)==="paragraph"?(e.tokens[0].text=n+" "+e.tokens[0].text,e.tokens[0].tokens&&e.tokens[0].tokens.length>0&&e.tokens[0].tokens[0].type==="text"&&(e.tokens[0].tokens[0].text=n+" "+vn(e.tokens[0].tokens[0].text),e.tokens[0].tokens[0].escaped=!0)):e.tokens.unshift({type:"text",raw:n+" ",text:n+" ",escaped:!0}):t+=n+" "}return t+=this.parser.parse(e.tokens,!!e.loose),`<li>${t}</li>
`}checkbox({checked:e}){return"<input "+(e?'checked="" ':"")+'disabled="" type="checkbox">'}paragraph({tokens:e}){return`<p>${this.parser.parseInline(e)}</p>
`}table(e){let t="",r="";for(let o=0;o<e.header.length;o++)r+=this.tablecell(e.header[o]);t+=this.tablerow({text:r});let n="";for(let o=0;o<e.rows.length;o++){let i=e.rows[o];r="";for(let l=0;l<i.length;l++)r+=this.tablecell(i[l]);n+=this.tablerow({text:r})}return n&&(n=`<tbody>${n}</tbody>`),`<table>
<thead>
`+t+`</thead>
`+n+`</table>
`}tablerow({text:e}){return`<tr>
${e}</tr>
`}tablecell(e){let t=this.parser.parseInline(e.tokens),r=e.header?"th":"td";return(e.align?`<${r} align="${e.align}">`:`<${r}>`)+t+`</${r}>
`}strong({tokens:e}){return`<strong>${this.parser.parseInline(e)}</strong>`}em({tokens:e}){return`<em>${this.parser.parseInline(e)}</em>`}codespan({text:e}){return`<code>${vn(e,!0)}</code>`}br(e){return"<br>"}del({tokens:e}){return`<del>${this.parser.parseInline(e)}</del>`}link({href:e,title:t,tokens:r}){let n=this.parser.parseInline(r),o=Rg(e);if(o===null)return n;e=o;let i='<a href="'+e+'"';return t&&(i+=' title="'+vn(t)+'"'),i+=">"+n+"</a>",i}image({href:e,title:t,text:r,tokens:n}){n&&(r=this.parser.parseInline(n,this.parser.textRenderer));let o=Rg(e);if(o===null)return vn(r);e=o;let i=`<img src="${e}" alt="${r}"`;return t&&(i+=` title="${vn(t)}"`),i+=">",i}text(e){return"tokens"in e&&e.tokens?this.parser.parseInline(e.tokens):"escaped"in e&&e.escaped?e.text:vn(e.text)}},mh=class{strong({text:e}){return e}em({text:e}){return e}codespan({text:e}){return e}del({text:e}){return e}html({text:e}){return e}text({text:e}){return e}link({text:e}){return""+e}image({text:e}){return""+e}br(){return""}},Fn=class Zd{constructor(t){Ue(this,"options");Ue(this,"renderer");Ue(this,"textRenderer");this.options=t||bo,this.options.renderer=this.options.renderer||new pc,this.renderer=this.options.renderer,this.renderer.options=this.options,this.renderer.parser=this,this.textRenderer=new mh}static parse(t,r){return new Zd(r).parse(t)}static parseInline(t,r){return new Zd(r).parseInline(t)}parse(t,r=!0){var o,i;let n="";for(let l=0;l<t.length;l++){let c=t[l];if((i=(o=this.options.extensions)==null?void 0:o.renderers)!=null&&i[c.type]){let d=c,g=this.options.extensions.renderers[d.type].call({parser:this},d);if(g!==!1||!["space","hr","heading","code","table","blockquote","list","html","def","paragraph","text"].includes(d.type)){n+=g||"";continue}}let u=c;switch(u.type){case"space":{n+=this.renderer.space(u);continue}case"hr":{n+=this.renderer.hr(u);continue}case"heading":{n+=this.renderer.heading(u);continue}case"code":{n+=this.renderer.code(u);continue}case"table":{n+=this.renderer.table(u);continue}case"blockquote":{n+=this.renderer.blockquote(u);continue}case"list":{n+=this.renderer.list(u);continue}case"html":{n+=this.renderer.html(u);continue}case"def":{n+=this.renderer.def(u);continue}case"paragraph":{n+=this.renderer.paragraph(u);continue}case"text":{let d=u,g=this.renderer.text(d);for(;l+1<t.length&&t[l+1].type==="text";)d=t[++l],g+=`
`+this.renderer.text(d);r?n+=this.renderer.paragraph({type:"paragraph",raw:g,text:g,tokens:[{type:"text",raw:g,text:g,escaped:!0}]}):n+=g;continue}default:{let d='Token with "'+u.type+'" type was not found.';if(this.options.silent)return console.error(d),"";throw new Error(d)}}}return n}parseInline(t,r=this.renderer){var o,i;let n="";for(let l=0;l<t.length;l++){let c=t[l];if((i=(o=this.options.extensions)==null?void 0:o.renderers)!=null&&i[c.type]){let d=this.options.extensions.renderers[c.type].call({parser:this},c);if(d!==!1||!["escape","html","link","image","strong","em","codespan","br","del","text"].includes(c.type)){n+=d||"";continue}}let u=c;switch(u.type){case"escape":{n+=r.text(u);break}case"html":{n+=r.html(u);break}case"link":{n+=r.link(u);break}case"image":{n+=r.image(u);break}case"strong":{n+=r.strong(u);break}case"em":{n+=r.em(u);break}case"codespan":{n+=r.codespan(u);break}case"br":{n+=r.br(u);break}case"del":{n+=r.del(u);break}case"text":{n+=r.text(u);break}default:{let d='Token with "'+u.type+'" type was not found.';if(this.options.silent)return console.error(d),"";throw new Error(d)}}}return n}},Sl,ta=(Sl=class{constructor(e){Ue(this,"options");Ue(this,"block");this.options=e||bo}preprocess(e){return e}postprocess(e){return e}processAllTokens(e){return e}emStrongMask(e){return e}provideLexer(){return this.block?$n.lex:$n.lexInline}provideParser(){return this.block?Fn.parse:Fn.parseInline}},Ue(Sl,"passThroughHooks",new Set(["preprocess","postprocess","processAllTokens","emStrongMask"])),Ue(Sl,"passThroughHooksRespectAsync",new Set(["preprocess","postprocess","processAllTokens"])),Sl),kj=class{constructor(...e){Ue(this,"defaults",ih());Ue(this,"options",this.setOptions);Ue(this,"parse",this.parseMarkdown(!0));Ue(this,"parseInline",this.parseMarkdown(!1));Ue(this,"Parser",Fn);Ue(this,"Renderer",pc);Ue(this,"TextRenderer",mh);Ue(this,"Lexer",$n);Ue(this,"Tokenizer",dc);Ue(this,"Hooks",ta);this.use(...e)}walkTokens(e,t){var n,o;let r=[];for(let i of e)switch(r=r.concat(t.call(this,i)),i.type){case"table":{let l=i;for(let c of l.header)r=r.concat(this.walkTokens(c.tokens,t));for(let c of l.rows)for(let u of c)r=r.concat(this.walkTokens(u.tokens,t));break}case"list":{let l=i;r=r.concat(this.walkTokens(l.items,t));break}default:{let l=i;(o=(n=this.defaults.extensions)==null?void 0:n.childTokens)!=null&&o[l.type]?this.defaults.extensions.childTokens[l.type].forEach(c=>{let u=l[c].flat(1/0);r=r.concat(this.walkTokens(u,t))}):l.tokens&&(r=r.concat(this.walkTokens(l.tokens,t)))}}return r}use(...e){let t=this.defaults.extensions||{renderers:{},childTokens:{}};return e.forEach(r=>{let n={...r};if(n.async=this.defaults.async||n.async||!1,r.extensions&&(r.extensions.forEach(o=>{if(!o.name)throw new Error("extension name required");if("renderer"in o){let i=t.renderers[o.name];i?t.renderers[o.name]=function(...l){let c=o.renderer.apply(this,l);return c===!1&&(c=i.apply(this,l)),c}:t.renderers[o.name]=o.renderer}if("tokenizer"in o){if(!o.level||o.level!=="block"&&o.level!=="inline")throw new Error("extension level must be 'block' or 'inline'");let i=t[o.level];i?i.unshift(o.tokenizer):t[o.level]=[o.tokenizer],o.start&&(o.level==="block"?t.startBlock?t.startBlock.push(o.start):t.startBlock=[o.start]:o.level==="inline"&&(t.startInline?t.startInline.push(o.start):t.startInline=[o.start]))}"childTokens"in o&&o.childTokens&&(t.childTokens[o.name]=o.childTokens)}),n.extensions=t),r.renderer){let o=this.defaults.renderer||new pc(this.defaults);for(let i in r.renderer){if(!(i in o))throw new Error(`renderer '${i}' does not exist`);if(["options","parser"].includes(i))continue;let l=i,c=r.renderer[l],u=o[l];o[l]=(...d)=>{let g=c.apply(o,d);return g===!1&&(g=u.apply(o,d)),g||""}}n.renderer=o}if(r.tokenizer){let o=this.defaults.tokenizer||new dc(this.defaults);for(let i in r.tokenizer){if(!(i in o))throw new Error(`tokenizer '${i}' does not exist`);if(["options","rules","lexer"].includes(i))continue;let l=i,c=r.tokenizer[l],u=o[l];o[l]=(...d)=>{let g=c.apply(o,d);return g===!1&&(g=u.apply(o,d)),g}}n.tokenizer=o}if(r.hooks){let o=this.defaults.hooks||new ta;for(let i in r.hooks){if(!(i in o))throw new Error(`hook '${i}' does not exist`);if(["options","block"].includes(i))continue;let l=i,c=r.hooks[l],u=o[l];ta.passThroughHooks.has(i)?o[l]=d=>{if(this.defaults.async&&ta.passThroughHooksRespectAsync.has(i))return Promise.resolve(c.call(o,d)).then(x=>u.call(o,x));let g=c.call(o,d);return u.call(o,g)}:o[l]=(...d)=>{let g=c.apply(o,d);return g===!1&&(g=u.apply(o,d)),g}}n.hooks=o}if(r.walkTokens){let o=this.defaults.walkTokens,i=r.walkTokens;n.walkTokens=function(l){let c=[];return c.push(i.call(this,l)),o&&(c=c.concat(o.call(this,l))),c}}this.defaults={...this.defaults,...n}}),this}setOptions(e){return this.defaults={...this.defaults,...e},this}lexer(e,t){return $n.lex(e,t??this.defaults)}parser(e,t){return Fn.parse(e,t??this.defaults)}parseMarkdown(e){return(t,r)=>{let n={...r},o={...this.defaults,...n},i=this.onError(!!o.silent,!!o.async);if(this.defaults.async===!0&&n.async===!1)return i(new Error("marked(): The async option was set to true by an extension. Remove async: false from the parse options object to return a Promise."));if(typeof t>"u"||t===null)return i(new Error("marked(): input parameter is undefined or null"));if(typeof t!="string")return i(new Error("marked(): input parameter is of type "+Object.prototype.toString.call(t)+", string expected"));o.hooks&&(o.hooks.options=o,o.hooks.block=e);let l=o.hooks?o.hooks.provideLexer():e?$n.lex:$n.lexInline,c=o.hooks?o.hooks.provideParser():e?Fn.parse:Fn.parseInline;if(o.async)return Promise.resolve(o.hooks?o.hooks.preprocess(t):t).then(u=>l(u,o)).then(u=>o.hooks?o.hooks.processAllTokens(u):u).then(u=>o.walkTokens?Promise.all(this.walkTokens(u,o.walkTokens)).then(()=>u):u).then(u=>c(u,o)).then(u=>o.hooks?o.hooks.postprocess(u):u).catch(i);try{o.hooks&&(t=o.hooks.preprocess(t));let u=l(t,o);o.hooks&&(u=o.hooks.processAllTokens(u)),o.walkTokens&&this.walkTokens(u,o.walkTokens);let d=c(u,o);return o.hooks&&(d=o.hooks.postprocess(d)),d}catch(u){return i(u)}}}onError(e,t){return r=>{if(r.message+=`
Please report this to https://github.com/markedjs/marked.`,e){let n="<p>An error occurred:</p><pre>"+vn(r.message+"",!0)+"</pre>";return t?Promise.resolve(n):n}if(t)return Promise.reject(r);throw r}}},fo=new kj;function it(e,t){return fo.parse(e,t)}it.options=it.setOptions=function(e){return fo.setOptions(e),it.defaults=fo.defaults,Ex(it.defaults),it};it.getDefaults=ih;it.defaults=bo;it.use=function(...e){return fo.use(...e),it.defaults=fo.defaults,Ex(it.defaults),it};it.walkTokens=function(e,t){return fo.walkTokens(e,t)};it.parseInline=fo.parseInline;it.Parser=Fn;it.parser=Fn.parse;it.Renderer=pc;it.TextRenderer=mh;it.Lexer=$n;it.lexer=$n.lex;it.Tokenizer=dc;it.Hooks=ta;it.parse=it;it.options;it.setOptions;it.use;it.walkTokens;it.parseInline;Fn.parse;$n.lex;function Sj(){const e=Et(),t=w.useRef(null),r=w.useCallback(u=>{try{const d=it(u,{breaks:!0,gfm:!0});return typeof d=="string"?d:String(d)}catch{return u}},[]),n=w.useCallback(u=>{try{if(/^#|^\*\*|^##|^\*|^-|\*\*.*\*\*|^1\.|```/.test(u)||u.includes("**")||u.includes("##")||u.includes("# ")||u.length>50){const g=it(u,{breaks:!0,gfm:!0});return typeof g=="string"?g:String(g)}else return u.replace(/\n/g,"<br>")}catch{try{const g=it(u,{breaks:!0,gfm:!0});return typeof g=="string"?g:String(g)}catch{return u.replace(/\n/g,"<br>")}}},[]),o=w.useCallback(()=>{setTimeout(()=>{t.current&&(t.current.scrollTop=t.current.scrollHeight)},0)},[]),i=w.useCallback(()=>{const u=`msg_${Date.now()}_${Math.random().toString(36).substr(2,9)}`;e.addMessage("ai","",void 0,{id:u});const d=e.chatMessages,g=d.findIndex(x=>x.id===u);return g>=0?g:d.length-1},[e]),l=w.useCallback((u,d)=>{const g=e.chatMessages;u>=0&&u<g.length&&e.updateMessage(g[u].id,d)},[e]),c=w.useCallback(async(u,d=!1)=>{if(d){const g=e.chatMessages.length;e.addMessage("ai","",void 0);for(let x=0;x<=u.length;x++){const y=e.chatMessages;y[g]&&e.updateMessage(y[g].id,u.substring(0,x)),await new Promise(S=>setTimeout(S,Math.random()*30+10))}}else e.isTyping=!0,await new Promise(g=>setTimeout(g,100+Math.random()*100)),e.isTyping=!1,e.addMessage("ai",u,void 0)},[e]);return{chatContainer:t,renderMarkdown:r,renderUserMessage:n,scrollToBottom:o,startStreamingMessage:i,updateStreamingMessage:l,simulateTyping:c}}function Tj(){const[e,t]=w.useState(""),r=w.useRef(null),[n,o]=w.useState(!1),i=w.useCallback(()=>{},[]),l=w.useCallback(()=>{o(!0)},[]),c=w.useCallback(()=>{o(!1)},[]),u=w.useCallback((g,x)=>{if(g.key==="Enter"){if(g.shiftKey)return;if(n)return;g.preventDefault(),x()}},[n]),d=w.useCallback(()=>{t("");const g=r.current;g&&(g.style.height="80px")},[]);return{userInput:e,setUserInput:t,textareaRef:r,isComposing:n,adjustTextareaHeight:i,handleCompositionStart:l,handleCompositionEnd:c,handleKeydown:u,clearInput:d}}const gt=vo((e,t)=>({notifications:[],confirmDialog:null,addNotification:r=>{const n=Date.now().toString(),o={id:n,...r,duration:r.duration??3e3};return e(i=>({notifications:[...i.notifications,o]})),o.duration&&o.duration>0&&setTimeout(()=>{t().removeNotification(n)},o.duration),n},removeNotification:r=>{e(n=>({notifications:n.notifications.filter(o=>o.id!==r)}))},showConfirmDialog:r=>new Promise(n=>{const o=`confirm-${Date.now()}`;e({confirmDialog:{id:o,...r,resolve:n}})}),closeConfirmDialog:r=>{const n=t().confirmDialog;n&&(n.resolve(r),e({confirmDialog:null}))},success:(r,n)=>t().addNotification({message:r,type:"success",duration:n}),error:(r,n)=>t().addNotification({message:r,type:"error",duration:n}),warning:(r,n)=>t().addNotification({message:r,type:"warning",duration:n}),info:(r,n)=>t().addNotification({message:r,type:"info",duration:n})})),Og=Object.freeze(Object.defineProperty({__proto__:null,useNotificationStore:gt},Symbol.toStringTag,{value:"Module"}));function Cj(){const e=gt(),[t,r]=w.useState([]),[n,o]=w.useState(!1),i=w.useRef(null),l=w.useCallback(()=>{i.current&&i.current.click()},[]),c=w.useCallback(async T=>{const I=Array.from(T.target.files||[]);if(I.length>0){try{const{processFiles:b}=await zt(async()=>{const{processFiles:v}=await import("./fileUtils-CvcPFew1.js");return{processFiles:v}},[]),h=await b(I);h.attachments.length>0&&r(v=>[...v,...h.attachments]),h.errors.length>0&&h.errors.forEach(v=>e.error(v))}catch{e.error("")}T.target.value=""}},[e]),u=w.useCallback(T=>{r(I=>I.filter(b=>b.id!==T))},[]),d=w.useCallback(()=>{r([])},[]),g=w.useCallback(T=>{var I;if(T.preventDefault(),(I=T.dataTransfer)!=null&&I.items){for(let b=0;b<T.dataTransfer.items.length;b++)if(T.dataTransfer.items[b].kind==="file"){o(!0);break}}},[]),x=w.useCallback(T=>{T.preventDefault(),o(!0)},[]),y=w.useCallback(T=>{T.preventDefault();const b=T.currentTarget.getBoundingClientRect(),h=T.clientX,v=T.clientY;(h<b.left||h>b.right||v<b.top||v>b.bottom)&&o(!1)},[]),S=w.useCallback(async T=>{var b;T.preventDefault(),o(!1);const I=Array.from(((b=T.dataTransfer)==null?void 0:b.files)||[]);if(I.length>0)try{const{processFiles:h}=await zt(async()=>{const{processFiles:C}=await import("./fileUtils-CvcPFew1.js");return{processFiles:C}},[]),v=await h(I);v.attachments.length>0&&r(C=>[...C,...v.attachments]),v.errors.length>0&&v.errors.forEach(C=>e.error(C))}catch{e.error("")}},[e]);return{currentAttachments:t,isGlobalDragging:n,fileInputRef:i,triggerFileSelect:l,handleFileSelect:c,removeAttachment:u,clearAttachments:d,handleGlobalDragEnter:g,handleGlobalDragOver:x,handleGlobalDragLeave:y,handleGlobalDrop:S}}function Pj(){const[e,t]=w.useState(!0),r=Be(b=>b.providers),n=Be(b=>b.isInitialized),o=Be(b=>b.selectedProviderId),i=Be(b=>b.selectedModelId),l=Be(b=>b.getProviderById),c=Be(b=>b.getAvailableModelsByProvider),u=Be(b=>b.setSelectedProvider),d=Be(b=>b.setSelectedModel),g=w.useMemo(()=>!o||!n?null:l(o)||null,[o,n,l,r]),x=w.useMemo(()=>!g||!i?null:g.models.find(b=>b.id===i)||null,[g,i]);w.useEffect(()=>{if(n&&r.length>0){const b=r.filter(h=>h.apiKey);if(b.length>0&&!o){const h=b[0];console.log("[useChatModel] :",h.name),u(h.id),h.models.length>0&&(console.log("[useChatModel] :",h.models[0].name),d(h.models[0].id))}else if(o&&!g){const h=b[0];h&&(console.log("[useChatModel] :",h.name),u(h.id),h.models.length>0&&d(h.models[0].id))}else if(g&&!x&&i){const h=c(g.id);h.length>0&&(console.log("[useChatModel] :",h[0].name),d(h[0].id))}}},[n,r.length,o,i,g,x]);const y=()=>{const b=o&&n?l(o):null,h=b&&i&&b.models.find(v=>v.id===i)||null;return console.log("[useChatModel] getCurrentChatModel :",{isInitialized:n,providersCount:r.length,selectedProviderId:o,selectedModelId:i,currentProvider:(b==null?void 0:b.name)||"null",currentModel:(h==null?void 0:h.name)||"null",hasProvider:!!b,hasModel:!!h}),{provider:b,model:h}},S=w.useCallback(()=>{const{provider:b,model:h}=y();return!b||!h?"":`${b.name} - ${h.name}`},[y]),T=w.useCallback(()=>{t(b=>{const h=!b;return localStorage.setItem("yprompt_stream_mode",JSON.stringify(h)),h})},[]),I=w.useCallback(()=>{const b=localStorage.getItem("yprompt_stream_mode");if(b!==null)try{t(JSON.parse(b))}catch{t(!0)}},[]);return w.useEffect(()=>{I()},[I]),{isStreamMode:e,getCurrentChatModel:y,getChatModelDisplay:S,toggleStreamMode:T,loadSettings:I}}function jj(e){const t=Et(),[r,n]=w.useState(!1),o=w.useRef(null),i=w.useMemo(()=>{const g=t.chatMessages.length,x=[""];if(g>=6){const S=!!t.promptData.requirementReport?"":"";return[...x,S]}return x},[t.chatMessages.length,t.promptData.requirementReport]),l=w.useMemo(()=>t.chatMessages.length>=2&&r,[t.chatMessages.length,r]),c=w.useCallback(g=>["",""].some(y=>g.includes(y)),[]),u=w.useCallback((g,x)=>{x(g),n(!1)},[]),d=w.useCallback(g=>{var y,S;const x=g.target;(y=e.current)!=null&&y.contains(x)||(S=o.current)!=null&&S.contains(x)||n(!1)},[e]);return w.useEffect(()=>(setTimeout(()=>{document.addEventListener("mousedown",d)},100),()=>{document.removeEventListener("mousedown",d)}),[d]),{showQuickReplies:r,setShowQuickReplies:n,quickReplies:i,quickRepliesContainerRef:o,shouldShowQuickReplies:l,checkForceGenerate:c,selectQuickReply:u}}class fh{constructor(t,r){Ue(this,"config");Ue(this,"modelId");this.config=t,this.modelId=r}async fetchWithTimeout(t,r,n=3e5,o){const i=o??new AbortController,l=setTimeout(()=>i.abort(),n);try{return await fetch(t,{...r,signal:i.signal})}finally{clearTimeout(l)}}}class Nj{static convertAttachments(t){return t.map(r=>r.type==="image"&&["image/png","image/jpeg","image/jpg","image/webp","image/gif"].includes(r.mimeType)?{type:"image_url",image_url:{url:`data:${r.mimeType};base64,${r.data}`}}:null).filter(r=>r!==null)}static isSupported(t){return t.type!=="image"?!1:["image/png","image/jpeg","image/jpg","image/webp","image/gif"].includes(t.mimeType)}static getSupportedTypes(){return["image/png","image/jpeg","image/jpg","image/webp","image/gif"]}}class Bx{constructor(){Ue(this,"buffer","");Ue(this,"inThinkTag",!1);Ue(this,"thinkTagContent","")}reset(){this.buffer="",this.inThinkTag=!1,this.thinkTagContent=""}filterChunk(t){this.buffer+=t;let r="";for(;this.buffer.length>0;)if(this.inThinkTag){const n=this.buffer.indexOf("</think>");if(n===-1){this.buffer.length>8&&(this.thinkTagContent+=this.buffer.slice(0,-8),this.buffer=this.buffer.slice(-8));break}else this.thinkTagContent+=this.buffer.slice(0,n),this.buffer=this.buffer.slice(n+8),this.inThinkTag=!1,this.thinkTagContent=""}else{const n=this.buffer.indexOf("<think>");if(n===-1){this.buffer.length>7&&(r+=this.buffer.slice(0,-7),this.buffer=this.buffer.slice(-7));break}else r+=this.buffer.slice(0,n),this.buffer=this.buffer.slice(n+7),this.inThinkTag=!0,this.thinkTagContent=""}return r}finalize(){const t=this.buffer;return this.reset(),t}static removeThinkTags(t){return t.replace(/<think>[\s\S]*?<\/think>/g,"")}}class vs{static cleanResponse(t){try{let r=t.replace(/<ASSESSMENT>[\s\S]*?<\/ASSESSMENT>/gi,"").trim();const n=r.indexOf("<ASSESSMENT>");if(n!==-1&&(r=r.substring(0,n).trim()),r.includes("ASSESSMENT")||r.includes("CONTEXT:")||r.includes("DECISION:")){const i=[/<ASSE[^>]*$/i,/<\/ASSE[^>]*$/i,/\n\n<ASSE/i,/\nCONTEXT:/i,/\nTASK:/i,/\nFORMAT:/i,/\nQUALITY:/i,/\nTURN_COUNT:/i,/\nDECISION:/i,/\nCONFIDENCE:/i];for(const l of i){const c=r.search(l);if(c!==-1){r=r.substring(0,c).trim();break}}}return r}catch{return t}}static cleanThinkTags(t){return t&&Bx.removeThinkTags(t)}}class Dg extends fh{async callAPI(t,r,n,o){var g,x,y,S,T,I;if(!this.config.baseUrl)throw new Error("API URL ");let i=this.config.baseUrl.trim();i.includes("/chat/completions")||(i.includes("/v1")?i=i.replace(/\/+$/,"")+"/chat/completions":i=i.replace(/\/+$/,"")+"/v1/chat/completions");const l=this.modelId,u=l.includes("gpt-5")||l.includes("o1")||l.includes("thinking")?6e5:3e5,d=await this.fetchWithTimeout(i,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${this.config.apiKey}`},body:JSON.stringify({model:l,messages:t.map(b=>{var h;if(this.hasMultimodalContent(b)){const v=this.convertToMultimodalContent(b);return{role:b.role,content:v}}else return{role:b.role,content:typeof b.content=="string"?b.content:((h=b.content[0])==null?void 0:h.text)||""}}),temperature:(n==null?void 0:n.temperature)??1,max_tokens:(n==null?void 0:n.maxTokens)??8192,top_p:(n==null?void 0:n.topP)??.95,...(n==null?void 0:n.frequencyPenalty)!==void 0&&{frequency_penalty:n.frequencyPenalty},...(n==null?void 0:n.presencePenalty)!==void 0&&{presence_penalty:n.presencePenalty},...r&&{stream:!0}})},u,o);if(!d.ok){const b=await d.json().catch(()=>({})),h=new Error(`OpenAI API error: ${d.status} ${d.statusText}`);throw h.error=b,h.status=d.status,h}if(r)return d.body;{const b=await d.json();let h;if(b.choices&&((x=(g=b.choices[0])==null?void 0:g.message)!=null&&x.content))h=b.choices[0].message.content;else if(b.candidates&&((S=(y=b.candidates[0])==null?void 0:y.content)!=null&&S.parts)){const v=b.candidates[0].content.parts;for(const C of v)if(C.text&&!C.thought){h=C.text;break}}else b.content&&typeof b.content=="string"?h=b.content:b.text&&typeof b.text=="string"&&(h=b.text);if(!h||h.trim()==="")throw new Error("API");return h=vs.cleanResponse(h),h=vs.cleanThinkTags(h),{content:h,finishReason:(I=(T=b.choices)==null?void 0:T[0])==null?void 0:I.finish_reason}}}parseStreamChunk(t){var r,n,o,i,l,c,u,d,g;if(!t.trim()||t.trim()==="[DONE]")return{content:"",done:!0};if(t===": OPENROUTER PROCESSING"||t.startsWith(": ")&&t.toUpperCase().includes("PROCESSING"))return null;try{const x=JSON.parse(t);let y;if((o=(n=(r=x.choices)==null?void 0:r[0])==null?void 0:n.delta)!=null&&o.content)y=x.choices[0].delta.content;else if((c=(l=(i=x.candidates)==null?void 0:i[0])==null?void 0:l.content)!=null&&c.parts){const I=x.candidates[0].content.parts;for(const b of I)if(b.text&&!b.thought){y=b.text;break}}else(u=x.delta)!=null&&u.text?y=x.delta.text:x.text&&(y=x.text);const T=!!(((g=(d=x.choices)==null?void 0:d[0])==null?void 0:g.finish_reason)||x.done);return{content:y||"",done:T}}catch{return null}}hasMultimodalContent(t){return!!(t.attachments&&t.attachments.length>0)}convertToMultimodalContent(t){const r=[];if(typeof t.content=="string"&&t.content.trim()&&r.push({type:"text",text:t.content}),t.attachments&&t.attachments.length>0){const n=Nj.convertAttachments(t.attachments);r.push(...n)}return r}}class Ij{static convertAttachments(t){return t.map(r=>r.type==="image"?{type:"image",source:{type:"base64",media_type:r.mimeType,data:r.data}}:r.type==="document"&&["application/pdf","text/plain","text/markdown","application/json","text/html","text/csv"].includes(r.mimeType)?{type:"image",source:{type:"base64",media_type:r.mimeType,data:r.data}}:null).filter(r=>r!==null)}static isSupported(t){return t.type==="image"?!0:t.type==="document"?["application/pdf","text/plain","text/markdown","application/json","text/html","text/csv"].includes(t.mimeType):!1}static getSupportedTypes(){return["image/png","image/jpeg","image/jpg","image/webp","image/gif","application/pdf","text/plain","text/markdown","application/json","text/html","text/csv"]}}class Aj extends fh{async callAPI(t,r,n,o){var y;const i=this.extractSystemMessageText(t),l=t.filter(S=>S.role!=="system");if(!this.config.baseUrl)throw new Error("API URL ");let c=this.config.baseUrl.trim();c.includes("/v1/messages")||(c=c.replace(/\/+$/,"")+"/v1/messages");const u=this.modelId,g=u.includes("claude-3")||u.includes("thinking")||u.includes("sonnet")?6e5:3e5,x=await this.fetchWithTimeout(c,{method:"POST",headers:{"Content-Type":"application/json","x-api-key":this.config.apiKey,"anthropic-version":"2023-06-01","anthropic-dangerous-direct-browser-access":"true"},body:JSON.stringify({model:u,max_tokens:(n==null?void 0:n.maxTokens)??8192,temperature:(n==null?void 0:n.temperature)??1,top_p:(n==null?void 0:n.topP)??.95,...(n==null?void 0:n.topK)!==void 0&&n.topK>0&&{top_k:n.topK},system:i,messages:l.map(S=>{var T;return{role:S.role==="assistant"?"assistant":"user",content:this.hasMultimodalContent(S)?this.convertToMultimodalContent(S):typeof S.content=="string"?S.content:Array.isArray(S.content)?((T=S.content[0])==null?void 0:T.text)||"":String(S.content)}}),...r&&{stream:!0}})},g,o);if(!x.ok){const S=await x.json().catch(()=>({})),T=new Error(`Anthropic API error: ${x.status} ${x.statusText}`);throw T.error=S,T.status=x.status,T}if(r)return x.body;{const S=await x.json(),T=(y=S.content[0])==null?void 0:y.text;if(!T||T.trim()==="")throw new Error("API");return{content:vs.cleanThinkTags(T),finishReason:S.stop_reason}}}parseStreamChunk(t){var r;if(!t.trim())return null;try{const n=JSON.parse(t);if(n.type==="content_block_delta"){const o=(r=n.delta)==null?void 0:r.text;if(o)return{content:o,done:!1}}else if(n.type==="message_stop")return{content:"",done:!0};return null}catch{return null}}extractSystemMessageText(t){const r=t.find(n=>n.role==="system");return r?typeof r.content=="string"?r.content:Array.isArray(r.content)?r.content.map(n=>n.text||"").join(" "):"":""}hasMultimodalContent(t){return!!(t.attachments&&t.attachments.length>0)}convertToMultimodalContent(t){const r=[];if(typeof t.content=="string"&&t.content.trim()&&r.push({type:"text",text:t.content}),t.attachments&&t.attachments.length>0){const n=Ij.convertAttachments(t.attachments);r.push(...n)}return r}}class $g{static convertAttachments(t){return t.map(r=>r.type==="image"?{inline_data:{mime_type:r.mimeType,data:r.data}}:r.type==="document"?["text/plain","text/html","text/css","text/javascript","application/json","text/markdown","application/pdf","text/csv","text/xml","application/xml","application/vnd.openxmlformats-officedocument.wordprocessingml.document","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet","application/vnd.openxmlformats-officedocument.presentationml.presentation","application/msword","application/vnd.ms-excel","application/vnd.ms-powerpoint","application/rtf"].includes(r.mimeType)?{inline_data:{mime_type:r.mimeType,data:r.data}}:null:r.type==="audio"?["audio/wav","audio/mp3","audio/mpeg","audio/aac","audio/ogg","audio/flac"].includes(r.mimeType)?{inline_data:{mime_type:r.mimeType,data:r.data}}:null:r.type==="video"&&["video/mp4","video/mpeg","video/mov","video/avi","video/x-flv","video/mpg","video/webm","video/wmv"].includes(r.mimeType)?{inline_data:{mime_type:r.mimeType,data:r.data}}:null).filter(Boolean)}static isSupported(t){return t.type==="image"?!0:t.type==="document"?["text/plain","text/html","text/css","text/javascript","application/json","text/markdown","application/pdf","text/csv","text/xml","application/xml","application/vnd.openxmlformats-officedocument.wordprocessingml.document","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet","application/vnd.openxmlformats-officedocument.presentationml.presentation","application/msword","application/vnd.ms-excel","application/vnd.ms-powerpoint","application/rtf"].includes(t.mimeType):t.type==="audio"?["audio/wav","audio/mp3","audio/mpeg","audio/aac","audio/ogg","audio/flac"].includes(t.mimeType):t.type==="video"?["video/mp4","video/mpeg","video/mov","video/avi","video/x-flv","video/mpg","video/webm","video/wmv"].includes(t.mimeType):!1}static getSupportedTypes(){return["image/png","image/jpeg","image/jpg","image/webp","image/gif","image/bmp","image/tiff","image/svg+xml","image/heic","text/plain","text/html","text/css","text/javascript","application/json","text/markdown","application/pdf","text/csv","text/xml","application/xml","application/vnd.openxmlformats-officedocument.wordprocessingml.document","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet","application/vnd.openxmlformats-officedocument.presentationml.presentation","application/msword","application/vnd.ms-excel","application/vnd.ms-powerpoint","application/rtf","audio/wav","audio/mp3","audio/mpeg","audio/aac","audio/ogg","audio/flac","video/mp4","video/mpeg","video/mov","video/avi","video/x-flv","video/mpg","video/webm","video/wmv"]}}class Ej extends fh{async callAPI(t,r,n,o){var S,T;const i=this.extractSystemMessageText(t),u={contents:t.filter(I=>I.role!=="system").map(I=>{var h;const b=I.role==="assistant"?"model":"user";if(this.hasMultimodalContent(I)){const v=this.convertToMultimodalContent(I);return{role:b,parts:v}}else{const v=typeof I.content=="string"?I.content:((h=I.content[0])==null?void 0:h.text)||"";return{role:b,parts:[{text:v}]}}}),generationConfig:{temperature:(n==null?void 0:n.temperature)??1,maxOutputTokens:(n==null?void 0:n.maxTokens)??8192,topP:(n==null?void 0:n.topP)??.95,...(n==null?void 0:n.topK)!==void 0&&n.topK>0&&{topK:n.topK}}};if(i&&(u.system_instruction={parts:[{text:i}]}),!this.config.baseUrl)throw new Error("API URL ");let d=this.config.baseUrl.trim();d.endsWith("/v1beta")||(d.includes("/models/")&&(d=d.split("/models/")[0]),d.endsWith("/v1beta")||(d=d.replace(/\/+$/,"")+"/v1beta"));const g=this.modelId;if(r){d=`${d}/models/${g}:streamGenerateContent`;const I=new URL(d);I.searchParams.set("alt","sse"),d=I.toString()}else d=`${d}/models/${g}:generateContent`;const y=await this.fetchWithTimeout(d,{method:"POST",headers:{"Content-Type":"application/json","x-goog-api-key":this.config.apiKey},body:JSON.stringify(u)},3e5,o);if(!y.ok){const I=await y.json().catch(()=>({})),b=new Error(`Google Gemini API error: ${y.status} ${y.statusText}`);throw b.error=I,b.status=y.status,b}if(r)return y.body;{const b=(S=(await y.json()).candidates)==null?void 0:S[0];if(!((T=b==null?void 0:b.content)!=null&&T.parts))throw new Error("API");let h="";for(const C of b.content.parts)if(C.text&&!C.thought){h=C.text;break}if(!h||h.trim()==="")throw new Error("API");return{content:vs.cleanThinkTags(h),finishReason:b.finishReason}}}parseStreamChunk(t){var r,n;try{const i=(r=JSON.parse(t).candidates)==null?void 0:r[0];if((n=i==null?void 0:i.content)!=null&&n.parts){for(const l of i.content.parts)if(l.text&&!l.thought)return{content:l.text,done:!1}}return i!=null&&i.finishReason?{content:"",done:!0}:null}catch{return null}}extractSystemMessageText(t){const r=t.find(n=>n.role==="system");return r?typeof r.content=="string"?r.content:Array.isArray(r.content)?r.content.map(n=>n.text||"").join(" "):"":""}hasMultimodalContent(t){return!!(t.attachments&&t.attachments.length>0)}convertToMultimodalContent(t){const r=[];if(typeof t.content=="string"&&t.content.trim()&&r.push({text:t.content}),t.attachments&&t.attachments.length>0){const n=$g.convertAttachments(t.attachments);r.push(...n);const o=t.attachments.length;if(n.length<o){const l=t.attachments.filter(c=>!$g.isSupported(c));if(l.length>0){const u=`[: ${l.map(d=>`${d.name} (${d.type}, ${(d.size/1024).toFixed(1)}KB)`).join(", ")}]`;r.push({text:u})}}}return r}}class Mj{isValidSSELine(t){if(!t||typeof t!="string")return!1;const r=t.trim();if(!r.startsWith("data: "))return!1;const n=r.slice(6).trim();return!n||n==="[DONE]"?!0:!(n===": OPENROUTER PROCESSING"||n.startsWith(": ")&&n.toUpperCase().includes("PROCESSING"))}parseDataFromLine(t){if(!this.isValidSSELine(t))return null;const r=t.slice(6).trim();return!r||r==="[DONE]"?null:r}}class _j{constructor(){Ue(this,"sseParser");Ue(this,"streamFilter");this.sseParser=new Mj,this.streamFilter=new Bx}reset(){this.streamFilter.reset()}async*processStream(t,r){const n=t.getReader(),o=new TextDecoder;try{for(;;){const{done:i,value:l}=await n.read();if(i){const d=this.streamFilter.finalize();d&&(yield d);break}const u=o.decode(l,{stream:!0}).split(`
`);for(const d of u){const g=this.sseParser.parseDataFromLine(d);if(!g)continue;const x=r(g);if(!x||!x.content)continue;const y=this.streamFilter.filterChunk(x.content);if(y&&(yield y),x.done){const S=this.streamFilter.finalize();S&&(yield S);return}}}}finally{n.releaseLock()}}}class Rj{parseAPIError(t,r){try{let n="",o="";t.message&&typeof t.message=="string"?n=t.message:t.error&&t.error.message?(n=t.error.message,o=t.error.code||t.error.type||""):typeof t=="string"?n=t:n=JSON.stringify(t);const i=/Unsupported MIME type: ([^(]+)/i,l=n.match(i);return l?this.parseMimeTypeError(l[1].trim(),r):this.isAttachmentError(n)?"GPT-4 VisionClaude 3.5+Gemini":this.isModelError(n)?"API":this.isAuthError(n,o)?"APIAPI":this.isRateLimitError(n,o)?"APIAPI":this.isNetworkError(n)?"":`API${n}`}catch{return"API"}}parseMimeTypeError(t,r){const n=this.getFileTypeHint(t),o=this.getModelSuggestion(r);return`${n}

${o}`}getFileTypeHint(t){return t.startsWith("application/vnd.openxmlformats-officedocument")?t.includes("wordprocessingml")?"Word(.docx)":t.includes("spreadsheetml")?"Excel(.xlsx)":t.includes("presentationml")?"PowerPoint(.pptx)":"Office":t.startsWith("application/msword")?"Word(.doc)":t.startsWith("application/vnd.ms-excel")?"Excel(.xls)":t.startsWith("application/vnd.ms-powerpoint")?"PowerPoint(.ppt)":t.startsWith("application/pdf")?"PDF":t.startsWith("text/")?"":t.startsWith("image/")?"":t.startsWith("audio/")?"":t.startsWith("video/")?"":""}getModelSuggestion(t){switch(t){case"openai":return"OpenAIGemini";case"anthropic":return"ClaudePDFGemini";case"google":return"GeminiPDFOffice";default:return""}}isAttachmentError(t){const r=t.toLowerCase();return r.includes("multimodal")||r.includes("attachment")||r.includes("file")||r.includes("image")}isModelError(t){const r=t.toLowerCase();return r.includes("model")&&(r.includes("not found")||r.includes("invalid"))}isAuthError(t,r){const n=t.toLowerCase();return n.includes("api key")||n.includes("unauthorized")||n.includes("authentication")||r==="401"}isRateLimitError(t,r){const n=t.toLowerCase();return n.includes("quota")||n.includes("limit")||n.includes("rate")||r==="429"}isNetworkError(t){const r=t.toLowerCase();return r.includes("network")||r.includes("timeout")||r.includes("connection")}}class qx{static parseError(t,r){return this.errorParser.parseAPIError(t,r)}static handleNetworkError(t){return t.name==="AbortError"?"":t.name==="TimeoutError"?"":""}static isRetriableError(t){var o,i;const r=((o=t==null?void 0:t.message)==null?void 0:o.toLowerCase())||"",n=((i=t==null?void 0:t.error)==null?void 0:i.code)||(t==null?void 0:t.code)||"";return!!(r.includes("network")||r.includes("timeout")||r.includes("connection")||n==="429"||r.includes("rate limit")||n>="500"&&n<"600")}}Ue(qx,"errorParser",new Rj);class zj{static async fetchWithTimeout(t,r,n=3e4){const o=new AbortController,i=setTimeout(()=>o.abort(),n);try{return await fetch(t,{...r,signal:o.signal})}finally{clearTimeout(i)}}static async getModels(t,r){switch(r||t.type){case"openai":return await this.getOpenAIModels(t);case"anthropic":return await this.getAnthropicModels();case"google":return await this.getGeminiModels(t);case"custom":return await this.getCustomProviderModels(t,r);default:return await this.getOpenAIModels(t)}}static async getOpenAIModels(t){if(!t.baseUrl)throw new Error("API URL ");const r=this.buildOpenAIModelsUrl(t.baseUrl),n=await this.fetchWithTimeout(r,{method:"GET",headers:{Authorization:`Bearer ${t.apiKey}`,"Content-Type":"application/json"}});if(!n.ok)throw new Error(`OpenAI Models API error: ${n.status} ${n.statusText}`);const o=await n.json();if(o.data&&Array.isArray(o.data))return o.data.map(i=>i.id).filter(i=>i&&typeof i=="string").sort();throw new Error("OpenAI API")}static async getGeminiModels(t){if(!t.baseUrl)throw new Error("API URL ");const r=this.buildGeminiModelsUrl(t.baseUrl),n=new URL(r);n.searchParams.set("key",t.apiKey);const o=await this.fetchWithTimeout(n.toString(),{method:"GET",headers:{"Content-Type":"application/json"}});if(!o.ok)throw new Error(`Gemini Models API error: ${o.status} ${o.statusText}`);const i=await o.json();if(i.models&&Array.isArray(i.models))return i.models.map(l=>l.name&&typeof l.name=="string"?l.name.replace(/^models\//,""):l.id||l.name).filter(l=>l&&typeof l=="string").sort();throw new Error("Gemini API")}static async getAnthropicModels(){return["claude-3-5-sonnet-20241022","claude-3-5-haiku-20241022","claude-3-opus-20240229","claude-3-sonnet-20240229","claude-3-haiku-20240307"].sort()}static async getCustomProviderModels(t,r){var o;if(r)switch(r){case"openai":return await this.getOpenAIModels(t);case"anthropic":return await this.getAnthropicModels();case"google":return await this.getGeminiModels(t)}const n=((o=t.baseUrl)==null?void 0:o.toLowerCase())||"";if(n.includes("googleapis.com")||n.includes("generativelanguage")||n.includes("/v1beta")||n.includes("gemini"))return await this.getGeminiModels(t);if(n.includes("anthropic.com")||n.includes("claude"))return await this.getAnthropicModels();try{return await this.getOpenAIModels(t)}catch{try{return await this.getGeminiModels(t)}catch{return await this.getGenericModels(t)}}}static async getGenericModels(t){if(!t.baseUrl)throw new Error("API URL ");let r=t.baseUrl.trim();r.includes("/models")||(r.includes("/v1")?r=r.replace(/\/+$/,"")+"/models":r=r.replace(/\/+$/,"")+"/v1/models");const n=await this.fetchWithTimeout(r,{method:"GET",headers:{Authorization:`Bearer ${t.apiKey}`,"Content-Type":"application/json"}});if(!n.ok)throw new Error(`Models API error: ${n.status} ${n.statusText}`);const o=await n.json();let i=[];if(o.data&&Array.isArray(o.data)?i=o.data.map(l=>l.id).filter(l=>l&&typeof l=="string"):o.models&&Array.isArray(o.models)?i=o.models.map(l=>l.name&&typeof l.name=="string"?l.name.replace(/^models\//,""):l.id||l.name).filter(l=>l&&typeof l=="string"):Array.isArray(o)&&(i=o.map(l=>typeof l=="string"?l:l.id?l.id:l.name?l.name.replace(/^models\//,""):null).filter(l=>l&&typeof l=="string")),i.length>0)return i.sort();throw new Error("")}static buildOpenAIModelsUrl(t){if(!t)throw new Error("API URL ");let r=t.trim();return r.endsWith("/models")||r.includes("/models?")||r.includes("/models/")?r:r.includes("/v1")?r.replace(/\/+$/,"")+"/models":r.replace(/\/+$/,"")+"/v1/models"}static buildGeminiModelsUrl(t){if(!t)throw new Error("API URL ");let r=t.trim();return r.includes("/models")?r:r.includes("/v1beta")?r.replace(/\/+$/,"")+"/models":r.replace(/\/+$/,"")+"/v1beta/models"}}const eo=class eo{constructor(){Ue(this,"providers",new Map);Ue(this,"streamProcessor");Ue(this,"onStreamUpdate");Ue(this,"abortController");this.streamProcessor=new _j}static getInstance(){return eo.instance||(eo.instance=new eo),eo.instance}getProvider(t,r){const n=`${t.type}-${t.baseUrl}-${r}`;if(this.providers.has(n))return this.providers.get(n);const o=t.models.find(c=>c.id===r),i=(o==null?void 0:o.apiType)||t.type;let l;switch(i){case"openai":l=new Dg(t,r);break;case"anthropic":l=new Aj(t,r);break;case"google":l=new Ej(t,r);break;default:l=new Dg(t,r)}return this.providers.set(n,l),l}convertMessagesToAI(t){return t.map(r=>"role"in r?{role:r.role,content:r.content,attachments:r.attachments}:{role:r.type==="ai"?"assistant":"user",content:r.content,attachments:r.attachments})}async callAI(t,r,n,o=!1,i){const l=r.models.find(x=>x.id===n),c=(l==null?void 0:l.apiType)||r.type,u=new AbortController;this.abortController=u;const d=l==null?void 0:l.params,g=d?{temperature:d.temperature,maxTokens:d.maxTokens,topP:d.topP,frequencyPenalty:d.frequencyPenalty,presencePenalty:d.presencePenalty,topK:d.topK}:void 0;try{const x=this.convertMessagesToAI(t),y=this.getProvider(r,n);if(o)return await this.callWithStream(y,x,g,i,u);{const S=await y.callAPI(x,!1,g,u);if(typeof S!="object"||!("content"in S))throw new Error("Expected AIResponse object");let T=S.content;return T=vs.cleanResponse(T),T=vs.cleanThinkTags(T),T}}catch(x){if((x==null?void 0:x.name)==="AbortError")throw x;const y=qx.parseError(x,c);throw new Error(y)}finally{this.abortController===u&&(this.abortController=void 0)}}async callWithStream(t,r,n,o,i){const l=o||this.onStreamUpdate,c=!!this.onStreamUpdate;try{const u=await t.callAPI(r,!0,n,i);if(typeof u=="string"||!("getReader"in u))throw new Error("Expected ReadableStream for streaming");let d="";this.streamProcessor.reset();const g=t.parseStreamChunk.bind(t);for await(const y of this.streamProcessor.processStream(u,g))d+=y,l&&l(y);if(!d||d.trim()==="")throw new Error("API");let x=vs.cleanResponse(d);return x=vs.cleanThinkTags(x),x}finally{c&&this.clearStreamUpdateCallback()}}setStreamUpdateCallback(t){this.onStreamUpdate=t}clearStreamUpdateCallback(){this.onStreamUpdate=void 0}abortCurrentRequest(){this.abortController&&(this.abortController.abort(),this.abortController=void 0),this.clearStreamUpdateCallback()}async getAvailableModels(t,r){return await zj.getModels(t,r)}async testConnection(t,r){try{const n=[{type:"user",content:"test",timestamp:new Date().toISOString()}];return await this.callAI(n,t,r,!1),!0}catch{return!1}}};Ue(eo,"instance");let Yt=eo;const to=class to{constructor(){Ue(this,"aiService");this.aiService=Yt.getInstance()}getStreamMode(){try{const t=localStorage.getItem("yprompt_stream_mode");return t?JSON.parse(t):!0}catch{return!0}}static getInstance(){return to.instance||(to.instance=new to),to.instance}interruptCurrentRequest(){this.aiService.abortCurrentRequest()}async generateSimpleResponse(t,r,n,o,i=!1){const l=this.buildSimpleConversationMessages(t,r),c=await this.aiService.callAI(l,n,o,i);if(!c||c.trim()==="")throw new Error("AI API");return c}buildSimpleConversationMessages(t,r){const n={role:"system",content:kt.getUserGuidedPromptRules()},o=r.map(l=>({role:l.type==="user"?"user":"assistant",content:l.content,attachments:l.attachments||[]})),i=[n,...o];return t.trim()&&i.push({role:"user",content:t}),i}getStepInfo(t){const r=[{id:"taskDefinition",title:"",description:"AI",focus:"AI"},{id:"context",title:"",description:"AI",focus:""},{id:"outputFormat",title:"",description:"AI",focus:"AI"},{id:"qualityCriteria",title:"",description:"",focus:""},{id:"executionParams",title:"",description:"AI",focus:"AI"},{id:"optimization",title:"",description:"",focus:""}];return r.find(n=>n.id===t)||r[0]}async getInitialQuestion(t,r,n,o=!1){if(!r||!n)throw new Error("AI");return await this.generateInitialQuestionWithAI(t,r,n,o)}async generateInitialQuestionWithAI(t,r,n,o=!1){const i=this.getStepInfo(t),l={role:"system",content:kt.getUserGuidedPromptRules()},c={role:"user",content:`"${i.title}"${i.description}`};return await this.aiService.callAI([l,c],r,n,o)}async generateRequirementReportFromConversation(t,r,n,o){if(!r||!n)throw new Error("AI");return await this.generateReportFromConversationWithAI(t,r,n,o)}async generateReportFromConversationWithAI(t,r,n,o){const i={role:"system",content:kt.getRequirementReportRules()},c={role:"user",content:`

****
${t.map(g=>{let x=`${g.type==="user"?"User":"AI"}: ${g.content}`;if(g.attachments&&g.attachments.length>0){const y=g.attachments.map(S=>`[: ${S.name} (${S.type}, ${S.size} bytes)]`).join(", ");x+=`
: ${y}`}return x}).join(`

`)}

5`},u=this.getStreamMode();o&&u&&this.aiService.setStreamUpdateCallback(g=>{o(g)});const d=await this.aiService.callAI([i,c],r,n,u);return o&&u&&this.aiService.clearStreamUpdateCallback(),d}};Ue(to,"instance");let hc=to;const ro=class ro{constructor(){Ue(this,"aiService");this.aiService=Yt.getInstance()}static getInstance(){return ro.instance||(ro.instance=new ro),ro.instance}formatVariablesForPrompt(t){if(!t||t.length===0||t.every(n=>n.trim()===""))return"";const r=t.filter(n=>n.trim()!=="");return r.length===0?"":`
---
Variable Integration:
The final prompt must be designed to be used in a programmatic context. As such, it needs to include specific placeholders or variables. You must incorporate the following variables into the generated prompt where it makes logical sense to do so.

Variable List:
${r.map(n=>`- \`${n}\``).join(`
`)}

For example, if a variable is \`{{user_topic}}\`, you might include a sentence like "The user will provide the \`{{user_topic}}\` for you to write about."
---
    `}getStreamMode(){return Be().streamMode}async getSystemPromptThinkingPoints(t,r,n,o,i,l){const c=this.formatVariablesForPrompt(o),d=kt.getFinalPromptGenerationRules().THINKING_POINTS_EXTRACTION.replace("{language}",n),g=`${c}
User's Description for AI Persona:
---
${t}
---`,x={role:"system",content:d},y={role:"user",content:g};if(!i)throw new Error("AI");const S=this.getStreamMode();l&&S&&this.aiService.setStreamUpdateCallback(b=>{l(b)});const T=await this.aiService.callAI([x,y],i,r,S);return l&&S&&this.aiService.clearStreamUpdateCallback(),T.split(`
`).map(b=>b.replace(/^[*-]\s*/,"").trim()).filter(Boolean)}async generateSystemPrompt(t,r,n,o,i,l,c){const u=kt.getSystemPromptRules(),d=this.formatVariablesForPrompt(o),g=i&&i.length>0&&i.some(A=>A.trim()!=="")?`
---
Key Directives to Incorporate:
You must intelligently integrate the following specific directives into the final System Prompt. These are non-negotiable and should guide the core logic and personality of the AI.

Directives:
${i.filter(A=>A.trim()!=="").map(A=>`- ${A}`).join(`
`)}
---
      `:"",x=kt.getFinalPromptGenerationRules(),y=n==="zh"?"":"English",S=`${x.SYSTEM_PROMPT_GENERATION}

---
Here are the prompt engineering rules I will follow:
${u}
---`.replace("{language_display}",y),T=`${d}
${g}
User's Original Description:
---
${t}
---`,I={role:"system",content:S},b={role:"user",content:T};if(!l)throw new Error("AI");const h=this.getStreamMode();c&&h&&this.aiService.setStreamUpdateCallback(A=>{c(A)});const v=await this.aiService.callAI([I,b],l,r,h);c&&h&&this.aiService.clearStreamUpdateCallback();let C=v.replace(/```/g,"").trim();return C.startsWith(`markdown
`)?C=C.substring(9):C.startsWith("markdown")&&(C=C.substring(8)),C.trim()}async getOptimizationAdvice(t,r,n,o,i,l,c){const u=this.formatVariablesForPrompt(i),d=kt.getFinalPromptGenerationRules(),g=r.charAt(0).toUpperCase()+r.slice(1),x=d.OPTIMIZATION_ADVICE_GENERATION.replace("{promptType}",r).replace("{language}",o),y=`${u}
${g} Prompt to Analyze:
---
${t}
---`,S={role:"system",content:x},T={role:"user",content:y};if(!l)throw new Error("AI");const I=this.getStreamMode();c&&I&&this.aiService.setStreamUpdateCallback(v=>{c(v)});const b=await this.aiService.callAI([S,T],l,n,I);return c&&I&&this.aiService.clearStreamUpdateCallback(),b.split(`
`).map(v=>v.replace(/^[*-]\s*/,"").trim()).filter(Boolean)}async applyOptimizationAdvice(t,r,n,o,i,l,c,u){const d=kt.getSystemPromptRules(),g=this.formatVariablesForPrompt(l),x=r.map(N=>`- ${N}`).join(`
`),y=kt.getFinalPromptGenerationRules(),S=i==="zh"?"":"English",T=n.charAt(0).toUpperCase()+n.slice(1),I=`${y.OPTIMIZATION_APPLICATION}

---
Here are the core principles of elite prompt engineering I will follow:
${d}
---`.replace("{promptType}",n).replace("{language_display}",S).replace("{promptType_capitalized}",T),b=`${g}
Original ${T} Prompt:
---
${t}
---

Optimization Suggestions to Apply:
---
${x}
---`,h={role:"system",content:I},v={role:"user",content:b};if(!c)throw new Error("AI");const C=this.getStreamMode();u&&C&&this.aiService.setStreamUpdateCallback(N=>{u(N)});const A=await this.aiService.callAI([h,v],c,o,C);u&&C&&this.aiService.clearStreamUpdateCallback();let P=A.replace(/```/g,"").trim();return P.startsWith(`markdown
`)?P=P.substring(9):P.startsWith("markdown")&&(P=P.substring(8)),P.trim()}};Ue(ro,"instance");let Lr=ro;const Lj={welcomeMessage:"AIAI",quickReplies:["",""],maxConversationTurns:5,typingDelay:50};function Oj(e){return{...Lj,...e}}const ln=e=>{try{let t=e.replace(/<think>[\s\S]*?<\/think>/gi,"").trim();t=t.replace(/<ASSESSMENT>[\s\S]*?<\/ASSESSMENT>/gi,"").trim();const r=t.indexOf("<think>");r!==-1&&(t=t.substring(0,r).trim());const n=t.indexOf("<ASSESSMENT>");n!==-1&&(t=t.substring(0,n).trim());const o=[/<thin[^>]*$/i,/<\/thin[^>]*$/i,/\n\n<thin/i,/<ASSE[^>]*$/i,/<\/ASSE[^>]*$/i,/\n\n<ASSE/i,/CONTEXT:/i,/TASK:/i,/FORMAT:/i,/QUALITY:/i,/TURN_COUNT:/i,/DECISION:/i,/CONFIDENCE:/i];for(const i of o){const l=t.search(i);if(l!==-1){t=t.substring(0,l).trim();break}}return t}catch{return e}},Fg=e=>{let t=e.replace(/<think>[\s\S]*?<\/think>/gi,"").replace(/^Here is the.*?translation.*?:\s*/i,"").replace(/^Here is the.*?converted.*?:\s*/i,"").replace(/^Here is.*?:\s*/i,"").replace(/^.*?.*?\s*/i,"").replace(/^.*?.*?\s*/i,"").replace(/^.*?\s*/i,"").replace(/^.*?.*?\s*/i,"").replace(/^.*?.*?\s*/i,"").trim();return t=t.replace(/^```[\w]*\n?/,""),t=t.replace(/\n?```$/,""),t.trim()},Zs=e=>{if(!e)return"";let t=e.trim();t=t.replace(/^```[a-z]*\n?/i,""),t=t.replace(/\n?```\s*$/i,"");const r=[/^Here\s+is\s+the.*?:\s*/i,/^.*?\s*/i,/^.*?\s*/i,/^.*?.*?\s*/i,/^.*?.*?\s*/i];for(const n of r)t=t.replace(n,"");return t.trim()},vl=e=>{try{const t=e.match(/<ASSESSMENT>([\s\S]*?)<\/ASSESSMENT>/i);if(!t)return!1;const n=t[1].match(/DECISION:\s*\[([^\]]+)\]/i);return n?n[1].trim().toUpperCase()==="END_NOW":!1}catch{return!1}};function Dj({chatMessages:e,chatModel:t,chatInput:r,chatAttachments:n,chatQuickReplies:o}){const i=Et(),l=Be(),c=gt(),u=Oj(),d=hc.getInstance(),g=w.useCallback(C=>C instanceof DOMException&&C.name==="AbortError"||(C==null?void 0:C.name)==="AbortError",[]),x=w.useMemo(()=>{let C=345,A=0;return n.currentAttachments.length>0&&(A=115),`calc(100vh - ${C+A}px)`},[n.currentAttachments.length]);w.useEffect(()=>{e.scrollToBottom()},[i.chatMessages.length,e]),w.useEffect(()=>{e.scrollToBottom()},[i.isTyping,e.scrollToBottom]);const y=w.useCallback(async()=>{const C=i.getState();C.chatMessages.length===0&&!C.isInitialized&&(i.setState({isInitialized:!0}),await e.simulateTyping(u.welcomeMessage,!1))},[i,e,u]),S=w.useCallback(()=>{i.clearChat(),o.setShowQuickReplies(!1),n.clearAttachments(),setTimeout(async()=>{await e.simulateTyping(u.welcomeMessage,!1),i.setState({isInitialized:!0})},500)},[i,o,n,e,u]),T=w.useCallback(async(C,A)=>{try{i.clearProgressMessages();const N=i.getValidMessages().map(F=>({type:F.type,content:F.content,attachments:F.attachments||[]}));i.setIsGenerating(!0),i.setCurrentExecutionStep("report"),i.addOrUpdateProgressMessage(" ...","progress");const z=i.getState();i.setState({promptData:{...z.promptData,requirementReport:""}});const L=F=>{const D=i.getState();i.promptData.requirementReport=(D.promptData.requirementReport||"")+F,i.setState({promptData:{...D.promptData,requirementReport:D.promptData.requirementReport+F}})},G=await d.generateRequirementReportFromConversation(N,C,A,l.streamMode?L:void 0);if(!l.streamMode){const F=i.getState();i.setState({promptData:{...F.promptData,requirementReport:G}})}if(i.setShowPreview(!0),i.getState().isAutoMode){i.addOrUpdateProgressMessage(" ...","progress");const F=Lr.getInstance();i.setCurrentExecutionStep("thinking"),i.addOrUpdateProgressMessage("  1/4: ...","progress");let D="";const O=K=>{D+=K;const xe=D.split(`
`).map(Le=>Le.replace(/^[*-]\s*/,"").trim()).filter(Boolean);if(xe.length>0){const Le=i.getState();i.setState({promptData:{...Le.promptData,thinkingPoints:xe}})}},q=i.getState(),Q=await F.getSystemPromptThinkingPoints(q.promptData.requirementReport||G,A,"zh",[],C,l.streamMode?O:void 0);if(!l.streamMode){const K=i.getState();i.setState({promptData:{...K.promptData,thinkingPoints:Q}})}i.setCurrentExecutionStep("initial"),i.addOrUpdateProgressMessage("  2/4: ...","progress");const oe=i.getState();i.setState({promptData:{...oe.promptData,initialPrompt:""}});const W=K=>{const xe=i.getState(),Le=(xe.promptData.initialPrompt||"")+K;i.setState({promptData:{...xe.promptData,initialPrompt:Le}})},U=i.getState(),te=await F.generateSystemPrompt(U.promptData.requirementReport||G,A,"zh",[],U.promptData.thinkingPoints||Q,C,l.streamMode?W:void 0);if(!l.streamMode){const K=i.getState();i.setState({promptData:{...K.promptData,initialPrompt:te}})}i.setCurrentExecutionStep("advice"),i.addOrUpdateProgressMessage("  3/4: ...","progress");let ne="";const Ce=K=>{ne+=K;const xe=ne.split(`
`).map(Le=>Le.replace(/^[*-]\s*/,"").trim()).filter(Boolean);if(xe.length>0){const Le=i.getState();i.setState({promptData:{...Le.promptData,advice:xe}})}},ze=i.getState(),Qe=await F.getOptimizationAdvice(ze.promptData.initialPrompt||te,"system",A,"zh",[],C,l.streamMode?Ce:void 0);if(!l.streamMode){const K=i.getState();i.setState({promptData:{...K.promptData,advice:Qe}})}i.setCurrentExecutionStep("final"),i.addOrUpdateProgressMessage("  4/4: ...","progress");const fe=i.getState();i.setState({promptData:{...fe.promptData,generatedPrompt:""}});const He=K=>{const xe=i.getState(),Je=(typeof xe.promptData.generatedPrompt=="string"?xe.promptData.generatedPrompt:"zh"in xe.promptData.generatedPrompt?xe.promptData.generatedPrompt.zh:"")+K;i.setState({promptData:{...xe.promptData,generatedPrompt:Je}})},ce=i.getState(),V=await F.applyOptimizationAdvice(ce.promptData.initialPrompt||te,ce.promptData.advice||Qe,"system",A,"zh",[],C,l.streamMode?He:void 0);if(!l.streamMode){const K=i.getState();i.setState({promptData:{...K.promptData,generatedPrompt:V}})}i.addOrUpdateProgressMessage(" AI","progress")}else i.addOrUpdateProgressMessage(" ","progress");i.isGenerating=!1,i.currentExecutionStep=null}catch(P){if(i.setIsGenerating(!1),i.setCurrentExecutionStep(null),g(P)){c.info("");return}const N=P instanceof Error?P.message:String(P);c.error(`: ${N}API`)}},[i,l,d,c,g]),I=w.useCallback(async C=>{if(!C.trim()){n.currentAttachments.length>0&&c.warning("");return}if(!l.isInitialized){console.log("[useChatLogic] providerStore ...");try{await l.initialize(),await new Promise(R=>setTimeout(R,100))}catch(R){console.error("[useChatLogic]  providerStore :",R),c.error("AI");return}}const A=Be.getState();if(!A.selectedProviderId&&A.enabledProviders.length>0){const R=A.enabledProviders[0];console.log("[useChatLogic] :",R.name),A.setSelectedProvider(R.id),R.models.length>0&&A.setSelectedModel(R.models[0].id),await new Promise(F=>setTimeout(F,50))}const{provider:P,model:N}=t.getCurrentChatModel();if(console.log("[useChatLogic] sendMessage :",{provider:P,model:N,hasProvider:!!P,hasModel:!!N,providerName:P==null?void 0:P.name,modelName:N==null?void 0:N.name,isInitialized:l.isInitialized,providersCount:l.providers.length,selectedProviderId:l.selectedProviderId,selectedModelId:l.selectedModelId}),!P||!N){const R={selectedProviderId:l.selectedProviderId,selectedModelId:l.selectedModelId,providersCount:l.providers.length,isInitialized:l.isInitialized,enabledProvidersCount:l.enabledProviders.length};console.error("[useChatLogic] :",{providerStoreState:R,currentProvider:l.currentProvider,currentModel:l.currentModel,enabledProviders:l.enabledProviders.map(F=>({id:F.id,name:F.name,modelsCount:F.models.length}))}),l.isInitialized&&l.enabledProviders.length>0?c.warning("AIAIAPI"):l.isInitialized?c.warning("AIAPI"):c.error("AI");return}i.clearProgressMessages();const z=C,L=[...n.currentAttachments],G=o.checkForceGenerate(z);if(i.addMessage("user",z,L),r.clearInput(),n.clearAttachments(),o.setShowQuickReplies(!1),G){await e.simulateTyping(",",!1),setTimeout(async()=>{const R=l.currentProvider,F=l.currentModel;R&&F&&await T(R,F.id)},800);return}i.setIsTyping(!0),i.setIsGenerating(!0);try{const R=t.isStreamMode;if(R){const F=Yt.getInstance();let D="",O=-1;F.setStreamUpdateCallback(U=>{O===-1&&(O=e.startStreamingMessage()),D+=U;const te=ln(D);e.updateStreamingMessage(O,te),e.scrollToBottom()});const Q=i.getValidMessages().map(U=>({type:U.type,content:U.content,attachments:U.attachments||[]})),oe=await d.generateSimpleResponse("",Q,P,N.id,R);if(F.clearStreamUpdateCallback(),R&&O===-1){O=e.startStreamingMessage();const U=ln(oe);e.updateStreamingMessage(O,U)}else if(R&&D.trim()===""){const U=ln(oe);e.updateStreamingMessage(O,U)}const W=vl(oe);i.setIsTyping(!1),i.setIsGenerating(!1),(W||oe.includes(""))&&setTimeout(async()=>{const U=l.currentProvider,te=l.currentModel;U&&te&&await T(U,te.id)},800)}else{const D=i.getValidMessages().map(Q=>({type:Q.type,content:Q.content,attachments:Q.attachments||[]})),O=await d.generateSimpleResponse("",D,P,N.id,R);if(vl(O)||O.includes("")){const Q=ln(O);await e.simulateTyping(Q,!1),i.setIsGenerating(!1),setTimeout(async()=>{const oe=l.currentProvider,W=l.currentModel;oe&&W&&await T(oe,W.id)},800)}else{const Q=ln(O);await e.simulateTyping(Q,!1),i.isGenerating=!1}}}catch(R){if(i.setIsTyping(!1),i.setIsGenerating(!1),g(R)){t.isStreamMode&&Yt.getInstance().clearStreamUpdateCallback();return}const F=R instanceof Error?R.message:String(R);c.error(`: ${F}`),t.isStreamMode&&Yt.getInstance().clearStreamUpdateCallback()}},[n,t,r,o,e,i,l,c,d,T,g]),b=w.useCallback(async(C,A,P,N)=>{const z=i.chatMessages.find(L=>L.id===C);if(!(!z||z.type!=="ai")){if(!P||!N){c.warning("AIAPI");return}try{i.clearProgressMessages();const G=i.getValidMessages().slice(0,A).map(R=>({type:R.type,content:R.content,attachments:R.attachments||[]}));if(i.setIsTyping(!0),t.isStreamMode){const R=Yt.getInstance();let F="";R.setStreamUpdateCallback(q=>{F+=q;const Q=ln(F);i.updateMessage(C,Q),e.scrollToBottom()});const D=await d.generateSimpleResponse("",G,P,N.id,!0);R.clearStreamUpdateCallback();const O=ln(D);i.updateMessage(C,O)}else{const R=await d.generateSimpleResponse("",G,P,N.id,!1),F=ln(R);i.updateMessage(C,F)}i.setIsTyping(!1),c.success("")}catch(L){if(i.setIsTyping(!1),g(L)){t.isStreamMode&&Yt.getInstance().clearStreamUpdateCallback();return}const G=L instanceof Error?L.message:String(L);c.error(`: ${G}`),t.isStreamMode&&Yt.getInstance().clearStreamUpdateCallback()}}},[i,t,c,d,e,g]),h=w.useCallback(async(C,A,P,N)=>{const z=i.chatMessages.find(L=>L.id===C);if(!(!z||z.type!=="user")){if(!P||!N){c.warning("AIAPI");return}try{if(i.clearProgressMessages(),A!==-1)for(let G=A+1;G<i.chatMessages.length;G++){const R=i.chatMessages[G];R&&!R.isProgress&&i.deleteMessage(R.id)}i.setIsTyping(!0);const L=t.isStreamMode;if(L){const G=Yt.getInstance();let R="",F=-1;G.setStreamUpdateCallback(oe=>{F===-1&&(F=e.startStreamingMessage()),R+=oe;const W=ln(R);e.updateStreamingMessage(F,W),e.scrollToBottom()});const O=i.getValidMessages().map(oe=>({type:oe.type,content:oe.content,attachments:oe.attachments||[]})),q=await d.generateSimpleResponse("",O,P,N.id,L);G.clearStreamUpdateCallback();const Q=vl(q);i.setIsTyping(!1),(Q||q.includes(""))&&setTimeout(async()=>{const oe=l.currentProvider,W=l.currentModel;oe&&W&&await T(oe,W.id)},800)}else{const R=i.getValidMessages().map(O=>({type:O.type,content:O.content,attachments:O.attachments||[]})),F=await d.generateSimpleResponse("",R,P,N.id,L);if(vl(F)||F.includes("")){const O=ln(F);await e.simulateTyping(O,!1),i.setIsTyping(!1),setTimeout(async()=>{const q=l.currentProvider,Q=l.currentModel;q&&Q&&await T(q,Q.id)},800)}else{const O=ln(F);await e.simulateTyping(O,!1),i.setIsTyping(!1)}}}catch(L){if(i.setIsTyping(!1),i.setIsGenerating(!1),g(L)){t.isStreamMode&&Yt.getInstance().clearStreamUpdateCallback();return}const G=L instanceof Error?L.message:String(L);c.error(`: ${G}`),t.isStreamMode&&Yt.getInstance().clearStreamUpdateCallback()}}},[i,t,e,l,c,d,T,g]),v=w.useCallback(()=>{d.interruptCurrentRequest(),i.setIsTyping(!1),i.setIsGenerating(!1),i.setCurrentExecutionStep(null)},[d,i]);return{chatContainerMaxHeight:x,initializeChat:y,clearChat:S,sendMessage:I,generatePrompt:T,regenerateMessage:b,resendUserMessage:h,interruptGeneration:v}}async function Hn(e){if(navigator.clipboard&&window.isSecureContext)try{await navigator.clipboard.writeText(e);return}catch(t){console.warn("Clipboard API :",t)}return $j(e)}function $j(e){return new Promise((t,r)=>{const n=document.createElement("textarea");if(n.value=e,n.style.position="fixed",n.style.top="0",n.style.left="0",n.style.width="2em",n.style.height="2em",n.style.padding="0",n.style.border="none",n.style.outline="none",n.style.boxShadow="none",n.style.background="transparent",n.style.opacity="0",document.body.appendChild(n),n.focus(),n.select(),navigator.userAgent.match(/ipad|ipod|iphone/i)){const o=document.createRange();o.selectNodeContents(n);const i=window.getSelection();i&&(i.removeAllRanges(),i.addRange(o)),n.setSelectionRange(0,999999)}try{const o=document.execCommand("copy");document.body.removeChild(n),o?t():r(new Error('execCommand("copy")  false'))}catch(o){document.body.removeChild(n),r(o)}})}const Fj=Object.freeze(Object.defineProperty({__proto__:null,copyToClipboard:Hn},Symbol.toStringTag,{value:"Module"}));function Uj(){const e=Et(),t=gt(),[r,n]=w.useState({}),o=w.useRef({}),i=w.useRef({}),l=Object.keys(r).length>0,c=w.useCallback((b,h)=>{h&&(o.current[b]=h)},[]),u=w.useCallback((b,h)=>{h&&(i.current[b]=h)},[]),d=w.useCallback(b=>{const h=e.chatMessages.find(v=>v.id===b);h&&(n(v=>({...v,[b]:h.content})),e.startEditMessage(b),setTimeout(()=>{const v=o.current[b];if(v){v.focus();const C=v.value.length;v.setSelectionRange(C,C)}},0))},[e]),g=w.useCallback(b=>{const h=r[b];h!==void 0&&h.trim()?(e.saveEditMessage(b,h),n(v=>{const C={...v};return delete C[b],C}),delete o.current[b]):t.warning("")},[r,e,t]),x=w.useCallback(b=>{e.cancelEditMessage(b),n(h=>{const v={...h};return delete v[b],v}),delete o.current[b]},[e]),y=w.useCallback(b=>{confirm("AI")&&(e.deleteMessage(b),t.success(""))},[e,t]),S=w.useCallback(async b=>{try{await Hn(b),t.success("")}catch{const v=document.createElement("textarea");v.value=b,document.body.appendChild(v),v.select();try{document.execCommand("copy"),t.success("")}catch{t.error("")}document.body.removeChild(v)}},[t]),T=w.useCallback((b,h)=>{b.key==="Enter"&&b.ctrlKey?(b.preventDefault(),g(h)):b.key==="Escape"&&(b.preventDefault(),x(h))},[g,x]),I=w.useCallback((b,h)=>{n(v=>({...v,[b]:h}))},[]);return{editingContent:r,editTextareaRefs:o,messageRefs:i,isEditing:l,setEditTextareaRef:c,setMessageRef:u,startEdit:d,saveEdit:g,cancelEdit:x,deleteMessage:y,copyMessage:S,handleEditKeydown:T,updateEditingContent:I}}function Bj({isStreamMode:e,isGenerating:t,isTyping:r,onToggleStream:n,onClearChat:o,onInterrupt:i}){const l=t||r;return s.jsx("div",{className:"p-4 border-b border-gray-200 flex-shrink-0",children:s.jsxs("div",{className:"flex justify-between items-center",children:[s.jsx("div",{className:"flex items-center space-x-2",children:s.jsx("h4",{className:"font-semibold text-gray-800",children:"AI"})}),s.jsxs("div",{className:"flex items-center space-x-3",children:[s.jsxs("div",{className:"flex items-center space-x-2",children:[s.jsx("span",{className:"text-sm text-gray-600",children:":"}),s.jsx("button",{onClick:n,className:`relative inline-flex h-5 w-9 items-center rounded-full transition-colors focus:outline-none ${e?"bg-blue-500":"bg-gray-300"}`,title:e?"":"",children:s.jsx("span",{className:`inline-block h-3 w-3 transform rounded-full bg-white transition-transform ${e?"translate-x-5":"translate-x-1"}`})})]}),l&&s.jsxs("button",{onClick:i,className:"flex items-center gap-1 px-3 py-1 text-sm text-gray-600 hover:text-orange-600 hover:bg-orange-100 rounded transition-colors",title:"",children:[s.jsx(gP,{className:"w-4 h-4"}),s.jsx("span",{children:""})]}),s.jsxs("button",{onClick:o,className:"flex items-center gap-1 px-3 py-1 text-sm text-gray-600 hover:text-red-600 hover:bg-red-50 rounded transition-colors",title:"",children:[s.jsx(It,{className:"w-4 h-4"}),s.jsx("span",{children:""})]})]})]})})}const qj=w.memo(function({message:t,messageIndex:r,renderMarkdown:n,renderUserMessage:o,editingContent:i="",isDisabled:l=!1,onStartEdit:c,onSaveEdit:u,onCancelEdit:d,onDelete:g,onCopy:x,onRegenerate:y,onResend:S,onResendUser:T,onEditKeydown:I,onSetEditRef:b,onSetMessageRef:h,onUpdateEditingContent:v}){const C=w.useRef(null),A=w.useRef(null),P=t.type==="user",N=t.isEditing||!1;w.useEffect(()=>{h&&C.current&&h(t.id,C.current)},[t.id,h]),w.useEffect(()=>{if(N&&A.current&&b){b(t.id,A.current),A.current.focus();const L=A.current.value.length;A.current.setSelectionRange(L,L)}},[N,t.id,b]);const z=P?o(t.content):n(t.content);return s.jsx("div",{ref:C,className:`flex group ${P?"justify-end":"justify-start"}`,children:s.jsxs("div",{className:`flex flex-col w-full ${N?"max-w-full sm:max-w-2xl":"max-w-xs lg:max-w-md"}`,children:[s.jsx("div",{className:`${N?"bg-transparent border-0 shadow-none p-0":P?"bg-blue-500 text-white px-4 py-3 rounded-lg":t.isProgress?"bg-blue-50 text-blue-800 border border-blue-200 px-4 py-3 rounded-lg animate-pulse":"bg-gray-100 text-gray-800 px-4 py-3 rounded-lg"} ${!N&&(P?"ml-auto":"mr-auto")} transition-all duration-300 relative`,children:N?s.jsx("div",{className:"relative",children:s.jsx("div",{className:"relative border border-blue-300 rounded-2xl overflow-hidden bg-white",children:s.jsx("div",{className:"relative",children:s.jsx("textarea",{ref:A,value:i,onChange:L=>v==null?void 0:v(t.id,L.target.value),onKeyDown:L=>I==null?void 0:I(L,t.id),className:"w-full p-4 border-0 resize-none focus:outline-none text-gray-800 bg-white min-h-[80px] max-h-[200px] overflow-y-auto text-base",placeholder:"..."})})})}):s.jsx("div",{children:t.type==="ai"?s.jsx("div",{className:"prose prose-sm max-w-none prose-headings:text-gray-800 prose-p:text-gray-800 prose-li:text-gray-800 prose-strong:text-gray-800",dangerouslySetInnerHTML:{__html:z}}):s.jsx("div",{className:"text-sm text-white [&_h1]:text-base [&_h1]:font-bold [&_h1]:text-white [&_h1]:mb-2 [&_h2]:text-sm [&_h2]:font-bold [&_h2]:text-white [&_h2]:mb-2 [&_h3]:text-sm [&_h3]:font-bold [&_h3]:text-white [&_h3]:mb-1 [&_h4]:text-sm [&_h4]:font-bold [&_h4]:text-white [&_h5]:text-sm [&_h5]:font-bold [&_h5]:text-white [&_h6]:text-sm [&_h6]:font-bold [&_h6]:text-white [&_p]:text-sm [&_p]:text-white [&_p]:mb-2 [&_strong]:font-bold [&_strong]:text-white [&_b]:font-bold [&_b]:text-white [&_em]:italic [&_em]:text-white [&_i]:italic [&_i]:text-white [&_ul]:list-disc [&_ul]:list-inside [&_ul]:text-white [&_ul]:text-sm [&_ul]:mb-2 [&_ol]:list-decimal [&_ol]:list-inside [&_ol]:text-white [&_ol]:text-sm [&_ol]:mb-2 [&_li]:text-sm [&_li]:text-white [&_li]:mb-1 [&_code]:bg-blue-600 [&_code]:text-blue-100 [&_code]:text-xs [&_code]:px-1 [&_code]:rounded [&_code]:font-mono [&_pre]:bg-blue-600 [&_pre]:text-blue-100 [&_pre]:text-xs [&_pre]:p-2 [&_pre]:rounded [&_pre]:overflow-x-auto [&_a]:text-blue-200 [&_a]:underline [&_a]:text-sm [&_blockquote]:border-l-2 [&_blockquote]:border-blue-300 [&_blockquote]:pl-2 [&_blockquote]:text-blue-100 [&_blockquote]:text-sm",dangerouslySetInnerHTML:{__html:z}})})}),t.attachments&&t.attachments.length>0&&!N&&s.jsxs("div",{className:`mt-2 ${P?"ml-auto max-w-xs lg:max-w-md":"mr-auto max-w-xs lg:max-w-md"}`,children:[s.jsxs("div",{className:"text-xs text-gray-500 mb-1",children:[" (",t.attachments.length,")"]}),s.jsx("div",{className:"flex gap-2 overflow-x-auto scrollbar-thin scrollbar-thumb-gray-300 scrollbar-track-gray-100 pb-1",children:t.attachments.map(L=>s.jsx("div",{className:`flex-shrink-0 flex items-center gap-2 px-2 py-1.5 rounded-md text-xs border min-w-0 ${P?"border-blue-200 bg-blue-50":"border-gray-200 bg-gray-100"}`,children:s.jsxs("div",{className:"flex items-center gap-2 min-w-0",children:[s.jsxs("div",{className:"flex-shrink-0",children:[L.type==="image"&&s.jsx("svg",{className:"w-3 h-3 text-green-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})}),L.type==="document"&&s.jsx("svg",{className:"w-3 h-3 text-blue-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})}),L.type==="audio"&&s.jsx("svg",{className:"w-3 h-3 text-purple-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M9 19V6l12-3v13M9 19c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zm12-3c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zM9 10l12-3"})}),L.type==="video"&&s.jsx("svg",{className:"w-3 h-3 text-red-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z"})})]}),s.jsxs("div",{className:"min-w-0 flex-1",children:[s.jsx("div",{className:`truncate max-w-20 font-medium text-xs ${P?"text-blue-700":"text-gray-700"}`,title:L.name,children:L.name}),s.jsxs("div",{className:`text-xs ${P?"text-blue-500":"text-gray-500"}`,children:[(L.size/1024).toFixed(1),"KB"]})]})]})},L.id))})]}),!t.isProgress&&s.jsx("div",{className:`flex space-x-1 mt-2 transition-opacity duration-200 ${N?"opacity-100 justify-end":`opacity-0 group-hover:opacity-100 ${P?"justify-end":"justify-start"}`}`,children:N?s.jsxs(s.Fragment,{children:[s.jsx("button",{onClick:()=>P?S==null?void 0:S(t.id):u==null?void 0:u(t.id),className:"p-1.5 text-gray-500 hover:text-blue-600 transition-colors rounded-lg hover:bg-gray-100",title:P?"":"",disabled:l,children:s.jsx(Kd,{className:"w-3.5 h-3.5"})}),s.jsx("button",{onClick:()=>d==null?void 0:d(t.id),className:"p-1.5 text-gray-500 hover:text-red-600 transition-colors rounded-lg hover:bg-gray-100",title:"",children:s.jsx(Er,{className:"w-3.5 h-3.5"})})]}):s.jsxs(s.Fragment,{children:[t.type==="ai"&&s.jsx("button",{onClick:()=>y==null?void 0:y(t.id),className:"p-1.5 text-gray-500 hover:text-blue-600 transition-colors rounded-lg hover:bg-gray-100",title:"",disabled:l,children:s.jsx(It,{className:"w-3.5 h-3.5"})}),t.type==="user"&&s.jsx("button",{onClick:()=>T==null?void 0:T(t.id),className:"p-1.5 text-gray-500 hover:text-blue-600 transition-colors rounded-lg hover:bg-gray-100",title:"",disabled:l,children:s.jsx(Kd,{className:"w-3.5 h-3.5"})}),s.jsx("button",{onClick:()=>c==null?void 0:c(t.id),className:"p-1.5 text-gray-500 hover:text-green-600 transition-colors rounded-lg hover:bg-gray-100",title:"",children:s.jsx(Tx,{className:"w-3.5 h-3.5"})}),s.jsx("button",{onClick:()=>g==null?void 0:g(t.id),className:"p-1.5 text-gray-500 hover:text-red-600 transition-colors rounded-lg hover:bg-gray-100",title:"",children:s.jsx(Nx,{className:"w-3.5 h-3.5"})}),s.jsx("button",{onClick:()=>x==null?void 0:x(t.content),className:"p-1.5 text-gray-500 hover:text-blue-600 transition-colors rounded-lg hover:bg-gray-100",title:"",children:s.jsx(wr,{className:"w-3.5 h-3.5"})})]})})]})})});function Wj({chatContainerRef:e,messages:t,renderMarkdown:r,renderUserMessage:n,chatContainerMaxHeight:o,editingContent:i={},isTyping:l=!1,isGenerating:c=!1,onStartEdit:u,onSaveEdit:d,onCancelEdit:g,onDelete:x,onCopy:y,onRegenerate:S,onResend:T,onResendUser:I,onEditKeydown:b,onSetEditRef:h,onSetMessageRef:v,onUpdateEditingContent:C}){const A=w.useMemo(()=>t.filter(P=>!P.isDeleted),[t]);return w.useEffect(()=>{e.current&&(e.current.scrollTop=e.current.scrollHeight)},[A.length,l]),s.jsxs("div",{ref:e,className:"flex-1 overflow-y-auto p-4 space-y-4 min-h-0",style:o?{maxHeight:o}:void 0,children:[A.length===0?s.jsx("div",{className:"text-center text-gray-500 py-8",children:s.jsx("p",{children:"AI "})}):A.map((P,N)=>s.jsx(qj,{message:P,messageIndex:N,renderMarkdown:r,renderUserMessage:n,editingContent:i[P.id]||"",isDisabled:l||c,onStartEdit:u,onSaveEdit:d,onCancelEdit:g,onDelete:x,onCopy:y,onRegenerate:z=>S==null?void 0:S(z,N),onResend:z=>T==null?void 0:T(z,N),onResendUser:z=>I==null?void 0:I(z,N),onEditKeydown:b,onSetEditRef:h,onSetMessageRef:v,onUpdateEditingContent:C},P.id)),l&&s.jsx("div",{className:"flex justify-start",children:s.jsx("div",{className:"bg-gray-100 text-gray-800 px-4 py-2 rounded-lg",children:s.jsxs("div",{className:"flex space-x-1",children:[s.jsx("div",{className:"w-2 h-2 bg-gray-400 rounded-full animate-bounce"}),s.jsx("div",{className:"w-2 h-2 bg-gray-400 rounded-full animate-bounce",style:{animationDelay:"0.1s"}}),s.jsx("div",{className:"w-2 h-2 bg-gray-400 rounded-full animate-bounce",style:{animationDelay:"0.2s"}})]})})})]})}function Gj({show:e,replies:t,quickRepliesContainerRef:r,onSelect:n}){return e?s.jsxs("div",{ref:r,className:"absolute bottom-full left-0 right-0 px-6 py-3 bg-gray-50 border-b border-gray-200 shadow-lg z-10",children:[s.jsx("div",{className:"text-xs text-gray-500 mb-2",children:""}),s.jsx("div",{className:"flex flex-wrap gap-2",children:t.map(o=>s.jsx("button",{onClick:()=>n(o),className:"px-3 py-1 text-sm bg-white border border-gray-300 rounded-full hover:bg-gray-50 transition-colors",children:o},o))})]}):null}function Hj({isEditing:e,userInput:t,setUserInput:r,attachments:n,placeholder:o,isDisabled:i,textareaRef:l,showQuickReplies:c,quickReplies:u,quickRepliesContainerRef:d,onKeydown:g,onCompositionStart:x,onCompositionEnd:y,onFocus:S,onSend:T,onFileSelect:I,onRemoveAttachment:b,onClearAttachments:h,onQuickReplySelect:v,fileInputRef:C}){const A=w.useRef(null);w.useEffect(()=>{d&&A.current},[d]);const P=()=>{var z;(z=C.current)==null||z.click()},N=z=>{const L=z.currentTarget;if(document.activeElement!==L){const G=window.pageYOffset||document.documentElement.scrollTop,R=window.pageXOffset||document.documentElement.scrollLeft;setTimeout(()=>{window.scrollTo(R,G)},0)}};return s.jsxs("div",{className:"p-3 border-t border-gray-200 bg-white flex-shrink-0 relative z-20",children:[c&&u&&u.length>0&&s.jsxs("div",{ref:A,className:"absolute bottom-full left-0 right-0 px-6 py-3 bg-gray-50 border-b border-gray-200 shadow-lg",children:[s.jsx("div",{className:"text-xs text-gray-500 mb-2",children:""}),s.jsx("div",{className:"flex flex-wrap gap-2",children:u.map(z=>s.jsx("button",{onClick:()=>v(z),className:"px-3 py-1 text-sm bg-white border border-gray-300 rounded-full hover:bg-gray-50 transition-colors",children:z},z))})]}),s.jsx("input",{ref:C,type:"file",multiple:!0,accept:"image/*,video/*,audio/*,.pdf,.doc,.docx,.xls,.xlsx,.ppt,.pptx,.txt,.md,.csv,.json,.xml,.html,.css,.js,.ts,.py,.java,.c,.cpp,.yaml,.yml",onChange:I,className:"hidden"}),n.length>0&&s.jsxs("div",{className:"mb-3 p-3 bg-gray-50 rounded-lg",children:[s.jsxs("div",{className:"flex items-center justify-between mb-2",children:[s.jsxs("span",{className:"text-sm text-gray-600",children:[" ",n.length," "]}),s.jsx("button",{onClick:h,className:"text-xs text-red-500 hover:text-red-700",children:""})]}),s.jsx("div",{className:"flex gap-2 overflow-x-auto scrollbar-thin scrollbar-thumb-gray-300 scrollbar-track-gray-100 pb-1",children:n.map(z=>s.jsxs("div",{className:"flex-shrink-0 flex items-center gap-2 bg-white px-3 py-2 rounded-md border border-gray-200 min-w-0",children:[s.jsxs("div",{className:"flex items-center gap-2 min-w-0",children:[s.jsxs("div",{className:"flex-shrink-0",children:[z.type==="image"&&s.jsx("svg",{className:"w-4 h-4 text-green-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})}),z.type==="document"&&s.jsx("svg",{className:"w-4 h-4 text-blue-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})}),z.type==="audio"&&s.jsx("svg",{className:"w-4 h-4 text-purple-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M9 19V6l12-3v13M9 19c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zm12-3c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zM9 10l12-3"})}),z.type==="video"&&s.jsx("svg",{className:"w-4 h-4 text-red-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z"})}),!["image","document","audio","video"].includes(z.type)&&s.jsx("svg",{className:"w-4 h-4 text-gray-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M15.172 7l-6.586 6.586a2 2 0 102.828 2.828l6.414-6.586a4 4 0 00-5.656-5.656l-6.415 6.585a6 6 0 108.486 8.486L20.5 13"})})]}),s.jsxs("div",{className:"min-w-0 flex-1",children:[s.jsx("div",{className:"text-xs font-medium text-gray-700 truncate max-w-24",title:z.name,children:z.name}),s.jsxs("div",{className:"text-xs text-gray-500",children:[(z.size/1024).toFixed(1),"KB"]})]})]}),s.jsx("button",{onClick:()=>b(z.id),className:"flex-shrink-0 w-4 h-4 text-gray-400 hover:text-red-500 transition-colors",title:"",children:s.jsx(Er,{className:"w-3 h-3"})})]},z.id))})]}),!e&&s.jsxs("div",{className:"relative border border-gray-300 rounded-2xl focus-within:outline-none focus-within:border-gray-300 overflow-hidden",style:{height:"120px"},children:[s.jsx("div",{className:"absolute top-0 left-0 right-0",style:{bottom:"48px"},children:s.jsx("textarea",{ref:l,value:t,onChange:z=>r(z.target.value),onKeyDown:g,onCompositionStart:x,onCompositionEnd:y,onFocus:S,onMouseDown:N,placeholder:o,disabled:i,className:"w-full h-full px-2 pt-3 pb-1 border-0 outline-none resize-none disabled:opacity-50 text-base overflow-y-auto bg-transparent",rows:1})}),s.jsxs("div",{className:"absolute bottom-0 left-0 right-0 h-12 flex justify-between items-center px-2 bg-transparent pointer-events-none",children:[s.jsxs("button",{onClick:P,className:"w-8 h-8 rounded-full text-gray-500 hover:bg-gray-100 hover:text-gray-700 transition-colors flex items-center justify-center pointer-events-auto relative",title:"25MB",children:[s.jsx(tP,{className:"w-4 h-4"}),n.length>0&&s.jsx("span",{className:"absolute -top-1 -right-1 bg-blue-500 text-white text-xs rounded-full w-3 h-3 flex items-center justify-center",style:{fontSize:"9px"},children:n.length})]}),s.jsx("button",{onClick:T,disabled:!t.trim()||i,className:"w-8 h-8 bg-blue-500 text-white rounded-full hover:bg-blue-600 disabled:opacity-50 disabled:cursor-not-allowed transition-colors flex items-center justify-center pointer-events-auto",children:s.jsx(di,{className:"w-4 h-4"})})]})]})]})}function Vj(){const e=w.useRef(null),t=Et(C=>C.isGenerating),r=Et(C=>C.isTyping),n=Et(C=>C.chatMessages),o=Sj(),i=Tj(),l=Cj(),c=Pj(),u=jj(e),d=Uj(),g=Dj({chatMessages:o,chatModel:c,chatInput:i,chatAttachments:l,chatQuickReplies:u});w.useEffect(()=>{g.initializeChat()},[]);const x=()=>{!i.userInput.trim()&&l.currentAttachments.length===0||g.sendMessage(i.userInput)},y=C=>{i.handleKeydown(C,x)},S=C=>{u.selectQuickReply(C,A=>{i.setUserInput(A),x()})},T=()=>{g.clearChat()},I=()=>{g.interruptGeneration()},b=(C,A)=>{const{provider:P,model:N}=c.getCurrentChatModel();g.regenerateMessage(C,A,P,N)},h=(C,A)=>{const P=n.find(L=>L.id===C);P&&P.type==="user"&&P.isEditing&&d.saveEdit(C);const{provider:N,model:z}=c.getCurrentChatModel();g.resendUserMessage(C,A,N,z)},v=(C,A)=>{const{provider:P,model:N}=c.getCurrentChatModel();g.resendUserMessage(C,A,P,N)};return s.jsxs("div",{className:"bg-white rounded-lg shadow-sm flex flex-col h-full max-h-full overflow-hidden relative",onDragOver:l.handleGlobalDragOver,onDragEnter:l.handleGlobalDragEnter,onDragLeave:l.handleGlobalDragLeave,onDrop:l.handleGlobalDrop,children:[s.jsx(Bj,{isStreamMode:c.isStreamMode,isGenerating:t,isTyping:r,onToggleStream:c.toggleStreamMode,onClearChat:T,onInterrupt:I}),s.jsx(Wj,{chatContainerRef:o.chatContainer,messages:n,renderMarkdown:o.renderMarkdown,renderUserMessage:o.renderUserMessage,chatContainerMaxHeight:g.chatContainerMaxHeight,editingContent:d.editingContent,isTyping:r,isGenerating:t,onStartEdit:d.startEdit,onSaveEdit:d.saveEdit,onCancelEdit:d.cancelEdit,onDelete:d.deleteMessage,onCopy:d.copyMessage,onRegenerate:b,onResend:h,onResendUser:v,onEditKeydown:d.handleEditKeydown,onSetEditRef:d.setEditTextareaRef,onSetMessageRef:d.setMessageRef,onUpdateEditingContent:d.updateEditingContent}),s.jsx(Gj,{show:u.shouldShowQuickReplies,replies:u.quickReplies,quickRepliesContainerRef:u.quickRepliesContainerRef,inputContainerRef:e,onSelect:S}),s.jsx("div",{ref:e,children:s.jsx(Hj,{isEditing:d.isEditing,userInput:i.userInput,setUserInput:i.setUserInput,attachments:l.currentAttachments,placeholder:u.shouldShowQuickReplies?"...":"Shift+Enter",isDisabled:r||t,textareaRef:i.textareaRef,showQuickReplies:u.shouldShowQuickReplies,quickReplies:u.quickReplies,quickRepliesContainerRef:u.quickRepliesContainerRef,onKeydown:y,onCompositionStart:i.handleCompositionStart,onCompositionEnd:i.handleCompositionEnd,onFocus:()=>u.setShowQuickReplies(!0),onSend:x,onFileSelect:l.handleFileSelect,onRemoveAttachment:l.removeAttachment,onClearAttachments:l.clearAttachments,onQuickReplySelect:S,fileInputRef:l.fileInputRef})}),l.isGlobalDragging&&s.jsx("div",{className:"absolute inset-0 bg-blue-50 bg-opacity-90 flex items-center justify-center z-50 border-2 border-dashed border-blue-400 rounded-lg",children:s.jsxs("div",{className:"text-center",children:[s.jsx(SP,{className:"w-12 h-12 mx-auto mb-4 text-blue-500"}),s.jsx("div",{className:"text-lg font-medium text-blue-700 mb-2",children:""}),s.jsx("div",{className:"text-sm text-blue-600",children:""})]})})]})}function Kj(){const[e,t]=w.useState("report"),[r,n]=w.useState(new Set),o=w.useRef({}),i=w.useCallback(g=>{o.current={...o.current,...g}},[]),l=w.useCallback(g=>{n(x=>{const y=new Set(x);return y.delete(g),y})},[]),c=w.useCallback(g=>{const y={report:o.current.reportTab,thinking:o.current.thinkingTab,initial:o.current.initialTab,advice:o.current.adviceTab,zh:o.current.zhTab}[g],S=o.current.tabContainer;if(y&&S){const T=S.getBoundingClientRect(),I=y.getBoundingClientRect(),b=I.left-T.left+S.scrollLeft,h=b+I.width,v=T.width,C=S.scrollLeft,A=C+v;b<C?S.scrollTo({left:b-20,behavior:"smooth"}):h>A&&S.scrollTo({left:b-v+I.width+20,behavior:"smooth"})}},[]),u=w.useCallback(g=>{t(g),setTimeout(()=>{c(g)},0)},[c]),d=w.useCallback(g=>{t(g),l(g),setTimeout(()=>{c(g)},0)},[l,c]);return{activeTab:e,newContentTabs:r,setNewContentTabs:n,setTabRefs:i,markTabAsViewed:l,scrollToActiveTab:c,switchToTabWithScroll:u,handleTabChange:d}}function Yj(){return{ensureConfig:w.useCallback(async()=>{console.log("[useEnsureAIConfig] ...");const t=Be.getState(),r=gt.getState(),n=t.providers||[],o=t.enabledProviders||[];if(console.log("[useEnsureAIConfig] providerStore :",{isInitialized:t.isInitialized,providers:n.map(d=>({id:d.id,name:d.name,hasApiKey:!!d.apiKey,apiKeyLength:d.apiKey?d.apiKey.length:0,modelsCount:(d.models||[]).length})),enabledProviders:o.map(d=>d.id),selectedProviderId:t.selectedProviderId,selectedModelId:t.selectedModelId}),!t.isInitialized){console.log("[useEnsureAIConfig] providerStore ...");try{if(await t.initialize(),console.log("[useEnsureAIConfig] "),!Be.getState().isInitialized)throw new Error("")}catch(d){throw console.error("[useEnsureAIConfig] :",d),r.error("AI"),new Error("Provider store not initialized")}}const i=Be.getState(),l=i.providers||[];let c=i.currentProvider,u=i.currentModel;if(!c&&i.selectedProviderId){const d=l.find(g=>g.id===i.selectedProviderId);if(d&&(console.log("[useEnsureAIConfig]  providers :",d.name),c=d,!u&&i.selectedModelId)){const x=(c.models||[]).find(y=>y.id===i.selectedModelId);x&&(console.log("[useEnsureAIConfig]  provider.models :",x.name),u=x)}}if(console.log("[useEnsureAIConfig] :",{provider:c?{id:c.id,name:c.name,hasApiKey:!!c.apiKey}:null,model:u?{id:u.id,name:u.name}:null,hasProvider:!!c,hasModel:!!u,isInitialized:i.isInitialized,providersCount:l.length,enabledProvidersCount:i.enabledProviders.length,selectedProviderId:i.selectedProviderId,selectedModelId:i.selectedModelId}),!c)throw console.error("[useEnsureAIConfig] ",{selectedProviderId:i.selectedProviderId,providersCount:l.length}),r.error("AI"),new Error("Provider not found");if(!c.apiKey)throw console.error("[useEnsureAIConfig]  API Key",{providerId:c.id,providerName:c.name}),r.error(` "${c.name}"  API `),new Error("Provider missing API key");if(!u){const d=c.models||[];throw console.error("[useEnsureAIConfig] ",{providerId:c.id,providerName:c.name,selectedModelId:i.selectedModelId,availableModels:d.map(g=>g.id)}),r.error(` "${c.name}" `),new Error("Model not found")}return console.log("[useEnsureAIConfig] :",c.name,u.name),{provider:c,model:u}},[])}}function Qj({switchToTabWithScroll:e,scrollToBottomOfContent:t}){const r=Et(),n=gt(),[o,i]=w.useState(!1),{ensureConfig:l}=Yj(),c=w.useCallback(async()=>{const h=r.getState();if(!(h.chatMessages&&h.chatMessages.length>0)){n.warning("AI");return}try{i(!0),r.setCurrentExecutionStep("report");const{provider:C,model:A}=await l();console.log("[usePreviewExecution] regenerateRequirementReport :",C.name,A.name);const P=hc.getInstance(),z=r.getValidMessages().map(D=>({type:D.type,content:D.content,attachments:D.attachments||[]}));let L="";const G=D=>{L+=D;const O=r.getState();r.setState({promptData:{...O.promptData,requirementReport:L}}),t()},R=await P.generateRequirementReportFromConversation(z,C,A.id,G),F=r.getState();r.setState({promptData:{...F.promptData,requirementReport:R}}),n.success("")}catch{n.error("")}finally{i(!1),r.setCurrentExecutionStep(null)}},[r,n,t,l]),u=w.useCallback(async()=>{const h=r.getState();if(!h.promptData.requirementReport.trim()){n.warning("");return}try{i(!0);let v,C;try{const V=await l();v=V.provider,C=V.model,console.log("[usePreviewExecution] executeFullWorkflow :",v.name,C.name)}catch(V){console.error("[usePreviewExecution] :",V),i(!1),r.setCurrentExecutionStep(null);return}const A=Lr.getInstance(),P=h.promptData.requirementReport;r.setCurrentExecutionStep("thinking");let N="",z=!1;const L=V=>{if(N+=V,!z&&V.trim()){z=!0;const xe=r.getState();r.setState({promptData:{...xe.promptData,thinkingPoints:["..."]}}),e("thinking")}const K=N.split(`
`).map(xe=>xe.replace(/^[*-]\s*/,"").trim()).filter(Boolean);if(K.length>0){const xe=r.getState();r.setState({promptData:{...xe.promptData,thinkingPoints:K}}),t()}},G=await A.getSystemPromptThinkingPoints(P,C.id,"zh",[],v,L),R=r.getState();r.setState({promptData:{...R.promptData,thinkingPoints:G}}),r.setCurrentExecutionStep("initial");let F="",D=!1;const O=V=>{if(!D&&V.trim()){D=!0;const K=r.getState();r.setState({promptData:{...K.promptData,initialPrompt:"..."}}),e("initial")}if(F+=V,D){const K=r.getState();K.promptData.initialPrompt==="..."?r.setState({promptData:{...K.promptData,initialPrompt:V}}):r.setState({promptData:{...K.promptData,initialPrompt:F}}),t()}},q=await A.generateSystemPrompt(P,C.id,"zh",[],G,v,O),Q=r.getState();r.setState({promptData:{...Q.promptData,initialPrompt:q}}),r.setCurrentExecutionStep("advice");let oe="",W=!1;const U=V=>{if(oe+=V,!W&&V.trim()){W=!0;const xe=r.getState();r.setState({promptData:{...xe.promptData,advice:["..."]}}),e("advice")}const K=oe.split(`
`).map(xe=>xe.replace(/^[*-]\s*/,"").trim()).filter(Boolean);if(K.length>0){const xe=r.getState();r.setState({promptData:{...xe.promptData,advice:K}}),t()}},te=await A.getOptimizationAdvice(q,"system",C.id,"zh",[],v,U),ne=r.getState();r.setState({promptData:{...ne.promptData,advice:te}}),r.setCurrentExecutionStep("final");let Ce="",ze=!1;const Qe=V=>{if(!ze&&V.trim()){ze=!0;const K=r.getState();r.setState({promptData:{...K.promptData,generatedPrompt:"..."}}),e("zh")}if(Ce+=V,ze){const K=r.getState();if(K.promptData.generatedPrompt==="...")r.setState({promptData:{...K.promptData,generatedPrompt:V}});else{const xe=typeof K.promptData.generatedPrompt=="string"?K.promptData.generatedPrompt:"";r.setState({promptData:{...K.promptData,generatedPrompt:xe+V}})}t()}},fe=await A.applyOptimizationAdvice(q,te,"system",C.id,"zh",[],v,Qe),He=Zs(fe),ce=r.getState();r.setState({promptData:{...ce.promptData,generatedPrompt:He}}),e("zh")}catch(v){console.error("[usePreviewExecution] executeFullWorkflow :",v),console.error("[usePreviewExecution] :",{message:v instanceof Error?v.message:String(v),stack:v instanceof Error?v.stack:void 0,errorType:v instanceof Error?v.constructor.name:typeof v});const C=v instanceof Error?v.message:"";n.error(`: ${C}`)}finally{i(!1),r.setCurrentExecutionStep(null)}},[r,n,e,t,l]),d=w.useCallback(async()=>{const h=r.getState();if(!h.promptData.requirementReport.trim()){n.warning("");return}try{i(!0),r.setCurrentExecutionStep("thinking");const{provider:v,model:C}=await l();console.log("[usePreviewExecution] executeThinkingPoints :",v.name,C.name);const A=Lr.getInstance();let P="",N=!1;const z=R=>{if(P+=R,!N&&R.trim()){N=!0;const D=r.getState();r.setState({promptData:{...D.promptData,thinkingPoints:["..."]}}),e("thinking")}const F=P.split(`
`).map(D=>D.replace(/^[*-]\s*/,"").trim()).filter(Boolean);if(F.length>0){const D=r.getState();r.setState({promptData:{...D.promptData,thinkingPoints:F}}),t()}},L=await A.getSystemPromptThinkingPoints(h.promptData.requirementReport,C.id,"zh",[],v,z),G=r.getState();r.setState({promptData:{...G.promptData,thinkingPoints:L}})}catch{n.error("")}finally{i(!1),r.setCurrentExecutionStep(null)}},[r,n,e,t,l]),g=w.useCallback(async()=>{const h=r.getState();if(!h.promptData.requirementReport.trim()||!h.promptData.thinkingPoints||h.promptData.thinkingPoints.length===0){n.warning("");return}try{i(!0),r.setCurrentExecutionStep("initial");const{provider:v,model:C}=await l();console.log("[usePreviewExecution] :",v.name,C.name);const A=Lr.getInstance();let P="",N=!1;const z=F=>{if(!N&&F.trim()){N=!0;const D=r.getState();r.setState({promptData:{...D.promptData,initialPrompt:"..."}}),e("initial")}if(P+=F,N){const D=r.getState();D.promptData.initialPrompt==="..."?r.setState({promptData:{...D.promptData,initialPrompt:F}}):r.setState({promptData:{...D.promptData,initialPrompt:P}}),t()}},L=await A.generateSystemPrompt(h.promptData.requirementReport,C.id,"zh",[],h.promptData.thinkingPoints,v,z),G=Zs(L),R=r.getState();r.setState({promptData:{...R.promptData,initialPrompt:G}})}catch{n.error("")}finally{i(!1),r.setCurrentExecutionStep(null)}},[r,n,t,e,l]),x=w.useCallback(async()=>{const h=r.getState();if(!h.promptData.initialPrompt||!h.promptData.initialPrompt.trim()){n.warning("");return}try{i(!0),r.setCurrentExecutionStep("advice");const{provider:v,model:C}=await l();console.log("[usePreviewExecution] :",v.name,C.name);const A=Lr.getInstance();let P="",N=!1;const z=R=>{if(P+=R,!N&&R.trim()){N=!0;const D=r.getState();r.setState({promptData:{...D.promptData,advice:["..."]}}),e("advice")}const F=P.split(`
`).map(D=>D.replace(/^[*-]\s*/,"").trim()).filter(Boolean);if(F.length>0){const D=r.getState();r.setState({promptData:{...D.promptData,advice:F}}),t()}},L=await A.getOptimizationAdvice(h.promptData.initialPrompt,"system",C.id,"zh",[],v,z),G=r.getState();r.setState({promptData:{...G.promptData,advice:L}})}catch{n.error("")}finally{i(!1),r.setCurrentExecutionStep(null)}},[r,n,t,e,l]),y=w.useCallback(async()=>{const h=r.getState();if(!h.promptData.initialPrompt||!h.promptData.advice||h.promptData.advice.length===0){n.warning("");return}try{i(!0),r.setCurrentExecutionStep("final");const{provider:v,model:C}=await l();console.log("[usePreviewExecution] :",v.name,C.name);const A=Lr.getInstance();let P="",N=!1;const z=F=>{if(!N&&F.trim()){N=!0;const D=r.getState();r.setState({promptData:{...D.promptData,generatedPrompt:"..."}}),e("zh")}if(P+=F,N){const D=r.getState();if(D.promptData.generatedPrompt==="...")r.setState({promptData:{...D.promptData,generatedPrompt:F}});else{const O=typeof D.promptData.generatedPrompt=="string"?D.promptData.generatedPrompt:"";r.setState({promptData:{...D.promptData,generatedPrompt:O+F}})}t()}},L=await A.applyOptimizationAdvice(h.promptData.initialPrompt,h.promptData.advice,"system",C.id,"zh",[],v,z),G=Zs(L),R=r.getState();r.setState({promptData:{...R.promptData,generatedPrompt:G}}),e("zh")}catch{n.error("")}finally{i(!1),r.setCurrentExecutionStep(null)}},[r,n,e,t,l]),S=w.useCallback(async()=>{const h=r.getState();if(!h.promptData.requirementReport.trim()){n.warning("");return}try{i(!0),r.setCurrentExecutionStep("thinking");const{provider:v,model:C}=await l();console.log("[usePreviewExecution] :",v.name,C.name);const A=Lr.getInstance();let P="",N=!1;const z=R=>{if(P+=R,!N&&R.trim()){N=!0;const D=r.getState();r.setState({promptData:{...D.promptData,thinkingPoints:["..."]}}),e("thinking")}const F=P.split(`
`).map(D=>D.replace(/^[*-]\s*/,"").trim()).filter(Boolean);if(F.length>0){const D=r.getState();r.setState({promptData:{...D.promptData,thinkingPoints:F}}),t()}},L=await A.getSystemPromptThinkingPoints(h.promptData.requirementReport,C.id,"zh",[],v,z),G=r.getState();r.setState({promptData:{...G.promptData,thinkingPoints:L}}),n.success("")}catch{n.error("")}finally{i(!1),r.setCurrentExecutionStep(null)}},[r,n,e,t,l]),T=w.useCallback(async()=>{const h=r.getState();if(!h.promptData.thinkingPoints||h.promptData.thinkingPoints.length===0){n.warning("");return}try{i(!0),r.setCurrentExecutionStep("initial");const{provider:v,model:C}=await l();console.log("[usePreviewExecution] :",v.name,C.name);const A=Lr.getInstance();let P=!1;const N=R=>{if(!P&&R.trim()){P=!0;const F=r.getState();r.setState({promptData:{...F.promptData,initialPrompt:"..."}}),e("initial")}if(P){const F=r.getState();if(F.promptData.initialPrompt==="...")r.setState({promptData:{...F.promptData,initialPrompt:R}});else{const D=F.promptData.initialPrompt||"";r.setState({promptData:{...F.promptData,initialPrompt:D+R}})}t()}},z=await A.generateSystemPrompt(h.promptData.requirementReport,C.id,"zh",[],h.promptData.thinkingPoints,v,N),L=Zs(z),G=r.getState();r.setState({promptData:{...G.promptData,initialPrompt:L}}),n.success("")}catch{n.error("")}finally{i(!1),r.setCurrentExecutionStep(null)}},[r,n,e,t,l]),I=w.useCallback(async()=>{const h=r.getState();if(!h.promptData.initialPrompt){n.error("");return}try{i(!0),r.setCurrentExecutionStep("advice");const{provider:v,model:C}=await l();console.log("[usePreviewExecution] :",v.name,C.name);const A=Lr.getInstance();let P="",N=!1;const z=R=>{if(P+=R,!N&&R.trim()){N=!0;const D=r.getState();r.setState({promptData:{...D.promptData,advice:["..."]}}),e("advice")}const F=P.split(`
`).map(D=>D.replace(/^[*-]\s*/,"").trim()).filter(Boolean);if(F.length>0){const D=r.getState();r.setState({promptData:{...D.promptData,advice:F}}),t()}},L=await A.getOptimizationAdvice(h.promptData.initialPrompt,"system",C.id,"zh",[],v,z),G=r.getState();r.setState({promptData:{...G.promptData,advice:L}}),n.success("")}catch{n.error("")}finally{i(!1),r.setCurrentExecutionStep(null)}},[r,n,e,t,l]),b=w.useCallback(async()=>{const h=r.getState();if(!h.promptData.initialPrompt||!h.promptData.advice){n.error("");return}try{i(!0),r.setCurrentExecutionStep("final");const{provider:v,model:C}=await l();console.log("[usePreviewExecution] :",v.name,C.name);const A=Lr.getInstance();let P=!1;const N=R=>{if(!P&&R.trim()){P=!0;const F=r.getState();r.setState({promptData:{...F.promptData,generatedPrompt:"..."}}),e("zh")}if(P){const F=r.getState();if(F.promptData.generatedPrompt==="...")r.setState({promptData:{...F.promptData,generatedPrompt:R}});else{const D=typeof F.promptData.generatedPrompt=="string"?F.promptData.generatedPrompt:"";r.setState({promptData:{...F.promptData,generatedPrompt:D+R}})}t()}},z=await A.applyOptimizationAdvice(h.promptData.initialPrompt,h.promptData.advice,"system",C.id,"zh",[],v,N),L=Zs(z),G=r.getState();r.setState({promptData:{...G.promptData,generatedPrompt:L}}),n.success("")}catch{n.error("")}finally{i(!1),r.setCurrentExecutionStep(null)}},[r,n,e,t,l]);return{isExecuting:o,regenerateRequirementReport:c,executeFullWorkflow:u,executeThinkingPoints:d,executeInitialPrompt:g,executeAdvice:x,executeFinalPrompt:y,regenerateThinkingPoints:S,regenerateInitialPrompt:T,regenerateAdvice:I,regenerateFinalPrompt:b}}function Jj(){const e=Et(),t=Be(),r=gt(),n=Yt.getInstance(),[o,i]=w.useState(!1),[l,c]=w.useState(!1),[u,d]=w.useState("markdown"),[g,x]=w.useState("zh"),y=w.useMemo(()=>{const b=e.promptData.generatedPrompt;if(typeof b=="string")return b;if("markdown"in b&&"xml"in b){const h=u;return g==="zh"?b[h].zh:b[h].en}return g==="zh"?b.zh:b.en},[e.promptData.generatedPrompt,u,g]),S=w.useCallback(b=>{const h=e.getState(),v=h.promptData.generatedPrompt;if(typeof v=="string"){e.setState({promptData:{...h.promptData,generatedPrompt:b}});return}if("markdown"in v&&"xml"in v){const A=u,P={...v};g==="zh"?P[A].zh=b:P[A].en=b,e.setState({promptData:{...h.promptData,generatedPrompt:P}});return}const C={...v};g==="zh"?C.zh=b:C.en=b,e.setState({promptData:{...h.promptData,generatedPrompt:C}})},[e,u,g]),T=w.useCallback(async()=>{if(!y||o||l)return;const b=u==="markdown"?"xml":"markdown",v=e.getState().promptData.generatedPrompt;if(typeof v!="string"&&"markdown"in v&&"xml"in v&&(g==="zh"?v[b].zh:v[b].en)){d(b),r.success(`${b==="xml"?"XML":"Markdown"}`);return}const C=t.currentProvider,A=t.currentModel;if(!C||!A){r.error("AI");return}try{i(!0);const P=u==="markdown"?"XML":"Markdown",N=u==="markdown"?"Markdown":"XML",z=Fg(y),L=[{role:"system",content:`${N}${P}`},{role:"user",content:`${N}${P}

${z}`}],G=await n.callAI(L,C,A.id,!1);if(G&&G.trim()){const R=Zs(G),F=e.getState(),D=F.promptData.generatedPrompt;if(typeof D=="string"){const O=g,q={markdown:{zh:u==="markdown"&&O==="zh"?D:"",en:u==="markdown"&&O==="en"?D:""},xml:{zh:u==="xml"&&O==="zh"?D:"",en:u==="xml"&&O==="en"?D:""}};g==="zh"?q[b].zh=R:q[b].en=R,e.setState({promptData:{...F.promptData,generatedPrompt:q}})}else if("markdown"in D){const O={...D};g==="zh"?O[b].zh=R:O[b].en=R,e.setState({promptData:{...F.promptData,generatedPrompt:O}})}else{const O={markdown:{zh:u==="markdown"?D.zh:"",en:u==="markdown"?D.en:""},xml:{zh:u==="xml"?D.zh:"",en:u==="xml"?D.en:""}};g==="zh"?O[b].zh=R:O[b].en=R,e.setState({promptData:{...F.promptData,generatedPrompt:O}})}d(b),r.success(`${P}`)}else r.error("")}catch{r.error("")}finally{i(!1)}},[y,u,g,o,l,t,r,n,e,S]),I=w.useCallback(async()=>{if(!y||o||l)return;const b=g==="zh"?"en":"zh",v=e.getState().promptData.generatedPrompt;if(typeof v!="string"&&"markdown"in v&&"xml"in v){if(v[u][b]){x(b),r.success(`${b==="zh"?"":"English"}`);return}}else if(typeof v!="string"&&v[b]){x(b),r.success(`${b==="zh"?"":"English"}`);return}const C=t.currentProvider,A=t.currentModel;if(!C||!A){r.error("AI");return}const P=e.getState(),N=P.promptData.generatedPrompt;try{c(!0);const z=g==="zh"?"English":"",L=Fg(y),G=[{role:"system",content:`${z}`},{role:"user",content:`${z}

${L}`}],R=await n.callAI(G,C,A.id,!1);if(R&&R.trim()){const F=Zs(R);if(typeof N=="string"){const D={markdown:{zh:u==="markdown"&&g==="zh"?N:"",en:u==="markdown"&&g==="en"?N:""},xml:{zh:u==="xml"&&g==="zh"?N:"",en:u==="xml"&&g==="en"?N:""}};D[u][b]=F,e.setState({promptData:{...P.promptData,generatedPrompt:D}})}else if("markdown"in N){const D={...N};D[u][b]=F,e.setState({promptData:{...P.promptData,generatedPrompt:D}})}else{const D={markdown:{zh:u==="markdown"?N.zh:"",en:u==="markdown"?N.en:""},xml:{zh:u==="xml"?N.zh:"",en:u==="xml"?N.en:""}};D[u][b]=F,e.setState({promptData:{...P.promptData,generatedPrompt:D}})}x(b),r.success(`${z}`)}else r.error("")}catch{r.error("")}finally{c(!1)}},[y,u,g,o,l,t,r,n,e,S]);return{currentGeneratedPrompt:y,setCurrentGeneratedPrompt:S,isConvertingFormat:o,isConvertingLanguage:l,formatState:u,languageState:g,toggleFormat:T,toggleLanguage:I}}function Zj(){const e=w.useRef({}),t=w.useCallback(o=>{e.current={...e.current,...o}},[]),r=w.useCallback(()=>{setTimeout(()=>{[e.current.reportScrollContainer,e.current.thinkingScrollContainer,e.current.initialScrollContainer,e.current.adviceScrollContainer,e.current.finalScrollContainer].forEach(i=>{i&&(i.scrollTop=i.scrollHeight)})},0)},[]),n=w.useCallback(o=>{setTimeout(()=>{const i=e.current[o];i&&(i.scrollTop=i.scrollHeight)},0)},[]);return{setScrollContainerRefs:t,scrollToBottomOfContent:r,scrollContainerToBottom:n}}function Xj(){const e=gt(),[t,r]=w.useState({report:!1,thinking:!1,initial:!1,advice:!1,final:!1}),n=w.useCallback(async(o,i)=>{if(!o||o.trim()===""){e.warning("");return}try{await Hn(o),r(l=>({...l,[i]:!0})),e.success(""),setTimeout(()=>{r(l=>({...l,[i]:!1}))},2e3)}catch{e.error("")}},[e]);return{copyStatus:t,copyToClipboard:n}}function eN(){const e=Et(),t=w.useCallback(()=>{const i=e.getState(),l=i.promptData.thinkingPoints||[];e.setState({promptData:{...i.promptData,thinkingPoints:[...l,""]}})},[e]),r=w.useCallback(i=>{const l=e.getState(),c=l.promptData.thinkingPoints||[];if(i>=0&&i<c.length){const u=c.filter((d,g)=>g!==i);e.setState({promptData:{...l.promptData,thinkingPoints:u}})}},[e]),n=w.useCallback(()=>{const i=e.getState(),l=i.promptData.advice||[];e.setState({promptData:{...i.promptData,advice:[...l,""]}})},[e]),o=w.useCallback(i=>{const l=e.getState(),c=l.promptData.advice||[];if(i>=0&&i<c.length){const u=c.filter((d,g)=>g!==i);e.setState({promptData:{...l.promptData,advice:u}})}},[e]);return{addThinkingPoint:t,removeThinkingPoint:r,addAdviceItem:n,removeAdviceItem:o}}function tN(){const e=Et(),t=w.useMemo(()=>!0,[]),r=w.useMemo(()=>e.chatMessages&&e.chatMessages.length>0,[e.chatMessages]),n=w.useCallback(o=>({report:"",thinking:"",initial:"",advice:"",final:""})[o]||"",[]);return{hasAnyContent:t,hasConversationData:r,getStepDisplayName:n}}const rN=e=>({report:"",thinking:"",initial:"",advice:"",final:""})[e]||e;function nN({isAutoMode:e,currentExecutionStep:t,isGenerating:r,onUpdateIsAutoMode:n}){return s.jsxs("div",{className:"p-4 border-b border-gray-200 flex items-center justify-between",children:[s.jsxs("div",{className:"flex items-center space-x-3",children:[s.jsx("h4",{className:"font-semibold text-gray-800",children:""}),(t||r&&!t)&&s.jsxs("div",{className:"flex items-center px-2 py-1 bg-blue-50 text-blue-700 rounded-full text-xs border border-blue-200",children:[s.jsx(It,{className:"w-3 h-3 animate-spin mr-1"}),s.jsx("span",{children:t?rN(t):""})]})]}),s.jsx("div",{className:"flex items-center space-x-3",children:s.jsx("div",{className:"flex items-center space-x-2",children:s.jsxs("label",{className:"flex items-center cursor-pointer",children:[s.jsx("input",{checked:e,onChange:o=>n(o.target.checked),type:"checkbox",className:"sr-only peer"}),s.jsx("span",{className:"text-sm text-gray-600",children:e?"":""}),s.jsx("div",{className:"relative w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600"})]})})})]})}function Wx({isGenerating:e,children:t,onMounted:r}){const n=w.useRef(null);return w.useEffect(()=>{n.current&&r&&r(n.current)},[r]),s.jsx("div",{ref:n,className:"flex space-x-2 mb-4 flex-shrink-0 overflow-x-auto scrollbar-hide scroll-smooth",children:s.jsxs("div",{className:"flex space-x-2 min-w-max px-1",children:[e&&s.jsxs("div",{className:"flex items-center px-3 py-1 bg-blue-100 text-blue-700 rounded text-sm whitespace-nowrap",children:[s.jsx(It,{className:"w-3 h-3 animate-spin mr-1"}),s.jsx("span",{children:""})]}),t]})})}function fs({isActive:e,activeClass:t,children:r,onClick:n,onMounted:o}){const i=w.useRef(null);return w.useEffect(()=>{i.current&&o&&o(i.current)},[o]),s.jsx("button",{ref:i,onClick:n,className:`px-3 py-1 rounded text-sm transition-colors whitespace-nowrap flex-shrink-0 ${e?t:"bg-gray-200 text-gray-700 hover:bg-gray-300"}`,children:r})}function Gx(){return s.jsx("div",{className:"flex-1 flex items-center justify-center p-8",children:s.jsx("div",{className:"text-center text-gray-500",children:s.jsx("p",{children:"..."})})})}function sN(){return s.jsx("div",{className:"flex-1 flex items-center justify-center p-8",children:s.jsxs("div",{className:"text-center",children:[s.jsx("div",{className:"inline-block w-8 h-8 border-4 border-blue-500 border-t-transparent rounded-full animate-spin mb-4"}),s.jsx("p",{className:"text-gray-600",children:"..."})]})})}function oN({requirementReport:e,setRequirementReport:t,hasConversationData:r,isAutoMode:n,isExecuting:o,isGenerating:i,currentExecutionStep:l,isCopied:c,onRegenerate:u,onCopy:d,onExecuteFull:g,onExecuteThinking:x,onScrollMounted:y}){const S=w.useRef(null);return w.useEffect(()=>{S.current&&y&&y(S.current)},[y]),w.useEffect(()=>{S.current&&i&&(S.current.scrollTop=S.current.scrollHeight)},[e,i]),s.jsxs("div",{className:"border rounded-lg overflow-hidden flex flex-col flex-1",children:[s.jsxs("div",{className:"bg-orange-50 px-3 py-2 text-sm font-medium text-orange-700 flex items-center justify-between flex-shrink-0",children:[s.jsx("span",{children:""}),s.jsxs("div",{className:"flex items-center space-x-2",children:[s.jsx("button",{onClick:u,disabled:o||i,className:"text-orange-500 hover:text-orange-600 disabled:opacity-50 disabled:cursor-not-allowed",title:"",children:s.jsx(It,{className:`w-4 h-4 ${o&&l==="report"?"animate-spin":""}`})}),s.jsx("button",{onClick:d,className:"text-orange-500 hover:text-orange-600",title:"",children:c?s.jsx(zs,{className:"w-4 h-4"}):s.jsx(wr,{className:"w-4 h-4"})})]})]}),s.jsxs("div",{className:"p-3 bg-white flex-1 flex flex-col overflow-hidden",children:[s.jsx("textarea",{ref:S,value:e,onChange:T=>t(T.target.value),placeholder:r?"...":"...",className:"w-full flex-1 px-3 py-2 text-sm border border-gray-300 rounded-lg focus:outline-none focus:border-gray-300 focus:ring-0 resize-none"}),s.jsx("div",{className:"mt-4 flex justify-end flex-shrink-0",children:n?s.jsxs("button",{onClick:g,disabled:!e.trim()||o||i,className:"px-4 py-2 bg-green-500 text-white rounded hover:bg-green-600 disabled:opacity-50 disabled:cursor-not-allowed transition-colors flex items-center space-x-2",children:[s.jsx(It,{className:`w-4 h-4 ${o||i?"animate-spin":""}`}),s.jsx("span",{children:o||i?"...":""})]}):s.jsxs("button",{onClick:x,disabled:!e.trim()||o,className:"px-4 py-2 bg-orange-500 text-white rounded hover:bg-orange-600 disabled:opacity-50 disabled:cursor-not-allowed transition-colors flex items-center space-x-2",children:[s.jsx(It,{className:`w-4 h-4 ${o&&l==="thinking"?"animate-spin":""}`}),s.jsx("span",{children:o&&l==="thinking"?"...":""})]})})]})]})}function iN({thinkingPoints:e,setThinkingPoints:t,isAutoMode:r,isExecuting:n,isGenerating:o,currentExecutionStep:i,isCopied:l,onRegenerate:c,onCopy:u,onAddPoint:d,onRemovePoint:g,onUpdatePoint:x,onExecuteInitial:y,onScrollMounted:S}){const T=w.useRef(null);w.useEffect(()=>{T.current&&S&&S(T.current)},[S]),w.useEffect(()=>{T.current&&o&&(T.current.scrollTop=T.current.scrollHeight)},[e,o]);const I=(b,h)=>{const v=[...e];v[b]=h,t(v),x(b,h)};return s.jsxs("div",{className:"border rounded-lg overflow-hidden flex flex-col flex-1 min-h-0",children:[s.jsxs("div",{className:"bg-purple-50 px-3 py-2 text-sm font-medium text-purple-700 flex items-center justify-between flex-shrink-0",children:[s.jsx("span",{children:""}),s.jsxs("div",{className:"flex items-center space-x-2",children:[s.jsx("button",{onClick:c,disabled:n||o,className:"text-purple-500 hover:text-purple-600 disabled:opacity-50 disabled:cursor-not-allowed",title:"",children:s.jsx(It,{className:`w-4 h-4 ${n&&i==="thinking"?"animate-spin":""}`})}),s.jsx("button",{onClick:u,className:"text-purple-500 hover:text-purple-600",title:"",children:l?s.jsx(zs,{className:"w-4 h-4"}):s.jsx(wr,{className:"w-4 h-4"})})]})]}),s.jsxs("div",{className:"bg-white flex flex-col p-3 flex-1",children:[s.jsx("div",{ref:T,className:"space-y-2 overflow-y-auto flex-1",style:{maxHeight:"calc(100vh - 400px)"},children:e.map((b,h)=>s.jsxs("div",{className:"flex items-start",children:[s.jsx("span",{className:"text-purple-500 mr-2 mt-2",children:""}),s.jsx("input",{value:b,onChange:v=>I(h,v.target.value),onFocus:v=>v.target.setSelectionRange(v.target.value.length,v.target.value.length),className:"flex-1 px-3 py-1 text-sm border border-gray-300 rounded focus:ring-2 focus:ring-purple-500 focus:border-transparent"}),s.jsx("button",{onClick:()=>{g(h);const v=e.filter((C,A)=>A!==h);t(v)},className:"ml-2 px-2 py-1 text-red-500 hover:text-red-700 text-sm",title:"",children:""})]},h))}),s.jsxs("div",{className:"p-3 pt-4 flex justify-between flex-shrink-0 border-t border-gray-100 bg-white",children:[s.jsx("button",{onClick:()=>{d(),t([...e,""])},className:"px-3 py-1 text-purple-600 hover:text-purple-800 text-sm",children:"+ "}),!r&&s.jsxs("button",{onClick:y,disabled:!e||e.length===0||n,className:"px-4 py-2 bg-purple-500 text-white rounded hover:bg-purple-600 disabled:opacity-50 disabled:cursor-not-allowed transition-colors flex items-center space-x-2",children:[s.jsx(It,{className:`w-4 h-4 ${n&&i==="initial"?"animate-spin":""}`}),s.jsx("span",{children:n&&i==="initial"?"...":""})]})]})]})]})}function aN({initialPrompt:e,setInitialPrompt:t,isAutoMode:r,isExecuting:n,isGenerating:o,currentExecutionStep:i,isCopied:l,onRegenerate:c,onCopy:u,onExecuteAdvice:d,onScrollMounted:g}){const x=w.useRef(null);return w.useEffect(()=>{x.current&&g&&g(x.current)},[g]),w.useEffect(()=>{x.current&&o&&(x.current.scrollTop=x.current.scrollHeight)},[e,o]),s.jsxs("div",{className:"border rounded-lg overflow-hidden flex flex-col flex-1",children:[s.jsxs("div",{className:"bg-green-50 px-3 py-2 text-sm font-medium text-green-700 flex items-center justify-between flex-shrink-0",children:[s.jsx("span",{children:""}),s.jsxs("div",{className:"flex items-center space-x-2",children:[s.jsx("button",{onClick:c,disabled:n||o,className:"text-green-500 hover:text-green-600 disabled:opacity-50 disabled:cursor-not-allowed",title:"",children:s.jsx(It,{className:`w-4 h-4 ${n&&i==="initial"?"animate-spin":""}`})}),s.jsx("button",{onClick:u,className:"text-green-500 hover:text-green-600",title:"",children:l?s.jsx(zs,{className:"w-4 h-4"}):s.jsx(wr,{className:"w-4 h-4"})})]})]}),s.jsxs("div",{className:"p-3 bg-white flex-1 flex flex-col overflow-hidden",children:[s.jsx("textarea",{ref:x,value:e,onChange:y=>t(y.target.value),placeholder:"...",className:"w-full flex-1 px-3 py-2 text-sm border border-gray-300 rounded-lg focus:outline-none focus:border-gray-300 focus:ring-0 resize-none"}),!r&&s.jsx("div",{className:"mt-4 flex justify-end flex-shrink-0",children:s.jsxs("button",{onClick:d,disabled:!e.trim()||n,className:"px-4 py-2 bg-green-500 text-white rounded hover:bg-green-600 disabled:opacity-50 disabled:cursor-not-allowed transition-colors flex items-center space-x-2",children:[s.jsx(It,{className:`w-4 h-4 ${n&&i==="advice"?"animate-spin":""}`}),s.jsx("span",{children:n&&i==="advice"?"...":""})]})})]})]})}function Hx({advice:e,setAdvice:t,isAutoMode:r,isExecuting:n,isGenerating:o,currentExecutionStep:i,isCopied:l,onRegenerate:c,onCopy:u,onAddItem:d,onRemoveItem:g,onUpdateItem:x,onExecuteFinal:y,onScrollMounted:S}){const T=w.useRef(null);w.useEffect(()=>{T.current&&S&&S(T.current)},[S]),w.useEffect(()=>{T.current&&o&&(T.current.scrollTop=T.current.scrollHeight)},[e,o]);const I=(b,h)=>{const v=[...e];v[b]=h,t(v),x(b,h)};return s.jsxs("div",{className:"border rounded-lg overflow-hidden flex flex-col flex-1 min-h-0",children:[s.jsxs("div",{className:"bg-yellow-50 px-3 py-2 text-sm font-medium text-yellow-700 flex items-center justify-between flex-shrink-0",children:[s.jsx("span",{children:""}),s.jsxs("div",{className:"flex items-center space-x-2",children:[s.jsx("button",{onClick:c,disabled:n||o,className:"text-yellow-500 hover:text-yellow-600 disabled:opacity-50 disabled:cursor-not-allowed",title:"",children:s.jsx(It,{className:`w-4 h-4 ${n&&i==="advice"?"animate-spin":""}`})}),s.jsx("button",{onClick:u,className:"text-yellow-500 hover:text-yellow-600",title:"",children:l?s.jsx(zs,{className:"w-4 h-4"}):s.jsx(wr,{className:"w-4 h-4"})})]})]}),s.jsxs("div",{className:"bg-white flex flex-col p-3 flex-1 min-h-0 overflow-hidden",children:[s.jsx("div",{ref:T,className:"space-y-2 overflow-y-auto flex-1 min-h-0",children:e.map((b,h)=>s.jsxs("div",{className:"flex items-start",children:[s.jsx("span",{className:"text-yellow-500 mr-2 mt-2",children:""}),s.jsx("input",{value:b,onChange:v=>I(h,v.target.value),onFocus:v=>v.target.setSelectionRange(v.target.value.length,v.target.value.length),className:"flex-1 px-3 py-1 text-sm border border-gray-300 rounded focus:ring-2 focus:ring-yellow-500 focus:border-transparent"}),s.jsx("button",{onClick:()=>{g(h);const v=e.filter((C,A)=>A!==h);t(v)},className:"ml-2 px-2 py-1 text-red-500 hover:text-red-700 text-sm",title:"",children:""})]},h))}),s.jsxs("div",{className:"p-3 pt-4 flex justify-between flex-shrink-0 border-t border-gray-100 bg-white",children:[s.jsx("button",{onClick:()=>{d(),t([...e,""])},className:"px-3 py-1 text-yellow-600 hover:text-yellow-800 text-sm",children:"+ "}),!r&&s.jsxs("button",{onClick:y,disabled:!e||e.length===0||n,className:"px-4 py-2 bg-yellow-500 text-white rounded hover:bg-yellow-600 disabled:opacity-50 disabled:cursor-not-allowed transition-colors flex items-center space-x-2",children:[s.jsx(It,{className:`w-4 h-4 ${n&&i==="final"?"animate-spin":""}`}),s.jsx("span",{children:n&&i==="final"?"...":""})]})]})]})]})}function Vx({generatedPrompt:e,setGeneratedPrompt:t,isExecuting:r,isGenerating:n,currentExecutionStep:o,isCopied:i,isConvertingFormat:l,isConvertingLanguage:c,isSaving:u,formatState:d,languageState:g,onRegenerate:x,onCopy:y,onToggleFormat:S,onToggleLanguage:T,onSavePrompt:I,onScrollMounted:b}){const h=w.useRef(null);return w.useEffect(()=>{h.current&&b&&b(h.current)},[b]),w.useEffect(()=>{h.current&&n&&(h.current.scrollTop=h.current.scrollHeight)},[e,n]),s.jsxs("div",{className:"border rounded-lg overflow-hidden flex flex-col flex-1",children:[s.jsxs("div",{className:"bg-blue-50 px-3 py-2 text-sm font-medium text-blue-700 flex items-center justify-between flex-shrink-0",children:[s.jsx("span",{children:""}),s.jsxs("div",{className:"flex items-center space-x-2",children:[s.jsx("button",{onClick:x,disabled:r||n,className:"text-blue-500 hover:text-blue-600 disabled:opacity-50 disabled:cursor-not-allowed",title:"",children:s.jsx(It,{className:`w-4 h-4 ${r&&o==="final"?"animate-spin":""}`})}),s.jsx("button",{onClick:y,className:"text-blue-500 hover:text-blue-600",title:"",children:i?s.jsx(zs,{className:"w-4 h-4"}):s.jsx(wr,{className:"w-4 h-4"})})]})]}),s.jsxs("div",{className:"p-3 bg-white flex-1 flex flex-col min-h-0 overflow-hidden",children:[s.jsxs("div",{className:"mb-2 flex items-center justify-between flex-shrink-0",children:[s.jsxs("div",{className:"flex items-center space-x-2",children:[s.jsx("button",{onClick:S,disabled:l||c,className:"px-3 py-1 text-xs border border-gray-300 rounded hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed",children:d==="markdown"?"Markdown":"XML"}),s.jsx("button",{onClick:T,disabled:l||c,className:"px-3 py-1 text-xs border border-gray-300 rounded hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed",children:g==="zh"?"":"English"})]}),s.jsxs("button",{onClick:I,disabled:!e.trim()||u,className:"px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600 disabled:opacity-50 disabled:cursor-not-allowed transition-colors flex items-center space-x-2",children:[s.jsx(Cx,{className:"w-4 h-4"}),s.jsx("span",{children:u?"...":""})]})]}),s.jsx("textarea",{ref:h,value:e,onChange:v=>t(v.target.value),placeholder:"...",className:"w-full flex-1 min-h-0 px-3 py-2 text-sm border border-gray-300 rounded-lg focus:outline-none focus:border-gray-300 focus:ring-0 resize-none"})]})]})}function gh({isOpen:e,promptContent:t,isSaving:r,onSave:n,onCancel:o}){const[i,l]=w.useState({title:"",description:"",tags:[],isPublic:!1,promptType:"system",content:""}),[c,u]=w.useState("");w.useEffect(()=>{e&&(l({title:"",description:"",tags:[],isPublic:!1,promptType:"system",content:""}),u(""))},[e]);const d=()=>{c.trim()&&!i.tags.includes(c.trim())&&(l(y=>({...y,tags:[...y.tags,c.trim()]})),u(""))},g=y=>{l(S=>({...S,tags:S.tags.filter(T=>T!==y)}))},x=()=>{i.title.trim()&&n({title:i.title,description:i.description,tags:i.tags,isPublic:i.isPublic,promptType:i.promptType})};return e?s.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50",onClick:o,children:s.jsxs("div",{className:"bg-white rounded-lg shadow-xl w-full max-w-lg mx-4 max-h-[90vh] overflow-y-auto",onClick:y=>y.stopPropagation(),children:[s.jsxs("div",{className:"flex items-center justify-between p-6 border-b",children:[s.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:""}),s.jsx("button",{onClick:o,className:"text-gray-400 hover:text-gray-600",children:s.jsx(Er,{className:"w-6 h-6"})})]}),s.jsxs("div",{className:"p-6 space-y-4",children:[s.jsxs("div",{children:[s.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[" ",s.jsx("span",{className:"text-red-500",children:"*"})]}),s.jsx("input",{value:i.title,onChange:y=>l(S=>({...S,title:y.target.value})),type:"text",placeholder:"",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",maxLength:200}),s.jsxs("p",{className:"mt-1 text-xs text-gray-500",children:[i.title.length,"/200"]})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:""}),s.jsx("textarea",{value:i.description,onChange:y=>l(S=>({...S,description:y.target.value})),placeholder:"",rows:3,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent resize-none",maxLength:500}),s.jsxs("p",{className:"mt-1 text-xs text-gray-500",children:[i.description.length,"/500"]})]}),s.jsxs("div",{children:[s.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[" ",s.jsx("span",{className:"text-red-500",children:"*"})]}),s.jsxs("div",{className:"flex gap-4",children:[s.jsxs("label",{className:"flex items-center cursor-pointer",children:[s.jsx("input",{type:"radio",checked:i.promptType==="system",onChange:()=>l(y=>({...y,promptType:"system"})),className:"w-4 h-4 text-blue-600 border-gray-300 focus:ring-blue-500"}),s.jsx("span",{className:"ml-2 text-sm text-gray-700",children:""})]}),s.jsxs("label",{className:"flex items-center cursor-pointer",children:[s.jsx("input",{type:"radio",checked:i.promptType==="user",onChange:()=>l(y=>({...y,promptType:"user"})),className:"w-4 h-4 text-blue-600 border-gray-300 focus:ring-blue-500"}),s.jsx("span",{className:"ml-2 text-sm text-gray-700",children:""})]})]}),s.jsx("p",{className:"mt-1 text-xs text-gray-500",children:"AI"})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:""}),s.jsx("div",{className:"flex flex-wrap gap-2 mb-2",children:i.tags.map(y=>s.jsxs("span",{className:"inline-flex items-center px-3 py-1 bg-blue-100 text-blue-700 rounded-full text-sm",children:[y,s.jsx("button",{onClick:()=>g(y),className:"ml-2 text-blue-500 hover:text-blue-700",children:""})]},y))}),s.jsxs("div",{className:"flex gap-2",children:[s.jsx("input",{value:c,onChange:y=>u(y.target.value),onKeyUp:y=>y.key==="Enter"&&d(),type:"text",placeholder:"",className:"flex-1 px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"}),s.jsx("button",{onClick:d,className:"px-4 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200",children:""})]})]}),s.jsxs("div",{className:"flex items-center",children:[s.jsx("input",{type:"checkbox",id:"isPublic",checked:i.isPublic,onChange:y=>l(S=>({...S,isPublic:y.target.checked})),className:"w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500"}),s.jsx("label",{htmlFor:"isPublic",className:"ml-2 text-sm text-gray-700",children:""})]}),s.jsxs("div",{children:[s.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[" ",s.jsx("span",{className:"text-red-500",children:"*"})]}),t&&t.trim()?s.jsxs("div",{className:"p-3 bg-gray-50 border border-gray-200 rounded-lg max-h-40 overflow-y-auto text-sm text-gray-600",children:[t.slice(0,200),t.length>200?"...":""]}):s.jsx("textarea",{value:i.content,onChange:y=>l(S=>({...S,content:y.target.value})),placeholder:"...",rows:8,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent resize-none text-sm"}),s.jsxs("p",{className:"mt-1 text-xs text-gray-500",children:[" ",(t||i.content).length," "]})]})]}),s.jsxs("div",{className:"flex justify-end gap-3 p-6 border-t bg-gray-50",children:[s.jsx("button",{onClick:o,disabled:r,className:"px-4 py-2 text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 disabled:opacity-50",children:""}),s.jsx("button",{onClick:x,disabled:!i.title.trim()||r,className:"px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 disabled:opacity-50 disabled:cursor-not-allowed",children:r?"...":""})]})]})}):null}const lN="https://api.prompt-ui.xiechengqi.top";function cN(){const e=gt(),[t,r]=w.useState(!1),[n,o]=w.useState(!1),[i,l]=w.useState(""),c=Kj(),u=Zj(),d=Jj(),g=Xj(),x=eN(),y=tN(),S=Qj({switchToTabWithScroll:c.switchToTabWithScroll,scrollToBottomOfContent:u.scrollToBottomOfContent}),T=Et(W=>W.promptData.requirementReport),I=Et(W=>W.promptData.thinkingPoints),b=Et(W=>W.promptData.initialPrompt),h=Et(W=>W.promptData.advice),v=Et(W=>W.promptData.generatedPrompt),C=Et(W=>W.isGenerating),A=Et(W=>W.chatMessages),P=w.useRef(c);P.current=c,w.useEffect(()=>{A.length===0&&(P.current.switchToTabWithScroll("report"),P.current.setNewContentTabs(new Set))},[A.length]),w.useEffect(()=>{T&&T.trim().length>0&&(P.current.setNewContentTabs(W=>{const U=new Set(W);return U.add("report"),U}),P.current.switchToTabWithScroll("report"))},[T]),w.useEffect(()=>{I&&I.length>0&&(P.current.setNewContentTabs(W=>{const U=new Set(W);return U.add("thinking"),U}),P.current.switchToTabWithScroll("thinking"))},[I]),w.useEffect(()=>{b&&b.trim().length>0&&(P.current.setNewContentTabs(W=>{const U=new Set(W);return U.add("initial"),U}),P.current.switchToTabWithScroll("initial"))},[b]),w.useEffect(()=>{h&&h.length>0&&(P.current.setNewContentTabs(W=>{const U=new Set(W);return U.add("advice"),U}),P.current.switchToTabWithScroll("advice"))},[h]),w.useEffect(()=>{let W=!1;typeof v=="string"?W=v.trim().length>0:v&&typeof v=="object"&&"markdown"in v&&"xml"in v?W=!!(v.markdown.zh&&v.markdown.zh.trim().length>0||v.markdown.en&&v.markdown.en.trim().length>0||v.xml.zh&&v.xml.zh.trim().length>0||v.xml.en&&v.xml.en.trim().length>0):v&&typeof v=="object"&&(W=!!("zh"in v&&v.zh&&v.zh.trim().length>0||"en"in v&&v.en&&v.en.trim().length>0)),W&&(P.current.setNewContentTabs(U=>{const te=new Set(U);return te.add("zh"),te}),P.current.switchToTabWithScroll("zh"))},[v]);const N=c.activeTab,z=w.useRef(u);z.current=u,w.useEffect(()=>{C&&N==="report"&&setTimeout(()=>{z.current.scrollContainerToBottom("reportScrollContainer")},0)},[T,C,N]),w.useEffect(()=>{C&&N==="thinking"&&setTimeout(()=>{z.current.scrollContainerToBottom("thinkingScrollContainer")},0)},[I,C,N]),w.useEffect(()=>{C&&N==="initial"&&setTimeout(()=>{z.current.scrollContainerToBottom("initialScrollContainer")},0)},[b,C,N]),w.useEffect(()=>{C&&N==="advice"&&setTimeout(()=>{z.current.scrollContainerToBottom("adviceScrollContainer")},0)},[h,C,N]),w.useEffect(()=>{C&&N==="zh"&&setTimeout(()=>{z.current.scrollContainerToBottom("finalScrollContainer")},0)},[v,C,N]);const L=Et(W=>W.getState),G=Et(W=>W.setState),R=Et(W=>W.setIsAutoMode),F=()=>{const W=L();let U;const te=W.promptData.generatedPrompt;if(typeof te=="string"?U=te:"markdown"in te&&"xml"in te?U=te.markdown.zh||te.markdown.en||te.xml.zh||te.xml.en:U=te.zh||te.en,!U||!U.trim()){e.warning("",2e3);return}l(U),o(!0)},D=async W=>{try{r(!0);const U=localStorage.getItem("yprompt_token");if(!U)throw new Error("");const te={title:W.title,description:W.description,final_prompt:i,language:"zh",format:"markdown",prompt_type:W.promptType,tags:W.tags,is_public:W.isPublic?1:0},ne=await fetch(`${lN}/api/prompts/`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${U}`},body:JSON.stringify(te)});if(!ne.ok){const ze=await ne.text();throw new Error(`HTTP ${ne.status}: ${ze}`)}const Ce=await ne.json();if(Ce.code===200)e.success("",2e3),o(!1);else throw new Error(Ce.message||"")}catch(U){console.error(":",U),e.error(`: ${U.message}`,3e3)}finally{r(!1)}},O=Et(W=>W.isAutoMode),q=Et(W=>W.currentExecutionStep),Q=Et(W=>W.isGenerating),oe=y.hasAnyContent;return s.jsxs("div",{className:"bg-white rounded-lg shadow-sm flex flex-col h-full",children:[s.jsx(nN,{isAutoMode:O,currentExecutionStep:q,isGenerating:Q,onUpdateIsAutoMode:R}),Q&&!oe&&s.jsx(sN,{}),oe&&s.jsxs("div",{className:"flex-1 flex flex-col overflow-hidden p-4",children:[s.jsxs(Wx,{isGenerating:Q,onMounted:W=>c.setTabRefs({tabContainer:W}),children:[s.jsx(fs,{isActive:c.activeTab==="report",activeClass:"bg-orange-500 text-white",onClick:()=>c.handleTabChange("report"),onMounted:W=>c.setTabRefs({reportTab:W}),children:""}),I&&s.jsx(fs,{isActive:c.activeTab==="thinking",activeClass:"bg-purple-500 text-white",onClick:()=>c.handleTabChange("thinking"),onMounted:W=>c.setTabRefs({thinkingTab:W}),children:""}),b&&s.jsx(fs,{isActive:c.activeTab==="initial",activeClass:"bg-green-500 text-white",onClick:()=>c.handleTabChange("initial"),onMounted:W=>c.setTabRefs({initialTab:W}),children:""}),h&&s.jsx(fs,{isActive:c.activeTab==="advice",activeClass:"bg-yellow-500 text-white",onClick:()=>c.handleTabChange("advice"),onMounted:W=>c.setTabRefs({adviceTab:W}),children:""}),d.currentGeneratedPrompt&&s.jsx(fs,{isActive:c.activeTab==="zh",activeClass:"bg-blue-500 text-white",onClick:()=>c.handleTabChange("zh"),onMounted:W=>c.setTabRefs({zhTab:W}),children:""})]}),c.activeTab==="report"&&s.jsx(oN,{requirementReport:T,setRequirementReport:W=>{const U=L();G({promptData:{...U.promptData,requirementReport:W}})},hasConversationData:y.hasConversationData,isAutoMode:O,isExecuting:S.isExecuting,isGenerating:Q,currentExecutionStep:q,isCopied:g.copyStatus.report,onRegenerate:S.regenerateRequirementReport,onCopy:()=>g.copyToClipboard(T||"","report"),onExecuteFull:S.executeFullWorkflow,onExecuteThinking:S.executeThinkingPoints,onScrollMounted:W=>u.setScrollContainerRefs({reportScrollContainer:W})}),c.activeTab==="thinking"&&I&&s.jsx(iN,{thinkingPoints:I,setThinkingPoints:W=>{const U=L();G({promptData:{...U.promptData,thinkingPoints:W}})},isAutoMode:O,isExecuting:S.isExecuting,isGenerating:Q,currentExecutionStep:q,isCopied:g.copyStatus.thinking,onRegenerate:S.regenerateThinkingPoints,onCopy:()=>g.copyToClipboard((I==null?void 0:I.join(`
`))||"","thinking"),onAddPoint:x.addThinkingPoint,onRemovePoint:x.removeThinkingPoint,onUpdatePoint:(W,U)=>{const te=L();if(te.promptData.thinkingPoints){const ne=[...te.promptData.thinkingPoints];ne[W]=U,G({promptData:{...te.promptData,thinkingPoints:ne}})}},onExecuteInitial:S.executeInitialPrompt,onScrollMounted:W=>u.setScrollContainerRefs({thinkingScrollContainer:W})}),c.activeTab==="initial"&&b&&s.jsx(aN,{initialPrompt:b,setInitialPrompt:W=>{const U=L();G({promptData:{...U.promptData,initialPrompt:W}})},isAutoMode:O,isExecuting:S.isExecuting,isGenerating:Q,currentExecutionStep:q,isCopied:g.copyStatus.initial,onRegenerate:S.regenerateInitialPrompt,onCopy:()=>g.copyToClipboard(b||"","initial"),onExecuteAdvice:S.executeAdvice,onScrollMounted:W=>u.setScrollContainerRefs({initialScrollContainer:W})}),c.activeTab==="advice"&&h&&s.jsx(Hx,{advice:h,setAdvice:W=>{const U=L();G({promptData:{...U.promptData,advice:W}})},isAutoMode:O,isExecuting:S.isExecuting,isGenerating:Q,currentExecutionStep:q,isCopied:g.copyStatus.advice,onRegenerate:S.regenerateAdvice,onCopy:()=>g.copyToClipboard((h==null?void 0:h.join(`
`))||"","advice"),onAddItem:x.addAdviceItem,onRemoveItem:x.removeAdviceItem,onUpdateItem:(W,U)=>{const te=L();if(te.promptData.advice){const ne=[...te.promptData.advice];ne[W]=U,G({promptData:{...te.promptData,advice:ne}})}},onExecuteFinal:S.executeFinalPrompt,onScrollMounted:W=>u.setScrollContainerRefs({adviceScrollContainer:W})}),c.activeTab==="zh"&&d.currentGeneratedPrompt&&s.jsx(Vx,{generatedPrompt:d.currentGeneratedPrompt,setGeneratedPrompt:d.setCurrentGeneratedPrompt,isExecuting:S.isExecuting,isGenerating:Q,currentExecutionStep:q,isCopied:g.copyStatus.final,isConvertingFormat:d.isConvertingFormat,isConvertingLanguage:d.isConvertingLanguage,isSaving:t,formatState:d.formatState,languageState:d.languageState,onRegenerate:S.regenerateFinalPrompt,onCopy:()=>g.copyToClipboard(d.currentGeneratedPrompt,"final"),onToggleFormat:d.toggleFormat,onToggleLanguage:d.toggleLanguage,onSavePrompt:F,onScrollMounted:W=>u.setScrollContainerRefs({finalScrollContainer:W})})]}),!oe&&!Q&&s.jsx(Gx,{}),s.jsx(gh,{isOpen:n,promptContent:i,isSaving:t,onSave:D,onCancel:()=>o(!1)})]})}function uN(){return null}function Kx(){const e=gt(g=>g.notifications),t=gt(g=>g.removeNotification),r=gt(g=>g.confirmDialog),n=gt(g=>g.closeConfirmDialog),[o,i]=w.useState(!1),l=g=>{switch(g){case"success":return"bg-white/95 border border-green-200/50 text-green-800 shadow-green-100/50";case"error":return"bg-white/95 border border-red-200/50 text-red-800 shadow-red-100/50";case"warning":return"bg-white/95 border border-yellow-200/50 text-yellow-800 shadow-yellow-100/50";case"info":return"bg-white/95 border border-blue-200/50 text-blue-800 shadow-blue-100/50";default:return"bg-white/95 border border-gray-200/50 text-gray-800 shadow-gray-100/50"}},c=g=>{switch(g){case"success":return"text-green-600";case"error":return"text-red-600";case"warning":return"text-yellow-600";case"info":return"text-blue-600";default:return"text-gray-600"}},u=g=>{switch(g){case"success":return th;case"error":return rh;case"warning":return Ig;case"info":return da;default:return da}};w.useEffect(()=>{i(!!r)},[r]);const d=s.jsxs(s.Fragment,{children:[s.jsx("div",{className:"fixed bottom-4 right-4 z-[9999] space-y-2 pointer-events-none",children:e.map(g=>{const x=u(g.type);return s.jsxs("div",{className:`max-w-sm w-full shadow-xl rounded-lg pointer-events-auto overflow-hidden backdrop-blur-sm transform transition-all duration-300 ease-out ${l(g.type)}`,style:{animation:"slideIn 0.3s ease-out"},children:[s.jsx("div",{className:"p-4",children:s.jsxs("div",{className:"flex items-start gap-3",children:[s.jsx("div",{className:"flex-shrink-0 mt-0.5",children:s.jsx(x,{className:`h-5 w-5 ${c(g.type)}`})}),s.jsx("div",{className:"flex-1 min-w-0",children:s.jsx("p",{className:"text-sm font-medium break-words leading-relaxed",children:g.message})}),s.jsx("div",{className:"flex-shrink-0",children:s.jsx("button",{onClick:()=>t(g.id),className:"inline-flex text-gray-400 hover:text-gray-600 focus:outline-none transition-colors rounded p-0.5 hover:bg-black/5",children:s.jsx(Er,{className:"h-4 w-4"})})})]})}),g.duration&&g.duration>0&&s.jsx("div",{className:"h-1 bg-black/10 overflow-hidden",children:s.jsx("div",{className:"h-full bg-current opacity-30 transition-all linear",style:{animation:`shrink ${g.duration}ms linear forwards`,animationFillMode:"forwards"}})})]},g.id)})}),r&&s.jsx("div",{className:`fixed bottom-4 right-4 z-[10000] transition-all duration-300 ease-out ${o?"opacity-100 translate-y-0":"opacity-0 translate-y-4"}`,children:s.jsx("div",{className:"max-w-sm w-full bg-white rounded-xl shadow-xl border border-slate-200 overflow-hidden backdrop-blur-sm",children:s.jsxs("div",{className:"p-4",children:[s.jsxs("div",{className:"flex items-start gap-3",children:[s.jsx("div",{className:"flex-shrink-0 mt-0.5",children:r.type==="warning"?s.jsx(Ig,{className:"h-5 w-5 text-yellow-600"}):s.jsx(da,{className:"h-5 w-5 text-blue-600"})}),s.jsx("div",{className:"flex-1 min-w-0",children:s.jsx("p",{className:"text-sm font-medium text-slate-900 break-words leading-relaxed",children:r.message})})]}),s.jsxs("div",{className:"flex items-center justify-end gap-2 mt-4",children:[s.jsx("button",{onClick:()=>n(!1),className:"px-4 py-2 text-sm font-medium text-slate-700 bg-white border border-slate-200 rounded-lg hover:bg-slate-50 transition-colors focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2",children:r.cancelText||""}),s.jsx("button",{onClick:()=>n(!0),className:"px-4 py-2 text-sm font-medium text-white bg-gradient-to-r from-indigo-600 to-violet-600 rounded-lg hover:shadow-lg hover:-translate-y-0.5 transition-all focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2",children:r.confirmText||""})]})]})})})]});return Yp.createPortal(d,document.body)}function dN(){const e=Be(r=>r.isInitialized),t=Be(r=>r.initialize);return w.useEffect(()=>{(async()=>{e||await t(),Be.getState().enabledProviders.length>0||setTimeout(()=>{},1e3)})()},[e]),s.jsxs("div",{className:"w-full flex-1 flex flex-col overflow-hidden p-2 min-h-0",children:[s.jsx(uN,{}),s.jsxs("div",{className:"w-full flex-1 flex flex-col overflow-hidden min-h-0",children:[s.jsx("div",{className:"bg-white rounded-lg shadow-sm p-4 mb-4 flex-shrink-0",children:s.jsx("div",{className:"flex items-center justify-between",children:s.jsxs("div",{className:"min-w-0",children:[s.jsx("h2",{className:"text-xl lg:text-2xl font-bold text-gray-800 mb-1",children:""}),s.jsx("p",{className:"text-sm lg:text-base text-gray-600",children:"AI"})]})})}),s.jsxs("div",{className:"flex flex-row flex-1 min-h-0 gap-4 overflow-hidden",children:[s.jsx("div",{className:"flex flex-col flex-1 min-h-0",children:s.jsx(Vj,{})}),s.jsx("div",{className:"flex flex-col flex-1 min-h-0",children:s.jsx(cN,{})})]})]}),s.jsx(Kx,{})]})}const yh=vo((e,t)=>({systemPrompt:"",userPrompt:"",importedPromptId:null,loadedPromptId:null,analysis:null,isAnalyzing:!1,suggestions:[],selectedSuggestions:[],optimizedPrompts:{system:"",user:""},isGeneratingSuggestions:!1,isApplyingSuggestions:!1,versions:[],currentVersion:"original",isVersionLoading:!1,testCases:[],currentTestCase:"",testResults:[],isTesting:!1,activeTab:"input",showDiffView:!1,showVersionHistory:!1,resetOptimization:()=>{e({systemPrompt:"",userPrompt:"",importedPromptId:null,loadedPromptId:null,analysis:null,suggestions:[],selectedSuggestions:[],optimizedPrompts:{system:"",user:""},versions:[],currentVersion:"original",testCases:[],testResults:[],activeTab:"input"})},setPrompts:(r,n,o)=>{e({systemPrompt:r,userPrompt:n,importedPromptId:o||null})},setLoadedPromptId:r=>{e({loadedPromptId:r})},setAnalysis:r=>{e({analysis:r})},setSuggestions:r=>{e({suggestions:r,selectedSuggestions:r.map(n=>n.id)})},toggleSuggestion:r=>{const n=t();n.selectedSuggestions.indexOf(r)>-1?e({selectedSuggestions:n.selectedSuggestions.filter(i=>i!==r)}):e({selectedSuggestions:[...n.selectedSuggestions,r]})},selectAllSuggestions:()=>{const r=t();e({selectedSuggestions:r.suggestions.map(n=>n.id)})},deselectAllSuggestions:()=>{e({selectedSuggestions:[]})},setOptimizedPrompts:(r,n)=>{const o=t(),i={id:`v_${Date.now()}`,version:`V${o.versions.length+1}`,systemPrompt:r,userPrompt:n,changes:pN(o.systemPrompt,r,o.userPrompt,n),appliedSuggestions:[...o.selectedSuggestions],createdAt:new Date,tag:"draft"};e({optimizedPrompts:{system:r,user:n},versions:[...o.versions,i],currentVersion:i.version})},addTestCase:r=>{const n=t();r.trim()&&!n.testCases.includes(r.trim())&&e({testCases:[...n.testCases,r.trim()]})},setCurrentTestCase:r=>{e({currentTestCase:r})},setTestResults:r=>{e({testResults:r})},switchTab:r=>{e({activeTab:r})},toggleDiffView:()=>{e(r=>({showDiffView:!r.showDiffView}))},toggleVersionHistory:()=>{e(r=>({showVersionHistory:!r.showVersionHistory}))},switchVersion:r=>{const o=t().versions.find(i=>i.version===r);o&&e({currentVersion:r,optimizedPrompts:{system:o.systemPrompt,user:o.userPrompt}})}}));function pN(e,t,r,n){const o=[];return e!==t&&o.push({type:"modify",field:"system",content:t}),r!==n&&o.push({type:"modify",field:"user",content:n}),o}function Yx(e){if(!e)throw new Error("Empty content");try{return JSON.parse(e)}catch{}const t=/```(?:json)?\s*\n?([\s\S]*?)\n?```/,r=e.match(t);if(r&&r[1])try{return JSON.parse(r[1].trim())}catch(i){throw new Error(`Failed to parse JSON from code block: ${i}`)}const n=e.indexOf("{"),o=e.lastIndexOf("}");if(n!==-1&&o!==-1&&o>n)try{const i=e.substring(n,o+1);return JSON.parse(i)}catch(i){throw new Error(`Failed to parse extracted JSON: ${i}`)}throw new Error("No valid JSON found in content")}function hN(){const e=Be(),t=Yt.getInstance(),r=Lr.getInstance(),n=w.useCallback(async(l,c,u)=>{if(!l||!l.trim())throw new Error("");const d=e.currentProvider,g=e.currentModel;if(!d||!g)throw new Error("AI");const x=kt.getQualityAnalysisSystemPrompt(),y=`


${l}

JSON`;let S="";u&&t.setStreamUpdateCallback(T=>{S+=T,u(S)});try{const I=await t.callAI([{role:"system",content:x},{role:"user",content:y}],d,g.id,!!u)||S;let b;try{b=Yx(I),console.log(" Parsed analysis result:",b)}catch(h){console.error(" Failed to parse analysis response:",h),console.error(" Original content:",I),b={overall_score:75,analysis:{role:{score:75,status:"good",feedback:""},task:{score:75,status:"good",feedback:""},format:{score:65,status:"needs_improvement",feedback:""},constraints:{score:70,status:"needs_improvement",feedback:""},example:{score:60,status:"needs_improvement",feedback:""},language:{score:80,status:"good",feedback:""}},suggestions:[],language:"zh",word_count:l.length,estimated_tokens:Math.ceil(l.length/4),issues:[""]}}return b}catch(T){return console.error("Analysis failed:",T),{overall_score:70,analysis:{role:{score:70,status:"needs_improvement",feedback:""},task:{score:70,status:"needs_improvement",feedback:""},format:{score:70,status:"needs_improvement",feedback:""},constraints:{score:70,status:"needs_improvement",feedback:""},example:{score:70,status:"needs_improvement",feedback:""},language:{score:70,status:"needs_improvement",feedback:""}},suggestions:[{area:"general",suggestion:""}],language:"zh",word_count:l.length,estimated_tokens:Math.ceil(l.length/4),issues:[""]}}finally{u&&t.clearStreamUpdateCallback()}},[e,t]),o=w.useCallback(async(l,c,u)=>{const d=e.currentProvider,g=e.currentModel;if(!d||!g)throw new Error("AI");return await r.getOptimizationAdvice(l,c,g.id,"zh",[],d,u)},[e,r]),i=w.useCallback(async(l,c,u,d)=>{const g=e.currentProvider,x=e.currentModel;if(!g||!x)throw new Error("AI");return await r.applyOptimizationAdvice(l,c,u,x.id,"zh",[],g,d)},[e,r]);return{analyzePrompt:n,generateOptimizationAdvice:o,applyOptimizationAdvice:i}}function mN(){const e=Yt.getInstance(),t=Be(S=>S.currentProvider),r=Be(S=>S.currentModel),[n,o]=w.useState({mode:"system",systemConfig:{leftSystemPrompt:"",rightSystemPrompt:"",sharedUserInput:""},leftMessages:[],rightMessages:[],userConfig:{sharedSystemPrompt:"",leftUserPrompt:"",rightUserPrompt:""},leftUserMessages:[],rightUserMessages:[],isLeftGenerating:!1,isRightGenerating:!1}),i=n.isLeftGenerating||n.isRightGenerating,l=w.useCallback((S,T)=>{o(I=>({...I,mode:"system",systemConfig:{leftSystemPrompt:S,rightSystemPrompt:T,sharedUserInput:""},leftMessages:[],rightMessages:[]}))},[]),c=w.useCallback((S,T,I)=>{o(b=>({...b,mode:"user",userConfig:{sharedSystemPrompt:S,leftUserPrompt:T,rightUserPrompt:I},leftUserMessages:[],rightUserMessages:[]}))},[]),u=w.useCallback(async(S,T,I,b,h)=>{const v=b||t,C=h||r;if(!v||!C)throw new Error("AI");o(N=>({...N,...S==="left"?{isLeftGenerating:!0}:{isRightGenerating:!0}}));const A=`${S}-ai-${Date.now()}`,P={id:A,role:"assistant",content:"",timestamp:new Date,isStreaming:!0};n.mode==="system"?o(N=>({...N,...S==="left"?{leftMessages:[...N.leftMessages,P]}:{rightMessages:[...N.rightMessages,P]}})):o(N=>({...N,...S==="left"?{leftUserMessages:[...N.leftUserMessages,P]}:{rightUserMessages:[...N.rightUserMessages,P]}}));try{const N=[{role:"system",content:T},...I.filter(R=>R.id!==A).map(R=>({role:R.role,content:R.content}))];let z="";const L=R=>{z+=R,o(F=>{const D=O=>O.map(q=>q.id===A?{...q,content:z}:q);return n.mode==="system"?{...F,...S==="left"?{leftMessages:D(F.leftMessages)}:{rightMessages:D(F.rightMessages)}}:{...F,...S==="left"?{leftUserMessages:D(F.leftUserMessages)}:{rightUserMessages:D(F.rightUserMessages)}}})},G=await e.callAI(N,v,C.id,!0,L);o(R=>{const F=D=>D.map(O=>O.id===A?{...O,content:G,isStreaming:!1}:O);return n.mode==="system"?{...R,...S==="left"?{leftMessages:F(R.leftMessages)}:{rightMessages:F(R.rightMessages)}}:{...R,...S==="left"?{leftUserMessages:F(R.leftUserMessages)}:{rightUserMessages:F(R.rightUserMessages)}}})}catch(N){console.error(`${S} AI call failed:`,N),o(z=>{const L=G=>G.map(R=>R.id===A?{...R,content:` : ${N.message}`,isStreaming:!1}:R);return n.mode==="system"?{...z,...S==="left"?{leftMessages:L(z.leftMessages)}:{rightMessages:L(z.rightMessages)}}:{...z,...S==="left"?{leftUserMessages:L(z.leftUserMessages)}:{rightUserMessages:L(z.rightUserMessages)}}})}finally{o(N=>({...N,...S==="left"?{isLeftGenerating:!1}:{isRightGenerating:!1}}))}},[t,r,n.mode,e]),d=w.useCallback(async()=>{if(!n.systemConfig.sharedUserInput.trim()||i)return;const S=n.systemConfig.sharedUserInput.trim(),T=`user-${Date.now()}`,I={id:T,role:"user",content:S,timestamp:new Date};o(h=>({...h,systemConfig:{...h.systemConfig,sharedUserInput:""},leftMessages:[...h.leftMessages,{...I,id:`left-${T}`}],rightMessages:[...h.rightMessages,{...I,id:`right-${T}`}]}));const b={...n};b.leftMessages=[...n.leftMessages,{...I,id:`left-${T}`}],b.rightMessages=[...n.rightMessages,{...I,id:`right-${T}`}],await Promise.all([u("left",n.systemConfig.leftSystemPrompt,b.leftMessages),u("right",n.systemConfig.rightSystemPrompt,b.rightMessages)])},[n,i,u]),g=w.useCallback(async()=>{if(!n.userConfig.leftUserPrompt.trim()||n.isLeftGenerating)return;const S=n.userConfig.leftUserPrompt.trim(),I={id:`left-user-${Date.now()}`,role:"user",content:S,timestamp:new Date};o(h=>({...h,userConfig:{...h.userConfig,leftUserPrompt:""},leftUserMessages:[...h.leftUserMessages,I]}));const b={...n};b.leftUserMessages=[...n.leftUserMessages,I],await u("left",n.userConfig.sharedSystemPrompt,b.leftUserMessages)},[n,u]),x=w.useCallback(async()=>{if(!n.userConfig.rightUserPrompt.trim()||n.isRightGenerating)return;const S=n.userConfig.rightUserPrompt.trim(),I={id:`right-user-${Date.now()}`,role:"user",content:S,timestamp:new Date};o(h=>({...h,userConfig:{...h.userConfig,rightUserPrompt:""},rightUserMessages:[...h.rightUserMessages,I]}));const b={...n};b.rightUserMessages=[...n.rightUserMessages,I],await u("right",n.userConfig.sharedSystemPrompt,b.rightUserMessages)},[n,u]),y=w.useCallback(S=>{o(T=>T.mode==="system"?{...T,...S==="left"||!S?{leftMessages:[]}:{},...S==="right"||!S?{rightMessages:[]}:{}}:{...T,...S==="left"||!S?{leftUserMessages:[]}:{},...S==="right"||!S?{rightUserMessages:[]}:{}})},[]);return{state:n,isGenerating:i,initSystemComparison:l,initUserComparison:c,sendSystemMessage:d,sendLeftUserMessage:g,sendRightUserMessage:x,clearHistory:y,setState:o}}function mc({isOpen:e,modelValue:t,onUpdateModelValue:r,onClose:n,onSave:o}){return e?s.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",onClick:n,children:s.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-2xl w-full max-h-[80vh] flex flex-col",onClick:i=>i.stopPropagation(),children:[s.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-gray-200",children:[s.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:""}),s.jsx("button",{onClick:n,className:"text-gray-400 hover:text-gray-600 transition-colors",children:s.jsx(Er,{className:"w-5 h-5"})})]}),s.jsxs("div",{className:"flex-1 overflow-y-auto p-4",children:[s.jsx("p",{className:"text-sm text-gray-600 mb-3",children:"AI"}),s.jsx("textarea",{value:t,onChange:i=>r(i.target.value),className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent resize-none bg-white text-gray-900",rows:8,placeholder:""})]}),s.jsxs("div",{className:"flex items-center justify-end gap-3 p-4 border-t border-gray-200",children:[s.jsx("button",{onClick:n,className:"px-4 py-2 text-gray-700 hover:bg-gray-100 rounded-lg transition-colors",children:""}),s.jsx("button",{onClick:()=>{o(),n()},className:"px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg transition-colors",children:""})]})]})}):null}function fN(){const e=mN(),t=Be(Y=>Y.enabledProviders),r=Be(Y=>Y.getProviderById),n=Be(Y=>Y.getAvailableModelsByProvider),o=w.useRef(null),i=w.useRef(null),[l,c]=w.useState("user"),[u,d]=w.useState(""),[g,x]=w.useState(""),[y,S]=w.useState(""),[T,I]=w.useState(!1),[b,h]=w.useState(!1),[v,C]=w.useState(!1),[A,P]=w.useState(!1),[N,z]=w.useState(!1),[L,G]=w.useState(""),[R,F]=w.useState(""),[D,O]=w.useState(""),[q,Q]=w.useState(""),[oe,W]=w.useState(""),[U,te]=w.useState(""),ne=l==="system"?e.state.leftMessages:e.state.leftUserMessages,Ce=l==="system"?e.state.rightMessages:e.state.rightUserMessages,ze=e.isGenerating,Qe=e.state.isLeftGenerating,fe=e.state.isRightGenerating,He=w.useMemo(()=>D?n(D):[],[D,n]),ce=w.useMemo(()=>oe?n(oe):[],[oe,n]),V=w.useMemo(()=>{if(!D||!q)return"";const Y=r(D),mt=He.find(ke=>ke.id===q);return mt?`${Y==null?void 0:Y.name} - ${mt.name}`:""},[D,q,He,r]),K=w.useMemo(()=>{if(!oe||!U)return"";const Y=r(oe),mt=ce.find(ke=>ke.id===U);return mt?`${Y==null?void 0:Y.name} - ${mt.name}`:""},[oe,U,ce,r]);w.useEffect(()=>{try{const Y=localStorage.getItem("yprompt_comparison_model_config");if(Y){const mt=JSON.parse(Y);O(mt.leftProvider||""),Q(mt.leftModel||""),W(mt.rightProvider||""),te(mt.rightModel||"")}}catch(Y){console.error(":",Y)}try{const Y=localStorage.getItem("yprompt_comparison_data");if(Y){const mt=JSON.parse(Y);I(!0),mt.mode==="system"?(c("system"),e.initSystemComparison(mt.originalPrompt,mt.optimizedPrompt)):mt.mode==="user"&&(c("user"),e.initUserComparison(mt.systemPrompt||"",mt.originalPrompt,mt.optimizedPrompt),x(mt.originalPrompt),S(mt.optimizedPrompt))}}catch(Y){console.error(":",Y)}},[e]),w.useEffect(()=>{if(l==="system")G(e.state.systemConfig.leftSystemPrompt),F(e.state.systemConfig.rightSystemPrompt);else{const Y=e.state.userConfig.sharedSystemPrompt;G(Y),F(Y)}},[l,e.state.systemConfig.leftSystemPrompt,e.state.systemConfig.rightSystemPrompt,e.state.userConfig.sharedSystemPrompt]),w.useEffect(()=>{const Y={leftProvider:D,leftModel:q,rightProvider:oe,rightModel:U};localStorage.setItem("yprompt_comparison_model_config",JSON.stringify(Y))},[D,q,oe,U]);const xe=w.useCallback(Y=>{Y&&setTimeout(()=>{Y.scrollTop=Y.scrollHeight},0)},[]);w.useEffect(()=>{xe(o.current)},[ne,Qe,xe]),w.useEffect(()=>{xe(i.current)},[Ce,fe,xe]);const Le=w.useCallback(async()=>{u.trim()&&(e.setState(Y=>({...Y,systemConfig:{...Y.systemConfig,sharedUserInput:u}})),await e.sendSystemMessage(),d(""))},[u,e]),Je=w.useCallback(async()=>{g.trim()&&(e.setState(Y=>({...Y,userConfig:{...Y.userConfig,leftUserPrompt:g}})),await e.sendLeftUserMessage())},[g,e]),at=w.useCallback(async()=>{y.trim()&&(e.setState(Y=>({...Y,userConfig:{...Y.userConfig,rightUserPrompt:y}})),await e.sendRightUserMessage())},[y,e]),et=()=>{confirm("")&&e.clearHistory("left")},qr=()=>{confirm("")&&e.clearHistory("right")},ge=()=>{confirm("")&&(e.clearHistory("left"),e.clearHistory("right"),e.setState(Y=>({...Y,systemConfig:{leftSystemPrompt:"",rightSystemPrompt:"",sharedUserInput:""},userConfig:{sharedSystemPrompt:"",leftUserPrompt:"",rightUserPrompt:""}})),d(""),x(""),S(""),G(""),F(""),localStorage.removeItem("yprompt_comparison_data"),localStorage.removeItem("yprompt_trigger_compare"))},mr=()=>{localStorage.removeItem("yprompt_trigger_compare");const Y=l==="system"?"system":"user";localStorage.setItem("yprompt_optimize_active_mode",Y),localStorage.setItem("yprompt_back_to_optimize","true")},Jr=()=>{e.setState(Y=>l==="system"?{...Y,systemConfig:{...Y.systemConfig,leftSystemPrompt:L}}:{...Y,userConfig:{...Y.userConfig,sharedSystemPrompt:L}})},ko=()=>{e.setState(Y=>l==="system"?{...Y,systemConfig:{...Y.systemConfig,rightSystemPrompt:R}}:{...Y,userConfig:{...Y.userConfig,sharedSystemPrompt:R}})},Ze=Y=>{Y.key==="Enter"&&!Y.shiftKey&&(Y.preventDefault(),u.trim()&&!ze&&Le())},_t=Y=>{Y.key==="Enter"&&!Y.shiftKey&&(Y.preventDefault(),g.trim()&&!Qe&&Je())},Pi=Y=>{Y.key==="Enter"&&!Y.shiftKey&&(Y.preventDefault(),y.trim()&&!fe&&at())},So=Y=>{try{return it(Y)}catch(mt){return console.error("Markdown:",mt),Y}},Ls=Y=>{const mt=Y.role==="user";return s.jsx("div",{className:`flex group ${mt?"justify-end":"justify-start"}`,children:s.jsx("div",{className:"flex flex-col w-full max-w-xs lg:max-w-md",children:s.jsx("div",{className:`${mt?"bg-blue-500 text-white px-4 py-3 rounded-lg ml-auto":"bg-gray-100 text-gray-800 px-4 py-3 rounded-lg mr-auto"} transition-all duration-300 relative`,children:mt?s.jsxs("div",{className:"whitespace-pre-wrap",children:[Y.content,Y.isStreaming&&s.jsx("span",{className:"animate-pulse",children:""})]}):s.jsx("div",{className:"prose prose-sm max-w-none prose-headings:text-gray-800 prose-p:text-gray-800 prose-li:text-gray-800 prose-strong:text-gray-800",dangerouslySetInnerHTML:{__html:So(Y.content)}})})})},Y.id)};return s.jsxs("div",{className:"h-full min-h-0 overflow-hidden flex flex-col",children:[s.jsxs("div",{className:"flex-1 min-h-0 grid grid-cols-2 gap-4 mb-4",children:[s.jsxs("div",{className:"flex flex-col bg-white rounded-lg shadow-sm overflow-hidden",children:[s.jsx("div",{className:"p-4 border-b border-gray-200 flex-shrink-0",children:s.jsxs("div",{className:"flex justify-between items-center",children:[s.jsxs("div",{className:"flex items-center space-x-2",children:[s.jsx("h4",{className:"font-semibold text-gray-800",children:""}),s.jsx("button",{onClick:()=>h(!0),className:`flex items-center gap-1 px-2 py-1 hover:bg-gray-100 rounded transition-colors text-sm ${l==="system"?e.state.systemConfig.leftSystemPrompt.trim():e.state.userConfig.sharedSystemPrompt.trim()?"text-green-600":"text-gray-400"}`,title:"",children:s.jsx(Ma,{className:"w-4 h-4"})}),s.jsx("button",{onClick:()=>P(!A),className:`p-1 hover:bg-gray-100 rounded transition-colors ${q?"text-green-600":"text-gray-600"}`,title:V,children:s.jsx("svg",{className:"w-4 h-4 hover:text-gray-800",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M8 7h12m0 0l-4 4m4-4l-4-4m0 6H4m0 0l4 4m-4-4l4-4"})})})]}),s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsxs("button",{onClick:ge,className:"flex items-center gap-1 px-3 py-1 text-sm text-gray-600 hover:text-gray-800 hover:bg-gray-100 rounded transition-colors",title:"",children:[s.jsx(It,{className:"w-4 h-4"}),s.jsx("span",{children:""})]}),s.jsxs("button",{onClick:et,className:"flex items-center gap-1 px-3 py-1 text-sm text-gray-600 hover:text-red-600 hover:bg-red-50 rounded transition-colors",title:"",children:[s.jsx(It,{className:"w-4 h-4"}),s.jsx("span",{children:""})]})]})]})}),A&&s.jsx("div",{className:"px-4 pb-2 border-b border-gray-200 bg-gray-50",children:s.jsxs("div",{className:"py-2 space-y-2",children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx("label",{className:"text-sm font-medium text-gray-700",children:"AI"}),D&&s.jsx("button",{onClick:()=>{O(""),Q("")},className:"px-2 py-1 text-xs text-gray-600 hover:text-gray-800 hover:bg-gray-100 rounded transition-colors",title:"",children:""})]}),s.jsxs("div",{className:"flex flex-col gap-2",children:[s.jsxs("select",{value:D,onChange:Y=>{O(Y.target.value),Q("")},className:"w-full px-2 py-1.5 border border-gray-300 rounded text-sm focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[s.jsx("option",{value:"",children:""}),t.map(Y=>s.jsx("option",{value:Y.id,children:Y.name},Y.id))]}),s.jsxs("select",{value:q,onChange:Y=>Q(Y.target.value),disabled:!D,className:"w-full px-2 py-1.5 border border-gray-300 rounded text-sm focus:ring-2 focus:ring-blue-500 focus:border-transparent disabled:opacity-50 disabled:bg-gray-100",children:[s.jsx("option",{value:"",children:""}),He.map(Y=>s.jsx("option",{value:Y.id,children:Y.name},Y.id))]})]}),s.jsx("div",{className:"text-xs text-gray-500",children:D?q?s.jsxs("span",{children:[": ",V]}):s.jsx("span",{children:""}):s.jsx("span",{children:": "})})]})}),s.jsxs("div",{className:"flex-1 flex flex-col min-h-0",children:[s.jsx("div",{ref:o,className:"flex-1 overflow-y-auto p-4 space-y-4 min-h-0",children:ne.length===0?s.jsx("div",{className:"flex items-center justify-center h-full text-gray-400",children:s.jsxs("div",{className:"text-center",children:[s.jsx(ac,{className:"w-12 h-12 mx-auto mb-2 opacity-50"}),s.jsx("p",{className:"text-sm",children:""})]})}):ne.map(Ls)}),l==="user"&&s.jsx("div",{className:"p-3 border-t border-gray-200",children:s.jsxs("div",{className:"relative border border-gray-300 rounded-2xl focus-within:outline-none focus-within:border-gray-300 overflow-hidden",style:{height:"120px"},children:[s.jsx("div",{className:"absolute top-0 left-0 right-0",style:{bottom:"48px"},children:s.jsx("textarea",{value:g,onChange:Y=>x(Y.target.value),onKeyDown:_t,placeholder:"Shift+Enter",className:"w-full h-full px-2 pt-3 pb-1 border-0 outline-none resize-none disabled:opacity-50 text-base overflow-y-auto bg-transparent",disabled:Qe,rows:1})}),s.jsxs("div",{className:"absolute bottom-0 left-0 right-0 h-12 flex justify-between items-center px-2 bg-transparent pointer-events-none",children:[s.jsx("div",{className:"w-8 h-8"}),s.jsx("button",{onClick:Je,disabled:!g.trim()||Qe,className:"w-8 h-8 bg-blue-500 text-white rounded-full hover:bg-blue-600 disabled:opacity-50 disabled:cursor-not-allowed transition-colors flex items-center justify-center pointer-events-auto",children:s.jsx(di,{className:"w-4 h-4"})})]})]})})]})]}),s.jsxs("div",{className:"flex flex-col bg-white rounded-lg shadow-sm overflow-hidden",children:[s.jsx("div",{className:"p-4 border-b border-gray-200 flex-shrink-0",children:s.jsxs("div",{className:"flex justify-between items-center",children:[s.jsxs("div",{className:"flex items-center space-x-2",children:[s.jsx("h4",{className:"font-semibold text-gray-800",children:""}),s.jsx("button",{onClick:()=>C(!0),className:`flex items-center gap-1 px-2 py-1 hover:bg-gray-100 rounded transition-colors text-sm ${l==="system"?e.state.systemConfig.rightSystemPrompt.trim():e.state.userConfig.sharedSystemPrompt.trim()?"text-green-600":"text-gray-400"}`,title:"",children:s.jsx(Ma,{className:"w-4 h-4"})}),s.jsx("button",{onClick:()=>z(!N),className:`p-1 hover:bg-gray-100 rounded transition-colors ${U?"text-green-600":"text-gray-600"}`,title:K,children:s.jsx("svg",{className:"w-4 h-4 hover:text-gray-800",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M8 7h12m0 0l-4 4m4-4l-4-4m0 6H4m0 0l4 4m-4-4l4-4"})})})]}),s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsxs("button",{onClick:qr,className:"flex items-center gap-1 px-3 py-1 text-sm text-gray-600 hover:text-red-600 hover:bg-red-50 rounded transition-colors",title:"",children:[s.jsx(It,{className:"w-4 h-4"}),s.jsx("span",{children:""})]}),T&&s.jsxs("button",{onClick:mr,className:"flex items-center gap-1 px-3 py-1 text-sm bg-blue-500 text-white hover:bg-blue-600 rounded transition-colors",title:"",children:[s.jsx(CC,{className:"w-4 h-4"}),s.jsx("span",{children:""})]})]})]})}),N&&s.jsx("div",{className:"px-4 pb-2 border-b border-gray-200 bg-gray-50",children:s.jsxs("div",{className:"py-2 space-y-2",children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx("label",{className:"text-sm font-medium text-gray-700",children:"AI"}),oe&&s.jsx("button",{onClick:()=>{W(""),te("")},className:"px-2 py-1 text-xs text-gray-600 hover:text-gray-800 hover:bg-gray-100 rounded transition-colors",title:"",children:""})]}),s.jsxs("div",{className:"flex flex-col gap-2",children:[s.jsxs("select",{value:oe,onChange:Y=>{W(Y.target.value),te("")},className:"w-full px-2 py-1.5 border border-gray-300 rounded text-sm focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[s.jsx("option",{value:"",children:""}),t.map(Y=>s.jsx("option",{value:Y.id,children:Y.name},Y.id))]}),s.jsxs("select",{value:U,onChange:Y=>te(Y.target.value),disabled:!oe,className:"w-full px-2 py-1.5 border border-gray-300 rounded text-sm focus:ring-2 focus:ring-blue-500 focus:border-transparent disabled:opacity-50 disabled:bg-gray-100",children:[s.jsx("option",{value:"",children:""}),ce.map(Y=>s.jsx("option",{value:Y.id,children:Y.name},Y.id))]})]}),s.jsx("div",{className:"text-xs text-gray-500",children:oe?U?s.jsxs("span",{children:[": ",K]}):s.jsx("span",{children:""}):s.jsx("span",{children:": "})})]})}),s.jsxs("div",{className:"flex-1 flex flex-col min-h-0",children:[s.jsx("div",{ref:i,className:"flex-1 overflow-y-auto p-4 space-y-4 min-h-0",children:Ce.length===0?s.jsx("div",{className:"flex items-center justify-center h-full text-gray-400",children:s.jsxs("div",{className:"text-center",children:[s.jsx(ac,{className:"w-12 h-12 mx-auto mb-2 opacity-50"}),s.jsx("p",{className:"text-sm",children:""})]})}):Ce.map(Ls)}),l==="user"&&s.jsx("div",{className:"p-3 border-t border-gray-200",children:s.jsxs("div",{className:"relative border border-gray-300 rounded-2xl focus-within:outline-none focus-within:border-gray-300 overflow-hidden",style:{height:"120px"},children:[s.jsx("div",{className:"absolute top-0 left-0 right-0",style:{bottom:"48px"},children:s.jsx("textarea",{value:y,onChange:Y=>S(Y.target.value),onKeyDown:Pi,placeholder:"Shift+Enter",className:"w-full h-full px-2 pt-3 pb-1 border-0 outline-none resize-none disabled:opacity-50 text-base overflow-y-auto bg-transparent",disabled:fe,rows:1})}),s.jsxs("div",{className:"absolute bottom-0 left-0 right-0 h-12 flex justify-between items-center px-2 bg-transparent pointer-events-none",children:[s.jsx("div",{className:"w-8 h-8"}),s.jsx("button",{onClick:at,disabled:!y.trim()||fe,className:"w-8 h-8 bg-blue-500 text-white rounded-full hover:bg-blue-600 disabled:opacity-50 disabled:cursor-not-allowed transition-colors flex items-center justify-center pointer-events-auto",children:s.jsx(di,{className:"w-4 h-4"})})]})]})})]})]})]}),l==="system"&&s.jsx("div",{className:"flex-shrink-0",children:s.jsx("div",{className:"bg-white rounded-lg shadow-md border border-gray-200 p-3",children:s.jsxs("div",{className:"relative border border-gray-300 rounded-2xl focus-within:outline-none focus-within:border-gray-300 overflow-hidden",style:{height:"120px"},children:[s.jsx("div",{className:"absolute top-0 left-0 right-0",style:{bottom:"48px"},children:s.jsx("textarea",{value:u,onChange:Y=>d(Y.target.value),onKeyDown:Ze,placeholder:"Shift+Enter",className:"w-full h-full px-2 pt-3 pb-1 border-0 outline-none resize-none disabled:opacity-50 text-base overflow-y-auto bg-transparent",disabled:ze,rows:1})}),s.jsxs("div",{className:"absolute bottom-0 left-0 right-0 h-12 flex justify-between items-center px-2 bg-transparent pointer-events-none",children:[s.jsx("div",{className:"w-8 h-8"}),s.jsx("button",{onClick:Le,disabled:!u.trim()||ze,className:"w-8 h-8 bg-blue-500 text-white rounded-full hover:bg-blue-600 disabled:opacity-50 disabled:cursor-not-allowed transition-colors flex items-center justify-center pointer-events-auto",title:"",children:s.jsx(di,{className:"w-4 h-4"})})]})]})})}),b&&s.jsx(mc,{isOpen:b,modelValue:L,onUpdateModelValue:G,onClose:()=>h(!1),onSave:Jr}),v&&s.jsx(mc,{isOpen:v,modelValue:R,onUpdateModelValue:F,onClose:()=>C(!1),onSave:ko})]})}const Vu="user_prompt_optimize_result";function gN(){const e=Be(),t=yh(),r=Yt.getInstance(),n=w.useCallback(()=>{try{const P=localStorage.getItem(Vu);if(P){const N=JSON.parse(P);return N.metadata&&N.metadata.timestamp&&(N.metadata.timestamp=new Date(N.metadata.timestamp)),N}}catch(P){console.error(":",P)}return null},[]),o=w.useCallback(P=>{try{P?localStorage.setItem(Vu,JSON.stringify(P)):localStorage.removeItem(Vu)}catch(N){console.error(":",N)}},[]),[i,l]=w.useState(()=>({draftPrompt:"",systemPrompt:"",conversationHistory:"",result:n(),isOptimizing:!1,error:null,isAnalyzing:!1,analysisText:"",isOptimizingPrompt:!1,optimizedText:"",enableQualityAnalysis:!0,languageState:"zh",isConvertingLanguage:!1})),c=w.useMemo(()=>i.draftPrompt.trim().length>0,[i.draftPrompt]),u=w.useMemo(()=>i.result!==null,[i.result]),d=w.useMemo(()=>i.error!==null,[i.error]),g=w.useCallback(P=>/[\u4e00-\u9fa5]/.test(P)?"":"",[]),x=w.useCallback(P=>{l(N=>({...N,draftPrompt:P})),T()},[]),y=w.useCallback(P=>{l(N=>({...N,systemPrompt:P}))},[]),S=w.useCallback(P=>{l(N=>({...N,conversationHistory:P}))},[]),T=w.useCallback(()=>{l(P=>({...P,result:null,error:null,languageState:"zh"})),o(null)},[o]),I=w.useCallback(async()=>{var N,z,L,G,R,F,D,O,q,Q,oe;if(!i.draftPrompt.trim()){l(W=>({...W,error:""}));return}l(W=>({...W,isOptimizing:!0,error:null,analysisText:"",optimizedText:""}));const P=performance.now();try{const W=g(i.draftPrompt),U=e.currentProvider,te=e.currentModel;if(!U||!te)throw new Error("AI");const ne=i.conversationHistory?`
****
${i.conversationHistory}
`:"",ze=`

****
${i.systemPrompt?`
**AI**
${i.systemPrompt}
`:""}${ne}
**  **
- ******AI**
- ****AIAI
- AIAI

****
-  ****AI""""
-  AI****
-  "AI"AI
-  AI

****
1. ** (clarity)**: 
2. ** (specificity)**: 
3. ** (structure)**: 
4. ** (context)**: 
5. ** (completeness)**: 

****
- 90-100: 
- 70-89: 
- 50-69: 
- <50: 

**JSON**
\`\`\`json
{
  "overall_score": 75,
  "analysis": {
    "clarity": {
      "score": 80,
      "feedback": ""
    },
    "specificity": {
      "score": 60,
      "feedback": ""
    },
    "structure": {
      "score": 70,
      "feedback": ""
    },
    "context": {
      "score": 50,
      "feedback": ""
    },
    "completeness": {
      "score": 65,
      "feedback": ""
    }
  },
  "issues": [
    "",
    "",
    ""
  ]
}
\`\`\`

****
${i.draftPrompt}

**JSON**`,Qe=kt.getUserPromptQuickOptimization(),fe=kt.getUserPromptRules(),He=Qe.replace("{SYSTEM_PROMPT_RULES}",fe).replace("{SYSTEM_PROMPT_CONTEXT}",i.systemPrompt||"").replace("{CONVERSATION_HISTORY}",i.conversationHistory||"").replace("{USER_DRAFT_PROMPT}",i.draftPrompt).replace("{VARIABLES_SECTION}","").replace("{LANGUAGE}",W),ce=[{role:"system",content:ze},{role:"user",content:""}],V=[{role:"system",content:He},{role:"user",content:""}];let K=null;if(i.enableQualityAnalysis){console.log(" "),l(mr=>({...mr,isAnalyzing:!0}));let et="";r.setStreamUpdateCallback(mr=>{et+=mr,l(Jr=>({...Jr,analysisText:et}))});const qr=await r.callAI(ce,U,te.id,!0);if(r.clearStreamUpdateCallback(),l(mr=>({...mr,isAnalyzing:!1})),K=Yx(qr),!K)throw new Error("");console.log(" ");const ge=`

****
- ${K.overall_score}/100
- ${(N=K.analysis.clarity)==null?void 0:N.score}/100 - ${(z=K.analysis.clarity)==null?void 0:z.feedback}
- ${(L=K.analysis.specificity)==null?void 0:L.score}/100 - ${(G=K.analysis.specificity)==null?void 0:G.feedback}
- ${(R=K.analysis.structure)==null?void 0:R.score}/100 - ${(F=K.analysis.structure)==null?void 0:F.feedback}
- ${(D=K.analysis.context)==null?void 0:D.score}/100 - ${(O=K.analysis.context)==null?void 0:O.feedback}
- ${(q=K.analysis.completeness)==null?void 0:q.score}/100 - ${(Q=K.analysis.completeness)==null?void 0:Q.feedback}
${K.issues&&K.issues.length>0?`
****
${K.issues.map((mr,Jr)=>`${Jr+1}. ${mr}`).join(`
`)}`:""}

`;V[0].content+=ge}else console.log(" ");l(et=>({...et,isOptimizingPrompt:!0}));let xe="";r.setStreamUpdateCallback(et=>{xe+=et,l(qr=>({...qr,optimizedText:xe}))});const Le=await r.callAI(V,U,te.id,!0);r.clearStreamUpdateCallback(),l(et=>({...et,isOptimizingPrompt:!1})),console.log(" ");const Je=performance.now()-P,at={originalPrompt:i.draftPrompt,qualityAnalysis:K||{overall_score:0,analysis:{},issues:[]},optimizedPrompt:Le.trim(),metadata:{processingTime:Je,modelUsed:((oe=e.currentModel)==null?void 0:oe.id)||"unknown",timestamp:new Date}};l(et=>({...et,result:at,languageState:"zh"})),o(at),console.log(` : ${Je.toFixed(0)}ms`)}catch(W){console.error(":",W),l(U=>({...U,error:W.message||"",result:null,isAnalyzing:!1,isOptimizingPrompt:!1})),o(null)}finally{l(W=>({...W,isOptimizing:!1}))}},[i,e,r,g,o]),b=w.useCallback(async()=>{var N,z,L,G,R,F,D,O,q,Q,oe;if(!i.result){l(W=>({...W,error:""}));return}l(W=>({...W,isOptimizing:!0,error:null,optimizedText:""}));const P=performance.now();try{const W=g(i.draftPrompt),U=e.currentProvider,te=e.currentModel;if(!U||!te)throw new Error("AI");const ne=kt.getUserPromptQuickOptimization(),Ce=kt.getUserPromptRules(),Qe=[{role:"system",content:ne.replace("{SYSTEM_PROMPT_RULES}",Ce).replace("{SYSTEM_PROMPT_CONTEXT}",i.systemPrompt||"").replace("{CONVERSATION_HISTORY}",i.conversationHistory||"").replace("{USER_DRAFT_PROMPT}",i.draftPrompt).replace("{VARIABLES_SECTION}","").replace("{LANGUAGE}",W)},{role:"user",content:""}];if(i.enableQualityAnalysis&&i.result.qualityAnalysis&&i.result.qualityAnalysis.overall_score>0){const K=i.result.qualityAnalysis,xe=`

****
- ${K.overall_score}/100
- ${(N=K.analysis.clarity)==null?void 0:N.score}/100 - ${(z=K.analysis.clarity)==null?void 0:z.feedback}
- ${(L=K.analysis.specificity)==null?void 0:L.score}/100 - ${(G=K.analysis.specificity)==null?void 0:G.feedback}
- ${(R=K.analysis.structure)==null?void 0:R.score}/100 - ${(F=K.analysis.structure)==null?void 0:F.feedback}
- ${(D=K.analysis.context)==null?void 0:D.score}/100 - ${(O=K.analysis.context)==null?void 0:O.feedback}
- ${(q=K.analysis.completeness)==null?void 0:q.score}/100 - ${(Q=K.analysis.completeness)==null?void 0:Q.feedback}
${K.issues&&K.issues.length>0?`
****
${K.issues.map((Le,Je)=>`${Je+1}. ${Le}`).join(`
`)}`:""}

`;Qe[0].content+=xe}l(K=>({...K,isOptimizingPrompt:!0}));let fe="";r.setStreamUpdateCallback(K=>{fe+=K,l(xe=>({...xe,optimizedText:fe}))});const He=await r.callAI(Qe,U,te.id,!0);r.clearStreamUpdateCallback(),l(K=>({...K,isOptimizingPrompt:!1})),console.log(" ");const ce=performance.now()-P,V={...i.result,optimizedPrompt:He.trim(),metadata:{processingTime:ce,modelUsed:((oe=e.currentModel)==null?void 0:oe.id)||"unknown",timestamp:new Date}};l(K=>({...K,result:V,languageState:"zh"})),o(V),console.log(` : ${ce.toFixed(0)}ms`)}catch(W){console.error(":",W),l(U=>({...U,error:W.message||"",isOptimizingPrompt:!1}))}finally{l(W=>({...W,isOptimizing:!1}))}},[i,e,r,g,o]),h=w.useCallback(async()=>{if(!i.result||i.isConvertingLanguage)return;const P=typeof i.result.optimizedPrompt=="string"?i.result.optimizedPrompt:i.languageState==="zh"?i.result.optimizedPrompt.zh:i.result.optimizedPrompt.en;if(!P)return;const N=i.languageState==="zh"?"en":"zh";if(typeof i.result.optimizedPrompt!="string"&&(N==="zh"?i.result.optimizedPrompt.zh:i.result.optimizedPrompt.en)){l(L=>({...L,languageState:N})),o(i.result),console.log(` ${N==="zh"?"":""}`);return}l(z=>({...z,isConvertingLanguage:!0}));try{const z=e.currentProvider,L=e.currentModel;if(!z||!L)throw new Error("AI");const G=N==="zh"?"":"",F=[{role:"system",content:`AI${G}

****
1. **** Markdown  #-  XML 
2. ****
3. ****
4. ****
5. ****
6. ****`},{role:"user",content:`AI${G}

${P}`}],D=await r.callAI(F,z,L.id,!1);if(D&&D.trim()){const O=D.trim();let q;if(typeof i.result.optimizedPrompt=="string"){const Q=i.result.optimizedPrompt;q={...i.result,optimizedPrompt:{zh:i.languageState==="zh"?Q:O,en:i.languageState==="en"?Q:O}}}else q={...i.result,optimizedPrompt:{...i.result.optimizedPrompt,[N]:O}};l(Q=>({...Q,result:q,languageState:N,isConvertingLanguage:!1})),o(q),console.log(` ${G}`)}else throw new Error("")}catch(z){throw console.error(":",z),l(L=>({...L,isConvertingLanguage:!1})),z}},[i,e,r,o]),v=w.useCallback(async P=>{try{const{copyToClipboard:N}=await zt(async()=>{const{copyToClipboard:z}=await Promise.resolve().then(()=>Fj);return{copyToClipboard:z}},void 0);return await N(P),!0}catch(N){return console.error(":",N),!1}},[]),C=w.useCallback(async P=>{if(!i.result)throw new Error("");try{const N=typeof i.result.optimizedPrompt=="string"?i.result.optimizedPrompt:i.result.optimizedPrompt.zh||i.result.optimizedPrompt.en;let z="";if(P.conversationHistory.trim())try{const F=JSON.parse(P.conversationHistory);z=JSON.stringify(F)}catch{throw new Error("JSON")}const L=t.loadedPromptId;console.log(" :",{promptId:L,isUpdate:!!L,title:P.title});const G={...L?{id:L}:{},title:P.title,description:P.description,final_prompt:N,language:"zh",format:"markdown",prompt_type:"user",tags:P.tags,is_public:P.isPublic?1:0,system_prompt:P.systemPrompt,conversation_history:z,create_version:!0,change_type:"patch",change_summary:P.description||"",change_log:"",version_tag:"stable"},R=await wo("/api/prompts/",G);if(R.code!==200)throw new Error(R.message||"");return console.log(" :",{id:R.data.id,isNew:R.data.is_new,version:R.data.version,message:R.data.message}),R.data.is_new&&(t.setLoadedPromptId(R.data.id),console.log(" ,loadedPromptId:",R.data.id)),{success:!0,id:R.data.id,version:R.data.version,message:R.data.message}}catch(N){throw console.error(" :",N),N}},[i.result,t]),A=w.useCallback(()=>{l({draftPrompt:"",systemPrompt:"",conversationHistory:"",result:null,error:null,isOptimizing:!1,isAnalyzing:!1,analysisText:"",isOptimizingPrompt:!1,optimizedText:"",enableQualityAnalysis:!0,languageState:"zh",isConvertingLanguage:!1})},[]);return{state:i,hasInput:c,hasResult:u,hasError:d,quickOptimize:I,regenerateOptimization:b,copyToClipboard:v,saveToLibrary:C,reset:A,clearResult:T,setDraftPrompt:x,setSystemPrompt:y,setConversationHistory:S,toggleLanguage:h,setEnableQualityAnalysis:P=>{l(N=>({...N,enableQualityAnalysis:P}))}}}function yN(){const[e,t]=w.useState([]),r=w.useCallback((x="user")=>{const y={id:`msg-${Date.now()}-${Math.random()}`,role:x,content:"",isEditing:!1};t(S=>[...S,y])},[]),n=w.useCallback(x=>{t(y=>y.filter(S=>S.id!==x))},[]),o=w.useCallback((x,y)=>{t(S=>S.map(T=>T.id===x?{...T,content:y}:T))},[]),i=w.useCallback((x,y)=>{t(S=>S.map(T=>T.id===x?{...T,role:y}:T))},[]),l=w.useCallback(x=>{t(y=>y.map(S=>({...S,isEditing:S.id===x})))},[]),c=w.useCallback(x=>{t(y=>y.map(S=>S.id===x?{...S,isEditing:!1}:S))},[]),u=w.useCallback(()=>e.length===0?"":e.filter(x=>x.content.trim()).map(x=>`${x.role==="ai"?"AI":""}: ${x.content}`).join(`

`),[e]),d=w.useCallback(()=>{t([])},[]),g=w.useCallback(x=>{t(x)},[]);return{messages:e,addMessage:r,removeMessage:n,updateMessage:o,updateMessageRole:i,startEdit:l,cancelEdit:c,formatForAI:u,reset:d,setMessagesState:g}}const Ku="user_prompt_optimize_data";function xN({draftPrompt:e,systemPrompt:t,conversationHistory:r,isOptimizing:n,onUpdateDraftPrompt:o,onUpdateSystemPrompt:i,onUpdateConversationHistory:l,onOptimize:c,onRestart:u}){const d=yN(),[g,x]=w.useState(!1),[y,S]=w.useState(t),[T,I]=w.useState("user"),[b,h]=w.useState(""),v=w.useRef(!1),C=()=>{if(r.trim())try{const O=JSON.parse(r);if(Array.isArray(O)){const q=O.map((Q,oe)=>({id:`msg-${Date.now()}-${oe}`,role:Q.role==="assistant"?"ai":"user",content:Q.content,isEditing:!1}));e.trim()&&q.push({id:`msg-${Date.now()}-draft`,role:"user",content:e,isEditing:!1}),d.setMessagesState(q)}}catch(O){console.error("JSON:",O)}else if(e.trim()){d.addMessage("user");const O=d.messages[d.messages.length-1];d.updateMessage(O.id,e)}};w.useEffect(()=>{if(!localStorage.getItem("yprompt_optimize_loaded_user_prompt"))try{const q=localStorage.getItem(Ku);if(q){const Q=JSON.parse(q);Q.messages&&d.setMessagesState(Q.messages),Q.systemPrompt&&(S(Q.systemPrompt),i(Q.systemPrompt))}}catch(q){console.error(":",q)}},[]),w.useEffect(()=>{v.current||C()},[r,e]);const A=()=>{try{const O={messages:d.messages,systemPrompt:y};localStorage.setItem(Ku,JSON.stringify(O))}catch(O){console.error(":",O)}};w.useEffect(()=>{S(t)},[t]),w.useEffect(()=>{if(v.current=!0,d.messages.length>1){const q=d.messages.slice(0,-1).filter(Q=>Q.content.trim()).map(Q=>({role:Q.role==="ai"?"assistant":"user",content:Q.content}));l(JSON.stringify(q,null,2))}else l("");if(d.messages.length>0){const O=d.messages[d.messages.length-1];o(O.content)}else o("");A(),setTimeout(()=>{v.current=!1},0)},[d.messages]);const P=()=>{if(!b.trim())return;const O=T;d.addMessage(O);const q=d.messages[d.messages.length-1];d.updateMessage(q.id,b),h("")},N=O=>{O.key==="Enter"&&O.shiftKey||O.key==="Enter"&&!O.shiftKey&&(O.preventDefault(),P())},z=(O,q)=>{O.key==="Enter"&&O.shiftKey||(O.key==="Enter"&&!O.shiftKey&&(O.preventDefault(),d.cancelEdit(q),A()),O.key==="Escape"&&d.cancelEdit(q))},L=()=>{d.messages.length===0||n||c()},G=()=>{confirm("")&&(d.reset(),h(""),S(""),o(""),i(""),l(""),u(),localStorage.removeItem(Ku))},R=()=>{i(y),A()},F=async O=>{try{await Hn(O)}catch(q){console.error(":",q)}},D=O=>O<=20?"":O<=100?"":O<=300?"":"";return s.jsxs(s.Fragment,{children:[s.jsxs("div",{className:"h-full flex flex-col bg-white rounded-lg shadow-sm border border-gray-200",children:[s.jsx("div",{className:"p-4 border-b border-gray-200 flex-shrink-0",children:s.jsxs("div",{className:"flex justify-between items-center",children:[s.jsx("h4",{className:"font-semibold text-gray-800",children:""}),s.jsxs("div",{className:"flex items-center space-x-3",children:[s.jsxs("button",{onClick:()=>x(!0),className:`flex items-center gap-1 px-2 py-1 hover:bg-gray-100 rounded transition-colors text-sm ${y.trim()?"text-green-600":"text-gray-400"}`,title:y.trim()?"":"",children:[s.jsx(Ma,{className:"w-4 h-4"}),s.jsx("span",{children:y.trim()?"":""})]}),s.jsxs("button",{onClick:G,className:"flex items-center gap-1 px-3 py-1 text-sm text-gray-600 hover:text-red-600 hover:bg-red-50 rounded transition-colors",title:"",children:[s.jsx(It,{className:"w-4 h-4"}),s.jsx("span",{children:""})]})]})]})}),s.jsxs("div",{className:"flex-1 overflow-y-auto p-4 space-y-4 min-h-0",children:[d.messages.map(O=>s.jsx("div",{className:`flex group ${O.role==="user"?"justify-end":"justify-start"}`,children:s.jsx("div",{className:`flex flex-col w-full ${O.isEditing?"max-w-full sm:max-w-2xl":"max-w-xs lg:max-w-md"}`,children:s.jsxs("div",{className:`flex gap-2 ${O.role==="user"?"flex-row-reverse":"flex-row"} ${O.isEditing?"items-start":""}`,children:[!O.isEditing&&s.jsx("div",{className:"flex-shrink-0",children:s.jsx("div",{className:`w-8 h-8 rounded-full flex items-center justify-center text-sm ${O.role==="user"?"bg-blue-100 text-blue-700":"bg-gray-200 text-gray-700"}`,children:O.role==="user"?"":""})}),s.jsxs("div",{className:"flex flex-col w-full",children:[O.isEditing?s.jsx("div",{className:"relative",children:s.jsx("div",{className:"relative border border-blue-300 rounded-2xl overflow-hidden bg-white",children:s.jsx("textarea",{value:O.content,onChange:q=>d.updateMessage(O.id,q.target.value),onKeyDown:q=>z(q,O.id),className:"w-full p-4 border-0 resize-none focus:outline-none text-gray-800 bg-white min-h-[80px] max-h-[200px] overflow-y-auto text-base",placeholder:"..."})})}):s.jsx("div",{className:`rounded-lg px-4 py-3 transition-all duration-300 ${O.role==="user"?"bg-blue-500 text-white ml-auto":"bg-gray-100 text-gray-800 mr-auto"}`,children:O.content?s.jsx("div",{className:"text-sm whitespace-pre-wrap break-words",children:O.content}):s.jsx("div",{className:"text-sm opacity-50",children:O.role==="ai"?"AI...":"..."})}),s.jsx("div",{className:`flex space-x-1 mt-2 transition-opacity duration-200 ${O.isEditing?"opacity-100 justify-end":`opacity-0 group-hover:opacity-100 ${O.role==="user"?"justify-end":"justify-start"}`}`,children:O.isEditing?s.jsxs(s.Fragment,{children:[s.jsx("button",{onClick:()=>{d.cancelEdit(O.id),A()},className:"p-1.5 text-gray-500 hover:text-red-600 transition-colors rounded-lg hover:bg-gray-100",title:"",children:s.jsx(Er,{className:"w-3.5 h-3.5"})}),s.jsx("button",{onClick:()=>{d.cancelEdit(O.id),A()},className:"p-1.5 text-gray-500 hover:text-blue-600 transition-colors rounded-lg hover:bg-gray-100",title:"",children:s.jsx(zs,{className:"w-3.5 h-3.5"})})]}):s.jsxs(s.Fragment,{children:[s.jsx("button",{onClick:()=>{d.startEdit(O.id)},className:"p-1.5 text-gray-500 hover:text-green-600 transition-colors rounded-lg hover:bg-gray-100",title:"",children:s.jsx(Tx,{className:"w-3.5 h-3.5"})}),s.jsx("button",{onClick:()=>{d.updateMessageRole(O.id,O.role==="user"?"ai":"user"),A()},className:"p-1.5 text-gray-500 hover:text-blue-600 transition-colors rounded-lg hover:bg-gray-100",title:O.role==="user"?"AI":"",children:s.jsx(wx,{className:"w-3.5 h-3.5"})}),s.jsx("button",{onClick:()=>{d.removeMessage(O.id),A()},className:"p-1.5 text-gray-500 hover:text-red-600 transition-colors rounded-lg hover:bg-gray-100",title:"",children:s.jsx(Nx,{className:"w-3.5 h-3.5"})}),s.jsx("button",{onClick:()=>F(O.content),className:"p-1.5 text-gray-500 hover:text-blue-600 transition-colors rounded-lg hover:bg-gray-100",title:"",children:s.jsx(wr,{className:"w-3.5 h-3.5"})})]})})]})]})})},O.id)),d.messages.length===0&&s.jsx("div",{className:"flex items-center justify-center h-full text-center py-12",children:s.jsxs("div",{children:[s.jsx(ac,{className:"w-12 h-12 mx-auto mb-3 text-gray-300"}),s.jsx("p",{className:"text-sm text-gray-500 mb-1",children:""}),s.jsx("p",{className:"text-xs text-gray-400",children:""})]})})]}),s.jsxs("div",{className:"p-3 border-t border-gray-200 bg-white flex-shrink-0 rounded-b-lg",children:[s.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[s.jsxs("select",{value:T,onChange:O=>I(O.target.value),className:"text-xs px-2 py-1 border border-gray-300 rounded bg-white text-gray-700 focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[s.jsx("option",{value:"user",children:" "}),s.jsx("option",{value:"ai",children:" AI"})]}),s.jsx("span",{className:"text-xs text-gray-500",children:T==="user"?"":"AI"})]}),s.jsxs("div",{className:"relative border border-gray-300 rounded-2xl focus-within:outline-none focus-within:border-gray-300 overflow-hidden",style:{height:"120px"},children:[s.jsx("div",{className:"absolute top-0 left-0 right-0",style:{bottom:"48px"},children:s.jsx("textarea",{value:b,onChange:O=>h(O.target.value),onKeyDown:N,placeholder:" (Shift+Enter)",className:"w-full h-full px-4 pt-3 pb-1 border-0 outline-none resize-none text-base overflow-y-auto bg-transparent text-gray-800",rows:1})}),s.jsxs("div",{className:"absolute bottom-0 left-0 right-0 h-12 flex justify-between items-center px-2 bg-transparent",children:[s.jsxs("div",{className:"text-xs text-gray-500 ml-2",children:[b.length," ",b.length>0&&s.jsxs("span",{className:"ml-2 text-blue-600",children:[" ",D(b.length)]})]}),s.jsxs("div",{className:"flex gap-2",children:[s.jsx("button",{onClick:P,disabled:!b.trim(),className:"w-8 h-8 bg-blue-500 text-white rounded-full hover:bg-blue-600 disabled:opacity-50 disabled:cursor-not-allowed transition-colors flex items-center justify-center",title:"",children:s.jsx(di,{className:"w-4 h-4"})}),s.jsx("button",{onClick:L,disabled:d.messages.length===0||n,className:"px-4 py-1.5 bg-green-600 hover:bg-green-700 disabled:bg-gray-300 text-white text-sm rounded-full transition-colors disabled:cursor-not-allowed",title:"",children:n?"...":""})]})]})]})]})]}),g&&s.jsx(mc,{isOpen:g,modelValue:y,onUpdateModelValue:S,onClose:()=>x(!1),onSave:R})]})}const vN=`[
  {
    "role": "user",
    "content": ""
  },
  {
    "role": "assistant",
    "content": ""
  },
  {
    "role": "user",
    "content": ""
  }
]`;function wN({isOpen:e,promptContent:t,systemPrompt:r="",conversationHistory:n="",isSaving:o,onSave:i,onCancel:l}){const[c,u]=w.useState({title:"",description:"",systemPrompt:"",conversationHistory:"",tags:["",""],isPublic:!1}),[d,g]=w.useState(""),[x,y]=w.useState(!1),[S,T]=w.useState(""),I=P=>{if(!P.trim())return"";try{const N=JSON.parse(P);if(!Array.isArray(N))return"";for(let z=0;z<N.length;z++){const L=N[z];if(!L.role||!L.content)return`${z+1}rolecontent`;if(!["user","assistant","system"].includes(L.role))return`${z+1}roleuserassistantsystem`}return""}catch(N){return N.message||"JSON"}};w.useEffect(()=>{if(e){const P=t.substring(0,50);u({title:` - ${P}${t.length>50?"...":""}`,description:"",systemPrompt:r||"",conversationHistory:n||"",tags:["",""],isPublic:!1}),T(""),y(!1),g("")}},[e,t,r,n]),w.useEffect(()=>{T(I(c.conversationHistory))},[c.conversationHistory]);const b=()=>{try{const P=JSON.parse(c.conversationHistory);u(N=>({...N,conversationHistory:JSON.stringify(P,null,2)})),T("")}catch{T("JSON")}},h=c.title.trim()&&t&&!S,v=()=>{const P=d.trim();P&&!c.tags.includes(P)&&c.tags.length<10&&(u(N=>({...N,tags:[...N.tags,P]})),g(""))},C=P=>{u(N=>({...N,tags:N.tags.filter(z=>z!==P)}))},A=()=>{h&&i({title:c.title.trim(),description:c.description.trim(),tags:c.tags,isPublic:c.isPublic,systemPrompt:c.systemPrompt.trim(),conversationHistory:c.conversationHistory.trim()})};return e?s.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50",children:s.jsxs("div",{className:"bg-white rounded-lg shadow-xl w-full max-w-2xl mx-4 max-h-[90vh] overflow-y-auto",onClick:P=>P.stopPropagation(),children:[s.jsxs("div",{className:"flex items-center justify-between p-6 border-b",children:[s.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:""}),s.jsx("button",{onClick:l,className:"text-gray-400 hover:text-gray-600",children:s.jsx(Er,{className:"w-6 h-6"})})]}),s.jsxs("div",{className:"p-6 space-y-4",children:[s.jsxs("div",{children:[s.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[" ",s.jsx("span",{className:"text-red-500",children:"*"})]}),s.jsx("input",{value:c.title,onChange:P=>u(N=>({...N,title:P.target.value})),type:"text",placeholder:"",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",maxLength:200}),s.jsxs("p",{className:"mt-1 text-xs text-gray-500",children:[c.title.length,"/200"]})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:""}),s.jsx("textarea",{value:c.description,onChange:P=>u(N=>({...N,description:P.target.value})),placeholder:"",rows:3,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent resize-none",maxLength:500}),s.jsxs("p",{className:"mt-1 text-xs text-gray-500",children:[c.description.length,"/500"]})]}),s.jsxs("div",{children:[s.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2 flex items-center gap-2",children:[s.jsx("span",{children:"AI"}),c.systemPrompt.trim()?s.jsxs("span",{className:"flex items-center gap-1 text-green-600 text-xs",children:[s.jsx("svg",{className:"w-4 h-4",fill:"currentColor",viewBox:"0 0 20 20",children:s.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z",clipRule:"evenodd"})}),""]}):s.jsxs("span",{className:"flex items-center gap-1 text-gray-400 text-xs",children:[s.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),""]})]}),s.jsx("textarea",{value:c.systemPrompt,onChange:P=>u(N=>({...N,systemPrompt:P.target.value})),placeholder:"AI",rows:4,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent resize-none font-mono text-sm",maxLength:5e3}),s.jsxs("p",{className:"mt-1 text-xs text-gray-500",children:[c.systemPrompt.length,"/5000 "]})]}),s.jsxs("div",{children:[s.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["",s.jsx("span",{className:"text-xs text-gray-500 ml-2",children:"(JSON)"})]}),s.jsx("textarea",{value:c.conversationHistory,onChange:P=>u(N=>({...N,conversationHistory:P.target.value})),placeholder:'[{"role":"user","content":"..."},{"role":"assistant","content":"..."}]',rows:6,className:`w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent resize-none font-mono text-xs ${S?"border-red-500":"border-gray-300"}`}),S?s.jsxs("p",{className:"mt-1 text-xs text-red-600",children:[" JSON",S]}):s.jsxs("p",{className:"mt-1 text-xs text-gray-500",children:[c.conversationHistory.length,"/10000 ",c.conversationHistory&&s.jsxs(s.Fragment,{children:[s.jsx("button",{onClick:b,className:"ml-2 text-blue-600 hover:text-blue-700 underline",children:""}),s.jsxs("button",{onClick:()=>y(!x),className:"ml-2 text-blue-600 hover:text-blue-700 underline",children:[x?"":"",""]})]})]}),x&&s.jsxs("div",{className:"mt-2 p-3 bg-blue-50 border border-blue-200 rounded text-xs",children:[s.jsx("p",{className:"font-semibold mb-1",children:""}),s.jsx("pre",{className:"bg-white p-2 rounded overflow-x-auto",children:vN})]})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:""}),s.jsx("div",{className:"flex flex-wrap gap-2 mb-2",children:c.tags.map(P=>s.jsxs("span",{className:"inline-flex items-center px-3 py-1 bg-blue-100 text-blue-700 rounded-full text-sm",children:[P,s.jsx("button",{onClick:()=>C(P),className:"ml-2 text-blue-500 hover:text-blue-700",children:""})]},P))}),s.jsxs("div",{className:"flex gap-2",children:[s.jsx("input",{value:d,onChange:P=>g(P.target.value),onKeyUp:P=>{P.key==="Enter"&&v()},type:"text",placeholder:"",className:"flex-1 px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"}),s.jsx("button",{onClick:v,className:"px-4 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200",children:""})]})]}),s.jsxs("div",{className:"flex items-center",children:[s.jsx("input",{type:"checkbox",checked:c.isPublic,onChange:P=>u(N=>({...N,isPublic:P.target.checked})),id:"isPublic",className:"w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500"}),s.jsx("label",{htmlFor:"isPublic",className:"ml-2 text-sm text-gray-700",children:""})]}),s.jsxs("div",{children:[s.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[" ",s.jsx("span",{className:"text-red-500",children:"*"})]}),s.jsxs("div",{className:"p-3 bg-gray-50 border border-gray-200 rounded-lg max-h-40 overflow-y-auto text-sm text-gray-600 font-mono",children:[t.slice(0,200),t.length>200?"...":""]}),s.jsxs("p",{className:"mt-1 text-xs text-gray-500",children:[" ",t.length," "]})]})]}),s.jsxs("div",{className:"flex justify-end gap-3 p-6 border-t bg-gray-50",children:[s.jsx("button",{onClick:l,className:"px-4 py-2 text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50",children:""}),s.jsx("button",{onClick:A,disabled:!h||o,className:"px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 disabled:opacity-50 disabled:cursor-not-allowed flex items-center",children:o?s.jsxs("span",{className:"flex items-center",children:[s.jsxs("svg",{className:"w-4 h-4 mr-2 animate-spin",fill:"none",viewBox:"0 0 24 24",children:[s.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),s.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"..."]}):s.jsx("span",{children:""})})]})]})}):null}const qo="yprompt_user_optimize_active_tab";function bN(){const e=gN(),t=gt(),[r,n]=w.useState("analysis"),[o,i]=w.useState(!1),[l,c]=w.useState(!1),[u,d]=w.useState(""),[g,x]=w.useState(!1);w.useEffect(()=>{try{const R=localStorage.getItem(qo);R&&["analysis","result"].includes(R)&&n(R)}catch(R){console.error("activeTab:",R)}},[]);const y=w.useMemo(()=>!e.state.isOptimizing&&!e.hasResult?0:e.state.enableQualityAnalysis?e.state.isAnalyzing?1:!e.state.isAnalyzing&&(e.state.isOptimizingPrompt||e.hasResult)?2:0:e.state.isOptimizingPrompt||e.hasResult?2:0,[e.state.isOptimizing,e.hasResult,e.state.enableQualityAnalysis,e.state.isAnalyzing,e.state.isOptimizingPrompt]),S=async()=>{const R=e.state.enableQualityAnalysis?"analysis":"result";n(R),localStorage.setItem(qo,R),await e.quickOptimize()},T=async()=>{n("result"),localStorage.setItem(qo,"result"),await e.regenerateOptimization()},I=async R=>{await e.copyToClipboard(R)?(i(!0),t.success(""),setTimeout(()=>i(!1),2e3)):t.error("")},b=()=>{x(!0)},h=async R=>{c(!0);try{const F=await e.saveToLibrary(R);typeof F=="object"&&F.version?t.success(` ${F.version}`):t.success(""),x(!1)}catch(F){t.error(F.message||"")}finally{c(!1)}},v=()=>{x(!1)};w.useEffect(()=>{!e.state.isAnalyzing&&e.state.isOptimizingPrompt&&r==="analysis"&&setTimeout(()=>{n("result"),localStorage.setItem(qo,"result")},300)},[e.state.isAnalyzing,e.state.isOptimizingPrompt,r]),w.useEffect(()=>{try{localStorage.setItem(qo,r)}catch(R){console.error("activeTab:",R)}},[r]);const C=w.useMemo(()=>{var R;return(R=e.state.result)!=null&&R.optimizedPrompt?typeof e.state.result.optimizedPrompt=="string"?e.state.result.optimizedPrompt:e.state.languageState==="zh"?e.state.result.optimizedPrompt.zh:e.state.result.optimizedPrompt.en:""},[e.state.result,e.state.languageState]);w.useEffect(()=>{C&&d(C)},[C]);const A=R=>R>=90?"text-green-600":R>=70?"text-blue-600":R>=50?"text-yellow-600":"text-red-600",P=R=>R>=90?"bg-green-500":R>=70?"bg-blue-500":R>=50?"bg-yellow-500":"bg-red-500",N=R=>({clarity:"",specificity:"",structure:"",context:"",completeness:""})[R]||R,z=async()=>{try{await e.toggleLanguage(),t.success("")}catch(R){t.error(R.message||"")}},L=()=>{e.clearResult(),n("analysis"),localStorage.setItem(qo,"analysis"),i(!1),d(""),t.success("")},G=()=>{if(!e.state.draftPrompt||!e.hasResult||!e.state.result){t.warning("");return}const R=typeof e.state.result.optimizedPrompt=="string"?e.state.result.optimizedPrompt:e.state.languageState==="zh"?e.state.result.optimizedPrompt.zh:e.state.result.optimizedPrompt.en,F={mode:"user",systemPrompt:e.state.systemPrompt||"",originalPrompt:e.state.draftPrompt,optimizedPrompt:R,conversationHistory:e.state.conversationHistory||""};localStorage.setItem("yprompt_comparison_data",JSON.stringify(F)),localStorage.setItem("yprompt_trigger_compare","true"),console.log(" :",F)};return w.useEffect(()=>{const R=()=>{var O,q,Q,oe,W,U;try{const te=localStorage.getItem("yprompt_optimize_loaded_user_prompt");if(te){const ne=JSON.parse(te);console.log(" UserPromptQuickOptimize: :",{draftPrompt:(O=ne.draftPrompt)==null?void 0:O.substring(0,50),systemPrompt:(q=ne.systemPrompt)==null?void 0:q.substring(0,50),conversationHistory:(Q=ne.conversationHistory)==null?void 0:Q.substring(0,50)}),e.setDraftPrompt(ne.draftPrompt||""),e.setSystemPrompt(ne.systemPrompt||""),e.setConversationHistory(ne.conversationHistory||""),console.log(" optimizeState:",{draftPrompt:(oe=e.state.draftPrompt)==null?void 0:oe.substring(0,50),systemPrompt:(W=e.state.systemPrompt)==null?void 0:W.substring(0,50),conversationHistory:(U=e.state.conversationHistory)==null?void 0:U.substring(0,50)}),localStorage.removeItem("yprompt_optimize_loaded_user_prompt")}}catch(te){console.error(":",te)}};R();const F=()=>{localStorage.getItem("yprompt_optimize_loaded_user_prompt")&&requestAnimationFrame(()=>{R()})};window.addEventListener("storage",F);const D=setInterval(()=>{localStorage.getItem("yprompt_optimize_loaded_user_prompt")&&R()},100);return()=>{window.removeEventListener("storage",F),clearInterval(D)}},[e]),s.jsxs(s.Fragment,{children:[s.jsxs("div",{className:"h-full min-h-0 overflow-hidden grid grid-cols-2 gap-4",children:[s.jsx("div",{className:"flex flex-col min-h-0",children:s.jsx(xN,{draftPrompt:e.state.draftPrompt,systemPrompt:e.state.systemPrompt,conversationHistory:e.state.conversationHistory,isOptimizing:e.state.isOptimizing,onUpdateDraftPrompt:e.setDraftPrompt,onUpdateSystemPrompt:e.setSystemPrompt,onUpdateConversationHistory:e.setConversationHistory,onOptimize:S,onRestart:L})}),s.jsx("div",{className:"flex flex-col min-h-0",children:s.jsxs("div",{className:"bg-white rounded-lg shadow-sm flex flex-col h-full min-h-0 overflow-hidden",children:[s.jsxs("div",{className:"p-4 border-b border-gray-200 flex items-center justify-between flex-shrink-0",children:[s.jsx("h4",{className:"font-semibold text-gray-800",children:""}),s.jsx("div",{className:"flex items-center space-x-2",children:s.jsxs("label",{className:"flex items-center cursor-pointer",children:[s.jsx("input",{type:"checkbox",checked:e.state.enableQualityAnalysis,onChange:R=>e.setEnableQualityAnalysis(R.target.checked),disabled:e.state.isOptimizing,className:"sr-only peer"}),s.jsx("span",{className:"text-sm text-gray-600 mr-2",children:""}),s.jsx("div",{className:"relative w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600 peer-disabled:opacity-50 peer-disabled:cursor-not-allowed"})]})})]}),y===0&&s.jsx("div",{className:"flex-1 flex flex-col min-h-0 overflow-hidden p-4",children:s.jsx("div",{className:"flex-1 flex items-center justify-center",children:s.jsxs("div",{className:"text-center text-gray-400",children:[s.jsx(lc,{className:"w-16 h-16 mx-auto mb-4 opacity-50"}),s.jsx("p",{className:"text-sm",children:'""'})]})})}),y>=1&&s.jsxs("div",{className:"flex-1 flex flex-col min-h-0 overflow-hidden p-4",children:[e.state.enableQualityAnalysis&&s.jsxs("div",{className:"flex space-x-2 mb-4 flex-shrink-0",children:[s.jsx("button",{onClick:()=>n("analysis"),className:`px-4 py-2 rounded-lg font-medium transition-colors text-sm ${r==="analysis"?"bg-blue-500 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:""}),y>=2&&s.jsx("button",{onClick:()=>n("result"),className:`px-4 py-2 rounded-lg font-medium transition-colors text-sm ${r==="result"?"bg-green-500 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:""})]}),e.state.enableQualityAnalysis&&r==="analysis"&&s.jsx("div",{className:"flex-1 flex flex-col min-h-0",children:e.state.isAnalyzing?s.jsx("div",{className:"flex-1 flex flex-col overflow-hidden",children:s.jsx("div",{className:"flex-1 overflow-y-auto bg-gray-50 rounded-lg p-4",children:s.jsx("pre",{className:"text-xs text-gray-700 whitespace-pre-wrap font-mono",children:e.state.analysisText||"AI..."})})}):e.hasResult&&e.state.result&&s.jsx("div",{className:"flex-1 flex flex-col min-h-0",children:s.jsxs("div",{className:"flex-1 overflow-y-auto space-y-4 pr-2",children:[s.jsxs("div",{className:"border border-gray-200 rounded-lg p-4",children:[s.jsxs("div",{className:"flex items-center justify-between mb-3",children:[s.jsx("h4",{className:"text-sm font-medium text-gray-700",children:""}),s.jsxs("span",{className:`text-2xl font-bold ${A(e.state.result.qualityAnalysis.overall_score)}`,children:[e.state.result.qualityAnalysis.overall_score,"/100"]})]}),s.jsx("div",{className:"w-full bg-gray-200 rounded-full h-3",children:s.jsx("div",{className:`h-3 rounded-full transition-all duration-500 ${P(e.state.result.qualityAnalysis.overall_score)}`,style:{width:`${e.state.result.qualityAnalysis.overall_score}%`}})})]}),s.jsx("div",{className:"grid grid-cols-2 gap-3",children:Object.entries(e.state.result.qualityAnalysis.analysis).map(([R,F])=>F?s.jsxs("div",{className:"border border-gray-200 rounded-lg p-3 hover:shadow-sm transition-shadow",children:[s.jsxs("div",{className:"flex items-center justify-between mb-2",children:[s.jsx("span",{className:"text-xs font-medium text-gray-700",children:N(R)}),s.jsx("span",{className:`text-lg font-bold ${A(F.score)}`,children:F.score})]}),s.jsx("p",{className:"text-xs text-gray-600",children:F.feedback})]},R):null)}),e.state.result.qualityAnalysis.issues&&e.state.result.qualityAnalysis.issues.length>0&&s.jsxs("div",{className:"border border-orange-200 bg-orange-50 rounded-lg p-4",children:[s.jsxs("h4",{className:"text-sm font-semibold text-orange-900 mb-3 flex items-center",children:[s.jsx("svg",{className:"w-4 h-4 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})}),""]}),s.jsx("ul",{className:"space-y-2",children:e.state.result.qualityAnalysis.issues.map((R,F)=>s.jsxs("li",{className:"text-sm text-orange-800 flex items-start",children:[s.jsxs("span",{className:"text-orange-600 mr-2 flex-shrink-0",children:[F+1,"."]}),s.jsx("span",{className:"flex-1",children:R})]},F))})]})]})})}),(!e.state.enableQualityAnalysis||r==="result")&&s.jsx("div",{className:"flex-1 flex flex-col min-h-0",children:e.state.isOptimizingPrompt?s.jsx("div",{className:"flex-1 flex flex-col overflow-hidden",children:s.jsx("div",{className:"flex-1 overflow-y-auto bg-gray-50 rounded-lg p-4",children:s.jsx("pre",{className:"text-xs text-gray-700 whitespace-pre-wrap font-mono",children:e.state.optimizedText||"AI..."})})}):e.hasResult&&e.state.result&&s.jsxs("div",{className:"border rounded-lg overflow-hidden flex flex-col flex-1",children:[s.jsxs("div",{className:"bg-blue-50 px-3 py-2 text-sm font-medium text-blue-700 flex items-center justify-between flex-shrink-0",children:[s.jsx("span",{children:""}),s.jsxs("div",{className:"flex items-center space-x-2",children:[s.jsx("button",{onClick:T,disabled:e.state.isOptimizing,className:"text-blue-500 hover:text-blue-600 disabled:opacity-50 disabled:cursor-not-allowed",title:"",children:s.jsx(It,{className:`w-4 h-4 ${e.state.isOptimizing?"animate-spin":""}`})}),s.jsx("button",{onClick:()=>I(C),className:"text-blue-500 hover:text-blue-600",title:"",children:o?s.jsx(zs,{className:"w-4 h-4"}):s.jsx(wr,{className:"w-4 h-4"})})]})]}),s.jsxs("div",{className:"p-3 bg-white flex-1 flex flex-col overflow-hidden",children:[s.jsx("textarea",{value:u,onChange:R=>d(R.target.value),className:"w-full flex-1 px-3 py-2 border border-gray-300 rounded-lg focus:outline-none resize-none"}),C&&s.jsxs("div",{className:"space-y-2 pt-4 flex-shrink-0",children:[s.jsxs("div",{className:"flex space-x-2",children:[s.jsxs("button",{onClick:z,disabled:e.state.isConvertingLanguage,className:"flex-1 flex items-center justify-center space-x-1 px-3 py-2 bg-green-500 text-white rounded hover:bg-green-600 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:[e.state.isConvertingLanguage&&s.jsx(It,{className:"w-4 h-4 animate-spin"}),s.jsx("span",{children:e.state.isConvertingLanguage?"...":e.state.languageState==="zh"?"":""})]}),s.jsxs("button",{onClick:b,disabled:l,className:"flex-1 flex items-center justify-center space-x-1 px-3 py-2 bg-blue-500 text-white rounded hover:bg-blue-600 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:[l&&s.jsx(It,{className:"w-4 h-4 animate-spin"}),s.jsx("span",{children:l?"...":""})]})]}),s.jsx("div",{className:"flex",children:s.jsxs("button",{onClick:G,className:"w-full flex items-center justify-center space-x-1 px-3 py-2 bg-orange-500 text-white rounded hover:bg-orange-600 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:[s.jsx(wx,{className:"w-4 h-4"}),s.jsx("span",{children:""})]})})]})]})]})})]})]})})]}),g&&s.jsx(wN,{isOpen:g,promptContent:C,systemPrompt:e.state.systemPrompt,conversationHistory:e.state.conversationHistory,isSaving:l,onSave:h,onCancel:v})]})}const Yu="yprompt_optimize_cache";function kN({activeMode:e,onUpdateActiveMode:t}){const r=yh(),n=gt(),{analyzePrompt:o,generateOptimizationAdvice:i,applyOptimizationAdvice:l}=hN(),[c,u]=w.useState(!0),d=()=>{try{const ke=localStorage.getItem(Yu);return ke?JSON.parse(ke):null}catch{return null}},g=ke=>{try{const Rt={...d()||{},...ke};localStorage.setItem(Yu,JSON.stringify(Rt))}catch(st){console.error("Failed to save optimize cache:",st)}},x=d(),[y,S]=w.useState((x==null?void 0:x.originalSystemPrompt)||r.systemPrompt||""),[T,I]=w.useState((x==null?void 0:x.originalSystemPrompt)||""),[b,h]=w.useState((x==null?void 0:x.optimizedSystemPrompt)||""),[v,C]=w.useState((x==null?void 0:x.systemSuggestions)||[]),[A,P]=w.useState(!1),[N,z]=w.useState((x==null?void 0:x.systemAnalysisResult)||null),[L,G]=w.useState(!1),[R,F]=w.useState((x==null?void 0:x.analysisStreamingText)||""),[D,O]=w.useState((x==null?void 0:x.systemOptimizationStage)||0),[q,Q]=w.useState((x==null?void 0:x.activeOptimizeTab)||"analysis"),[oe,W]=w.useState(!1),[U,te]=w.useState(!1),[ne,Ce]=w.useState(!1),[ze,Qe]=w.useState(!1),[fe,He]=w.useState((x==null?void 0:x.formatState)||"markdown"),[ce,V]=w.useState((x==null?void 0:x.languageState)||"zh"),[K,xe]=w.useState(!1),[Le,Je]=w.useState(!1);w.useEffect(()=>{r.systemPrompt&&!y&&(S(r.systemPrompt),I(r.systemPrompt))},[r.systemPrompt]),w.useEffect(()=>{if(v.length>0&&D>=2&&q==="analysis"){const ke=setTimeout(()=>{Q("advice")},500);return()=>clearTimeout(ke)}},[v,D]);const at=w.useMemo(()=>v.map(ke=>ke.description),[v]),et=w.useMemo(()=>typeof b=="string"?b:ce==="zh"?b.zh:b.en,[b,ce]),qr=ke=>{h(typeof b=="string"?ke:ce==="zh"?{...b,zh:ke}:{...b,en:ke})},ge=()=>{confirm("")&&(S(""),I(""),h(""),C([]),z(null),O(0),Q("analysis"),F(""),He("markdown"),V("zh"),Qe(!1),Ce(!1),W(!1),te(!1),r.resetOptimization(),localStorage.removeItem(Yu),n.success(""))},mr=async()=>{if(y!=null&&y.trim()){I(y),P(!0),O(0),F(""),He("markdown"),V("zh"),g({originalSystemPrompt:y,formatState:"markdown",languageState:"zh"});try{O(1),g({systemOptimizationStage:1}),G(!0);let ke="";const st=await o(y,"system",$t=>{ke=$t,F($t)});z(st),G(!1),g({systemAnalysisResult:st,analysisStreamingText:ke}),O(2),g({systemOptimizationStage:2});let Rt="",Ht=!1;const ft=await i(y,"system",$t=>{Rt+=$t,!Ht&&$t.trim()&&(Ht=!0,C([{id:"temp",type:"modify",category:"role",title:"...",description:"...",reason:"",expectedEffect:"",priority:"medium"}]));const Ie=Rt.split(`
`).map(Zr=>Zr.replace(/^[*-]\s*/,"").trim()).filter(Boolean);Ie.length>0&&C(Ie.map((Zr,Mr)=>({id:`sys_${Mr}`,type:"modify",category:"role",title:Zr.substring(0,50),description:Zr,reason:"",expectedEffect:"",priority:"medium"})))});if(C(ft.map(($t,Ie)=>({id:`sys_${Ie}`,type:"modify",category:"role",title:$t.substring(0,50),description:$t,reason:"",expectedEffect:"",priority:"medium"}))),g({systemSuggestions:v}),c){O(3),g({systemOptimizationStage:3}),He("markdown"),V("zh"),g({formatState:"markdown",languageState:"zh"});let $t=!1;const Ie=await l(y,ft,"system",Zr=>{!$t&&Zr.trim()&&($t=!0,h("...")),$t&&h(Mr=>Mr==="..."||typeof Mr=="string"?Mr==="..."?Zr:Mr+Zr:{...Mr,zh:Mr.zh+Zr})});h(Ie),r.setOptimizedPrompts(Ie,""),g({optimizedSystemPrompt:Ie,activeOptimizeTab:"final"}),Q("final")}else Q("advice")}catch(ke){console.error("System optimization failed:",ke),n.error(`: ${ke.message}`,3e3),C([{id:"sys_fallback",type:"modify",category:"role",title:"",description:"",reason:"",expectedEffect:"",priority:"high"}])}finally{P(!1),G(!1)}}},Jr=async()=>{if(T){P(!0),O(2);try{let ke="",st=!1;const Rt=await i(T,"system",Ht=>{ke+=Ht,!st&&Ht.trim()&&(st=!0,C([{id:"temp",type:"modify",category:"role",title:"...",description:"...",reason:"",expectedEffect:"",priority:"medium"}]));const ft=ke.split(`
`).map($t=>$t.replace(/^[*-]\s*/,"").trim()).filter(Boolean);ft.length>0&&C(ft.map(($t,Ie)=>({id:`sys_${Ie}`,type:"modify",category:"role",title:$t.substring(0,50),description:$t,reason:"",expectedEffect:"",priority:"medium"})))});C(Rt.map((Ht,ft)=>({id:`sys_${ft}`,type:"modify",category:"role",title:Ht.substring(0,50),description:Ht,reason:"",expectedEffect:"",priority:"medium"}))),g({systemSuggestions:v})}catch(ke){console.error("Failed to generate advice:",ke),n.error(`: ${ke.message}`,3e3)}finally{P(!1)}}},ko=async()=>{if(!(!T||v.length===0)){P(!0),O(3),g({systemOptimizationStage:3});try{He("markdown"),V("zh"),g({formatState:"markdown",languageState:"zh"});let ke=!1;const st=v.map(Ht=>Ht.description),Rt=await l(T,st,"system",Ht=>{!ke&&Ht.trim()&&(ke=!0,h("...")),ke&&h(ft=>ft==="..."||typeof ft=="string"?ft==="..."?Ht:ft+Ht:{...ft,zh:ft.zh+Ht})});h(Rt),r.setOptimizedPrompts(Rt,""),g({optimizedSystemPrompt:Rt,activeOptimizeTab:"final"}),Q("final")}catch(ke){console.error("Failed to generate final optimized prompt:",ke),n.error(`: ${ke.message}`,3e3)}finally{P(!1)}}},Ze=async()=>{try{await Hn(at.join(`
`)),W(!0),n.success("",2e3),setTimeout(()=>W(!1),2e3)}catch{n.error("",2e3)}},_t=async()=>{try{await Hn(et),te(!0),n.success("",2e3),setTimeout(()=>te(!1),2e3)}catch{n.error("",2e3)}},Pi=()=>{Je(!0)},So=async ke=>{xe(!0);try{const st=await wo("/api/prompts/",{title:ke.title,description:ke.description,final_prompt:et,language:"zh",format:fe,prompt_type:ke.promptType,tags:ke.tags,is_public:ke.isPublic?1:0});if(st.code===200)n.success("",2e3),Je(!1);else throw new Error(st.message||"")}catch(st){console.error(":",st),n.error(`: ${st.message}`,3e3)}finally{xe(!1)}},Ls=ke=>ke>=80?"text-green-600":ke>=60?"text-yellow-600":"text-red-600",Y=ke=>ke>=80?"bg-green-500":ke>=60?"bg-yellow-500":"bg-red-500",mt=ke=>({role:"",task:"",format:"",constraints:"",example:"",language:""})[ke]||ke;return e==="user"?s.jsx(bN,{}):e==="compare"?s.jsx(fN,{}):s.jsxs("div",{className:"w-full h-full min-h-0 overflow-hidden flex flex-row gap-4",children:[s.jsx("div",{className:"flex flex-col flex-1 min-h-0 overflow-hidden",children:s.jsxs("div",{className:"bg-white rounded-lg shadow-sm flex flex-col flex-1 min-h-0 p-4 overflow-hidden",children:[s.jsxs("div",{className:"mb-4 flex-shrink-0 flex items-center justify-between",children:[s.jsx("div",{children:s.jsx("h4",{className:"text-base font-semibold text-gray-800 mb-2",children:""})}),s.jsxs("button",{onClick:ge,className:"flex items-center gap-1 px-3 py-1 text-sm text-gray-600 hover:text-red-600 hover:bg-red-50 rounded transition-colors",title:"",children:[s.jsx(It,{className:"w-4 h-4"}),s.jsx("span",{children:""})]})]}),s.jsxs("div",{className:"flex-1 flex flex-col min-h-0 overflow-hidden",children:[s.jsx("textarea",{value:y,onChange:ke=>S(ke.target.value),placeholder:`...

`,className:"w-full flex-1 p-3 border border-gray-300 rounded-lg focus:outline-none resize-none text-sm min-h-0"}),s.jsxs("div",{className:"flex items-center justify-between text-xs text-gray-500 mt-2 flex-shrink-0",children:[s.jsxs("span",{children:[(y==null?void 0:y.length)||0," "]}),s.jsxs("span",{children:[Math.ceil(((y==null?void 0:y.length)||0)/4)," tokens"]})]})]}),s.jsx("div",{className:"mt-4 flex justify-end flex-shrink-0",children:s.jsxs("button",{onClick:mr,disabled:!(y!=null&&y.trim())||A,className:"px-6 py-2.5 bg-blue-600 text-white rounded-lg font-medium hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors flex items-center space-x-2",children:[A&&s.jsxs("svg",{className:"animate-spin h-4 w-4",fill:"none",viewBox:"0 0 24 24",children:[s.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),s.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),s.jsx("span",{children:A?"...":""})]})})]})}),s.jsx("div",{className:"flex flex-col flex-1 min-h-0 overflow-hidden",children:s.jsxs("div",{className:"bg-white rounded-lg shadow-sm flex flex-col flex-1 min-h-0 overflow-hidden",children:[s.jsxs("div",{className:"p-4 border-b border-gray-200 flex items-center justify-between flex-shrink-0",children:[s.jsx("h4",{className:"font-semibold text-gray-800",children:""}),s.jsx("div",{className:"flex items-center space-x-3",children:s.jsx("div",{className:"flex items-center space-x-2",children:s.jsxs("label",{className:"flex items-center cursor-pointer",children:[s.jsx("input",{type:"checkbox",checked:c,onChange:ke=>u(ke.target.checked),className:"sr-only peer"}),s.jsx("span",{className:"text-sm text-gray-600",children:c?"":""}),s.jsx("div",{className:"relative w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600"})]})})})]}),D===0?s.jsx("div",{className:"flex-1 flex flex-col min-h-0 overflow-hidden p-4",children:s.jsx(Gx,{})}):s.jsxs("div",{className:"flex-1 flex flex-col min-h-0 overflow-hidden p-4",children:[s.jsxs(Wx,{isGenerating:A,children:[s.jsx(fs,{isActive:q==="analysis",activeClass:"bg-orange-500 text-white",onClick:()=>Q("analysis"),children:""}),D>=2&&s.jsx(fs,{isActive:q==="advice",activeClass:"bg-yellow-500 text-white",onClick:()=>Q("advice"),children:""}),D>=3&&s.jsx(fs,{isActive:q==="final",activeClass:"bg-blue-500 text-white",onClick:()=>Q("final"),children:""})]}),s.jsxs("div",{className:"flex-1 flex flex-col min-h-0 mt-4",children:[q==="analysis"&&s.jsx("div",{className:"flex-1 flex flex-col min-h-0",children:L?s.jsx("div",{className:"flex-1 flex flex-col min-h-0 overflow-hidden",children:s.jsx("div",{className:"flex-1 overflow-y-auto bg-gray-50 rounded-lg p-4 min-h-0",children:s.jsx("pre",{className:"text-xs text-gray-700 whitespace-pre-wrap font-mono",children:R||"AI..."})})}):N?s.jsxs("div",{className:"flex-1 flex flex-col min-h-0",children:[s.jsxs("div",{className:"flex-1 overflow-y-auto space-y-4 pr-2 min-h-0",children:[s.jsxs("div",{className:"border border-gray-200 rounded-lg p-4",children:[s.jsxs("div",{className:"flex items-center justify-between mb-3",children:[s.jsx("h4",{className:"text-sm font-medium text-gray-700",children:""}),s.jsxs("span",{className:`text-2xl font-bold ${Ls(N.overall_score)}`,children:[N.overall_score,"/100"]})]}),s.jsx("div",{className:"w-full bg-gray-200 rounded-full h-3",children:s.jsx("div",{className:`h-3 rounded-full transition-all duration-500 ${Y(N.overall_score)}`,style:{width:`${N.overall_score}%`}})})]}),N.analysis&&s.jsx("div",{className:"grid grid-cols-2 gap-3",children:Object.entries(N.analysis).map(([ke,st])=>s.jsxs("div",{className:"border border-gray-200 rounded-lg p-3 hover:shadow-sm transition-shadow",children:[s.jsxs("div",{className:"flex items-center justify-between mb-2",children:[s.jsx("span",{className:"text-xs font-medium text-gray-700",children:mt(ke)}),s.jsx("span",{className:`text-lg font-bold ${Ls(st.score)}`,children:st.score})]}),s.jsx("p",{className:"text-xs text-gray-600",children:st.feedback})]},ke))})]}),!c&&D===1&&s.jsx("div",{className:"pt-4 mt-4 border-t border-gray-100 flex justify-end flex-shrink-0",children:s.jsxs("button",{onClick:Jr,disabled:A,className:"px-4 py-2 bg-yellow-500 text-white rounded hover:bg-yellow-600 disabled:opacity-50 disabled:cursor-not-allowed transition-colors flex items-center space-x-2",children:[A&&s.jsxs("svg",{className:"w-4 h-4 animate-spin",fill:"none",viewBox:"0 0 24 24",children:[s.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),s.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),s.jsx("span",{children:A?"...":""})]})})]}):null}),q==="advice"&&s.jsx(Hx,{advice:at,setAdvice:ke=>{},isAutoMode:c,isExecuting:A,isGenerating:A,currentExecutionStep:D===3?"final":"advice",isCopied:oe,onRegenerate:Jr,onCopy:Ze,onAddItem:()=>{},onRemoveItem:ke=>{C(v.filter((st,Rt)=>Rt!==ke))},onUpdateItem:(ke,st)=>{C(v.map((Rt,Ht)=>Ht===ke?{...Rt,description:st}:Rt))},onExecuteFinal:ko}),q==="final"&&s.jsx(Vx,{generatedPrompt:et,setGeneratedPrompt:qr,isExecuting:!1,isGenerating:A,currentExecutionStep:null,isCopied:U,isConvertingFormat:ne,isConvertingLanguage:ze,isSaving:K,formatState:fe,languageState:ce,onRegenerate:ko,onCopy:_t,onToggleFormat:()=>{n.info("...",2e3)},onToggleLanguage:()=>{n.info("...",2e3)},onSavePrompt:Pi})]})]})]})}),Le&&s.jsx(gh,{isOpen:Le,promptContent:et,isSaving:K,onSave:So,onCancel:()=>Je(!1)})]})}function SN({leftContent:e,rightContent:t,leftLabel:r,rightLabel:n,onClose:o}){return s.jsxs("div",{className:"flex flex-col h-full",children:[s.jsxs("div",{className:"flex items-center justify-between p-4 border-b",children:[s.jsx("h3",{className:"text-lg font-semibold text-gray-800",children:""}),s.jsx("button",{onClick:o,className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:s.jsx(Er,{className:"w-5 h-5"})})]}),s.jsxs("div",{className:"flex-1 grid grid-cols-2 gap-4 p-4 overflow-auto",children:[s.jsxs("div",{className:"flex flex-col",children:[s.jsx("div",{className:"mb-2 text-sm font-medium text-gray-700",children:r}),s.jsx("pre",{className:"flex-1 p-4 bg-gray-50 rounded-lg border border-gray-200 text-sm whitespace-pre-wrap overflow-auto",children:e})]}),s.jsxs("div",{className:"flex flex-col",children:[s.jsx("div",{className:"mb-2 text-sm font-medium text-gray-700",children:n}),s.jsx("pre",{className:"flex-1 p-4 bg-gray-50 rounded-lg border border-gray-200 text-sm whitespace-pre-wrap overflow-auto",children:t})]})]})]})}const Gs="yprompt_optimize_active_mode";function Ug(){const e=pT(),t=ut(h=>h.loadSettings),r=Be(h=>h.isInitialized),n=Be(h=>h.initialize),o=yh(),i=gt(),[l,c]=w.useState(!1),[u,d]=w.useState("system"),[g,x]=w.useState(window.innerWidth),[,y]=w.useState(!1),S=w.useRef(null);w.useEffect(()=>{if(!e.id)try{const h=localStorage.getItem(Gs);h&&["system","user","compare"].includes(h)&&d(h)}catch(h){console.error("activeMode:",h)}},[e.id]);const T=[{key:"system",label:""},{key:"user",label:""},{key:"compare",label:""}],I=h=>{d(h);try{localStorage.setItem(Gs,h)}catch(v){console.error("activeMode:",v)}};w.useEffect(()=>{const h=()=>{x(window.innerWidth)};return window.addEventListener("resize",h),()=>window.removeEventListener("resize",h)},[]);const b=async h=>{var v,C,A,P;y(!0);try{const N=await _a(`/api/prompts/${h}`);if(N.code===200){const z=N.data;if(console.log(" :",{id:z.id,title:z.title,type:z.prompt_type,final_prompt_length:(v=z.final_prompt)==null?void 0:v.length,system_prompt_length:(C=z.system_prompt)==null?void 0:C.length,conversation_history_length:(A=z.conversation_history)==null?void 0:A.length}),z.prompt_type==="user"){d("user"),o.setLoadedPromptId(z.id),console.log("  - loadedPromptId:",z.id);const L={draftPrompt:z.final_prompt||"",systemPrompt:z.system_prompt||"",conversationHistory:z.conversation_history||""};console.log(" localStorage:",L),localStorage.setItem("yprompt_optimize_loaded_user_prompt",JSON.stringify(L))}else d("system"),o.setPrompts(z.final_prompt||"",""),o.setLoadedPromptId(z.id),console.log("  - loadedPromptId:",z.id),console.log(" store:",(P=z.final_prompt)==null?void 0:P.substring(0,50));localStorage.setItem(Gs,u)}else throw new Error(N.message||"")}catch(N){console.error(":",N),i.error(`: ${N.message}`,3e3)}finally{y(!1)}};return w.useEffect(()=>{e.id&&b(Number(e.id))},[e.id]),w.useEffect(()=>{const h=C=>{if(C.key==="yprompt_trigger_compare"&&C.newValue==="true"&&(console.log(" compare"),d("compare"),localStorage.removeItem("yprompt_trigger_compare"),localStorage.setItem(Gs,"compare")),C.key==="yprompt_back_to_optimize"&&C.newValue==="true"){console.log(" ");const A=localStorage.getItem(Gs);A&&["system","user"].includes(A)&&d(A),localStorage.removeItem("yprompt_back_to_optimize")}};window.addEventListener("storage",h);const v=C=>{const A=C;if(A.detail.key==="yprompt_trigger_compare"&&A.detail.newValue==="true"&&(console.log(" compare"),d("compare"),localStorage.removeItem("yprompt_trigger_compare"),localStorage.setItem(Gs,"compare")),A.detail.key==="yprompt_back_to_optimize"&&A.detail.newValue==="true"){console.log(" ");const P=localStorage.getItem(Gs);P&&["system","user"].includes(P)&&d(P),localStorage.removeItem("yprompt_back_to_optimize")}};return window.addEventListener("localStorageChange",v),()=>{window.removeEventListener("storage",h),window.removeEventListener("localStorageChange",v),S.current&&(clearInterval(S.current),S.current=null)}},[]),w.useEffect(()=>{t(),r||n()},[]),s.jsxs("div",{className:"w-full flex-1 flex flex-col overflow-hidden p-2 min-h-0",children:[s.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-4 mb-4 flex-shrink-0",children:[s.jsx("div",{className:"flex flex-col lg:flex-row lg:items-center lg:justify-between gap-4",children:s.jsx("div",{className:"min-w-0",children:s.jsx("h2",{className:"text-xl lg:text-2xl font-bold text-gray-800 mb-1",children:""})})}),s.jsx("div",{className:"flex space-x-2 mt-4",children:T.map(h=>s.jsx("button",{onClick:()=>I(h.key),className:`px-4 py-2 rounded-lg text-sm font-medium transition-colors ${u===h.key?"bg-blue-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:h.label},h.key))})]}),s.jsx("div",{className:"flex-1 min-h-0 overflow-hidden",children:s.jsx(kN,{activeMode:u,onUpdateActiveMode:d})}),l&&s.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:s.jsx("div",{className:"bg-white rounded-lg p-6 max-w-4xl max-h-[90vh] w-[90vw] overflow-hidden",children:s.jsx(SN,{leftContent:o.systemPrompt,rightContent:o.optimizedPrompts.system,leftLabel:"",rightLabel:"",onClose:()=>c(!1)})})})]})}const TN=e=>{const t=/```(markdown|md)/gi;let r,n=-1,o=null;for(;(r=t.exec(e))!==null;)n=r.index,o=r[1];if(n===-1)return null;const l=n+(o==="md"?"```md":"```markdown").length,c=e.lastIndexOf("```");return c<=l?null:e.slice(l,c).trim()},Bg=e=>{const t=TN(e);if(t)return{type:"markdown",content:t};const r=e.match(/```xml\s*([\s\S]*?)```/i);if(r){const d=r[1].trim();if(d.includes("<mxfile")||d.includes("<mxGraphModel"))return{type:"drawio",content:d}}const n=e.match(/```mermaid\s*([\s\S]*?)```/i);if(n)return{type:"mermaid",content:n[1].trim()};const o=e.match(/```echarts\s*([\s\S]*?)```/i);if(o)return{type:"echarts",content:o[1].trim()};const i=e.match(/```(?:svg)\s*([\s\S]*?)```/i);if(i){const d=i[1].trim();if(d.startsWith("<svg"))return{type:"svg",content:d}}const l=e.match(/```html\s*([\s\S]*?)```/i);if(l)return{type:"html",content:l[1].trim()};const c=e.match(/```markdown\s*([\s\S]*?)```/i);if(c)return{type:"markdown",content:c[1].trim()};const u=e.match(/```json\s*([\s\S]*?)```/i);if(u){let d=u[1].trim();const g=d.indexOf("{"),x=d.lastIndexOf("}");if(g!==-1&&x!==-1){const y=d.substring(g,x+1);try{const S=JSON.parse(y),T=S&&typeof S=="object"?S.mindmap??S:null;if(T&&typeof T=="object"){const I=Array.isArray(T.children)||Array.isArray(T.nodes),b=!!T.name||!!T.title||!!S.mindmap;if(I&&b)return{type:"mindmap",content:y}}}catch{}return y.includes('"series"')||y.includes('"xAxis"')?{type:"echarts",content:y}:y.includes('"children"')&&(y.includes('"name"')||y.includes('"title"'))?{type:"mindmap",content:y}:y.includes('"mindmap"')&&y.includes('"nodes"')?{type:"mindmap",content:y}:{type:"json",content:y}}}return null},fc=class fc{constructor(){Ue(this,"aiService");this.aiService=Yt.getInstance()}static getInstance(){return this.instance||(this.instance=new fc),this.instance}async send(t){const{messages:r,provider:n,modelId:o,capability:i,stream:l=!0,onChunk:c,systemPrompt:u}=t,d=[],g=u==null?void 0:u.trim();g&&d.push({role:"system",content:g}),i!=null&&i.prompt&&d.push({role:"system",content:i.prompt}),d.push(...r.map(S=>({role:S.role==="assistant"?"assistant":"user",content:S.content})));const y=l&&!0;return await this.aiService.callAI(d,n,o,y,c)}};Ue(fc,"instance");let Xd=fc;function CN({messages:e,isStreaming:t,isStreamMode:r,hasSystemPrompt:n,currentModelName:o,onSend:i,onClear:l,onToggleStream:c,onOpenSystemPrompt:u}){const[d,g]=w.useState(""),x=w.useRef(null),y=w.useRef(null),S=w.useCallback(()=>{if(!x.current)return;const P=x.current;P.scrollHeight-P.scrollTop-P.clientHeight<300&&P.scrollTo({top:P.scrollHeight,behavior:"smooth"})},[]),T=w.useCallback(()=>{if(!x.current||t)return;x.current.querySelectorAll("pre code").forEach(N=>{const z=N;!window.hljs||z.dataset.highlighted||(window.hljs.highlightElement(z),z.dataset.highlighted="yes")})},[t]);w.useEffect(()=>{S(),T()},[e,t,S,T]),w.useEffect(()=>{y.current&&y.current.focus()},[]);const I=w.useCallback(()=>{y.current&&(y.current.style.height="auto",y.current.style.height=`${Math.min(y.current.scrollHeight,200)}px`)},[]),b=P=>{P.key==="Enter"&&!P.shiftKey&&(P.preventDefault(),h())},h=()=>{!d.trim()||t||(i({text:d}),g(""),setTimeout(()=>{var P;(P=y.current)==null||P.focus(),I()},0))},v=P=>{if(!P)return"";try{return it.parse(P,{breaks:!0,gfm:!0})}catch(N){return console.warn("Markdown ",N),P}},C=P=>{if(!P)return!1;const N=P.trim();if(N.includes("```markdown")||N.includes("```md"))return!0;if(!N.startsWith("```"))return!1;const z=N.lastIndexOf("```");return z<=0?!1:z===N.length-3},A=P=>{const N=P.displayText||P.text;return!!(N&&N.trim().length)};return s.jsxs("div",{className:"bg-white rounded-lg shadow-sm flex flex-col flex-1 min-h-0 overflow-hidden border border-gray-100",children:[s.jsxs("div",{className:"p-4 border-b border-gray-200 flex items-center justify-between flex-shrink-0",children:[s.jsx("h4",{className:"font-semibold text-gray-800",children:"AI"}),s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("span",{className:"text-sm text-gray-600",children:":"}),s.jsx("button",{onClick:c,className:`relative inline-flex h-6 w-11 items-center rounded-full transition-colors focus:outline-none ${r?"bg-blue-500":"bg-gray-300"}`,title:r?"":"",children:s.jsx("span",{className:`inline-block h-4 w-4 transform rounded-full bg-white transition-transform ${r?"translate-x-6":"translate-x-1"}`})})]}),s.jsx("button",{className:`p-2 rounded-lg border transition-colors ${n?"border-blue-200 bg-blue-50 text-blue-600":"border-gray-200 text-gray-500 hover:bg-gray-50"}`,onClick:u,title:"",children:s.jsx(Ma,{className:"w-4 h-4"})}),s.jsx("button",{onClick:l,className:"p-2 rounded-lg border border-gray-200 text-gray-500 hover:text-red-600 hover:bg-red-50 transition-colors",title:"",children:s.jsx(It,{className:"w-4 h-4"})})]})]}),s.jsx("div",{ref:x,className:"flex-1 overflow-y-auto bg-gray-50 px-4 py-6 space-y-5",children:e.length===0?s.jsxs("div",{className:"h-full flex flex-col items-center justify-center text-gray-400 p-6 text-center",children:[s.jsx("div",{className:"w-16 h-16 rounded-2xl bg-white border border-gray-200 flex items-center justify-center mb-4",children:s.jsx(lc,{className:"w-8 h-8 text-gray-300"})}),s.jsx("p",{className:"text-base font-medium text-gray-700 mb-2",children:""}),s.jsx("p",{className:"text-sm text-gray-500 max-w-xs",children:""})]}):e.map(P=>s.jsx("div",{className:"space-y-2",children:P.role==="user"?s.jsx("div",{className:"flex justify-end",children:s.jsx("div",{className:"bg-blue-500 text-white px-4 py-3 rounded-2xl rounded-tr-md max-w-xl whitespace-pre-wrap text-sm shadow-sm",children:P.text})}):s.jsxs("div",{className:"flex items-start gap-3",children:[s.jsx("div",{className:"w-9 h-9 rounded-full bg-white border border-gray-200 flex items-center justify-center shadow-sm",children:s.jsx(lc,{className:"w-5 h-5 text-blue-500"})}),s.jsxs("div",{className:"flex-1 min-w-0",children:[s.jsx("div",{className:"flex items-center gap-2 text-sm text-gray-500 mb-1",children:s.jsx("span",{className:"font-medium text-gray-900",children:"AI"})}),s.jsx("div",{className:"bg-white text-gray-800 px-4 py-3 rounded-2xl rounded-tl-md border border-gray-200 shadow-sm",children:P.isStreaming?A(P)?C(P.displayText||P.text)?s.jsx("pre",{className:"playground-code-block",children:P.displayText||P.text}):s.jsx("div",{className:"markdown-body prose prose-sm max-w-none text-gray-800",dangerouslySetInnerHTML:{__html:v(P.displayText||P.text)}}):s.jsxs("div",{className:"flex items-center gap-1 text-gray-400",children:[s.jsx("span",{className:"w-1.5 h-1.5 bg-gray-400 rounded-full animate-bounce"}),s.jsx("span",{className:"w-1.5 h-1.5 bg-gray-400 rounded-full animate-bounce",style:{animationDelay:"0.1s"}}),s.jsx("span",{className:"w-1.5 h-1.5 bg-gray-400 rounded-full animate-bounce",style:{animationDelay:"0.2s"}})]}):C(P.text)?s.jsx("pre",{className:"playground-code-block",children:P.text}):s.jsx("div",{className:"markdown-body prose prose-sm max-w-none text-gray-800",dangerouslySetInnerHTML:{__html:v(P.text)}})})]})]})},P.id))}),s.jsx("div",{className:"p-3 border-t border-gray-200 bg-white flex-shrink-0",children:s.jsx("div",{className:"max-w-4xl mx-auto relative",children:s.jsxs("div",{className:"relative border border-gray-300 rounded-2xl focus-within:outline-none focus-within:border-gray-300 overflow-hidden",style:{height:"120px"},children:[s.jsx("div",{className:"absolute top-0 left-0 right-0",style:{bottom:"48px"},children:s.jsx("textarea",{ref:y,value:d,onChange:P=>{g(P.target.value),I()},rows:1,className:"w-full h-full px-3 pt-3 pb-1 border-0 outline-none resize-none text-base overflow-y-auto bg-transparent",placeholder:"Shift+Enter ",onKeyDown:b})}),s.jsx("div",{className:"absolute bottom-0 left-0 right-0 h-12 flex items-center justify-end px-3 bg-transparent pointer-events-none",children:s.jsx("button",{onClick:h,disabled:!d.trim()||t,className:"w-8 h-8 rounded-full bg-blue-600 text-white hover:bg-blue-700 disabled:bg-gray-300 disabled:cursor-not-allowed transition-colors flex items-center justify-center pointer-events-auto",children:s.jsx(di,{className:"w-4 h-4"})})})]})})})]})}let wl=null,bl=null,kl=null;const er={echarts:null,d3:null,mermaid:null};async function PN(){return wl||(er.echarts||(er.echarts=zt(()=>import("./index-BzBQJFYZ.js"),[]).then(e=>(wl=e.default||e,er.echarts=null,wl)).catch(e=>{throw er.echarts=null,console.error("Failed to load ECharts:",e),e})),er.echarts)}async function jN(){return bl||(er.d3||(er.d3=zt(()=>import("./index-_sMxyxIe.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14])).then(e=>(bl=e,er.d3=null,bl)).catch(e=>{throw er.d3=null,console.error("Failed to load D3:",e),e})),er.d3)}async function NN(){return kl||(er.mermaid||(er.mermaid=zt(()=>import("./mermaid.core-Cuwf8kxx.js").then(e=>e.aD),__vite__mapDeps([15,1])).then(e=>(kl=e.default||e,er.mermaid=null,kl)).catch(e=>{throw er.mermaid=null,console.error("Failed to load Mermaid:",e),e})),er.mermaid)}function IN({content:e,onError:t}){const r=w.useRef(null),n=w.useRef(null),[o,i]=w.useState(!1),l=w.useRef(null),c=w.useRef(null),u=async()=>{if(!e||!n.current||!r.current)return;if(!c.current){i(!0);try{c.current=await jN()}catch(L){i(!1),t(`Failed to load D3: ${L.message}`);const G=c.current?c.current.select(n.current):null;G&&(G.selectAll("*").remove(),G.append("text").attr("x","50%").attr("y","50%").attr("text-anchor","middle").attr("fill","#ef4444").text("Failed to load D3 library"));return}i(!1)}let d;try{let L=e;const G=L.indexOf("{"),R=L.lastIndexOf("}");if(G!==-1&&R!==-1&&(L=L.substring(G,R+1)),d=JSON.parse(L),d&&d.mindmap&&(d=d.mindmap),d&&d.nodes&&!d.children&&(d.children=d.nodes),d&&!d.name&&d.title&&(d.name=d.title),d&&Array.isArray(d.children)){const F=D=>{if(!D)return null;const O={name:D.title||D.name||"",children:[]},q=D.children||D.nodes||[];return O.children=q.map(F).filter(Boolean),O};d=F({title:d.title||d.name||"MindMap",children:d.children})}if(Array.isArray(d))throw new Error("MindMap expects a Root Object { name: '...', children: [...] }, but received an Array.")}catch(L){console.warn("Invalid JSON for mindmap:",L),t(`MindMap Data Error: ${L.message}`);const G=c.current.select(n.current);G.selectAll("*").remove(),G.append("text").attr("x","50%").attr("y","50%").attr("text-anchor","middle").attr("fill","#ef4444").text("Invalid MindMap Data");return}const g=r.current,x=g.clientWidth,y=g.clientHeight;if(x===0||y===0)return;const S=c.current,T=S.select(n.current);T.selectAll("*").remove();const I=T.append("g"),b=S.zoom().scaleExtent([.1,5]).on("zoom",L=>{I.attr("transform",L.transform)});T.call(b).on("dblclick.zoom",null);const h=S.hierarchy(d),v=40,C=x/(h.height+2);S.tree().nodeSize([v,C])(h);let P=1/0,N=-P;h.each(L=>{L.x>N&&(N=L.x),L.x<P&&(P=L.x)}),I.selectAll(".link").data(h.links()).enter().append("path").attr("class","link").attr("fill","none").attr("stroke","#cbd5e1").attr("stroke-width",1.5).attr("d",S.linkHorizontal().x(L=>L.y).y(L=>L.x));const z=I.selectAll(".node").data(h.descendants()).enter().append("g").attr("class","node").attr("transform",L=>`translate(${L.y},${L.x})`);z.append("circle").attr("r",6).attr("fill",L=>L.children?"#ffffff":"#3b82f6").attr("stroke","#3b82f6").attr("stroke-width",2),z.append("text").attr("dy","0.31em").attr("x",L=>L.children?-10:10).style("text-anchor",L=>L.children?"end":"start").text(L=>L.data.name).style("font-size","13px").style("font-family","'Inter', sans-serif").style("font-weight","500").style("fill","#0f172a").each(function(){var G;const L=this.cloneNode(!0);S.select(L).style("stroke","white").style("stroke-width","4px").style("stroke-opacity","0.9").attr("class","stroke-clone"),(G=this.parentNode)==null||G.insertBefore(L,this)}),T.call(b.transform,S.zoomIdentity.translate(100,y/2).scale(1))};return w.useEffect(()=>(u(),l.current=new ResizeObserver(()=>{u()}),r.current&&l.current.observe(r.current),()=>{l.current&&l.current.disconnect()}),[e]),s.jsxs("div",{ref:r,className:"w-full h-full bg-white overflow-hidden relative select-none",children:[o&&s.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-white z-10",children:s.jsxs("div",{className:"flex flex-col items-center gap-3",children:[s.jsx("div",{className:"w-8 h-8 border-4 border-blue-200 border-t-blue-600 rounded-full animate-spin"}),s.jsx("p",{className:"text-sm text-gray-600",children:"..."})]})}),s.jsx("div",{className:"absolute top-3 left-3 bg-white/90 backdrop-blur text-slate-500 text-xs px-2.5 py-1.5 rounded-md z-10 border border-slate-200 shadow-sm font-medium flex items-center gap-2",children:"Pan & Zoom"}),s.jsx("svg",{ref:n,className:`w-full h-full cursor-grab active:cursor-grabbing block ${o?"opacity-0":""}`})]})}function AN({artifact:e}){const t=gt(),[r,n]=w.useState("preview"),[o,i]=w.useState(!1),[l,c]=w.useState(""),[u,d]=w.useState(!1),[g,x]=w.useState(!1),[y,S]=w.useState([]),[T,I]=w.useState(0),[b,h]=w.useState("default"),[v,C]=w.useState(!1),[A,P]=w.useState(!1),N=w.useRef(null),z=w.useRef(null),L=w.useRef(null),G=w.useRef(null),R=w.useRef(null);let F=null,D=null,O=null;w.useEffect(()=>{e&&(c(e.content),S([]),e.type==="mermaid"?(h("default"),setTimeout(()=>oe(),100)):e.type==="echarts"?setTimeout(()=>W(),100):e.type==="drawio"&&L.current&&U(e.content))},[e]),w.useEffect(()=>{r==="preview"&&e&&(e.type==="mermaid"?setTimeout(()=>oe(),100):e.type==="echarts"&&setTimeout(()=>W(),100))},[r,e]),w.useEffect(()=>{const V=K=>{K.data&&K.data.type==="iframe-log"&&q(K.data.level,K.data.message),te(K)};return window.addEventListener("message",V),()=>window.removeEventListener("message",V)},[]),w.useEffect(()=>{const V=()=>{d(!!document.fullscreenElement)};return document.addEventListener("fullscreenchange",V),()=>document.removeEventListener("fullscreenchange",V)},[]),w.useEffect(()=>{R.current&&(R.current.scrollTop=R.current.scrollHeight)},[y]);const q=w.useCallback((V,K)=>{S(xe=>{const Le=xe[xe.length-1];return Le&&Le.message===K&&Le.level===V?xe.map((Je,at)=>at===xe.length-1?{...Je,count:Je.count+1,timestamp:Date.now()}:Je):[...xe,{level:V,message:K,timestamp:Date.now(),count:1}]})},[]),Q=w.useCallback(V=>{q("error",V)},[q]),oe=w.useCallback(async()=>{if(!(!N.current||!l)){if(!F){C(!0);try{if(F=await NN(),!F)throw new Error("Mermaid library not available")}catch(V){C(!1);const K=`Failed to load Mermaid: ${V.message}`;q("error",K),N.current&&(N.current.innerHTML=`<div class="text-red-600 font-mono text-xs p-4 bg-red-50 border border-red-200 rounded">${K}</div>`);return}C(!1)}try{F.initialize({startOnLoad:!1,look:b,theme:b==="handDrawn"?"neutral":"base",securityLevel:"loose"});const V="mermaid-graph-"+Date.now(),{svg:K}=await F.render(V,l);N.current&&(N.current.innerHTML=K)}catch(V){const K=`Mermaid Render Error: ${V.message}`;q("error",K),N.current&&(N.current.innerHTML=`<div class="text-red-600 font-mono text-xs p-4 bg-red-50 border border-red-200 rounded">${K}</div>`)}}},[l,b,q]),W=w.useCallback(async()=>{if(!(!z.current||!l)){if(!D){P(!0);try{if(D=await PN(),!D)throw new Error("ECharts library not available")}catch(V){P(!1);const K=`Failed to load ECharts: ${V.message}`;q("error",K),z.current&&(z.current.innerHTML=`<div class="text-red-600 font-mono text-xs p-4 bg-red-50 border border-red-200 rounded flex items-center justify-center h-full">${K}</div>`);return}P(!1)}O&&O.dispose(),O=D.init(z.current);try{let V=l.trim();V.startsWith("option =")&&(V=V.replace("option =","")),V.endsWith(";")&&(V=V.slice(0,-1));const K=JSON.parse(V);O.setOption(K),new ResizeObserver(()=>O.resize()).observe(z.current)}catch(V){const K=`ECharts Parse Error: ${V.message}`;q("error",K),O.setOption({title:{text:"Error Parsing Chart Data",subtext:V.message,left:"center",top:"center",textStyle:{color:"#d32f2f"}}})}}},[l,q]),U=w.useCallback(V=>{var K;L.current&&((K=L.current.contentWindow)==null||K.postMessage(JSON.stringify({action:"load",xml:V,autosave:1}),"*"))},[]),te=w.useCallback(V=>{if(!(!L.current||!V.data||typeof V.data!="string"))try{const K=JSON.parse(V.data);(K.event==="autosave"||K.event==="save")&&K.xml&&c(K.xml)}catch{}},[]),ne=w.useCallback(()=>{G.current&&(document.fullscreenElement?document.exitFullscreen():G.current.requestFullscreen().catch(V=>{console.error(`Error attempting to enable fullscreen mode: ${V.message}`)}))},[]),Ce=w.useCallback(()=>{S([]),(e==null?void 0:e.type)==="html"?I(V=>V+1):(e==null?void 0:e.type)==="echarts"?W():(e==null?void 0:e.type)==="mermaid"?oe():(e==null?void 0:e.type)==="drawio"&&U(l)},[e,l,W,oe,U]),ze=w.useCallback(()=>{var Je;if(!e)return;const V=e.type,K=l;let xe=null,Le="";if(V==="html")xe=new Blob([He],{type:"text/html"}),Le="playground-export.html";else if(V==="svg")xe=new Blob([K],{type:"image/svg+xml"}),Le="image.svg";else if(V==="drawio")xe=new Blob([K],{type:"application/xml"}),Le="diagram.xml";else if(V==="mermaid"){const at=(Je=N.current)==null?void 0:Je.querySelector("svg");if(at){const et=at.cloneNode(!0);et.removeAttribute("transform"),et.removeAttribute("style");const ge=new XMLSerializer().serializeToString(et);xe=new Blob([ge],{type:"image/svg+xml"}),Le="diagram.svg"}}else if(V==="echarts"){const at=O==null?void 0:O.getDataURL({type:"png",pixelRatio:2,backgroundColor:"#fff"});if(at){const et=document.createElement("a");et.download="chart.png",et.href=at,et.click();return}}else V==="markdown"?(xe=new Blob([K],{type:"text/markdown"}),Le="readme.md"):V==="mindmap"?(xe=new Blob([K],{type:"application/json"}),Le="mindmap.json"):V==="json"&&(xe=new Blob([K],{type:"application/json"}),Le="data.json");if(xe){const at=URL.createObjectURL(xe),et=document.createElement("a");et.href=at,et.download=Le,et.click(),URL.revokeObjectURL(at)}},[e,l,O]),Qe=w.useCallback(async()=>{try{await Hn(l),i(!0),setTimeout(()=>i(!1),2e3)}catch{t.error("")}},[l,t]),fe=w.useCallback(V=>{try{return it.parse(V,{breaks:!0,gfm:!0})}catch{return V}},[]),He=w.useMemo(()=>{if(!e||e.type!=="html")return"";let V=l;const K=`
      html { height: 100%; width: 100%; }
      body { 
        min-height: 100vh; 
        margin: 0; padding: 0; 
        background-color: white; 
        font-family: system-ui, sans-serif;
        height: auto;
        position: relative;
      }
      canvas { display: block; outline: none; } 
      #app { width: 100%; min-height: 100%; }
    `,xe=`
      <script>
        (function() {
          const originalLog = console.log;
          const originalError = console.error;
          const originalWarn = console.warn;
          const originalInfo = console.info;
          function sendLog(level, args) {
            try {
              const message = args.map(arg => {
                if (typeof arg === 'object') {
                  try { return JSON.stringify(arg); } catch(e) { return String(arg); }
                }
                return String(arg);
              }).join(' ');
              window.parent.postMessage({ type: 'iframe-log', level, message }, '*');
            } catch(e) {}
          }
          console.log = function(...args) { originalLog.apply(console, args); sendLog('log', args); };
          console.error = function(...args) { originalError.apply(console, args); sendLog('error', args); };
          console.warn = function(...args) { 
            if (args.length > 0 && typeof args[0] === 'string' && args[0].includes('cdn.tailwindcss.com')) return;
            originalWarn.apply(console, args); sendLog('warn', args); 
          };
          console.info = function(...args) { originalInfo.apply(console, args); sendLog('info', args); };
          window.onerror = function(msg, source, lineno, colno, error) {
            window.parent.postMessage({ type: 'iframe-log', level: 'error', message: 'Uncaught Error: ' + msg + ' (Line ' + lineno + ')' }, '*');
            return false; 
          };
          window.addEventListener('unhandledrejection', function(event) {
            window.parent.postMessage({ type: 'iframe-log', level: 'error', message: 'Unhandled Promise Rejection: ' + (event.reason ? event.reason.message || event.reason : 'Unknown') }, '*');
          });
        })();
      <\/script>
    `,Le=`
      <script src="https://cdn.tailwindcss.com"><\/script>
      <script src="https://unpkg.com/lucide@latest"><\/script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"><\/script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/ScrollTrigger.min.js"><\/script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js"><\/script>
      <script src="https://cdn.jsdelivr.net/npm/echarts@5.4.3/dist/echarts.min.js"><\/script>
      <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    `,Je=`
      <script type="importmap">
        {
          "imports": {
            "three": "https://unpkg.com/three@0.160.0/build/three.module.js",
            "three/addons/": "https://unpkg.com/three@0.160.0/examples/jsm/",
            "echarts": "https://cdn.jsdelivr.net/npm/echarts@5.4.3/dist/echarts.esm.min.js",
            "gsap": "https://esm.sh/gsap@3.12.5",
            "gsap/ScrollTrigger": "https://esm.sh/gsap@3.12.5/ScrollTrigger"
          }
        }
      <\/script>
    `,at=`
      <script type="module">
        import * as THREE from 'three';
        import { OrbitControls } from 'three/addons/controls/OrbitControls.js';
        window.THREE = { ...THREE, OrbitControls };
        window.OrbitControls = OrbitControls;
      <\/script>
    `;V=V.replace(/<script\b([^>]*)>([\s\S]*?)<\/script>/gi,(qr,ge,mr)=>ge.match(/\bsrc\s*=/i)||ge.match(/\btype\s*=/i)?qr:`<script type="module" ${ge}>${mr}<\/script>`);const et=`${xe}${Le}${Je}${at}<style>${K}</style>`;return V.includes("<!DOCTYPE html>")||V.includes("<html")?V.replace("<head>",`<head>${et}`):`<!DOCTYPE html><html><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0">
    ${et}</head><body class="p-0">
      <div id="app">${V}</div>
      <script>
        window.onload = function() {
          if (window.lucide) window.lucide.createIcons();
        };
      <\/script>
    </body></html>`},[e,l]),ce=w.useMemo(()=>y.filter(V=>V.level==="error").length,[y]);return s.jsxs("div",{ref:G,className:"flex flex-col flex-1 min-h-0 bg-[#f8f9fa] select-none outline-none",tabIndex:0,children:[s.jsxs("div",{className:"h-14 border-b border-[#e5e7eb] flex items-center justify-between px-4 bg-white sticky top-0 z-10 flex-shrink-0",children:[s.jsxs("div",{className:"flex items-center gap-1 bg-gray-100/50 p-1 rounded-lg border border-gray-200",children:[s.jsxs("button",{onClick:()=>n("preview"),className:`px-4 py-1.5 rounded-md text-sm font-medium transition-all duration-200 flex items-center gap-2 ${r==="preview"?"bg-white text-gray-800 shadow-sm ring-1 ring-gray-200":"text-gray-500 hover:text-gray-700 hover:bg-gray-200/50"}`,children:[s.jsx(sh,{className:"w-3.5 h-3.5"}),"Preview"]}),s.jsxs("button",{onClick:()=>n("code"),className:`px-4 py-1.5 rounded-md text-sm font-medium transition-all duration-200 flex items-center gap-2 ${r==="code"?"bg-white text-gray-800 shadow-sm ring-1 ring-gray-200":"text-gray-500 hover:text-gray-700 hover:bg-gray-200/50"}`,children:[s.jsx(DC,{className:"w-3.5 h-3.5"}),"Code"]})]}),s.jsx("div",{className:"flex items-center gap-4",children:r==="preview"&&e&&e.type==="mermaid"&&s.jsxs("div",{className:"flex items-center gap-1 bg-gray-50 p-1 rounded-lg border border-gray-200",children:[s.jsx("button",{onClick:()=>{h("default"),oe()},className:`px-3 py-1.5 rounded text-xs font-medium transition-colors flex items-center gap-1.5 ${b==="default"?"bg-white shadow text-blue-700":"text-gray-600 hover:bg-gray-200"}`,children:"Standard"}),s.jsx("button",{onClick:()=>{h("handDrawn"),oe()},className:`px-3 py-1.5 rounded text-xs font-medium transition-colors flex items-center gap-1.5 ${b==="handDrawn"?"bg-white shadow text-purple-700":"text-gray-600 hover:bg-gray-200"}`,children:"Hand-Drawn"})]})}),e&&s.jsxs("div",{className:"flex items-center gap-2 ml-4",children:[s.jsxs("button",{onClick:()=>x(!g),className:`p-2 rounded-md transition-colors relative border ${g?"bg-gray-100 text-gray-900 border-gray-300":"text-gray-500 border-transparent hover:text-gray-800 hover:bg-gray-100"}`,title:"Toggle Debug Console",children:[s.jsx(Ng,{className:"w-4 h-4"}),ce>0&&s.jsx("span",{className:"absolute top-0.5 right-0.5 w-2.5 h-2.5 bg-red-500 text-white text-[8px] font-bold rounded-full flex items-center justify-center border border-white",children:ce>9?"!":ce})]}),s.jsx("div",{className:"w-px h-4 bg-gray-300 mx-1"}),r==="preview"&&s.jsx("button",{onClick:Ce,className:"p-2 text-gray-500 hover:text-blue-600 hover:bg-blue-50 rounded-md transition-colors",title:"Reload / Reset Preview",children:s.jsx(cP,{className:"w-4 h-4"})}),s.jsx("button",{onClick:ne,className:"p-2 text-gray-500 hover:text-gray-800 hover:bg-gray-100 rounded-md transition-colors",title:"Toggle Fullscreen",children:u?s.jsx(XC,{className:"w-4 h-4"}):s.jsx(QC,{className:"w-4 h-4"})}),s.jsx("button",{onClick:ze,className:"p-2 text-gray-500 hover:text-gray-800 hover:bg-gray-100 rounded-md transition-colors",title:"Download Artifact",children:s.jsx(UC,{className:"w-4 h-4"})}),s.jsx("button",{onClick:Qe,className:"p-2 text-gray-500 hover:text-blue-600 hover:bg-blue-50 rounded-md transition-colors",title:"Copy Code",children:o?s.jsx(zs,{className:"w-4 h-4"}):s.jsx(wr,{className:"w-4 h-4"})})]})]}),s.jsxs("div",{className:"flex-1 overflow-hidden relative flex flex-col bg-[#e2e8f0]",children:[!e&&s.jsxs("div",{className:"absolute inset-0 flex flex-col items-center justify-center text-gray-600 bg-[#f8f9fa] z-20 px-6 text-center",children:[s.jsx("div",{className:"w-20 h-20 bg-white rounded-full shadow-sm border border-gray-100 flex items-center justify-center mb-4",children:s.jsx(lc,{className:"w-8 h-8 text-blue-400"})}),s.jsx("p",{className:"text-base font-semibold text-gray-800 mb-3",children:""}),s.jsx("p",{className:"text-sm text-gray-600 max-w-2xl mb-4",children:" AI  Artifact"}),s.jsxs("ul",{className:"text-sm text-gray-600 space-y-1 max-w-xl text-left",children:[s.jsxs("li",{children:["  ",s.jsx("span",{className:"font-medium text-gray-800",children:"HTMLTailwind / Three.js / GSAP / ECharts"})]}),s.jsxs("li",{children:["  ",s.jsx("span",{className:"font-medium text-gray-800",children:"MarkdownSVGMindMapMermaidDraw.io"})," "]})]})]}),r==="preview"&&e&&s.jsxs("div",{className:"flex-1 min-h-0 overflow-auto relative flex flex-col items-center pt-4 pb-4",children:[s.jsx("div",{className:"absolute inset-0 pointer-events-none opacity-[0.03] z-0",style:{backgroundImage:"radial-gradient(#000 1px, transparent 1px)",backgroundSize:"24px 24px"}}),s.jsxs("div",{className:"relative bg-white shadow-xl transition-all duration-300 ease-in-out z-10 border border-gray-300 overflow-hidden flex-shrink-0 w-full flex-1 min-h-0 max-w-[98%] rounded-lg",children:[e.type==="html"&&s.jsx("iframe",{className:"w-full h-full border-none bg-white",sandbox:"allow-scripts allow-same-origin allow-forms allow-popups allow-modals",srcDoc:He},`html-preview-${T}`),e.type==="drawio"&&s.jsx("div",{className:"w-full h-full bg-white",children:s.jsx("iframe",{ref:L,className:"w-full h-full border-none",src:"https://embed.diagrams.net/?embed=1&ui=atlas&spin=1&modified=0&proto=json"})}),e.type==="mermaid"&&s.jsxs("div",{className:"w-full h-full relative overflow-hidden bg-white cursor-grab active:cursor-grabbing",children:[v&&s.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-white z-10",children:s.jsxs("div",{className:"flex flex-col items-center gap-3",children:[s.jsx("div",{className:"w-8 h-8 border-4 border-blue-200 border-t-blue-600 rounded-full animate-spin"}),s.jsx("p",{className:"text-sm text-gray-600",children:"..."})]})}),s.jsx("div",{className:"absolute top-3 left-3 bg-white/90 backdrop-blur text-slate-500 text-xs px-2.5 py-1.5 rounded-md z-10 border border-slate-200 shadow-sm font-medium flex items-center gap-2",children:"Pan & Zoom"}),s.jsx("div",{ref:N,className:"origin-center p-10",style:{opacity:v?0:1}})]}),e.type==="echarts"&&s.jsxs("div",{className:"w-full h-full bg-white overflow-hidden relative",children:[A&&s.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-white z-10",children:s.jsxs("div",{className:"flex flex-col items-center gap-3",children:[s.jsx("div",{className:"w-8 h-8 border-4 border-blue-200 border-t-blue-600 rounded-full animate-spin"}),s.jsx("p",{className:"text-sm text-gray-600",children:"..."})]})}),s.jsx("div",{ref:z,className:"w-full h-full",style:{opacity:A?0:1}})]}),e.type==="svg"&&s.jsx("div",{className:"w-full h-full relative bg-white overflow-auto hide-scrollbar",children:s.jsx("div",{className:"svg-content-wrapper w-full h-full flex items-center justify-center min-w-[100%] min-h-[100%] relative",style:{overflow:"visible"},dangerouslySetInnerHTML:{__html:l}})}),e.type==="markdown"&&s.jsx("div",{className:"w-full h-full bg-white p-8 overflow-y-auto markdown-body preview-markdown",dangerouslySetInnerHTML:{__html:fe(l)}}),e.type==="json"&&s.jsxs("div",{className:"w-full h-full bg-white overflow-y-auto p-0",children:[s.jsx("div",{className:"sticky top-0 z-10 bg-gray-50 border-b border-gray-200 px-4 py-2 text-xs font-medium text-gray-500 uppercase tracking-wider",children:"JSON Data Viewer"}),s.jsx("div",{className:"markdown-body p-4",children:s.jsx("pre",{className:"!m-0 !border-0 !bg-gray-50",children:s.jsx("code",{className:"language-json !bg-transparent !p-0",children:l})})})]}),e.type==="mindmap"&&s.jsx(IN,{content:l,onError:Q})]})]}),r==="code"&&s.jsx("div",{className:"flex-1 min-h-0 bg-[#f9fafb] overflow-hidden flex flex-col relative z-20",children:s.jsx("textarea",{value:l,onChange:V=>c(V.target.value),className:"w-full h-full p-6 font-mono text-sm resize-none outline-none border-none bg-transparent text-slate-800 leading-relaxed",spellCheck:!1,placeholder:"Edit code here..."})}),g&&s.jsxs("div",{className:"h-48 bg-white border-t border-gray-300 flex flex-col z-30 shadow-[0_-4px_12px_rgba(0,0,0,0.05)] flex-shrink-0 transition-all duration-200",children:[s.jsxs("div",{className:"h-7 bg-[#f1f3f4] border-b border-[#e0e0e0] flex items-center px-2 justify-between select-none",children:[s.jsxs("div",{className:"flex items-center gap-2 text-[11px] font-medium text-gray-600",children:[s.jsx(Ng,{className:"w-3 h-3 text-gray-500"}),"Console Output",y.length>0&&s.jsxs("span",{className:"text-gray-400 font-normal ml-1",children:[y.length," messages"]})]}),s.jsxs("div",{className:"flex items-center gap-1",children:[s.jsx("button",{onClick:()=>S([]),className:"p-1 hover:bg-gray-300/50 rounded text-gray-500 hover:text-gray-800 transition-colors",title:"Clear Console",children:s.jsx(NC,{className:"w-3 h-3"})}),s.jsx("button",{onClick:()=>x(!1),className:"p-1 hover:bg-gray-300/50 rounded text-gray-500 hover:text-gray-800 transition-colors",title:"Close",children:s.jsx(Er,{className:"w-3 h-3"})})]})]}),s.jsx("div",{ref:R,className:"flex-1 overflow-y-auto font-mono text-[11px] leading-relaxed bg-white",children:y.length===0?s.jsx("div",{className:"text-gray-400 italic p-3 text-center mt-4",children:"No logs to display"}):y.map((V,K)=>s.jsxs("div",{className:`px-2 py-1 border-b border-[#f0f0f0] flex gap-2 group font-medium select-text ${V.level==="error"?"bg-[#fff0f0] text-[#d32f2f] border-[#ffcdd2]":V.level==="warn"?"bg-[#fff8e1] text-[#f57c00] border-[#ffecb3]":"text-[#202124] hover:bg-[#f8f9fa]"}`,children:[s.jsx("div",{className:"flex-shrink-0 text-gray-400 w-[65px] text-[10px] select-none pt-0.5",children:new Date(V.timestamp).toLocaleTimeString([],{hour12:!1})}),s.jsxs("div",{className:"flex-1 break-words whitespace-pre-wrap relative",children:[V.count>1&&s.jsx("span",{className:"bg-gray-200 text-gray-600 px-1.5 rounded-[10px] text-[9px] font-bold mr-1.5 inline-block align-middle min-w-[18px] text-center",children:V.count}),s.jsx("span",{className:"align-middle",children:V.message})]})]},K))})]})]})]})}const EN=e=>{const t=e.match(/```/g);return t&&t.length%2!==0?`${e}
\`\`\``:e};function MN({systemPrompt:e,onOpenSystemPrompt:t}){const r=Be(),n=gt(),o=Xd.getInstance(),[i,l]=w.useState([]),[c,u]=w.useState(!1),[d,g]=w.useState(null),x=w.useMemo(()=>!!(e&&e.trim().length),[e]),y=w.useMemo(()=>{const h=r.currentProvider,v=r.currentModel;return h&&v?`${h.name}  ${v.name}`:""},[r.currentProvider,r.currentModel]),S=w.useCallback(()=>{const h=r.currentProvider,v=r.currentModel;return!h||!v||!h.apiKey?(n.warning(" AI  API Key"),null):{provider:h,model:v}},[r.currentProvider,r.currentModel,n]),T=w.useCallback(()=>{l([]),g(null)},[]),I=w.useCallback(()=>{r.setStreamMode(!r.streamMode)},[r]),b=w.useCallback(async h=>{var G;const v=(G=h==null?void 0:h.text)==null?void 0:G.trim();if(!v)return;const C=S();if(!C)return;const A={id:Date.now().toString(),role:"user",text:v,timestamp:Date.now()};l(R=>[...R,A]),u(!0);const P=`${Date.now()}_ai`,N={id:P,role:"model",text:"",displayText:"",isStreaming:!0,timestamp:Date.now()};l(R=>[...R,N]);const z=[...i,A].map(R=>({id:R.id,role:R.role==="model"?"assistant":"user",content:R.text,timestamp:R.timestamp})),L=r.streamMode;try{let R="";const F=O=>{R+=O,l(Q=>{const oe=[...Q],W=oe.find(U=>U.id===P);return W&&(W.text=R,W.displayText=EN(R)),oe});const q=Bg(R);q&&g(q)},D=await o.send({messages:z,provider:C.provider,modelId:C.model.id,stream:L,onChunk:L?F:void 0,systemPrompt:e});if(!L&&typeof D=="string"){l(q=>{const Q=[...q],oe=Q.find(W=>W.id===P);return oe&&(oe.text=D,oe.displayText=D,oe.isStreaming=!1),Q});const O=Bg(D);O&&g(O)}else l(O=>{const q=[...O],Q=q.find(oe=>oe.id===P);return Q&&(Q.isStreaming=!1,Q.displayText=Q.text),q})}catch(R){l(F=>{const D=[...F],O=D.find(q=>q.id===P);return O&&(O.text+=`

*Error: ${(R==null?void 0:R.message)||R}*`,O.displayText=O.text,O.isStreaming=!1),D})}finally{u(!1)}},[i,r.streamMode,e,o,S]);return s.jsx("div",{className:"w-full flex-1 flex flex-col overflow-hidden min-h-0",children:s.jsxs("div",{className:"flex flex-row gap-4 flex-1 min-h-0 overflow-hidden",children:[s.jsx("div",{className:"flex-1 min-h-0 flex flex-col overflow-hidden",children:s.jsx(CN,{messages:i,isStreaming:c,isStreamMode:r.streamMode,hasSystemPrompt:x,currentModelName:y,onSend:b,onClear:T,onToggleStream:I,onOpenSystemPrompt:t})}),s.jsx("div",{className:"flex-1 min-h-0 flex flex-col bg-[#f0f4f9] rounded-lg overflow-hidden",children:s.jsx(AN,{artifact:d})})]})})}const qg="yprompt_playground_system_prompt";function _N(){const e=Be(),[t,r]=w.useState(""),[n,o]=w.useState(""),[i,l]=w.useState(!1);w.useEffect(()=>{e.isInitialized||e.initialize()},[e]),w.useEffect(()=>{try{const d=localStorage.getItem(qg);d&&r(d)}catch(d){console.warn("",d)}},[]),w.useEffect(()=>{t&&localStorage.setItem(qg,t)},[t]);const c=()=>{o(t),l(!0)},u=()=>{r(n),l(!1)};return s.jsxs("div",{className:"w-full flex-1 flex flex-col overflow-hidden p-2 playground-container min-h-0",children:[i&&s.jsx(mc,{isOpen:i,modelValue:n,onUpdateModelValue:o,onClose:()=>l(!1),onSave:u}),s.jsx("div",{className:"bg-white rounded-lg shadow-sm p-4 mb-4 flex-shrink-0",children:s.jsx("div",{className:"flex flex-col gap-4 lg:flex-row lg:items-center lg:justify-between",children:s.jsxs("div",{className:"min-w-0",children:[s.jsx("h2",{className:"text-xl lg:text-2xl font-bold text-gray-900",children:""}),s.jsx("p",{className:"text-sm text-gray-500",children:" Artifact"})]})})}),s.jsx("div",{className:"flex-1 min-h-0 overflow-hidden",children:s.jsx(MN,{systemPrompt:t,onOpenSystemPrompt:c})})]})}class lo{static getApiBaseUrl(){return"https://api.prompt-ui.xiechengqi.top"}static getAuthHeaders(){const t=localStorage.getItem("yprompt_token");if(!t)throw new Error("");return{Authorization:`Bearer ${t}`,"Content-Type":"application/json"}}static async getVersionList(t,r=1,n=20,o){const i=new URLSearchParams({page:r.toString(),limit:n.toString()});return o&&i.append("tag",o),(await fetch(`${this.getApiBaseUrl()}/api/versions/${t}/versions?${i}`,{headers:this.getAuthHeaders()})).json()}static async getVersionDetail(t,r){return(await fetch(`${this.getApiBaseUrl()}/api/versions/${t}/versions/${r}`,{headers:this.getAuthHeaders()})).json()}static async createVersion(t,r){return(await fetch(`${this.getApiBaseUrl()}/api/versions/${t}`,{method:"POST",headers:this.getAuthHeaders(),body:JSON.stringify(r)})).json()}static async rollbackToVersion(t,r,n){return(await fetch(`${this.getApiBaseUrl()}/api/versions/${t}/versions/${r}/rollback`,{method:"POST",headers:this.getAuthHeaders(),body:JSON.stringify(n||{})})).json()}static async updateVersionTag(t,r,n){return(await fetch(`${this.getApiBaseUrl()}/api/versions/${t}/versions/${r}/tag`,{method:"PUT",headers:this.getAuthHeaders(),body:JSON.stringify({version_tag:n})})).json()}static async deleteVersion(t,r){const n=await fetch(`${this.getApiBaseUrl()}/api/versions/${t}/versions/${r}`,{method:"DELETE",headers:this.getAuthHeaders()});if(!n.ok)throw new Error(`HTTP ${n.status}`);return n.json()}}function Qx({version:e,promptId:t,onClose:r,onRollback:n}){const o=gt(),[i,l]=w.useState(null),[c,u]=w.useState(!1),d=async()=>{if(e)try{u(!0);const b=await lo.getVersionDetail(t,e.id);if(b.code===200)l(b.data);else throw new Error(b.message||"")}catch(b){console.error(":",b),o.error(`: ${b.message}`)}finally{u(!1)}};w.useEffect(()=>{e&&d()},[e,t]);const g=()=>{i&&n(i)},x=b=>({manual:"",auto:"",rollback:"",import:""})[b]||b,y=b=>({major:"",minor:"",patch:""})[b]||b,S=b=>new Date(b).toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"}),T=b=>b<1024?`${b}B`:b<1024*1024?`${(b/1024).toFixed(1)}KB`:`${(b/(1024*1024)).toFixed(1)}MB`,I=b=>{try{const h=JSON.parse(b);return Array.isArray(h)?h.map((v,C)=>`[${C+1}] ${v.role}: ${v.content}`).join(`

`):b}catch{return b}};return s.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-[60] p-4",onClick:r,children:s.jsxs("div",{className:"bg-white rounded-lg max-w-4xl w-full max-h-[90vh] overflow-hidden flex flex-col",onClick:b=>b.stopPropagation(),children:[s.jsxs("div",{className:"flex items-center justify-between p-6 border-b",children:[s.jsx("h2",{className:"text-xl font-bold text-gray-900",children:""}),s.jsx("button",{onClick:r,className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",title:"",children:s.jsx(Er,{className:"w-5 h-5"})})]}),s.jsx("div",{className:"flex-1 overflow-y-auto p-6",children:c?s.jsx("div",{className:"flex items-center justify-center h-32",children:s.jsxs("div",{className:"flex items-center gap-2 text-gray-500",children:[s.jsx("div",{className:"w-4 h-4 border-2 border-blue-500 border-t-transparent rounded-full animate-spin"}),s.jsx("span",{children:"..."})]})}):i?s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{children:[s.jsxs("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:["v",i.version_number]}),s.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[s.jsxs("div",{children:[s.jsx("span",{className:"text-gray-600",children:""}),s.jsx("span",{className:"text-gray-900",children:S(i.create_time)})]}),s.jsxs("div",{children:[s.jsx("span",{className:"text-gray-600",children:""}),s.jsx("span",{className:"text-gray-900",children:i.author_name})]}),s.jsxs("div",{children:[s.jsx("span",{className:"text-gray-600",children:""}),s.jsx("span",{className:"text-gray-900",children:x(i.version_type)})]}),s.jsxs("div",{children:[s.jsx("span",{className:"text-gray-600",children:""}),s.jsx("span",{className:"text-gray-900",children:y(i.change_type)})]})]})]}),s.jsxs("div",{className:"border-t pt-6",children:[s.jsxs("h4",{className:"text-sm font-semibold text-gray-900 mb-2 flex items-center gap-2",children:[s.jsx(jx,{className:"w-4 h-4"}),""]}),s.jsx("p",{className:"text-sm text-gray-700",children:i.change_summary||""}),i.change_log&&s.jsx("div",{className:"mt-3 p-3 bg-gray-50 rounded text-sm text-gray-700 whitespace-pre-wrap",children:i.change_log})]}),s.jsxs("div",{className:"border-t pt-6",children:[s.jsxs("h4",{className:"text-sm font-semibold text-gray-900 mb-2 flex items-center gap-2",children:[s.jsx(AC,{className:"w-4 h-4"}),""]}),s.jsxs("div",{className:"grid grid-cols-3 gap-4 text-sm",children:[s.jsxs("div",{children:[s.jsx("span",{className:"text-gray-600",children:""}),s.jsx("span",{className:"text-gray-900",children:T(i.content_size)})]}),s.jsxs("div",{children:[s.jsx("span",{className:"text-gray-600",children:""}),s.jsxs("span",{className:"text-gray-900",children:[i.use_count," "]})]}),s.jsxs("div",{children:[s.jsx("span",{className:"text-gray-600",children:""}),s.jsxs("span",{className:"text-gray-900",children:[i.rollback_count," "]})]})]})]}),(i.system_prompt||i.conversation_history)&&s.jsxs("div",{className:"border-t pt-6",children:[s.jsxs("h4",{className:"text-sm font-semibold text-gray-900 mb-3 flex items-center gap-2",children:[s.jsx(ac,{className:"w-4 h-4"}),""]}),i.system_prompt&&s.jsxs("div",{className:"mb-4",children:[s.jsx("h5",{className:"text-xs font-semibold text-gray-700 mb-2",children:""}),s.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-3 max-h-48 overflow-y-auto",children:s.jsx("pre",{className:"text-sm text-gray-800 whitespace-pre-wrap font-mono",children:i.system_prompt})})]}),i.conversation_history&&s.jsxs("div",{className:"mb-4",children:[s.jsx("h5",{className:"text-xs font-semibold text-gray-700 mb-2",children:""}),s.jsx("div",{className:"bg-green-50 border border-green-200 rounded-lg p-3 max-h-48 overflow-y-auto",children:s.jsx("pre",{className:"text-sm text-gray-800 whitespace-pre-wrap font-mono",children:I(i.conversation_history)})})]})]}),s.jsxs("div",{className:"border-t pt-6",children:[s.jsxs("h4",{className:"text-sm font-semibold text-gray-900 mb-3 flex items-center gap-2",children:[s.jsx(Ma,{className:"w-4 h-4"}),i.system_prompt||i.conversation_history?"":""]}),s.jsx("div",{className:"bg-gray-50 rounded-lg p-4 max-h-96 overflow-y-auto",children:s.jsx("pre",{className:"text-sm text-gray-800 whitespace-pre-wrap font-mono",children:i.final_prompt||""})})]}),i.tags&&i.tags.length>0&&s.jsxs("div",{className:"border-t pt-6",children:[s.jsxs("h4",{className:"text-sm font-semibold text-gray-900 mb-3 flex items-center gap-2",children:[s.jsx(xP,{className:"w-4 h-4"}),""]}),s.jsx("div",{className:"flex flex-wrap gap-2",children:i.tags.map(b=>s.jsx("span",{className:"px-3 py-1 bg-gray-100 text-gray-700 text-sm rounded-full",children:b},b))})]})]}):null}),s.jsxs("div",{className:"flex justify-end space-x-3 p-6 border-t bg-gray-50",children:[s.jsx("button",{onClick:r,className:"px-4 py-2 text-gray-600 border border-gray-300 rounded-md hover:bg-gray-50",children:""}),s.jsx("button",{onClick:g,className:"px-4 py-2 bg-blue-500 text-white rounded-md hover:bg-blue-600",children:""})]})]})})}function RN({promptId:e,onRollback:t}){const r=gt(),[n,o]=w.useState([]),[i,l]=w.useState(!1),[c,u]=w.useState(!1),[d,g]=w.useState(null),x=async()=>{try{l(!0);const h=await lo.getVersionList(e,1,10);if(h.code===200)o(h.data.items);else throw new Error(h.message||"")}catch(h){console.error(":",h),r.error(`: ${h.message}`)}finally{l(!1)}};w.useEffect(()=>{x()},[e]);const y=h=>{g(h),u(!0)},S=async h=>{if(confirm(` v${h.version_number} `))try{const v=await lo.rollbackToVersion(e,h.id,{change_summary:` ${h.version_number}`});if(v.code===200)r.success(` v${h.version_number}`),t(h.version_number),x(),u(!1);else throw new Error(v.message||"")}catch(v){console.error(":",v),r.error(`: ${v.message}`)}},T=async h=>{if(confirm(` v${h.version_number} `))try{const v=await lo.deleteVersion(e,h.id);if(v.code===200)r.success(` v${h.version_number} `),x();else throw new Error(v.message||"")}catch(v){console.error(":",v),r.error(`: ${v.message}`)}},I=h=>{const v=new Date(h),A=new Date().getTime()-v.getTime(),P=Math.floor(A/(1e3*60*60*24));return P===0?" "+v.toLocaleTimeString("zh-CN",{hour:"2-digit",minute:"2-digit"}):P===1?" "+v.toLocaleTimeString("zh-CN",{hour:"2-digit",minute:"2-digit"}):P<7?`${P}`:v.toLocaleDateString("zh-CN",{month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"})},b=h=>h<1024?`${h}B`:h<1024*1024?`${(h/1024).toFixed(1)}KB`:`${(h/(1024*1024)).toFixed(1)}MB`;return s.jsxs(s.Fragment,{children:[s.jsx("div",{className:"h-full flex flex-col",children:i?s.jsx("div",{className:"flex items-center justify-center h-32",children:s.jsxs("div",{className:"flex items-center gap-2 text-gray-500",children:[s.jsx("div",{className:"w-4 h-4 border-2 border-blue-500 border-t-transparent rounded-full animate-spin"}),s.jsx("span",{children:"..."})]})}):n.length===0?s.jsxs("div",{className:"flex flex-col items-center justify-center h-32 text-center",children:[s.jsx("svg",{className:"w-12 h-12 mb-2 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})}),s.jsx("p",{className:"text-gray-600",children:""})]}):s.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3 overflow-y-auto pr-2",children:n.map(h=>s.jsxs("div",{onClick:()=>y(h),className:"border border-gray-200 rounded-md p-2.5 hover:shadow-md transition-shadow cursor-pointer",children:[s.jsx("div",{className:"flex items-start justify-between mb-1.5",children:s.jsxs("div",{className:"flex-1 min-w-0",children:[s.jsxs("div",{className:"flex items-center gap-2 mb-0.5",children:[s.jsxs("h4",{className:"text-sm font-semibold text-gray-900",children:["v",h.version_number]}),s.jsx("span",{className:"text-xs text-gray-500",children:I(h.create_time)})]}),s.jsx("p",{className:"text-xs text-gray-600 line-clamp-1",children:h.change_summary||""})]})}),s.jsxs("div",{className:"flex items-center text-xs text-gray-500 mb-1.5",children:[s.jsxs("span",{className:"flex items-center gap-0.5",children:[s.jsx("svg",{className:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"})}),s.jsx("span",{className:"truncate max-w-[80px]",children:h.author_name})]}),s.jsx("span",{className:"mx-2 text-gray-300",children:""}),s.jsxs("span",{className:"flex items-center gap-0.5",children:[s.jsx("svg",{className:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4"})}),b(h.content_size)]})]}),s.jsxs("div",{className:"flex items-center gap-1.5 pt-1.5 border-t border-gray-100",children:[s.jsxs("button",{onClick:v=>{v.stopPropagation(),S(h)},className:"px-2 py-1 text-xs bg-blue-50 hover:bg-blue-100 text-blue-600 rounded transition-colors flex items-center gap-1",children:[s.jsx("svg",{className:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})}),s.jsx("span",{children:""})]}),s.jsx("button",{onClick:v=>{v.stopPropagation(),T(h)},className:"px-2 py-1 text-xs bg-red-50 hover:bg-red-100 text-red-600 rounded transition-colors flex items-center justify-center",title:"",children:s.jsx("svg",{className:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})})]})]},h.id))})}),c&&d&&s.jsx(Qx,{version:d,promptId:e,onClose:()=>u(!1),onRollback:S})]})}function zN({prompt:e,onClose:t,onEdit:r,onOptimize:n,onRollback:o}){const i=gt(),[l,c]=w.useState("content"),[u,d]=w.useState(!1),[g,x]=w.useState(""),[y,S]=w.useState(""),[T,I]=w.useState(""),[b,h]=w.useState("system"),[v,C]=w.useState(!1),[A,P]=w.useState([]),[N,z]=w.useState(""),[L,G]=w.useState(!1),[R,F]=w.useState(!1),D=w.useRef(null),O=!!e,q=w.useMemo(()=>{if(!e)return[];const fe=e.tags;return Array.isArray(fe)?fe:typeof fe=="string"?fe.split(",").map(He=>He.trim()).filter(He=>He):[]},[e]),Q=[{key:"content",label:""},{key:"info",label:""},{key:"versions",label:""}];w.useEffect(()=>{L&&D.current&&D.current.focus()},[L]),w.useEffect(()=>{if(e&&u){x(e.final_prompt),S(e.title),I(e.description||""),h(e.prompt_type||"system"),C(!!e.is_public);const fe=e.tags;P(Array.isArray(fe)?[...fe]:typeof fe=="string"?fe.split(",").map(He=>He.trim()).filter(He=>He):[])}},[e,u]);const oe=()=>{d(!1),t(),c("content")},W=()=>{e&&d(!0)},U=()=>{d(!1),x(""),S(""),I(""),h("system"),C(!1),P([]),z(""),G(!1)},te=()=>{const fe=N.trim();if(fe){if(A.length>=5){i.warning("5",2e3);return}if(A.includes(fe)){i.warning("",2e3),z("");return}if(fe.length>8){i.warning("8",2e3);return}P([...A,fe]),z(""),G(!1)}},ne=fe=>{P(A.filter((He,ce)=>ce!==fe))},Ce=async()=>{if(e)try{F(!0);const fe=await Ax(`/api/prompts/${e.id}`,{title:y.trim(),description:T.trim(),final_prompt:g,prompt_type:b,is_public:v?1:0,tags:A});if(fe.code===200){i.success("",2e3),d(!1);const He={...e,title:y.trim(),description:T.trim(),final_prompt:g,prompt_type:b,is_public:v?1:0,tags:A};r(He)}else throw new Error(fe.message||"")}catch(fe){console.error(":",fe),i.error(`: ${fe.message}`,3e3)}finally{F(!1)}},ze=async()=>{if(e)try{await Hn(e.final_prompt),i.success("",2e3)}catch(fe){console.error(":",fe),i.error("",2e3)}},Qe=fe=>new Date(fe).toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"});return!O||!e?null:s.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50 p-4",children:s.jsxs("div",{className:"prompt-detail-modal bg-white rounded-lg shadow-xl w-full h-[90vh] max-w-6xl mx-4 overflow-hidden flex flex-col",children:[s.jsxs("div",{className:"flex items-start justify-between p-6 border-b bg-gray-50",children:[s.jsx("div",{className:"flex-1 min-w-0",children:u?s.jsxs("div",{className:"space-y-3",children:[s.jsxs("div",{className:"flex items-center gap-4",children:[s.jsx("div",{className:"flex-1 min-w-0",children:s.jsx("input",{value:y,onChange:fe=>S(fe.target.value),type:"text",className:"w-full px-3 py-2 border border-gray-300 rounded-lg outline-none text-xl font-semibold text-gray-900",placeholder:""})}),s.jsxs("div",{className:"flex items-center gap-2 flex-shrink-0",children:[s.jsxs("button",{onClick:U,className:"px-3 py-1.5 text-sm bg-gray-500 hover:bg-gray-600 text-white rounded-lg transition-colors flex items-center gap-1",children:[s.jsx(Er,{className:"w-4 h-4"}),""]}),s.jsx("button",{onClick:Ce,disabled:R,className:"px-3 py-1.5 text-sm bg-green-500 hover:bg-green-600 text-white rounded-lg transition-colors flex items-center gap-1 disabled:opacity-50",children:R?"...":s.jsxs(s.Fragment,{children:[s.jsx(Cx,{className:"w-4 h-4"}),""]})})]})]}),s.jsx("textarea",{value:T,onChange:fe=>I(fe.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg outline-none text-sm text-gray-700 resize-none",rows:2,placeholder:""}),s.jsxs("div",{className:"flex items-center gap-3 px-3 py-2 bg-gray-50 rounded-lg border border-gray-200",children:[s.jsxs("div",{className:"flex items-center gap-1.5",children:[s.jsx("span",{className:"text-xs font-medium text-gray-600",children:""}),s.jsxs("div",{className:"flex gap-2",children:[s.jsxs("label",{className:"flex items-center cursor-pointer group",children:[s.jsx("input",{type:"radio",checked:b==="system",onChange:()=>h("system"),className:"w-3.5 h-3.5 text-purple-600 border-gray-300 focus:ring-purple-500 focus:ring-1"}),s.jsx("span",{className:"ml-1 text-xs text-gray-700 group-hover:text-purple-600",children:""})]}),s.jsxs("label",{className:"flex items-center cursor-pointer group",children:[s.jsx("input",{type:"radio",checked:b==="user",onChange:()=>h("user"),className:"w-3.5 h-3.5 text-blue-600 border-gray-300 focus:ring-blue-500 focus:ring-1"}),s.jsx("span",{className:"ml-1 text-xs text-gray-700 group-hover:text-blue-600",children:""})]})]})]}),s.jsx("div",{className:"w-px h-4 bg-gray-300"}),s.jsxs("label",{className:"flex items-center cursor-pointer group",children:[s.jsx("input",{type:"checkbox",checked:v,onChange:fe=>C(fe.target.checked),className:"w-3.5 h-3.5 text-green-600 border-gray-300 rounded focus:ring-green-500 focus:ring-1"}),s.jsx("span",{className:"ml-1 text-xs text-gray-700 group-hover:text-green-600",children:""})]}),s.jsx("div",{className:"w-px h-4 bg-gray-300"}),s.jsxs("div",{className:"flex items-center gap-1.5 flex-1 min-w-0",children:[s.jsx("span",{className:"text-xs font-medium text-gray-600 flex-shrink-0",children:""}),s.jsxs("div",{className:"flex items-center gap-1 flex-wrap flex-1 min-w-0",children:[A.map((fe,He)=>s.jsxs("span",{className:"inline-flex items-center gap-0.5 px-1.5 py-0.5 bg-blue-100 text-blue-700 text-xs rounded hover:bg-blue-200 transition-colors",children:[s.jsx("span",{className:"max-w-[80px] truncate",children:fe}),s.jsx("button",{onClick:()=>ne(He),className:"text-blue-600 hover:text-blue-800 font-bold text-sm leading-none",title:"",children:""})]},He)),A.length<5?s.jsx("button",{onClick:()=>G(!L),className:"inline-flex items-center gap-0.5 px-1.5 py-0.5 bg-gray-200 hover:bg-gray-300 text-gray-600 text-xs rounded transition-colors",title:"",children:s.jsx("span",{children:"+"})}):s.jsx("span",{className:"text-xs text-gray-400",children:"(5)"})]})]})]}),L&&s.jsx("div",{className:"px-3",children:s.jsxs("div",{className:"flex items-center gap-2 p-2 bg-blue-50 border border-blue-200 rounded-lg",children:[s.jsx("input",{ref:D,value:N,onChange:fe=>z(fe.target.value),type:"text",placeholder:"8",maxLength:8,className:"flex-1 px-2 py-1 border border-gray-300 rounded outline-none text-sm focus:border-blue-500 focus:ring-1 focus:ring-blue-500",onKeyDown:fe=>{fe.key==="Enter"?(fe.preventDefault(),te()):fe.key==="Escape"&&(G(!1),z(""))}}),s.jsx("button",{onClick:te,className:"px-3 py-1 bg-blue-500 hover:bg-blue-600 text-white text-sm rounded transition-colors",children:""}),s.jsx("button",{onClick:()=>{G(!1),z("")},className:"px-3 py-1 bg-gray-300 hover:bg-gray-400 text-gray-700 text-sm rounded transition-colors",children:""})]})})]}):s.jsx("div",{children:s.jsxs("div",{className:"flex items-center gap-4",children:[s.jsxs("div",{className:"flex-1 min-w-0",children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("h2",{className:"text-xl font-semibold text-gray-900 truncate",children:e.title}),s.jsx("span",{className:`px-2 py-0.5 text-xs font-medium rounded border flex-shrink-0 ${e.prompt_type==="system"?"bg-purple-100 text-purple-700 border-purple-200":"bg-blue-100 text-blue-700 border-blue-200"}`,children:e.prompt_type==="system"?"":""})]}),e.description&&s.jsx("p",{className:"text-sm text-gray-600 mt-1 truncate",children:e.description})]}),s.jsxs("div",{className:"flex items-center gap-2 flex-shrink-0",children:[s.jsxs("button",{onClick:ze,className:"px-3 py-1.5 text-sm bg-gray-100 hover:bg-gray-200 text-gray-700 rounded-lg transition-colors flex items-center gap-1",children:[s.jsx(wr,{className:"w-4 h-4"}),""]}),s.jsxs("button",{onClick:W,"data-edit":"prompt-detail",className:"px-3 py-1.5 text-sm bg-blue-500 hover:bg-blue-600 text-white rounded-lg transition-colors flex items-center gap-1",children:[s.jsx(jx,{className:"w-4 h-4"}),""]}),s.jsxs("button",{onClick:()=>n(e),className:"px-3 py-1.5 text-sm bg-green-500 hover:bg-green-600 text-white rounded-lg transition-colors flex items-center gap-1",children:[s.jsx(PP,{className:"w-4 h-4"}),""]})]})]})})}),s.jsx("button",{onClick:oe,className:"text-gray-400 hover:text-gray-600 ml-4",children:s.jsx(Er,{className:"w-6 h-6"})})]}),e&&s.jsxs("div",{className:"flex-1 overflow-hidden flex flex-col",children:[!u&&s.jsx("div",{className:"px-6 py-3 bg-gray-50 border-b",children:s.jsxs("div",{className:"flex items-center flex-wrap gap-4 text-sm text-gray-600",children:[s.jsxs("span",{className:"flex items-center gap-1",children:[s.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M3.055 11H5a2 2 0 012 2v1a2 2 0 002 2 2 2 0 012 2v2.945M8 3.935V5.5A2.5 2.5 0 0010.5 8h.5a2 2 0 012 2 2 2 0 104 0 2 2 0 012-2h1.064M15 20.488V18a2 2 0 012-2h3.064M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),e.is_public?"":""]}),s.jsx("span",{className:"w-px h-4 bg-gray-300"}),s.jsxs("span",{className:"flex items-center gap-1",children:[s.jsxs("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"}),s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"})]}),e.view_count||0]}),s.jsxs("span",{className:"flex items-center gap-1",children:[s.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"})}),e.use_count||0]}),s.jsxs("span",{className:"flex items-center gap-1",children:[s.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M7 7h.01M7 3h5c.512 0 1.024.195 1.414.586l7 7a2 2 0 010 2.828l-7 7a2 2 0 01-2.828 0l-7-7A1.994 1.994 0 013 12V7a4 4 0 014-4z"})}),"v",e.current_version||"1.0.0"]}),s.jsxs("span",{className:"flex items-center gap-1",children:[e.is_favorite?s.jsx("svg",{className:"w-4 h-4 text-yellow-500",fill:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{d:"M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"})}):s.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M11.049 2.927c.3-.921 1.603-.921 1.902 0l1.519 4.674a1 1 0 00.95.69h4.915c.969 0 1.371 1.24.588 1.81l-3.976 2.888a1 1 0 00-.363 1.118l1.518 4.674c.3.922-.755 1.688-1.538 1.118l-3.976-2.888a1 1 0 00-1.176 0l-3.976 2.888c-.783.57-1.838-.197-1.538-1.118l1.518-4.674a1 1 0 00-.363-1.118l-3.976-2.888c-.784-.57-.38-1.81.588-1.81h4.914a1 1 0 00.951-.69l1.519-4.674z"})}),e.is_favorite?"":""]}),s.jsx("span",{className:"w-px h-4 bg-gray-300"}),s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("span",{children:":"}),s.jsx("div",{className:"flex flex-wrap gap-1",children:q.length>0?q.map(fe=>s.jsx("span",{className:"inline-block px-2 py-1 bg-blue-100 text-blue-700 text-xs rounded-full",children:fe},fe)):s.jsx("span",{className:"text-xs text-gray-500",children:""})})]})]})}),s.jsxs("div",{className:"flex-1 overflow-hidden flex flex-col",children:[s.jsx("div",{className:"flex border-b",children:Q.map(fe=>s.jsx("button",{onClick:()=>c(fe.key),className:`flex-1 px-4 py-3 text-sm font-medium transition-colors ${l===fe.key?"text-blue-600 border-b-2 border-blue-600 bg-blue-50":"text-gray-600 hover:text-gray-800 hover:bg-gray-50"}`,children:fe.label},fe.key))}),s.jsxs("div",{className:"flex-1 overflow-y-auto p-6",children:[l==="content"&&s.jsx("div",{className:"h-full",children:u?s.jsx("textarea",{value:g,onChange:fe=>x(fe.target.value),className:"w-full h-full p-4 outline-none resize-none text-sm text-gray-800 font-mono bg-gradient-to-br from-gray-50 to-gray-100 rounded-lg border border-gray-200",placeholder:"..."}):s.jsx("pre",{className:"h-full p-4 whitespace-pre-wrap text-sm text-gray-800 font-mono overflow-auto bg-gradient-to-br from-gray-50 to-gray-100 rounded-lg border border-gray-200",children:e.final_prompt})}),l==="info"&&s.jsx("div",{className:"space-y-4",children:s.jsx("div",{children:s.jsxs("dl",{className:"space-y-3",children:[s.jsxs("div",{className:"flex",children:[s.jsx("dt",{className:"w-32 text-sm font-medium text-gray-600",children:":"}),s.jsx("dd",{className:"text-sm text-gray-900",children:e.title})]}),s.jsxs("div",{className:"flex",children:[s.jsx("dt",{className:"w-32 text-sm font-medium text-gray-600",children:":"}),s.jsx("dd",{className:"text-sm text-gray-900",children:e.description||""})]}),s.jsxs("div",{className:"flex",children:[s.jsx("dt",{className:"w-32 text-sm font-medium text-gray-600",children:":"}),s.jsx("dd",{className:"text-sm text-gray-900",children:e.language==="zh"?"":""})]}),s.jsxs("div",{className:"flex",children:[s.jsx("dt",{className:"w-32 text-sm font-medium text-gray-600",children:":"}),s.jsx("dd",{className:"text-sm text-gray-900",children:e.format})]}),s.jsxs("div",{className:"flex",children:[s.jsx("dt",{className:"w-32 text-sm font-medium text-gray-600",children:":"}),s.jsx("dd",{className:"text-sm text-gray-900",children:e.final_prompt.length})]}),s.jsxs("div",{className:"flex",children:[s.jsx("dt",{className:"w-32 text-sm font-medium text-gray-600",children:":"}),s.jsx("dd",{className:"text-sm text-gray-900",children:Qe(e.create_time)})]}),s.jsxs("div",{className:"flex",children:[s.jsx("dt",{className:"w-32 text-sm font-medium text-gray-600",children:":"}),s.jsx("dd",{className:"text-sm text-gray-900",children:Qe(e.update_time)})]}),e.prompt_type==="user"&&s.jsxs(s.Fragment,{children:[s.jsxs("div",{className:"pt-3 border-t border-gray-200",children:[s.jsx("dt",{className:"text-sm font-medium text-gray-600 mb-2",children:":"}),s.jsx("dd",{className:"text-sm text-gray-900",children:"system_prompt"in e&&e.system_prompt?s.jsx("pre",{className:"p-3 bg-gray-50 rounded border border-gray-200 whitespace-pre-wrap font-mono text-xs",children:e.system_prompt}):s.jsx("span",{className:"text-gray-400 italic",children:""})})]}),s.jsxs("div",{className:"pt-3 border-t border-gray-200",children:[s.jsx("dt",{className:"text-sm font-medium text-gray-600 mb-2",children:":"}),s.jsx("dd",{className:"text-sm text-gray-900",children:"conversation_history"in e&&e.conversation_history?s.jsx("pre",{className:"p-3 bg-gray-50 rounded border border-gray-200 whitespace-pre-wrap font-mono text-xs",children:e.conversation_history}):s.jsx("span",{className:"text-gray-400 italic",children:""})})]})]})]})})}),l==="versions"&&s.jsx("div",{className:"h-full",children:s.jsx(RN,{promptId:e.id,onRollback:o})})]})]})]})]})})}function LN({isOpen:e,promptId:t,onClose:r,onRollback:n}){const o=gt(),[i,l]=w.useState([]),[c,u]=w.useState(!1),[d,g]=w.useState(!1),[x,y]=w.useState(null),S=async()=>{try{u(!0);const A=await lo.getVersionList(t,1,10);if(A.code===200)l(A.data.items);else throw new Error(A.message||"")}catch(A){console.error(":",A),o.error(`: ${A.message}`)}finally{u(!1)}};w.useEffect(()=>{e&&S()},[e,t]);const T=A=>{y(A),g(!0)},I=async A=>{if(confirm(` v${A.version_number} `))try{const P=await lo.rollbackToVersion(t,A.id,{change_summary:` ${A.version_number}`});if(P.code===200)o.success(` v${A.version_number}`),n(A.version_number),S(),g(!1);else throw new Error(P.message||"")}catch(P){console.error(":",P),o.error(`: ${P.message}`)}},b=async A=>{if(confirm(` v${A.version_number} `))try{const P=await lo.deleteVersion(t,A.id);if(P.code===200)o.success(` v${A.version_number} `),S();else throw new Error(P.message||"")}catch(P){console.error(":",P),o.error(`: ${P.message}`)}},h=()=>{r()},v=A=>{const P=new Date(A),z=new Date().getTime()-P.getTime(),L=Math.floor(z/(1e3*60*60*24));return L===0?" "+P.toLocaleTimeString("zh-CN",{hour:"2-digit",minute:"2-digit"}):L===1?" "+P.toLocaleTimeString("zh-CN",{hour:"2-digit",minute:"2-digit"}):L<7?`${L}`:P.toLocaleDateString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"})},C=A=>A<1024?`${A}B`:A<1024*1024?`${(A/1024).toFixed(1)}KB`:`${(A/(1024*1024)).toFixed(1)}MB`;return e?s.jsxs(s.Fragment,{children:[s.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",onClick:h,children:s.jsxs("div",{className:"bg-white rounded-lg max-w-3xl w-full max-h-[85vh] overflow-hidden flex flex-col",onClick:A=>A.stopPropagation(),children:[s.jsxs("div",{className:"flex items-center justify-between p-6 border-b",children:[s.jsxs("div",{children:[s.jsxs("h2",{className:"text-xl font-bold text-gray-900 flex items-center gap-2",children:[s.jsx(nh,{className:"w-6 h-6"}),""]}),s.jsxs("p",{className:"text-sm text-gray-600 mt-1",children:[" ",i.length," "]})]}),s.jsx("button",{onClick:h,className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",title:"",children:s.jsx(Er,{className:"w-5 h-5"})})]}),s.jsx("div",{className:"flex-1 overflow-y-auto p-6",children:c?s.jsx("div",{className:"flex items-center justify-center h-32",children:s.jsxs("div",{className:"flex items-center gap-2 text-gray-500",children:[s.jsx("div",{className:"w-4 h-4 border-2 border-blue-500 border-t-transparent rounded-full animate-spin"}),s.jsx("span",{children:"..."})]})}):i.length===0?s.jsxs("div",{className:"flex flex-col items-center justify-center h-32 text-center",children:[s.jsx("svg",{className:"w-12 h-12 mb-2 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})}),s.jsx("p",{className:"text-gray-600",children:""})]}):s.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:i.map(A=>s.jsxs("div",{onClick:()=>T(A),className:"border border-gray-200 rounded-lg p-4 hover:shadow-md transition-shadow cursor-pointer",children:[s.jsx("div",{className:"flex items-start justify-between mb-3",children:s.jsxs("div",{className:"flex-1 min-w-0",children:[s.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[s.jsxs("h3",{className:"text-base font-semibold text-gray-900",children:["v",A.version_number]}),s.jsx("span",{className:"text-xs text-gray-500",children:v(A.create_time)})]}),s.jsx("p",{className:"text-sm text-gray-700 line-clamp-2",children:A.change_summary||""})]})}),s.jsx("div",{className:"flex items-center justify-between text-xs text-gray-500 mb-3",children:s.jsxs("div",{className:"flex items-center gap-4",children:[s.jsxs("span",{className:"flex items-center gap-1",children:[s.jsx("svg",{className:"w-3.5 h-3.5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"})}),A.author_name]}),s.jsxs("span",{className:"flex items-center gap-1",children:[s.jsx("svg",{className:"w-3.5 h-3.5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4"})}),C(A.content_size)]})]})}),s.jsxs("div",{className:"flex items-center gap-2 pt-3 border-t border-gray-100",children:[s.jsxs("button",{onClick:P=>{P.stopPropagation(),I(A)},className:"flex-1 px-3 py-1.5 text-sm bg-blue-100 hover:bg-blue-200 text-blue-700 rounded transition-colors flex items-center justify-center gap-1",children:[s.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})}),""]}),s.jsx("button",{onClick:P=>{P.stopPropagation(),b(A)},className:"px-3 py-1.5 text-sm bg-red-100 hover:bg-red-200 text-red-700 rounded transition-colors flex items-center justify-center",title:"",children:s.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})})]})]},A.id))})})]})}),d&&x&&s.jsx(Qx,{version:x,promptId:t,onClose:()=>g(!1),onRollback:I})]}):null}const Jx=w.forwardRef(({searchKeyword:e},t)=>{const r=Ci(),n=ui(),o=gt(),[i,l]=w.useState([]),[c,u]=w.useState(!1),[d,g]=w.useState(1),x=10,[y,S]=w.useState(0),[T]=w.useState(""),[I]=w.useState("create_time"),[b]=w.useState("0"),[,h]=w.useState([]),[v,C]=w.useState({}),[A,P]=w.useState(!1),[N,z]=w.useState(null),[L,G]=w.useState(!1),[R,F]=w.useState(null),[D,O]=w.useState(""),q=Math.ceil(y/x);w.useImperativeHandle(t,()=>({searchWithKeyword:ce=>{O(ce),g(1),Q()},loadPrompts:Q})),w.useEffect(()=>{e!==D&&(O(e),g(1),Q())},[e]);const Q=async()=>{try{u(!0);const ce=new URLSearchParams({page:d.toString(),limit:x.toString(),keyword:D,tag:T,sort:I,is_favorite:b}),V=await _a(`/api/prompts/?${ce}`);if(V.code===200){l(V.data.items.map(xe=>({...xe,final_prompt:xe.final_prompt||"",current_version:xe.current_version||"1.0.0"}))),S(V.data.total);const K=new Set;V.data.items.forEach(xe=>{xe.tags&&(Array.isArray(xe.tags)?xe.tags:[]).forEach(Je=>K.add(Je))}),h(Array.from(K).sort())}else throw new Error(V.message||"")}catch(ce){console.error(":",ce),o.error(`: ${ce.message}`,3e3)}finally{u(!1)}},oe=ce=>{g(ce)};w.useEffect(()=>{Q()},[d,T,I,b]);const W=async ce=>{try{const V=await _a(`/api/prompts/${ce.id}`);V.code===200&&(z(V.data),P(!0))}catch(V){console.error(":",V),z(ce),P(!0)}},U=ce=>{z(ce),P(!0),setTimeout(()=>{const V=document.querySelector('button[data-edit="prompt-detail"]');V&&V.click()},100)},te=ce=>{l(V=>V.map(K=>K.id===ce.id?{...ce}:K)),P(!1)},ne=ce=>{n.setCurrentModule("optimize"),r(`/optimize/${ce.id}`),P(!1)},Ce=async ce=>{try{await Hn(ce.final_prompt),o.success("",2e3)}catch(V){console.error(":",V),o.error("",2e3)}},ze=ce=>{F(ce),G(!0),C({})},Qe=()=>{Q()},fe=async ce=>{if(confirm(`"${ce.title}"`))try{const V=await oh(`/api/prompts/${ce.id}`);if(V.code===200)o.success("",2e3),Q();else throw new Error(V.message||"")}catch(V){console.error(":",V),o.error(`: ${V.message}`,3e3)}},He=ce=>new Date(ce).toLocaleDateString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"});return w.useEffect(()=>{const ce=V=>{V.target.closest(".relative.group")||C({})};return document.addEventListener("click",ce),()=>document.removeEventListener("click",ce)},[]),s.jsxs("div",{className:"h-full flex flex-col",children:[s.jsxs("div",{className:"flex-1 overflow-y-auto p-4",children:[c&&s.jsx("div",{className:"flex items-center justify-center h-32",children:s.jsxs("div",{className:"flex items-center gap-2 text-gray-500",children:[s.jsx("div",{className:"w-4 h-4 border-2 border-blue-500 border-t-transparent rounded-full animate-spin"}),s.jsx("span",{children:"..."})]})}),!c&&i.length===0&&s.jsxs("div",{className:"flex flex-col items-center justify-center h-64 text-center",children:[s.jsx("svg",{className:"w-16 h-16 mb-4 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})}),s.jsx("h3",{className:"text-lg font-semibold text-gray-800 mb-2",children:D||T?"":""}),s.jsx("p",{className:"text-gray-600 mb-4",children:D||T?"":""}),s.jsx("a",{href:"/generate",className:"inline-block px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg transition-colors",children:""})]}),!c&&i.length>0&&s.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:i.map(ce=>s.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg p-4 hover:shadow-md transition-shadow cursor-pointer",onClick:()=>W(ce),children:[s.jsxs("div",{className:"flex items-start justify-between gap-3 mb-3",children:[s.jsxs("div",{className:"flex-1 min-w-0",children:[s.jsx("h3",{className:"text-base font-medium text-gray-900 truncate mb-1",children:ce.title}),s.jsx("p",{className:"text-sm text-gray-600 line-clamp-2 h-10",children:ce.description||""})]}),s.jsx("span",{className:`px-2 py-0.5 text-xs font-medium rounded border flex-shrink-0 ${ce.prompt_type==="system"?"bg-purple-100 text-purple-700 border-purple-200":"bg-blue-100 text-blue-700 border-blue-200"}`,children:ce.prompt_type==="system"?"":""})]}),s.jsx("div",{className:"text-sm text-gray-700 mb-3 p-3 bg-gradient-to-br from-gray-50 to-gray-100 rounded-md border border-gray-200",children:s.jsx("div",{className:"line-clamp-2 h-10 font-mono text-xs leading-relaxed",children:ce.final_prompt?s.jsxs(s.Fragment,{children:[ce.final_prompt.slice(0,150),ce.final_prompt.length>150?"...":""]}):s.jsx("span",{className:"text-gray-400 italic",children:""})})}),s.jsxs("div",{className:"flex items-center justify-between pt-2 border-t border-gray-100",children:[s.jsxs("div",{className:"flex items-center gap-3 text-xs text-gray-500",children:[s.jsxs("span",{className:"flex items-center gap-1",children:[s.jsxs("svg",{className:"w-3.5 h-3.5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"}),s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"})]}),ce.view_count||0]}),s.jsxs("span",{className:"flex items-center gap-1",children:[s.jsx("svg",{className:"w-3.5 h-3.5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"})}),ce.use_count||0]}),s.jsxs("span",{className:"flex items-center gap-1",children:[s.jsx("svg",{className:"w-3.5 h-3.5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M7 7h.01M7 3h5c.512 0 1.024.195 1.414.586l7 7a2 2 0 010 2.828l-7 7a2 2 0 01-2.828 0l-7-7A1.994 1.994 0 013 12V7a4 4 0 014-4z"})}),"v",ce.current_version||"1.0.0"]}),s.jsxs("span",{className:"text-gray-400",children:[" ",He(ce.update_time||ce.create_time)]})]}),s.jsxs("div",{className:"flex items-center gap-1",children:[s.jsx("button",{onClick:V=>{V.stopPropagation(),Ce(ce)},className:"p-1.5 hover:bg-gray-100 rounded-lg transition-colors",title:"",children:s.jsx("svg",{className:"w-4 h-4 text-gray-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"})})}),s.jsxs("div",{className:"relative group",children:[s.jsx("button",{onClick:V=>{V.stopPropagation(),C(K=>({...K,[ce.id]:!K[ce.id]}))},className:"p-1.5 hover:bg-gray-100 rounded-lg transition-colors",title:"",children:s.jsx("svg",{className:"w-4 h-4 text-gray-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M12 5v.01M12 12v.01M12 19v.01M12 6a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2z"})})}),v[ce.id]&&s.jsxs("div",{onClick:V=>V.stopPropagation(),className:"absolute right-0 top-full mt-1 w-40 bg-white border border-gray-200 rounded-lg shadow-lg z-10",children:[s.jsxs("button",{onClick:V=>{V.stopPropagation(),U(ce)},className:"w-full text-left px-3 py-2 text-sm hover:bg-gray-100 transition-colors flex items-center gap-2",children:[s.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})}),""]}),s.jsxs("button",{onClick:V=>{V.stopPropagation(),ne(ce)},className:"w-full text-left px-3 py-2 text-sm hover:bg-gray-100 transition-colors flex items-center gap-2",children:[s.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M13 10V3L4 14h7v7l9-11h-7z"})}),""]}),s.jsxs("button",{onClick:V=>{V.stopPropagation(),ze(ce)},className:"w-full text-left px-3 py-2 text-sm hover:bg-gray-100 transition-colors flex items-center gap-2",children:[s.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})}),""]}),s.jsxs("button",{onClick:V=>{V.stopPropagation(),fe(ce)},className:"w-full text-left px-3 py-2 text-sm hover:bg-red-50 text-red-600 transition-colors flex items-center gap-2",children:[s.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})}),""]})]})]})]})]}),s.jsx("div",{className:"mt-3 pt-2 border-t border-gray-100",children:s.jsx("div",{className:"flex flex-wrap gap-1",children:Array.isArray(ce.tags)?ce.tags.map(V=>s.jsx("span",{className:"inline-block px-2 py-1 bg-gray-100 text-gray-600 text-xs rounded-md",children:V},V)):s.jsx("span",{className:"text-xs text-gray-400",children:""})})})]},ce.id))}),q>1&&s.jsxs("div",{className:"flex justify-center items-center gap-2 mt-6",children:[s.jsx("button",{onClick:()=>oe(d-1),disabled:d<=1,className:"px-3 py-1 border border-gray-300 rounded-lg hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed",children:""}),s.jsxs("span",{className:"text-sm text-gray-600",children:[" ",d,"  ",q," "]}),s.jsx("button",{onClick:()=>oe(d+1),disabled:d>=q,className:"px-3 py-1 border border-gray-300 rounded-lg hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed",children:""})]})]}),A&&N&&s.jsx(zN,{prompt:N,onClose:()=>P(!1),onEdit:te,onOptimize:ne,onRollback:Qe}),L&&R&&s.jsx(LN,{isOpen:L,promptId:R.id,onClose:()=>G(!1),onRollback:Qe})]})});Jx.displayName="PromptList";function ON(){const e=jr(I=>I.token),t=jr(I=>I.user),r=gt(),[n,o]=w.useState(!1),[i,l]=w.useState(""),[c,u]=w.useState(!1),[d,g]=w.useState(""),x=w.useRef(null),y=w.useRef(null),S=()=>{y.current&&clearTimeout(y.current),y.current=setTimeout(()=>{x.current&&x.current.searchWithKeyword(d)},500)},T=async I=>{try{u(!0);const b=await wo("/api/prompts/",{title:I.title,description:I.description,final_prompt:I.content||i,language:"zh",format:"markdown",prompt_type:I.promptType,tags:I.tags,is_public:I.isPublic?1:0});if(b.code===200)r.success("",2e3),o(!1),l(""),x.current&&await x.current.loadPrompts();else throw new Error(b.message||"")}catch(b){console.error(":",b),r.error(`: ${b.message}`,3e3)}finally{u(!1)}};return s.jsxs("div",{className:"h-full flex flex-col overflow-hidden p-2",children:[s.jsx("div",{className:"bg-white rounded-lg shadow-sm p-6 mb-4 flex-shrink-0",children:s.jsxs("div",{className:"flex flex-col lg:flex-row lg:items-center lg:justify-between gap-6",children:[s.jsxs("div",{className:"min-w-0",children:[s.jsx("h2",{className:"text-xl lg:text-2xl font-bold text-gray-900",children:""}),s.jsx("p",{className:"text-sm text-gray-500 mt-1",children:""})]}),s.jsxs("div",{className:"flex flex-col sm:flex-row items-stretch sm:items-center gap-4",children:[s.jsxs("div",{className:"relative",children:[s.jsx("span",{className:"absolute left-3.5 top-2.5 text-gray-400",children:s.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})})}),s.jsx("input",{value:d,onChange:I=>{g(I.target.value),S()},type:"text",placeholder:"...",className:"w-80 pl-11 pr-4 py-2.5 border border-gray-300 rounded-lg text-sm outline-none"})]}),s.jsx("div",{className:"flex items-center gap-3",children:s.jsx("button",{onClick:()=>o(!0),className:"px-4 py-2.5 bg-blue-600 hover:bg-blue-700 text-white rounded-lg transition-colors flex items-center gap-2 whitespace-nowrap text-sm font-medium",children:s.jsx("span",{children:""})})})]})]})}),s.jsx("div",{className:"flex-1 bg-white rounded-lg shadow-sm overflow-hidden",children:e&&t?s.jsxs(s.Fragment,{children:[s.jsx(Jx,{ref:x,searchKeyword:d,onCreatePrompt:()=>o(!0)}),s.jsx(gh,{isOpen:n,promptContent:i,isSaving:c,onSave:T,onCancel:()=>o(!1)})]}):s.jsx("div",{className:"h-full flex items-center justify-center",children:s.jsxs("div",{className:"text-center max-w-md px-6",children:[s.jsx("svg",{className:"w-16 h-16 mb-4 text-gray-400 mx-auto",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"})}),s.jsx("h4",{className:"text-2xl font-bold text-gray-800 mb-2",children:""}),s.jsx("p",{className:"text-gray-600",children:""})]})})})]})}function Wg({onOpen:e}){return null}function DN({activeTab:e,onActiveTabChange:t,onClose:r}){return s.jsxs("div",{className:"flex items-center justify-between mb-6",children:[s.jsxs("div",{className:"flex items-center space-x-4",children:[s.jsx("h2",{className:"text-xl font-semibold",children:""}),s.jsxs("div",{className:"flex space-x-1",children:[s.jsx("button",{onClick:()=>t("providers"),className:`px-3 py-1 rounded text-sm font-medium transition-colors ${e==="providers"?"bg-blue-100 text-blue-700":"text-gray-600 hover:text-gray-800"}`,children:"AI"}),s.jsx("button",{onClick:()=>t("params"),className:`px-3 py-1 rounded text-sm font-medium transition-colors ${e==="params"?"bg-blue-100 text-blue-700":"text-gray-600 hover:text-gray-800"}`,children:""}),s.jsx("button",{onClick:()=>t("prompts"),className:`px-3 py-1 rounded text-sm font-medium transition-colors ${e==="prompts"?"bg-blue-100 text-blue-700":"text-gray-600 hover:text-gray-800"}`,children:""})]})]}),s.jsx("button",{onClick:r,className:"p-1 hover:bg-gray-100 rounded",children:s.jsx(Er,{className:"w-5 h-5"})})]})}function $N({visible:e,providerName:t,modelId:r,status:n,requestInfo:o,responseInfo:i,errorMessage:l,testTime:c,duration:u,onClose:d}){const g=gt(),[x,y]=w.useState(!1),[S,T]=w.useState(5),I=w.useRef(null),b=w.useRef(null),h=w.useRef(null),v=w.useRef(null);w.useEffect(()=>{e&&(y(!1),T(5)),C()},[e]),w.useEffect(()=>(x&&e&&z(),()=>C()),[x,e]);const C=()=>{h.current&&(clearInterval(h.current),h.current=null),v.current&&(clearTimeout(v.current),v.current=null)},A=()=>{x&&(y(!1),C(),T(5)),v.current&&(clearTimeout(v.current),v.current=null)},P=()=>{v.current=setTimeout(()=>{x||y(!0)},300)},N=()=>{y(!1),C(),T(5)},z=()=>{C(),T(5),h.current=setInterval(()=>{T(W=>W<=1?(L(),0):W-1)},1e3)},L=()=>{C(),d()},G=W=>{try{return JSON.stringify(W,null,2)}catch{return String(W)}},R=async W=>{try{await navigator.clipboard.writeText(W),g.success("",1500)}catch{g.error("",2e3)}},F=W=>{switch(W){case"success":return"bg-green-100 text-green-700";case"error":return"bg-red-100 text-red-700";case"timeout":return"bg-yellow-100 text-yellow-700";default:return"bg-gray-100 text-gray-700"}},D=W=>{switch(W){case"success":return"";case"error":return"";case"timeout":return"";default:return""}},O=W=>{switch(W){case"success":return th;case"error":return rh;case"timeout":return nh;default:return Sx}},q=W=>{switch(W){case"success":return"bg-green-500";case"error":return"bg-red-500";case"timeout":return"bg-yellow-500";default:return"bg-gray-500"}};if(!e)return null;const Q=O(n),oe=s.jsxs(s.Fragment,{children:[!x&&s.jsxs("div",{className:"fixed inset-0 z-[10000] flex items-end justify-end pointer-events-none",style:{display:e?"flex":"none"},children:[s.jsx("div",{className:"absolute inset-0 bg-black/20 backdrop-blur-sm"}),s.jsxs("div",{ref:I,onMouseEnter:A,onMouseLeave:P,className:"relative bg-white/95 backdrop-blur-xl rounded-3xl shadow-2xl w-full max-w-2xl max-h-[90vh] flex flex-col pointer-events-auto transform transition-all duration-300 ease-out border border-white/20",children:[s.jsxs("div",{className:"relative flex items-center justify-between px-6 py-5 border-b border-gray-200/50 bg-gradient-to-r from-blue-50/80 via-indigo-50/80 to-purple-50/80 backdrop-blur-sm rounded-t-3xl",children:[s.jsxs("div",{className:"relative flex items-center gap-3 z-10",children:[s.jsx("div",{className:`w-3 h-3 rounded-full shadow-lg ${n==="success"?"bg-green-500 shadow-green-500/50":n==="error"?"bg-red-500 shadow-red-500/50":n==="timeout"?"bg-yellow-500 shadow-yellow-500/50":"bg-gray-400 shadow-gray-400/50"}`}),s.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:""}),s.jsx("span",{className:`px-2 py-1 text-xs font-medium rounded-full shadow-sm ${F(n)}`,children:D(n)})]}),s.jsxs("div",{className:"relative flex items-center gap-2 text-xs text-gray-500 z-10",children:[s.jsx("span",{className:"hidden sm:inline",children:""}),s.jsx("div",{className:"w-1 h-1 rounded-full bg-gray-400 animate-pulse"})]})]}),s.jsxs("div",{className:"flex-1 overflow-y-auto px-6 py-5 space-y-4 bg-gradient-to-b from-white/95 to-white/90",children:[s.jsxs("div",{className:"space-y-2",children:[s.jsxs("h4",{className:"text-sm font-semibold text-gray-700 flex items-center gap-2",children:[s.jsx(da,{className:"w-4 h-4"}),""]}),s.jsxs("div",{className:"bg-gray-50 rounded-lg p-3 space-y-1 text-sm",children:[s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{className:"text-gray-600",children:":"}),s.jsx("span",{className:"text-gray-900 font-medium",children:t})]}),s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{className:"text-gray-600",children:"ID:"}),s.jsx("span",{className:"text-gray-900 font-mono text-xs",children:r})]}),s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{className:"text-gray-600",children:":"}),s.jsx("span",{className:"text-gray-900",children:c||new Date().toLocaleString("zh-CN")})]}),s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{className:"text-gray-600",children:":"}),s.jsxs("span",{className:"text-gray-900",children:[u||0,"ms"]})]})]})]}),o&&s.jsxs("div",{className:"space-y-2",children:[s.jsxs("h4",{className:"text-sm font-semibold text-gray-700 flex items-center gap-2",children:[s.jsx(Kd,{className:"w-4 h-4"}),""]}),s.jsxs("div",{className:"bg-blue-50 rounded-lg border border-blue-200",children:[s.jsx("div",{className:"px-4 py-2 border-b border-blue-200 bg-blue-100/50",children:s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx("span",{className:"text-xs font-medium text-blue-800",children:"URL"}),s.jsx("button",{onClick:()=>R(o.url||""),className:"text-blue-600 hover:text-blue-800 text-xs",title:"URL",children:s.jsx(wr,{className:"w-3.5 h-3.5"})})]})}),s.jsx("div",{className:"px-4 py-2",children:s.jsx("code",{className:"text-xs text-blue-900 break-all",children:o.url||"N/A"})})]}),s.jsxs("div",{className:"bg-blue-50 rounded-lg border border-blue-200",children:[s.jsx("div",{className:"px-4 py-2 border-b border-blue-200 bg-blue-100/50",children:s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx("span",{className:"text-xs font-medium text-blue-800",children:""}),s.jsx("button",{onClick:()=>R(G(o.headers||{})),className:"text-blue-600 hover:text-blue-800 text-xs",title:"",children:s.jsx(wr,{className:"w-3.5 h-3.5"})})]})}),s.jsx("pre",{className:"px-4 py-2 text-xs text-blue-900 overflow-x-auto",children:s.jsx("code",{children:G(o.headers||{})})})]}),s.jsxs("div",{className:"bg-blue-50 rounded-lg border border-blue-200",children:[s.jsx("div",{className:"px-4 py-2 border-b border-blue-200 bg-blue-100/50",children:s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx("span",{className:"text-xs font-medium text-blue-800",children:""}),s.jsx("button",{onClick:()=>R(G(o.body||{})),className:"text-blue-600 hover:text-blue-800 text-xs",title:"",children:s.jsx(wr,{className:"w-3.5 h-3.5"})})]})}),s.jsx("pre",{className:"px-4 py-2 text-xs text-blue-900 overflow-x-auto max-h-60 overflow-y-auto",children:s.jsx("code",{children:G(o.body||{})})})]})]}),s.jsxs("div",{className:"space-y-2",children:[s.jsxs("h4",{className:"text-sm font-semibold text-gray-700 flex items-center gap-2",children:[s.jsx(aP,{className:"w-4 h-4"}),""]}),i&&s.jsxs(s.Fragment,{children:[s.jsx("div",{className:"bg-green-50 rounded-lg border border-green-200",children:s.jsx("div",{className:"px-4 py-2 border-b border-green-200 bg-green-100/50",children:s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx("span",{className:"text-xs font-medium text-green-800",children:""}),s.jsx("span",{className:`px-2 py-0.5 text-xs font-medium rounded ${i.status?i.status>=200&&i.status<300?"bg-green-200 text-green-800":"bg-red-200 text-red-800":"bg-gray-200 text-gray-800"}`,children:i.status||"N/A"})]})})}),i.headers&&s.jsxs("div",{className:"bg-green-50 rounded-lg border border-green-200",children:[s.jsx("div",{className:"px-4 py-2 border-b border-green-200 bg-green-100/50",children:s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx("span",{className:"text-xs font-medium text-green-800",children:""}),s.jsx("button",{onClick:()=>R(G(i.headers||{})),className:"text-green-600 hover:text-green-800 text-xs",title:"",children:s.jsx(wr,{className:"w-3.5 h-3.5"})})]})}),s.jsx("pre",{className:"px-4 py-2 text-xs text-green-900 overflow-x-auto",children:s.jsx("code",{children:G(i.headers)})})]}),i.body&&s.jsxs("div",{className:"bg-green-50 rounded-lg border border-green-200",children:[s.jsx("div",{className:"px-4 py-2 border-b border-green-200 bg-green-100/50",children:s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx("span",{className:"text-xs font-medium text-green-800",children:""}),s.jsx("button",{onClick:()=>R(G(i.body||{})),className:"text-green-600 hover:text-green-800 text-xs",title:"",children:s.jsx(wr,{className:"w-3.5 h-3.5"})})]})}),s.jsx("pre",{className:"px-4 py-2 text-xs text-green-900 overflow-x-auto max-h-60 overflow-y-auto",children:s.jsx("code",{children:G(i.body)})})]})]}),l&&s.jsxs("div",{className:"px-4 py-2 text-xs text-red-700 bg-red-50 rounded",children:[s.jsx("strong",{children:":"})," ",l]})]})]}),s.jsx("div",{className:"px-6 py-4 border-t border-gray-200/50 bg-gradient-to-r from-gray-50/80 to-gray-100/80 backdrop-blur-sm rounded-b-3xl flex items-center justify-center",children:s.jsxs("div",{className:"flex items-center gap-2 text-xs text-gray-500",children:[s.jsx(da,{className:"w-3.5 h-3.5"}),s.jsx("span",{children:"5"})]})})]})]}),x&&s.jsxs("div",{ref:b,onMouseEnter:A,onClick:N,className:"fixed bottom-4 right-4 z-[10000] pointer-events-auto cursor-pointer group",children:[s.jsx("div",{className:`w-16 h-16 rounded-2xl shadow-2xl flex items-center justify-center transition-all duration-300 backdrop-blur-xl border border-white/30 hover:scale-110 hover:shadow-3xl ${q(n)}`,children:s.jsx(Q,{className:"w-7 h-7 text-white transition-transform duration-300 group-hover:scale-110"})}),S>0&&s.jsx("div",{className:"absolute -top-1 -right-1 w-6 h-6 rounded-full bg-gradient-to-br from-red-500 to-red-600 text-white text-xs flex items-center justify-center font-bold shadow-lg border-2 border-white/50 backdrop-blur-sm",children:S}),s.jsxs("div",{className:"absolute bottom-full right-0 mb-2 px-3 py-1.5 bg-gray-900/90 backdrop-blur-sm text-white text-xs rounded-lg shadow-xl opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap pointer-events-none",children:["",s.jsx("div",{className:"absolute top-full right-4 w-0 h-0 border-l-4 border-r-4 border-t-4 border-transparent border-t-gray-900/90"})]})]})]});return Yp.createPortal(oe,document.body)}function FN({providers:e,lastRefreshedAt:t,isLoading:r,onRefreshConfig:n}){const o=ut(),i=gt(),l=Be();w.useEffect(()=>{console.log("[ProvidersTab]  providers (props):",e),console.log("[ProvidersTab] providers  (props):",e.length),console.log("[ProvidersTab] providerStore.allProviders:",l.allProviders),console.log("[ProvidersTab] providerStore.allProviders :",l.allProviders.length),console.log("[ProvidersTab] providerStore.isInitialized:",l.isInitialized),console.log("[ProvidersTab] providerStore.error:",l.error),e.length===0&&l.allProviders.length>0&&console.warn("[ProvidersTab] : props.providers  store ")},[e,l.allProviders,l.isInitialized,l.error]);const[c,u]=w.useState(new Set),[d,g]=w.useState(new Map),[x,y]=w.useState(!1),[S,T]=w.useState(new Set),[I,b]=w.useState({providerName:"",modelId:"",status:"testing"}),h=D=>new Intl.DateTimeFormat("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"}).format(D),v=D=>({openai:"bg-green-100 text-green-700",anthropic:"bg-orange-100 text-orange-700",google:"bg-blue-100 text-blue-700",custom:"bg-purple-100 text-purple-700"})[D]||"bg-gray-100 text-gray-700",C=D=>({openai:"OpenAI",anthropic:"Anthropic",google:"Google",custom:""})[D]||D,A=D=>({openai:"bg-green-50 text-green-600 border border-green-200",anthropic:"bg-orange-50 text-orange-600 border border-orange-200",google:"bg-blue-50 text-blue-600 border border-blue-200"})[D]||"bg-gray-50 text-gray-600 border border-gray-200",P=D=>({openai:"OpenAI API",anthropic:"Claude API",google:"Gemini API"})[D]||D,N=(D,O)=>{const q=`${D}-${O}`,Q=c.has(q),oe=d.get(q);if(Q)return"bg-blue-100 text-blue-700 border border-blue-300 cursor-wait";switch(oe){case"success":return"bg-green-100 text-green-700 border border-green-300 hover:bg-green-200";case"error":return"bg-red-100 text-red-700 border border-red-300 hover:bg-red-200";case"timeout":return"bg-yellow-100 text-yellow-700 border border-yellow-300 hover:bg-yellow-200";default:return"bg-gray-100 text-gray-700 border border-gray-300 hover:bg-gray-200"}},z=(D,O)=>{const q=`${D}-${O}`,Q=c.has(q),oe=d.get(q);if(Q)return It;switch(oe){case"success":return th;case"error":return rh;case"timeout":return nh;default:return sP}},L=(D,O)=>{const q=`${D}-${O}`,Q=c.has(q),oe=d.get(q);if(Q)return"...";switch(oe){case"success":return"";case"error":return"";case"timeout":return"";default:return""}},G=(D,O)=>{const q=`${D}-${O}`,Q=c.has(q),oe=d.get(q);if(Q)return"...";switch(oe){case"success":return"";case"error":return"";case"timeout":return"10";default:return""}},R=(D,O,q,Q)=>{const oe=D.models.find(Ce=>Ce.id===O),W=(oe==null?void 0:oe.apiType)||D.type;let U=D.baseUrl||"",te={"Content-Type":"application/json"},ne={};return W==="openai"?(U.includes("/chat/completions")||(U.includes("/v1")?U=U.replace(/\/+$/,"")+"/chat/completions":U=U.replace(/\/+$/,"")+"/v1/chat/completions"),te.Authorization=`Bearer ${D.apiKey}`,ne={model:O,messages:q.map(Ce=>({role:Ce.type==="ai"?"assistant":"user",content:Ce.content})),temperature:Q.temperature??1,max_tokens:Q.maxTokens??8192,top_p:Q.topP??.95},Q.frequencyPenalty!==void 0&&(ne.frequency_penalty=Q.frequencyPenalty),Q.presencePenalty!==void 0&&(ne.presence_penalty=Q.presencePenalty)):W==="anthropic"?(U.includes("/v1/messages")||(U=U.replace(/\/+$/,"")+"/v1/messages"),te["x-api-key"]=D.apiKey||"",te["anthropic-version"]="2023-06-01",te["anthropic-dangerous-direct-browser-access"]="true",ne={model:O,max_tokens:Q.maxTokens??8192,temperature:Q.temperature??1,messages:q.map(Ce=>({role:Ce.type==="ai"?"assistant":"user",content:Ce.content}))},Q.topP!==void 0&&(ne.top_p=Q.topP),Q.topK!==void 0&&Q.topK>0&&(ne.top_k=Q.topK)):W==="google"&&(U.endsWith("/v1beta")||(U.includes("/models/")&&(U=U.split("/models/")[0]),U.endsWith("/v1beta")||(U=U.replace(/\/+$/,"")+"/v1beta")),U=`${U}/models/${O}:generateContent`,te["x-goog-api-key"]=D.apiKey||"",ne={contents:q.map(Ce=>({role:Ce.type==="ai"?"model":"user",parts:[{text:Ce.content}]})),generationConfig:{temperature:Q.temperature??1,maxOutputTokens:Q.maxTokens??8192}},Q.topP!==void 0&&(ne.generationConfig.topP=Q.topP),Q.topK!==void 0&&Q.topK>0&&(ne.generationConfig.topK=Q.topK)),{url:U,method:"POST",headers:te,body:ne}},F=async(D,O)=>{const q=`${D.id}-${O}`;if(!D.apiKey){i.warning(" API Key",2e3);return}if(c.has(q))return;u(ne=>new Set(ne).add(q)),g(ne=>{const Ce=new Map(ne);return Ce.delete(q),Ce});const Q=Date.now(),oe=[{type:"user",content:"",timestamp:new Date().toISOString()}],W=o.globalModelParams;console.log("[ProvidersTab] :",W);const U=R(D,O,oe,W),te={...U.headers};te.Authorization&&(te.Authorization="Bearer ***"),te["x-api-key"]&&(te["x-api-key"]="***"),te["x-goog-api-key"]&&(te["x-goog-api-key"]="***"),b({providerName:D.name,modelId:O,status:"testing",requestInfo:{...U,headers:te},testTime:new Date().toLocaleString("zh-CN")}),y(!0);try{const ne=window.fetch;let Ce=null,ze={},Qe,fe;window.fetch=async(K,xe)=>{const Le=await ne(K,xe);Qe=Le.status,fe=Le.statusText;const Je=Le.clone();Le.headers.forEach((at,et)=>{ze[et]=at});try{(Le.headers.get("content-type")||"").includes("application/json")?Ce=await Je.json():Ce={raw:await Je.text()}}catch{Ce={error:""}}return Le};const He=Yt.getInstance(),ce=new Promise((K,xe)=>{setTimeout(()=>{window.fetch=ne,xe(new Error("TIMEOUT"))},1e4)}),V=He.callAI(oe,D,O,!1);try{await Promise.race([V,ce]),window.fetch=ne;const K=Date.now()-Q;g(xe=>{const Le=new Map(xe);return Le.set(q,"success"),Le}),b(xe=>({...xe,status:"success",duration:K,responseInfo:{status:Qe,statusText:fe,headers:ze,body:Ce}})),i.success(` ${O} `,2e3)}catch(K){window.fetch=ne;const xe=Date.now()-Q;if((K==null?void 0:K.message)==="TIMEOUT")g(Le=>{const Je=new Map(Le);return Je.set(q,"timeout"),Je}),b(Le=>({...Le,status:"timeout",duration:xe,errorMessage:"10"})),i.warning(` ${O} 10`,3e3);else{g(Je=>{const at=new Map(Je);return at.set(q,"error"),at}),b(Je=>({...Je,status:"error",duration:xe,errorMessage:(K==null?void 0:K.message)||"",responseInfo:{status:Qe,statusText:fe,headers:ze,body:Ce||(K!=null&&K.error?{error:K.error}:null)}}));const Le=(K==null?void 0:K.message)||"";i.error(` ${O} : ${Le}`,3e3)}}}catch(ne){const Ce=Date.now()-Q;g(Qe=>{const fe=new Map(Qe);return fe.set(q,"error"),fe}),b(Qe=>({...Qe,status:"error",duration:Ce,errorMessage:(ne==null?void 0:ne.message)||""}));const ze=(ne==null?void 0:ne.message)||"";i.error(` ${O} : ${ze}`,3e3)}finally{setTimeout(()=>{u(ne=>{const Ce=new Set(ne);return Ce.delete(q),Ce})},2e3)}};return s.jsxs(s.Fragment,{children:[s.jsx($N,{visible:x,providerName:I.providerName,modelId:I.modelId,status:I.status,requestInfo:I.requestInfo,responseInfo:I.responseInfo,errorMessage:I.errorMessage,testTime:I.testTime,duration:I.duration,onClose:()=>y(!1)}),s.jsx("div",{className:"mb-6 p-4 bg-yellow-50 border border-yellow-200 rounded-lg",children:s.jsxs("div",{className:"flex items-start space-x-3",children:[s.jsx(bx,{className:"w-5 h-5 text-yellow-600 flex-shrink-0 mt-0.5"}),s.jsxs("div",{className:"flex-1",children:[s.jsx("h4",{className:"text-sm font-semibold text-yellow-800 mb-2",children:""}),s.jsxs("div",{className:"text-sm text-yellow-700 space-y-1",children:[s.jsx("p",{children:"AI"}),s.jsxs("p",{children:[s.jsx("strong",{children:""}),"",s.jsx("code",{className:"bg-yellow-100 px-2 py-0.5 rounded text-xs font-mono",children:".setting.json"}),'""']}),s.jsxs("p",{className:"text-xs mt-2",children:[s.jsx("strong",{children:""}),s.jsx("code",{className:"bg-yellow-100 px-2 py-0.5 rounded font-mono",children:"/app/projects/yprompt/.setting.json"})]})]})]})]})}),s.jsx("div",{className:"mb-6",children:s.jsxs("div",{className:"flex items-center justify-between mb-4",children:[s.jsxs("div",{className:"flex items-center space-x-4",children:[s.jsx("h3",{className:"text-lg font-medium",children:"AI"}),t&&s.jsxs("div",{className:"text-sm text-gray-500",children:[": ",h(t)]})]}),s.jsxs("button",{onClick:n,disabled:r,className:"flex items-center space-x-2 px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:[s.jsx(It,{className:`w-4 h-4 ${r?"animate-spin":""}`}),s.jsx("span",{children:""})]})]})}),e.length===0?s.jsxs("div",{className:"text-center py-12 text-gray-500",children:[s.jsx(Px,{className:"w-12 h-12 text-gray-300 mx-auto mb-3"}),s.jsx("p",{className:"text-lg mb-2",children:""}),s.jsx("p",{className:"text-sm",children:" .setting.json  Provider "})]}):s.jsx("div",{className:"space-y-4",children:e.map(D=>s.jsxs("div",{className:"border rounded-lg p-5 bg-white shadow-sm",children:[s.jsx("div",{className:"flex items-start justify-between mb-4",children:s.jsxs("div",{className:"flex items-center space-x-3",children:[s.jsx("div",{className:`w-3 h-3 rounded-full ${D.apiKey?"bg-green-500":"bg-gray-300"}`,title:D.apiKey?"API Key ":"API Key "}),s.jsxs("div",{children:[s.jsx("h4",{className:"text-base font-semibold text-gray-900",children:D.name}),s.jsxs("div",{className:"flex items-center space-x-2 mt-1",children:[s.jsx("span",{className:`text-xs px-2 py-0.5 rounded-full ${v(D.type)}`,children:C(D.type)}),!D.apiKey&&s.jsx("span",{className:"text-xs text-red-600",children:" API Key"})]})]})]})}),s.jsx("div",{className:"space-y-3 mb-4 pl-6",children:s.jsxs("div",{className:"grid grid-cols-1 gap-2 text-sm",children:[s.jsxs("div",{className:"flex items-start",children:[s.jsx("span",{className:"text-gray-500 w-24 flex-shrink-0",children:"API Key:"}),s.jsxs("div",{className:"flex-1 flex items-center space-x-2",children:[s.jsx("span",{className:"text-gray-900 font-mono text-xs break-all",children:D.apiKey?S.has(D.id)?D.apiKey:"********"+D.apiKey.substring(D.apiKey.length-4):""}),D.apiKey&&s.jsx("button",{onClick:()=>{T(O=>{const q=new Set(O);return q.has(D.id)?q.delete(D.id):q.add(D.id),q})},className:"flex-shrink-0 p-1 text-gray-500 hover:text-gray-700 transition-colors",title:S.has(D.id)?" API Key":" API Key",children:S.has(D.id)?s.jsx(kx,{className:"w-4 h-4"}):s.jsx(sh,{className:"w-4 h-4"})})]})]}),D.baseUrl&&s.jsxs("div",{className:"flex items-start",children:[s.jsx("span",{className:"text-gray-500 w-24 flex-shrink-0",children:"Base URL:"}),s.jsx("span",{className:"text-gray-700 font-mono text-xs break-all",children:D.baseUrl})]})]})}),s.jsxs("div",{className:"pl-6 border-l-2 border-gray-200",children:[s.jsxs("h5",{className:"text-sm font-medium text-gray-700 mb-3",children:[" (",D.models.length,")"]}),D.models.length===0?s.jsx("div",{className:"text-sm text-gray-500 py-2",children:""}):s.jsx("div",{className:"space-y-2",children:D.models.map(O=>{const q=`${D.id}-${O.id}`,Q=c.has(q),oe=z(D.id,O.id);return s.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-md hover:bg-gray-100 transition-colors",children:[s.jsx("div",{className:"flex items-center space-x-3 flex-1",children:s.jsxs("div",{className:"flex-1 min-w-0",children:[s.jsx("div",{className:"font-medium text-sm text-gray-900",children:O.name}),s.jsx("div",{className:"text-xs text-gray-500 font-mono truncate",children:O.id})]})}),s.jsxs("div",{className:"flex items-center gap-2 flex-shrink-0",children:[O.apiType&&s.jsx("div",{className:"flex-shrink-0",children:s.jsx("span",{className:`text-xs px-2 py-1 rounded ${A(O.apiType)}`,children:P(O.apiType)})}),s.jsxs("button",{onClick:()=>F(D,O.id),disabled:!D.apiKey||Q,className:`px-3 py-1.5 text-xs font-medium rounded-md transition-all flex items-center gap-1.5 ${N(D.id,O.id)}`,title:G(D.id,O.id),children:[s.jsx(oe,{className:`w-3.5 h-3.5 ${Q?"animate-spin":""}`}),s.jsx("span",{children:L(D.id,O.id)})]})]})]},O.id)})})]})]},D.id))})]})}function UN(){const e=ut(),t=()=>(console.log("[useModelParams] :",e.globalModelParams),{...e.globalModelParams}),r=u=>{console.log("[useModelParams] :",u),e.globalModelParams={...e.globalModelParams,...u},console.log("[useModelParams] :",e.globalModelParams),e.saveSettings()};return{getCurrentParams:t,updateCurrentModelParams:r,resetToDefaults:()=>{console.log("[useModelParams] "),r({temperature:1,maxTokens:8192,topP:.95,frequencyPenalty:0,presencePenalty:0,topK:0})},isParamSupported:u=>["temperature","maxTokens","topP","frequencyPenalty","presencePenalty","topK"].includes(u),getParamRange:u=>{switch(u){case"temperature":return{min:0,max:2,step:.1};case"maxTokens":return{min:1,max:8e3,step:1};case"topP":return{min:0,max:1,step:.01};case"frequencyPenalty":case"presencePenalty":return{min:-2,max:2,step:.1};case"topK":return{min:1,max:100,step:1};default:return{min:0,max:1,step:.1}}},getParamLabel:u=>({temperature:"Temperature",maxTokens:"Max Tokens",topP:"Top P",frequencyPenalty:"Frequency Penalty",presencePenalty:"Presence Penalty",topK:"Top K"})[u]||u,getParamDescription:u=>({temperature:"",maxTokens:" token ",topP:"",frequencyPenalty:"OpenAI ",presencePenalty:"OpenAI ",topK:" K Claude/Gemini"})[u]||""}}function Zx(){const e=gt(r=>r.showConfirmDialog);return{confirm:r=>e(r)}}function BN(){const e=ut(),{getCurrentParams:t,updateCurrentModelParams:r,resetToDefaults:n,isParamSupported:o,getParamRange:i,getParamLabel:l,getParamDescription:c}=UN(),{confirm:u}=Zx(),d=gt(),[g,x]=w.useState(t());w.useEffect(()=>{x(t())},[e.globalModelParams]);const y=(T,I)=>{x(b=>({...b,[T]:I})),r({[T]:I})},S=async()=>{await u({message:"",type:"warning"})&&(n(),x(t()),d.success("",2e3))};return s.jsx("div",{className:"space-y-6",children:s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:""}),s.jsx("button",{onClick:S,className:"px-3 py-1.5 text-sm font-medium text-slate-700 bg-white border border-slate-200 rounded-lg hover:bg-slate-50 hover:border-slate-300 transition-all focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2",children:""})]}),o("temperature")&&s.jsxs("div",{className:"space-y-2",children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx("label",{className:"text-sm font-medium text-gray-700",children:l("temperature")}),s.jsx("input",{type:"number",value:g.temperature,onChange:T=>y("temperature",parseFloat(T.target.value)),min:i("temperature").min,max:i("temperature").max,step:i("temperature").step,className:"w-20 px-2 py-1 text-sm border border-gray-300 rounded focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),s.jsx("input",{type:"range",value:g.temperature,onChange:T=>y("temperature",parseFloat(T.target.value)),min:i("temperature").min,max:i("temperature").max,step:i("temperature").step,className:"w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer"}),s.jsx("p",{className:"text-xs text-gray-500",children:c("temperature")})]}),o("maxTokens")&&s.jsxs("div",{className:"space-y-2",children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx("label",{className:"text-sm font-medium text-gray-700",children:l("maxTokens")}),s.jsx("input",{type:"number",value:g.maxTokens,onChange:T=>y("maxTokens",parseInt(T.target.value)),min:i("maxTokens").min,max:i("maxTokens").max,step:i("maxTokens").step,className:"w-24 px-2 py-1 text-sm border border-gray-300 rounded focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),s.jsx("input",{type:"range",value:g.maxTokens,onChange:T=>y("maxTokens",parseInt(T.target.value)),min:i("maxTokens").min,max:i("maxTokens").max,step:i("maxTokens").step,className:"w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer"}),s.jsx("p",{className:"text-xs text-gray-500",children:c("maxTokens")})]}),o("topP")&&s.jsxs("div",{className:"space-y-2",children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx("label",{className:"text-sm font-medium text-gray-700",children:l("topP")}),s.jsx("input",{type:"number",value:g.topP,onChange:T=>y("topP",parseFloat(T.target.value)),min:i("topP").min,max:i("topP").max,step:i("topP").step,className:"w-20 px-2 py-1 text-sm border border-gray-300 rounded focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),s.jsx("input",{type:"range",value:g.topP,onChange:T=>y("topP",parseFloat(T.target.value)),min:i("topP").min,max:i("topP").max,step:i("topP").step,className:"w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer"}),s.jsx("p",{className:"text-xs text-gray-500",children:c("topP")})]}),o("frequencyPenalty")&&s.jsxs("div",{className:"space-y-2",children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx("label",{className:"text-sm font-medium text-gray-700",children:l("frequencyPenalty")}),s.jsx("input",{type:"number",value:g.frequencyPenalty,onChange:T=>y("frequencyPenalty",parseFloat(T.target.value)),min:i("frequencyPenalty").min,max:i("frequencyPenalty").max,step:i("frequencyPenalty").step,className:"w-20 px-2 py-1 text-sm border border-gray-300 rounded focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),s.jsx("input",{type:"range",value:g.frequencyPenalty,onChange:T=>y("frequencyPenalty",parseFloat(T.target.value)),min:i("frequencyPenalty").min,max:i("frequencyPenalty").max,step:i("frequencyPenalty").step,className:"w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer"}),s.jsx("p",{className:"text-xs text-gray-500",children:c("frequencyPenalty")})]}),o("presencePenalty")&&s.jsxs("div",{className:"space-y-2",children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx("label",{className:"text-sm font-medium text-gray-700",children:l("presencePenalty")}),s.jsx("input",{type:"number",value:g.presencePenalty,onChange:T=>y("presencePenalty",parseFloat(T.target.value)),min:i("presencePenalty").min,max:i("presencePenalty").max,step:i("presencePenalty").step,className:"w-20 px-2 py-1 text-sm border border-gray-300 rounded focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),s.jsx("input",{type:"range",value:g.presencePenalty,onChange:T=>y("presencePenalty",parseFloat(T.target.value)),min:i("presencePenalty").min,max:i("presencePenalty").max,step:i("presencePenalty").step,className:"w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer"}),s.jsx("p",{className:"text-xs text-gray-500",children:c("presencePenalty")})]}),o("topK")&&s.jsxs("div",{className:"space-y-2",children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx("label",{className:"text-sm font-medium text-gray-700",children:l("topK")}),s.jsx("input",{type:"number",value:g.topK,onChange:T=>y("topK",parseInt(T.target.value)),min:i("topK").min,max:i("topK").max,step:i("topK").step,className:"w-20 px-2 py-1 text-sm border border-gray-300 rounded focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),s.jsx("input",{type:"range",value:g.topK,onChange:T=>y("topK",parseInt(T.target.value)),min:i("topK").min,max:i("topK").max,step:i("topK").step,className:"w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer"}),s.jsx("p",{className:"text-xs text-gray-500",children:c("topK")})]}),s.jsxs("div",{className:"mt-6 p-4 bg-gray-50 border border-gray-200 rounded-lg",children:[s.jsx("h4",{className:"text-sm font-medium text-gray-900 mb-2",children:""}),s.jsxs("ul",{className:"text-xs text-gray-600 space-y-1",children:[s.jsx("li",{children:" Temperature: 0-2"}),s.jsx("li",{children:" Max Tokens: token"}),s.jsx("li",{children:" Top P: "}),s.jsx("li",{children:" Frequency Penalty: OpenAI"}),s.jsx("li",{children:" Presence Penalty: OpenAI"}),s.jsx("li",{children:" Top K: KClaude/Gemini"}),s.jsx("li",{className:"mt-2",children:"AI"})]})]})]})})}function qN({onResetSystem:e,onResetUser:t,onResetRequirement:r,onResetQualityAnalysisSystem:n,onResetThinking:o,onResetGeneration:i,onResetAdvice:l,onResetApplication:c,onToggleSlimRules:u,onResetUserPromptQualityAnalysis:d,onResetUserPromptQuickOptimization:g}){const x=ut(),[y,S]=w.useState(!0),[T,I]=w.useState(!1);return s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{className:"border border-gray-300 rounded-lg overflow-hidden",children:[s.jsxs("button",{onClick:()=>S(!y),className:"w-full px-4 py-3 bg-blue-50 hover:bg-blue-100 flex items-center justify-between transition-colors",children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(jg,{className:`w-5 h-5 text-blue-600 transition-transform ${y?"transform rotate-180":""}`}),s.jsx("h2",{className:"text-lg font-semibold text-blue-900",children:""})]}),s.jsx("span",{className:"text-xs text-blue-600",children:""})]}),y&&s.jsxs("div",{className:"p-4 space-y-6 bg-white",children:[s.jsxs("div",{children:[s.jsxs("div",{className:"flex items-center justify-between mb-3",children:[s.jsx("h3",{className:"text-lg font-medium",children:""}),s.jsxs("div",{className:"flex items-center space-x-3",children:[s.jsxs("label",{className:"flex items-center space-x-2 cursor-pointer select-none",onClick:b=>{b.preventDefault(),u()},children:[s.jsx("span",{className:"text-sm text-gray-600",children:""}),s.jsxs("div",{className:"relative w-11 h-6",children:[s.jsx("input",{type:"checkbox",checked:x.useSlimRules,className:"sr-only",readOnly:!0,tabIndex:-1}),s.jsx("div",{className:`w-11 h-6 rounded-full transition-all duration-200 ${x.useSlimRules?"bg-blue-600":"bg-gray-300"}`,children:s.jsx("div",{className:`absolute top-[2px] left-[2px] h-5 w-5 bg-white border border-gray-300 rounded-full transition-all duration-200 ${x.useSlimRules?"translate-x-5":"translate-x-0"}`})})]})]}),s.jsx("button",{onClick:e,className:"px-3 py-1.5 text-sm font-medium text-slate-700 bg-white border border-slate-200 rounded-lg hover:bg-slate-50 hover:border-slate-300 transition-all focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2",children:""})]})]}),s.jsx("textarea",{value:x.editingSystemRules,onChange:b=>{ut.setState({editingSystemRules:b.target.value})},placeholder:"...",className:"w-full h-48 px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-transparent resize-none text-xs"}),s.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"AI"})]}),s.jsxs("div",{children:[s.jsxs("div",{className:"flex items-center justify-between mb-3",children:[s.jsx("h3",{className:"text-lg font-medium",children:""}),s.jsx("button",{onClick:t,className:"px-3 py-1.5 text-sm font-medium text-slate-700 bg-white border border-slate-200 rounded-lg hover:bg-slate-50 hover:border-slate-300 transition-all focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2",children:""})]}),s.jsx("textarea",{value:x.editingUserRules,onChange:b=>{ut.setState({editingUserRules:b.target.value})},placeholder:"...",className:"w-full h-48 px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-transparent resize-none text-xs"}),s.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"AI"})]}),s.jsxs("div",{children:[s.jsxs("div",{className:"flex items-center justify-between mb-3",children:[s.jsx("h3",{className:"text-lg font-medium",children:""}),s.jsx("button",{onClick:r,className:"px-3 py-1.5 text-sm font-medium text-slate-700 bg-white border border-slate-200 rounded-lg hover:bg-slate-50 hover:border-slate-300 transition-all focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2",children:""})]}),s.jsx("textarea",{value:x.editingRequirementReportRules,onChange:b=>{ut.setState({editingRequirementReportRules:b.target.value})},placeholder:"...",className:"w-full h-48 px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-transparent resize-none text-xs"}),s.jsx("p",{className:"text-xs text-gray-500 mt-1",children:""})]}),s.jsxs("div",{children:[s.jsx("div",{className:"mb-3",children:s.jsx("h3",{className:"text-lg font-medium",children:""})}),s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{children:[s.jsxs("div",{className:"flex items-center justify-between mb-2",children:[s.jsx("h4",{className:"text-sm font-medium text-gray-700",children:""}),s.jsx("button",{onClick:o,className:"px-2.5 py-1 text-xs font-medium text-slate-700 bg-white border border-slate-200 rounded-lg hover:bg-slate-50 hover:border-slate-300 transition-all focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-1",children:""})]}),s.jsx("textarea",{value:x.editingFinalPromptRules.THINKING_POINTS_EXTRACTION,onChange:b=>{ut.setState({editingFinalPromptRules:{...x.editingFinalPromptRules,THINKING_POINTS_EXTRACTION:b.target.value}})},placeholder:"...",className:"w-full h-32 px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-transparent resize-none text-xs"})]}),s.jsxs("div",{children:[s.jsxs("div",{className:"flex items-center justify-between mb-2",children:[s.jsx("h4",{className:"text-sm font-medium text-gray-700",children:""}),s.jsx("button",{onClick:i,className:"px-2.5 py-1 text-xs font-medium text-slate-700 bg-white border border-slate-200 rounded-lg hover:bg-slate-50 hover:border-slate-300 transition-all focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-1",children:""})]}),s.jsx("textarea",{value:x.editingFinalPromptRules.SYSTEM_PROMPT_GENERATION,onChange:b=>{ut.setState({editingFinalPromptRules:{...x.editingFinalPromptRules,SYSTEM_PROMPT_GENERATION:b.target.value}})},placeholder:"...",className:"w-full h-32 px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-transparent resize-none text-xs"})]}),s.jsxs("div",{children:[s.jsxs("div",{className:"flex items-center justify-between mb-2",children:[s.jsx("h4",{className:"text-sm font-medium text-gray-700",children:""}),s.jsx("button",{onClick:l,className:"px-2.5 py-1 text-xs font-medium text-slate-700 bg-white border border-slate-200 rounded-lg hover:bg-slate-50 hover:border-slate-300 transition-all focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-1",children:""})]}),s.jsx("textarea",{value:x.editingFinalPromptRules.OPTIMIZATION_ADVICE_GENERATION,onChange:b=>{ut.setState({editingFinalPromptRules:{...x.editingFinalPromptRules,OPTIMIZATION_ADVICE_GENERATION:b.target.value}})},placeholder:"...",className:"w-full h-32 px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-transparent resize-none text-xs"})]}),s.jsxs("div",{children:[s.jsxs("div",{className:"flex items-center justify-between mb-2",children:[s.jsx("h4",{className:"text-sm font-medium text-gray-700",children:""}),s.jsx("button",{onClick:c,className:"px-2.5 py-1 text-xs font-medium text-slate-700 bg-white border border-slate-200 rounded-lg hover:bg-slate-50 hover:border-slate-300 transition-all focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-1",children:""})]}),s.jsx("textarea",{value:x.editingFinalPromptRules.OPTIMIZATION_APPLICATION,onChange:b=>{ut.setState({editingFinalPromptRules:{...x.editingFinalPromptRules,OPTIMIZATION_APPLICATION:b.target.value}})},placeholder:"...",className:"w-full h-32 px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-transparent resize-none text-xs"})]})]}),s.jsx("p",{className:"text-xs text-gray-500 mt-1",children:""})]})]})]}),s.jsxs("div",{className:"border border-gray-300 rounded-lg overflow-hidden",children:[s.jsxs("button",{onClick:()=>I(!T),className:"w-full px-4 py-3 bg-green-50 hover:bg-green-100 flex items-center justify-between transition-colors",children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(jg,{className:`w-5 h-5 text-green-600 transition-transform ${T?"transform rotate-180":""}`}),s.jsx("h2",{className:"text-lg font-semibold text-green-900",children:""})]}),s.jsx("span",{className:"text-xs text-green-600",children:""})]}),T&&s.jsxs("div",{className:"p-4 space-y-6 bg-white",children:[s.jsxs("div",{children:[s.jsx("div",{className:"flex items-center justify-between mb-3",children:s.jsx("h3",{className:"text-lg font-medium",children:""})}),s.jsx("p",{className:"text-sm text-gray-600 mb-3",children:"    "}),s.jsxs("div",{className:"space-y-4 pl-4 border-l-2 border-green-200",children:[s.jsxs("div",{children:[s.jsxs("div",{className:"flex items-center justify-between mb-2",children:[s.jsx("h4",{className:"text-sm font-medium text-gray-700",children:"1. "}),s.jsx("button",{onClick:n,className:"px-2.5 py-1 text-xs font-medium text-slate-700 bg-white border border-slate-200 rounded-lg hover:bg-slate-50 hover:border-slate-300 transition-all focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-1",children:""})]}),s.jsx("textarea",{value:x.editingQualityAnalysisRules.systemPrompt,onChange:b=>{ut.setState({editingQualityAnalysisRules:{...x.editingQualityAnalysisRules,systemPrompt:b.target.value}})},placeholder:"...",className:"w-full h-32 px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-green-500 focus:border-transparent resize-none text-xs"}),s.jsx("p",{className:"text-xs text-gray-500 mt-1",children:""})]}),s.jsxs("div",{children:[s.jsxs("div",{className:"flex items-center justify-between mb-2",children:[s.jsx("h4",{className:"text-sm font-medium text-gray-700",children:"2. "}),s.jsx("button",{onClick:l,className:"px-2.5 py-1 text-xs font-medium text-slate-700 bg-white border border-slate-200 rounded-lg hover:bg-slate-50 hover:border-slate-300 transition-all focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-1",children:""})]}),s.jsx("textarea",{value:x.editingFinalPromptRules.OPTIMIZATION_ADVICE_GENERATION,onChange:b=>{ut.setState({editingFinalPromptRules:{...x.editingFinalPromptRules,OPTIMIZATION_ADVICE_GENERATION:b.target.value}})},placeholder:"...",className:"w-full h-32 px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-green-500 focus:border-transparent resize-none text-xs"}),s.jsx("p",{className:"text-xs text-gray-500 mt-1",children:""})]}),s.jsxs("div",{children:[s.jsxs("div",{className:"flex items-center justify-between mb-2",children:[s.jsx("h4",{className:"text-sm font-medium text-gray-700",children:"3. "}),s.jsx("button",{onClick:c,className:"px-2.5 py-1 text-xs font-medium text-slate-700 bg-white border border-slate-200 rounded-lg hover:bg-slate-50 hover:border-slate-300 transition-all focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-1",children:""})]}),s.jsx("textarea",{value:x.editingFinalPromptRules.OPTIMIZATION_APPLICATION,onChange:b=>{ut.setState({editingFinalPromptRules:{...x.editingFinalPromptRules,OPTIMIZATION_APPLICATION:b.target.value}})},placeholder:"...",className:"w-full h-32 px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-green-500 focus:border-transparent resize-none text-xs"}),s.jsx("p",{className:"text-xs text-gray-500 mt-1",children:""})]})]})]}),s.jsxs("div",{children:[s.jsx("div",{className:"flex items-center justify-between mb-3",children:s.jsx("h3",{className:"text-lg font-medium",children:""})}),s.jsx("p",{className:"text-sm text-gray-600 mb-3",children:"  "}),s.jsxs("div",{className:"space-y-4 pl-4 border-l-2 border-green-200",children:[s.jsxs("div",{children:[s.jsxs("div",{className:"flex items-center justify-between mb-2",children:[s.jsx("h4",{className:"text-sm font-medium text-gray-700",children:"1. "}),s.jsx("button",{onClick:d,className:"px-2.5 py-1 text-xs font-medium text-slate-700 bg-white border border-slate-200 rounded-lg hover:bg-slate-50 hover:border-slate-300 transition-all focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-1",children:""})]}),s.jsx("textarea",{value:x.editingUserPromptOptimizationRules.qualityAnalysis,onChange:b=>{ut.setState({editingUserPromptOptimizationRules:{...x.editingUserPromptOptimizationRules,qualityAnalysis:b.target.value}})},placeholder:"...",className:"w-full h-48 px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-green-500 focus:border-transparent resize-none text-xs"}),s.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"JSON"})]}),s.jsxs("div",{children:[s.jsxs("div",{className:"flex items-center justify-between mb-2",children:[s.jsx("h4",{className:"text-sm font-medium text-gray-700",children:"2. "}),s.jsx("button",{onClick:g,className:"px-2.5 py-1 text-xs font-medium text-slate-700 bg-white border border-slate-200 rounded-lg hover:bg-slate-50 hover:border-slate-300 transition-all focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-1",children:""})]}),s.jsx("textarea",{value:x.editingUserPromptOptimizationRules.quickOptimization,onChange:b=>{ut.setState({editingUserPromptOptimizationRules:{...x.editingUserPromptOptimizationRules,quickOptimization:b.target.value}})},placeholder:"...",className:"w-full h-48 px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-green-500 focus:border-transparent resize-none text-xs"}),s.jsx("p",{className:"text-xs text-gray-500 mt-1",children:""})]})]})]})]})]})]})}function WN(){const e=ut(),{confirm:t}=Zx(),r=gt();return{resetSystemPromptRules:async()=>{await t({message:"",type:"warning"})&&(ut.setState({editingSystemRules:os}),r.success("",2e3))},resetUserPromptRules:async()=>{await t({message:"",type:"warning"})&&(ut.setState({editingUserRules:Ks}),r.success("",2e3))},resetRequirementReportRules:async()=>{await t({message:"",type:"warning"})&&(ut.setState({editingRequirementReportRules:Ys}),r.success("",2e3))},resetThinkingPointsExtractionPrompt:async()=>{await t({message:"",type:"warning"})&&(ut.setState({editingFinalPromptRules:{...e.editingFinalPromptRules,THINKING_POINTS_EXTRACTION:is}}),r.success("",2e3))},resetSystemPromptGenerationPrompt:async()=>{await t({message:"",type:"warning"})&&(ut.setState({editingFinalPromptRules:{...e.editingFinalPromptRules,SYSTEM_PROMPT_GENERATION:as}}),r.success("",2e3))},resetOptimizationAdvicePrompt:async()=>{await t({message:"",type:"warning"})&&(ut.setState({editingFinalPromptRules:{...e.editingFinalPromptRules,OPTIMIZATION_ADVICE_GENERATION:ls}}),r.success("",2e3))},resetOptimizationApplicationPrompt:async()=>{await t({message:"",type:"warning"})&&(ut.setState({editingFinalPromptRules:{...e.editingFinalPromptRules,OPTIMIZATION_APPLICATION:cs}}),r.success("",2e3))},resetQualityAnalysisSystemPrompt:async()=>{await t({message:"",type:"warning"})&&(ut.setState({editingQualityAnalysisRules:{...e.editingQualityAnalysisRules,systemPrompt:us}}),r.success("",2e3))},resetUserPromptQualityAnalysis:async()=>{await t({message:"",type:"warning"})&&(ut.setState({editingUserPromptOptimizationRules:{...e.editingUserPromptOptimizationRules,qualityAnalysis:Js}}),r.success("",2e3))},resetUserPromptQuickOptimization:async()=>{await t({message:"",type:"warning"})&&(ut.setState({editingUserPromptOptimizationRules:{...e.editingUserPromptOptimizationRules,quickOptimization:ds.quick}}),r.success("",2e3))},handleSlimRulesToggle:()=>{const I=!e.useSlimRules;ut.setState({useSlimRules:I,editingSystemRules:I?Ix:os}),kt.setUseSlimRules(I),e.saveSettings()},saveAndClose:async()=>{try{kt.updateSystemPromptRules(e.editingSystemRules),kt.updateUserGuidedPromptRules(e.editingUserRules),kt.updateRequirementReportRules(e.editingRequirementReportRules),e.saveSettings(),e.setShowSettings(!1);const{useNotificationStore:I}=await zt(async()=>{const{useNotificationStore:h}=await Promise.resolve().then(()=>Og);return{useNotificationStore:h}},void 0);I().success("",2e3)}catch(I){console.error(":",I);const{useNotificationStore:b}=await zt(async()=>{const{useNotificationStore:v}=await Promise.resolve().then(()=>Og);return{useNotificationStore:v}},void 0);b().error("",3e3)}}}}function GN(){const e=Be(S=>S.providers),t=Be(S=>S.lastRefreshedAt),r=Be(S=>S.isLoading),n=Be(S=>S.isInitialized);Be(S=>S.error);const o=Be(S=>S.refreshProviders),i=ut(),l=ut(S=>S.showSettings),c=ut(S=>S.setShowSettings),u=gt(),d=WN(),[g,x]=w.useState("providers");w.useEffect(()=>{n||Be.getState().initialize(),i.loadSettings()},[n]),w.useEffect(()=>{g==="prompts"?i.openPromptEditor("system"):g==="params"&&i.loadSettings()},[g]);const y=async()=>{try{console.log("[SettingsModal] ..."),await o(),await new Promise(I=>setTimeout(I,100));const S=Be.getState().providers,T=Be.getState().error;console.log("[SettingsModal]  providers:",S),console.log("[SettingsModal] providers :",S.length),S.length===0?T?u.error(`: ${T}`):u.warning(` AI 

1.  .setting.json 
2. .setting.json  providers 
3. `):u.success(` ${S.length}  AI `)}catch(S){console.error("[SettingsModal] :",S),console.error("[SettingsModal] :",S.stack),u.error(`: ${S.message||""}`)}};return l?s.jsxs(s.Fragment,{children:[s.jsx(Wg,{onOpen:()=>c(!0)}),s.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:s.jsxs("div",{className:"bg-white rounded-lg max-w-4xl w-full h-[85vh] overflow-hidden flex flex-col",children:[s.jsx("div",{className:"p-6",children:s.jsx(DN,{activeTab:g,onActiveTabChange:x,onClose:()=>c(!1)})}),s.jsxs("div",{className:"p-6 overflow-y-auto flex-1",children:[g==="providers"&&s.jsx(FN,{providers:e,lastRefreshedAt:t,isLoading:r,onRefreshConfig:y}),!1,g==="params"&&s.jsx(BN,{}),g==="prompts"&&s.jsx(qN,{onResetSystem:d.resetSystemPromptRules,onResetUser:d.resetUserPromptRules,onResetRequirement:d.resetRequirementReportRules,onResetQualityAnalysisSystem:d.resetQualityAnalysisSystemPrompt,onResetThinking:d.resetThinkingPointsExtractionPrompt,onResetGeneration:d.resetSystemPromptGenerationPrompt,onResetAdvice:d.resetOptimizationAdvicePrompt,onResetApplication:d.resetOptimizationApplicationPrompt,onToggleSlimRules:d.handleSlimRulesToggle,onResetUserPromptQualityAnalysis:d.resetUserPromptQualityAnalysis,onResetUserPromptQuickOptimization:d.resetUserPromptQuickOptimization})]}),s.jsxs("div",{className:"flex justify-end space-x-3 p-6 border-t bg-gray-50 flex-shrink-0",children:[s.jsx("button",{onClick:()=>c(!1),className:"px-4 py-2 text-gray-600 border border-gray-300 rounded-md hover:bg-gray-50",children:""}),s.jsx("button",{onClick:d.saveAndClose,className:"px-4 py-2 bg-blue-500 text-white rounded-md hover:bg-blue-600",children:""})]})]})})]}):s.jsx(Wg,{onOpen:()=>c(!0)})}function Wo({children:e}){const t=jr(o=>o.token),r=jr(o=>o.user);return!!t&&!!r?s.jsx(s.Fragment,{children:e}):s.jsx(Wd,{to:"/login",replace:!0})}function HN(){const e=xo(),t=jr(i=>i.initialize),r=ui(),n=ui(i=>i.currentModule),o=e.pathname==="/login";return w.useEffect(()=>{t()},[]),w.useEffect(()=>{if(!o){const i=r.getModuleByPath(e.pathname);i&&n!==i.id&&r.setCurrentModule(i.id)}},[e.pathname,o]),s.jsxs("div",{id:"app",className:"min-h-screen bg-[var(--ct-slate-50)] text-[var(--ct-slate-900)]",children:[s.jsxs(NT,{children:[s.jsx(Rn,{path:"/login",element:s.jsx(zP,{})}),s.jsx(Rn,{path:"/",element:s.jsx(Wo,{children:s.jsx(Bo,{children:s.jsx(Wd,{to:"/generate",replace:!0})})})}),s.jsx(Rn,{path:"/generate",element:s.jsx(Wo,{children:s.jsx(Bo,{children:s.jsx(dN,{})})})}),s.jsx(Rn,{path:"/optimize",element:s.jsx(Wo,{children:s.jsx(Bo,{children:s.jsx(Ug,{})})})}),s.jsx(Rn,{path:"/optimize/:id?",element:s.jsx(Wo,{children:s.jsx(Bo,{children:s.jsx(Ug,{})})})}),s.jsx(Rn,{path:"/playground",element:s.jsx(Wo,{children:s.jsx(Bo,{children:s.jsx(_N,{})})})}),s.jsx(Rn,{path:"/library",element:s.jsx(Wo,{children:s.jsx(Bo,{children:s.jsx(ON,{})})})}),s.jsx(Rn,{path:"*",element:s.jsx(Wd,{to:"/login",replace:!0})})]}),s.jsx(GN,{}),s.jsx(Kx,{})]})}jr.getState().initialize();Be.getState().initialize();const VN=document.getElementById("root");Qu.createRoot(VN).render(s.jsx(sp.StrictMode,{children:s.jsx(LT,{children:s.jsx(HN,{})})}));export{zt as _,YN as c,Gg as g};
