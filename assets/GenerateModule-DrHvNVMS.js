var Ie=Object.defineProperty;var Ae=(p,l,e)=>l in p?Ie(p,l,{enumerable:!0,configurable:!0,writable:!0,value:e}):p[l]=e;var be=(p,l,e)=>Ae(p,typeof l!="symbol"?l+"":l,e);import{c as ke,s as ze,r as D,u as Ge,d as K,a as W,e as C,q as y,f as m,g as z,n as O,h as q,k as n,R as Z,t as Q,F as re,x as ce,S as Pe,X as we,y as he,z as $e,j,A as De,B as _,i as qe,D as Ue,E as V,G as se,H as Me,I as me,o as oe,J as Be,K as Y,M as xe,w as ge,N as Ee,m as le,O as pe,P as Le,Q as Fe,U as je,V as Oe,W as He,Y as _e}from"./index-CgStLW2f.js";import{savePrompt as Qe}from"./apiService-U8WeGMz-.js";import{d as ue,A as Ke}from"./marked.esm-B0Ieip5I.js";import{P as Ne,T as Xe,c as J,a as ve,b as te,u as Se,C as Ce,d as ie,e as Re,f as Ve,_ as de,g as We,h as Je,i as Ye}from"./FinalTab.vue_vue_type_script_setup_true_lang-Be1GIgUz.js";import{c as Te,_ as Ze}from"./SavePromptDialog.vue_vue_type_script_setup_true_lang-Byq4kPDr.js";/**
 * @license lucide-vue-next v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const et=ke("paperclip",[["path",{d:"m16 6-8.414 8.586a2 2 0 0 0 2.829 2.829l8.414-8.586a4 4 0 1 0-5.657-5.657l-8.379 8.551a6 6 0 1 0 8.485 8.485l8.379-8.551",key:"1miecu"}]]);/**
 * @license lucide-vue-next v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const tt=ke("square",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}]]);/**
 * @license lucide-vue-next v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const nt=ke("upload",[["path",{d:"M12 3v12",key:"1x0j5s"}],["path",{d:"m17 8-5-5-5 5",key:"7q97r8"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}]]),ee=ze("prompt",()=>{const p=D(0),l=D(0),e=D([]),s=D(!1),r=D(!1),a=D(!1),t=D("zh"),i=D(!0),u=D(!1),d=D(null),v=D({taskDefinition:"",context:"",outputFormat:"",qualityCriteria:"",executionParams:""}),c=D({requirementReport:"",generatedPrompt:{zh:"",en:""},optimizedPrompt:{zh:"",en:""}}),f=[{id:"taskDefinition",title:"ä»»åŠ¡å®šä¹‰",description:"æ˜ç¡®AIåŠ©æ‰‹çš„æ ¸å¿ƒä»»åŠ¡å’Œä¸»è¦åŠŸèƒ½"},{id:"context",title:"ä½¿ç”¨åœºæ™¯",description:"äº†è§£AIçš„ä½¿ç”¨ç¯å¢ƒå’Œç›®æ ‡ç”¨æˆ·"},{id:"outputFormat",title:"è¾“å‡ºæ ¼å¼",description:"å®šä¹‰AIå›ç­”çš„ç»“æ„ã€æ ¼å¼å’Œé£æ ¼"},{id:"qualityCriteria",title:"è´¨é‡è¦æ±‚",description:"ç¡®å®šæˆåŠŸæ ‡å‡†å’Œè´¨é‡æœŸæœ›"},{id:"executionParams",title:"å·¥ä½œæ–¹å¼",description:"è®¾å®šAIçš„æ€è€ƒæ–¹å¼å’Œäº’åŠ¨é£æ ¼"},{id:"optimization",title:"æœ€ç»ˆç¡®è®¤",description:"ç¡®è®¤ä¿¡æ¯å®Œæ•´æ€§å¹¶ç”Ÿæˆæç¤ºè¯"}],M=(x,P,$,G)=>{const L={id:(G==null?void 0:G.id)||`msg_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,type:x,content:P,timestamp:new Date().toISOString(),isProgress:(G==null?void 0:G.isProgress)||!1,attachments:$&&$.length>0?$:[]};e.value.push(L),x==="user"&&l.value++};return{currentStep:p,currentStepUserMessages:l,chatMessages:e,isTyping:s,isGenerating:r,showPreview:a,currentLanguage:t,isAutoMode:i,isInitialized:u,currentExecutionStep:d,collectedData:v,promptData:c,steps:f,addMessage:M,addOrUpdateProgressMessage:(x,P="progress_message")=>{const $=e.value.findIndex(G=>G.id===P);$!==-1?(e.value[$].content=x,e.value[$].timestamp=new Date().toISOString()):M("ai",x,void 0,{id:P,isProgress:!0})},clearChat:()=>{e.value=[],p.value=0,l.value=0,a.value=!1,u.value=!1,d.value=null,v.value={taskDefinition:"",context:"",outputFormat:"",qualityCriteria:"",executionParams:""},c.value={requirementReport:"",generatedPrompt:{zh:"",en:""},optimizedPrompt:{zh:"",en:""}}},nextStep:()=>{p.value<f.length-1&&(p.value++,l.value=0)},updateCollectedData:(x,P)=>{if(x in v.value){const $=v.value[x];v.value[x]=$?$+`
`+P:P}},deleteMessage:x=>{const P=e.value.find($=>$.id===x);P&&(P.isDeleted=!0)},startEditMessage:x=>{const P=e.value.find($=>$.id===x);P&&(P.isEditing=!0,P.originalContent=P.content)},saveEditMessage:(x,P)=>{const $=e.value.find(G=>G.id===x);$&&($.content=P.trim(),$.isEditing=!1,$.originalContent=void 0,$.timestamp=new Date().toISOString())},cancelEditMessage:x=>{const P=e.value.find($=>$.id===x);P&&P.originalContent!==void 0&&(P.content=P.originalContent,P.isEditing=!1,P.originalContent=void 0)},updateMessage:(x,P)=>{const $=e.value.find(G=>G.id===x);$&&($.content=P,$.timestamp=new Date().toISOString())},getValidMessages:()=>e.value.filter(x=>!x.isDeleted&&!x.isProgress),clearProgressMessages:()=>{e.value=e.value.filter(x=>!x.isProgress)},saveToBackend:async(x,P,$,G="system")=>{if(!Ge().isLoggedIn)return{success:!1,error:"è¯·å…ˆç™»å½•åå†ä¿å­˜æç¤ºè¯"};let B;const U=c.value.generatedPrompt;if(typeof U=="string"?B=U:"markdown"in U&&"xml"in U?B=U.markdown.zh||U.markdown.en||U.xml.zh||U.xml.en:B=U[t.value],!B||!B.trim())return{success:!1,error:"æ²¡æœ‰å¯ä¿å­˜çš„æç¤ºè¯"};try{const F={title:x.trim(),description:P==null?void 0:P.trim(),requirement_report:c.value.requirementReport,thinking_points:c.value.thinkingPoints,initial_prompt:c.value.initialPrompt,advice:c.value.advice,final_prompt:B,language:t.value,format:"markdown",prompt_type:G,tags:$},N=await Qe(F);return N.code===200&&N.data?{success:!0,promptId:N.data.id}:{success:!1,error:N.message||"ä¿å­˜å¤±è´¥"}}catch(F){return{success:!1,error:F.message||"ä¿å­˜å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•"}}}}}),rt={class:"p-4 border-b border-gray-200 flex-shrink-0"},st={class:"flex justify-between items-center"},ot={class:"flex items-center space-x-3"},it={class:"flex items-center space-x-2"},at=["title"],lt=K({__name:"ChatHeader",props:{isStreamMode:{type:Boolean},isGenerating:{type:Boolean},isTyping:{type:Boolean}},emits:["toggle-stream","clear-chat","interrupt"],setup(p){const l=p,e=W(()=>l.isGenerating||l.isTyping);return(s,r)=>(y(),C("div",rt,[m("div",st,[r[6]||(r[6]=m("div",{class:"flex items-center space-x-2"},[m("h4",{class:"font-semibold text-gray-800"},"AIåŠ©æ‰‹å¯¹è¯")],-1)),m("div",ot,[m("div",it,[r[3]||(r[3]=m("span",{class:"text-sm text-gray-600"},"æµå¼:",-1)),m("button",{onClick:r[0]||(r[0]=a=>s.$emit("toggle-stream")),class:O(["relative inline-flex h-5 w-9 items-center rounded-full transition-colors focus:outline-none",s.isStreamMode?"bg-blue-500":"bg-gray-300"]),title:s.isStreamMode?"å…³é—­æµå¼æ¨¡å¼":"å¼€å¯æµå¼æ¨¡å¼"},[m("span",{class:O(["inline-block h-3 w-3 transform rounded-full bg-white transition-transform",s.isStreamMode?"translate-x-5":"translate-x-1"])},null,2)],10,at)]),e.value?(y(),C("button",{key:0,onClick:r[1]||(r[1]=a=>s.$emit("interrupt")),class:"flex items-center gap-1 px-3 py-1 text-sm text-gray-600 hover:text-orange-600 hover:bg-orange-100 rounded transition-colors",title:"ä¸­æ–­ç”Ÿæˆ"},[q(n(tt),{class:"w-4 h-4"}),r[4]||(r[4]=m("span",null,"ä¸­æ–­",-1))])):z("",!0),m("button",{onClick:r[2]||(r[2]=a=>s.$emit("clear-chat")),class:"flex items-center gap-1 px-3 py-1 text-sm text-gray-600 hover:text-red-600 hover:bg-red-50 rounded transition-colors",title:"é‡æ–°å¼€å§‹"},[q(n(Z),{class:"w-4 h-4"}),r[5]||(r[5]=m("span",null,"é‡æ–°å¼€å§‹",-1))])])])]))}}),ut={key:0,class:"relative"},ct={class:"relative border border-blue-300 rounded-2xl overflow-hidden bg-white"},pt={class:"relative"},dt=["value"],mt={key:1},gt=["innerHTML"],vt=["innerHTML"],ft={class:"text-xs text-gray-500 mb-1"},ht={class:"flex gap-2 overflow-x-auto scrollbar-thin scrollbar-thumb-gray-300 scrollbar-track-gray-100 pb-1"},yt={class:"flex items-center gap-2 min-w-0"},bt={class:"flex-shrink-0"},xt={key:0,class:"w-3 h-3 text-green-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},kt={key:1,class:"w-3 h-3 text-blue-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},wt={key:2,class:"w-3 h-3 text-purple-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},St={key:3,class:"w-3 h-3 text-red-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},Ct={key:4,class:"w-3 h-3 text-gray-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},Pt={class:"min-w-0 flex-1"},Mt=["title"],Rt=["title","disabled"],$t=["disabled"],Dt=["disabled"],Et=K({__name:"ChatMessage",props:{message:{},messageIndex:{},editingContent:{},isDisabled:{type:Boolean}},emits:["start-edit","save-edit","cancel-edit","delete","copy","regenerate","resend","resend-user","edit-keydown","set-edit-ref","set-message-ref","update:editingContent"],setup(p){const l=s=>{try{const r=ue(s,{breaks:!0,gfm:!0});return typeof r=="string"?r:String(r)}catch{return s}},e=s=>{try{if(/^#|^\*\*|^##|^\*|^-|\*\*.*\*\*|^1\.|```/.test(s)||s.includes("**")||s.includes("##")||s.includes("# ")||s.length>50){const a=ue(s,{breaks:!0,gfm:!0});return typeof a=="string"?a:String(a)}else return s.replace(/\n/g,"<br>")}catch{try{const a=ue(s,{breaks:!0,gfm:!0});return typeof a=="string"?a:String(a)}catch{return s.replace(/\n/g,"<br>")}}};return(s,r)=>(y(),C("div",{ref:a=>s.$emit("set-message-ref",{messageId:s.message.id,el:a}),class:O([s.message.type==="user"?"justify-end":"justify-start","flex group"])},[m("div",{class:O(["flex flex-col w-full",s.message.isEditing?"max-w-full sm:max-w-2xl":"max-w-xs lg:max-w-md"])},[m("div",{class:O([s.message.isEditing?"bg-transparent border-0 shadow-none p-0":s.message.type==="user"?"bg-blue-500 text-white px-4 py-3 rounded-lg":s.message.isProgress?"bg-blue-50 text-blue-800 border border-blue-200 px-4 py-3 rounded-lg":"bg-gray-100 text-gray-800 px-4 py-3 rounded-lg",s.message.isProgress&&"animate-pulse",!s.message.isEditing&&(s.message.type==="user"?"ml-auto":"mr-auto"),"transition-all duration-300 relative"])},[s.message.isEditing?(y(),C("div",ut,[m("div",ct,[m("div",pt,[m("textarea",{ref:a=>s.$emit("set-edit-ref",{messageId:s.message.id,el:a}),value:s.editingContent,onInput:r[0]||(r[0]=a=>s.$emit("update:editingContent",a.target.value)),class:"w-full p-4 border-0 resize-none focus:outline-none text-gray-800 bg-white min-h-[80px] max-h-[200px] overflow-y-auto text-base",onKeydown:r[1]||(r[1]=a=>s.$emit("edit-keydown",{event:a,messageId:s.message.id})),placeholder:"ç¼–è¾‘æ¶ˆæ¯å†…å®¹..."},null,40,dt)])])])):(y(),C("div",mt,[s.message.type==="ai"?(y(),C("div",{key:0,innerHTML:l(s.message.content),class:"prose prose-sm max-w-none prose-headings:text-gray-800 prose-p:text-gray-800 prose-li:text-gray-800 prose-strong:text-gray-800"},null,8,gt)):(y(),C("div",{key:1,innerHTML:e(s.message.content),class:"text-sm text-white [&_h1]:text-base [&_h1]:font-bold [&_h1]:text-white [&_h1]:mb-2 [&_h2]:text-sm [&_h2]:font-bold [&_h2]:text-white [&_h2]:mb-2 [&_h3]:text-sm [&_h3]:font-bold [&_h3]:text-white [&_h3]:mb-1 [&_h4]:text-sm [&_h4]:font-bold [&_h4]:text-white [&_h5]:text-sm [&_h5]:font-bold [&_h5]:text-white [&_h6]:text-sm [&_h6]:font-bold [&_h6]:text-white [&_p]:text-sm [&_p]:text-white [&_p]:mb-2 [&_strong]:font-bold [&_strong]:text-white [&_b]:font-bold [&_b]:text-white [&_em]:italic [&_em]:text-white [&_i]:italic [&_i]:text-white [&_ul]:list-disc [&_ul]:list-inside [&_ul]:text-white [&_ul]:text-sm [&_ul]:mb-2 [&_ol]:list-decimal [&_ol]:list-inside [&_ol]:text-white [&_ol]:text-sm [&_ol]:mb-2 [&_li]:text-sm [&_li]:text-white [&_li]:mb-1 [&_code]:bg-blue-600 [&_code]:text-blue-100 [&_code]:text-xs [&_code]:px-1 [&_code]:rounded [&_code]:font-mono [&_pre]:bg-blue-600 [&_pre]:text-blue-100 [&_pre]:text-xs [&_pre]:p-2 [&_pre]:rounded [&_pre]:overflow-x-auto [&_a]:text-blue-200 [&_a]:underline [&_a]:text-sm [&_blockquote]:border-l-2 [&_blockquote]:border-blue-300 [&_blockquote]:pl-2 [&_blockquote]:text-blue-100 [&_blockquote]:text-sm"},null,8,vt))]))],2),s.message.attachments&&s.message.attachments.length>0&&!s.message.isEditing?(y(),C("div",{key:0,class:O(["mt-2",s.message.type==="user"?"ml-auto max-w-xs lg:max-w-md":"mr-auto max-w-xs lg:max-w-md"])},[m("div",ft,"é™„ä»¶ ("+Q(s.message.attachments.length)+")",1),m("div",ht,[(y(!0),C(re,null,ce(s.message.attachments,a=>(y(),C("div",{key:a.id,class:O(["flex-shrink-0 flex items-center gap-2 px-2 py-1.5 rounded-md text-xs border min-w-0",s.message.type==="user"?"border-blue-200 bg-blue-50":"border-gray-200 bg-gray-100"])},[m("div",yt,[m("div",bt,[a.type==="image"?(y(),C("svg",xt,[...r[9]||(r[9]=[m("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"},null,-1)])])):a.type==="document"?(y(),C("svg",kt,[...r[10]||(r[10]=[m("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"},null,-1)])])):a.type==="audio"?(y(),C("svg",wt,[...r[11]||(r[11]=[m("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 19V6l12-3v13M9 19c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zm12-3c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zM9 10l12-3"},null,-1)])])):a.type==="video"?(y(),C("svg",St,[...r[12]||(r[12]=[m("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z"},null,-1)])])):(y(),C("svg",Ct,[...r[13]||(r[13]=[m("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15.172 7l-6.586 6.586a2 2 0 102.828 2.828l6.414-6.586a4 4 0 00-5.656-5.656l-6.415 6.585a6 6 0 108.486 8.486L20.5 13"},null,-1)])]))]),m("div",Pt,[m("div",{class:O(["truncate max-w-20 font-medium text-xs",s.message.type==="user"?"text-blue-700":"text-gray-700"]),title:a.name},Q(a.name),11,Mt),m("div",{class:O(["text-xs",s.message.type==="user"?"text-blue-500":"text-gray-500"])},Q((a.size/1024).toFixed(1))+"KB ",3)])])],2))),128))])],2)):z("",!0),s.message.isProgress?z("",!0):(y(),C("div",{key:1,class:O(["flex space-x-1 mt-2 transition-opacity duration-200",[s.message.isEditing?"opacity-100 justify-end":"opacity-0 group-hover:opacity-100 "+(s.message.type==="user"?"justify-end":"justify-start")]])},[s.message.isEditing?(y(),C(re,{key:0},[m("button",{onClick:r[2]||(r[2]=a=>s.message.type==="user"?s.$emit("resend",s.message.id):s.$emit("save-edit",s.message.id)),class:"p-1.5 text-gray-500 hover:text-blue-600 transition-colors rounded-lg hover:bg-gray-100",title:s.message.type==="user"?"ä¿å­˜å¹¶é‡æ–°å‘é€":"ä¿å­˜ç¼–è¾‘",disabled:s.isDisabled},[q(n(Pe),{class:"w-3.5 h-3.5"})],8,Rt),m("button",{onClick:r[3]||(r[3]=a=>s.$emit("cancel-edit",s.message.id)),class:"p-1.5 text-gray-500 hover:text-red-600 transition-colors rounded-lg hover:bg-gray-100",title:"å–æ¶ˆç¼–è¾‘"},[q(n(we),{class:"w-3.5 h-3.5"})])],64)):(y(),C(re,{key:1},[s.message.type==="ai"?(y(),C("button",{key:0,onClick:r[4]||(r[4]=a=>s.$emit("regenerate",s.message.id)),class:"p-1.5 text-gray-500 hover:text-blue-600 transition-colors rounded-lg hover:bg-gray-100",title:"é‡æ–°ç”Ÿæˆå›å¤",disabled:s.isDisabled},[q(n(Z),{class:"w-3.5 h-3.5"})],8,$t)):z("",!0),s.message.type==="user"?(y(),C("button",{key:1,onClick:r[5]||(r[5]=a=>s.$emit("resend-user",s.message.id)),class:"p-1.5 text-gray-500 hover:text-blue-600 transition-colors rounded-lg hover:bg-gray-100",title:"é‡æ–°å‘é€æ¶ˆæ¯",disabled:s.isDisabled},[q(n(Pe),{class:"w-3.5 h-3.5"})],8,Dt)):z("",!0),m("button",{onClick:r[6]||(r[6]=a=>s.$emit("start-edit",s.message.id)),class:"p-1.5 text-gray-500 hover:text-green-600 transition-colors rounded-lg hover:bg-gray-100",title:"ç¼–è¾‘æ¶ˆæ¯"},[q(n(Ne),{class:"w-3.5 h-3.5"})]),m("button",{onClick:r[7]||(r[7]=a=>s.$emit("delete",s.message.id)),class:"p-1.5 text-gray-500 hover:text-red-600 transition-colors rounded-lg hover:bg-gray-100",title:"åˆ é™¤æ¶ˆæ¯"},[q(n(Xe),{class:"w-3.5 h-3.5"})]),m("button",{onClick:r[8]||(r[8]=a=>s.$emit("copy",s.message.content)),class:"p-1.5 text-gray-500 hover:text-blue-600 transition-colors rounded-lg hover:bg-gray-100",title:"å¤åˆ¶æ¶ˆæ¯å†…å®¹"},[q(n(he),{class:"w-3.5 h-3.5"})])],64))],2))],2)],2))}}),Tt={key:0,class:"flex justify-start"},It=K({__name:"ChatMessageList",props:{chatContainer:{},chatContainerMaxHeight:{},editingContent:{}},emits:["start-edit","save-edit","cancel-edit","delete","copy","regenerate","resend","resend-user","edit-keydown","set-edit-ref","set-message-ref"],setup(p){const l=p,e=ee(),s=W(()=>e.chatMessages.filter(i=>!i.isDeleted)),r=W(()=>e.isTyping),a=W(()=>e.isGenerating),t=i=>{l.chatContainer&&i&&(l.chatContainer.value=i)};return(i,u)=>(y(),C("div",{ref:t,class:"flex-1 overflow-y-auto p-4 space-y-4 min-h-0",style:$e({maxHeight:i.chatContainerMaxHeight})},[(y(!0),C(re,null,ce(s.value,(d,v)=>(y(),j(Et,{key:d.id||v,message:d,"message-index":v,"editing-content":i.editingContent[d.id]||"","is-disabled":r.value||a.value,onStartEdit:u[0]||(u[0]=c=>i.$emit("start-edit",c)),onSaveEdit:u[1]||(u[1]=c=>i.$emit("save-edit",c)),onCancelEdit:u[2]||(u[2]=c=>i.$emit("cancel-edit",c)),onDelete:u[3]||(u[3]=c=>i.$emit("delete",c)),onCopy:u[4]||(u[4]=c=>i.$emit("copy",c)),onRegenerate:c=>i.$emit("regenerate",{messageId:c,messageIndex:v}),onResend:c=>i.$emit("resend",{messageId:c,messageIndex:v}),onResendUser:c=>i.$emit("resend-user",{messageId:c,messageIndex:v}),onEditKeydown:u[5]||(u[5]=c=>i.$emit("edit-keydown",c)),onSetEditRef:u[6]||(u[6]=c=>i.$emit("set-edit-ref",c)),onSetMessageRef:u[7]||(u[7]=c=>i.$emit("set-message-ref",c))},null,8,["message","message-index","editing-content","is-disabled","onRegenerate","onResend","onResendUser"]))),128)),r.value?(y(),C("div",Tt,[...u[8]||(u[8]=[De('<div class="bg-gray-100 text-gray-800 px-4 py-2 rounded-lg"><div class="flex space-x-1"><div class="w-2 h-2 bg-gray-400 rounded-full animate-bounce"></div><div class="w-2 h-2 bg-gray-400 rounded-full animate-bounce" style="animation-delay:0.1s;"></div><div class="w-2 h-2 bg-gray-400 rounded-full animate-bounce" style="animation-delay:0.2s;"></div></div></div>',1)])])):z("",!0)],4))}}),At={class:"flex flex-wrap gap-2"},zt=["onClick"],Gt=K({__name:"ChatQuickReplies",props:{show:{type:Boolean},replies:{},quickRepliesContainer:{},inputContainerRef:{}},emits:["select"],setup(p){const l=p,e=D(),s=W(()=>{if(!l.inputContainerRef)return{position:"absolute",bottom:"100%",left:"0",right:"0"};const r=l.inputContainerRef.getBoundingClientRect();return{position:"fixed",bottom:`${window.innerHeight-r.top}px`,left:`${r.left}px`,right:`${window.innerWidth-r.right}px`}});return _(e,r=>{l.quickRepliesContainer&&(l.quickRepliesContainer.value=r)}),(r,a)=>r.show?(y(),C("div",{key:0,ref_key:"containerRef",ref:e,class:"px-6 py-3 bg-gray-50 border-b border-gray-200 shadow-lg z-10",style:$e(s.value)},[a[0]||(a[0]=m("div",{class:"text-xs text-gray-500 mb-2"},"å¿«é€Ÿå›å¤ï¼š",-1)),m("div",At,[(y(!0),C(re,null,ce(r.replies,t=>(y(),C("button",{key:t,onClick:i=>r.$emit("select",t),class:"px-3 py-1 text-sm bg-white border border-gray-300 rounded-full hover:bg-gray-50 transition-colors"},Q(t),9,zt))),128))])],4)):z("",!0)}}),qt={ref:"inputContainer",class:"p-3 border-t border-gray-200 bg-white flex-shrink-0 relative z-20"},Ut={class:"flex flex-wrap gap-2"},Bt=["onClick"],Lt={key:1,class:"mb-3 p-3 bg-gray-50 rounded-lg"},Ft={class:"flex items-center justify-between mb-2"},jt={class:"text-sm text-gray-600"},Ot={class:"flex gap-2 overflow-x-auto scrollbar-thin scrollbar-thumb-gray-300 scrollbar-track-gray-100"},Ht={class:"flex items-center gap-2 min-w-0"},_t={class:"flex-shrink-0"},Qt={key:0,class:"w-4 h-4 text-green-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},Kt={key:1,class:"w-4 h-4 text-blue-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},Nt={key:2,class:"w-4 h-4 text-purple-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},Xt={key:3,class:"w-4 h-4 text-red-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},Vt={key:4,class:"w-4 h-4 text-gray-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},Wt={class:"min-w-0 flex-1"},Jt=["title"],Yt={class:"text-xs text-gray-500"},Zt=["onClick"],en={class:"relative border border-gray-300 rounded-2xl focus-within:outline-none focus-within:border-gray-300 overflow-hidden",style:{height:"120px"}},tn={class:"absolute top-0 left-0 right-0",style:{bottom:"48px"}},nn=["value","placeholder","disabled"],rn={class:"absolute bottom-0 left-0 right-0 h-12 flex justify-between items-center px-2 bg-transparent pointer-events-none"},sn={class:"relative"},on={key:0,class:"absolute -top-1 -right-1 bg-blue-500 text-white text-xs rounded-full w-3 h-3 flex items-center justify-center",style:{"font-size":"9px"}},an=["disabled"],ln=K({__name:"ChatInputArea",props:{isEditing:{type:Boolean},userInput:{},attachments:{},placeholder:{},isDisabled:{type:Boolean},textareaRef:{},inputContainer:{},showQuickReplies:{type:Boolean},quickReplies:{},quickRepliesContainer:{}},emits:["update:userInput","keydown","composition-start","composition-end","focus","send","file-select","remove-attachment","clear-attachments","quick-reply-select"],setup(p,{emit:l}){const e=p,s=l,r=D(),a=D();_(r,d=>{e.quickRepliesContainer&&(e.quickRepliesContainer.value=d)});const t=()=>{a.value&&a.value.click()},i=()=>{s("focus")},u=d=>{const v=d.target;if(document.activeElement!==v){const c=window.pageYOffset||document.documentElement.scrollTop,f=window.pageXOffset||document.documentElement.scrollLeft;setTimeout(()=>{window.scrollTo(f,c)},0)}};return(d,v)=>(y(),C("div",qt,[d.showQuickReplies?(y(),C("div",{key:0,ref_key:"quickRepliesRef",ref:r,class:"absolute bottom-full left-0 right-0 px-6 py-3 bg-gray-50 border-b border-gray-200 shadow-lg"},[v[7]||(v[7]=m("div",{class:"text-xs text-gray-500 mb-2"},"å¿«é€Ÿå›å¤ï¼š",-1)),m("div",Ut,[(y(!0),C(re,null,ce(d.quickReplies,c=>(y(),C("button",{key:c,onClick:f=>d.$emit("quick-reply-select",c),class:"px-3 py-1 text-sm bg-white border border-gray-300 rounded-full hover:bg-gray-50 transition-colors"},Q(c),9,Bt))),128))])],512)):z("",!0),m("input",{ref_key:"fileInputRef",ref:a,type:"file",multiple:"",accept:"image/*,video/*,audio/*,.pdf,.doc,.docx,.xls,.xlsx,.ppt,.pptx,.txt,.md,.csv,.json,.xml,.html,.css,.js,.ts,.py,.java,.c,.cpp,.yaml,.yml",onChange:v[0]||(v[0]=c=>d.$emit("file-select",c)),class:"hidden"},null,544),d.attachments.length>0?(y(),C("div",Lt,[m("div",Ft,[m("span",jt,"å·²é€‰æ‹© "+Q(d.attachments.length)+" ä¸ªé™„ä»¶",1),m("button",{onClick:v[1]||(v[1]=c=>d.$emit("clear-attachments")),class:"text-xs text-red-500 hover:text-red-700"}," æ¸…ç©ºå…¨éƒ¨ ")]),m("div",Ot,[(y(!0),C(re,null,ce(d.attachments,c=>(y(),C("div",{key:c.id,class:"flex-shrink-0 flex items-center gap-2 bg-white px-3 py-2 rounded-md border border-gray-200 min-w-0"},[m("div",Ht,[m("div",_t,[c.type==="image"?(y(),C("svg",Qt,[...v[8]||(v[8]=[m("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"},null,-1)])])):c.type==="document"?(y(),C("svg",Kt,[...v[9]||(v[9]=[m("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"},null,-1)])])):c.type==="audio"?(y(),C("svg",Nt,[...v[10]||(v[10]=[m("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 19V6l12-3v13M9 19c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zm12-3c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zM9 10l12-3"},null,-1)])])):c.type==="video"?(y(),C("svg",Xt,[...v[11]||(v[11]=[m("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z"},null,-1)])])):(y(),C("svg",Vt,[...v[12]||(v[12]=[m("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15.172 7l-6.586 6.586a2 2 0 102.828 2.828l6.414-6.586a4 4 0 00-5.656-5.656l-6.415 6.585a6 6 0 108.486 8.486L20.5 13"},null,-1)])]))]),m("div",Wt,[m("div",{class:"text-xs font-medium text-gray-700 truncate max-w-24",title:c.name},Q(c.name),9,Jt),m("div",Yt,Q((c.size/1024).toFixed(1))+"KB ",1)])]),m("button",{onClick:f=>d.$emit("remove-attachment",c.id),class:"flex-shrink-0 w-4 h-4 text-gray-400 hover:text-red-500 transition-colors",title:"ç§»é™¤é™„ä»¶"},[q(n(we),{class:"w-3 h-3"})],8,Zt)]))),128))])])):z("",!0),qe(m("div",en,[m("div",tn,[m("textarea",{ref:"textareaRef",value:d.userInput,onInput:v[2]||(v[2]=c=>d.$emit("update:userInput",c.target.value)),onKeydown:v[3]||(v[3]=c=>d.$emit("keydown",c)),onCompositionstart:v[4]||(v[4]=c=>d.$emit("composition-start")),onCompositionend:v[5]||(v[5]=c=>d.$emit("composition-end")),onFocus:i,onMousedown:u,placeholder:d.placeholder,disabled:d.isDisabled,class:"w-full h-full px-2 pt-3 pb-1 border-0 outline-none resize-none disabled:opacity-50 text-base overflow-y-auto bg-transparent",rows:"1"},null,40,nn)]),m("div",rn,[m("button",{onClick:t,class:"w-8 h-8 rounded-full text-gray-500 hover:bg-gray-100 hover:text-gray-700 transition-colors flex items-center justify-center pointer-events-auto",title:"æ”¯æŒæ‹–æ‹½ä¸Šä¼ å›¾ç‰‡ã€æ–‡æ¡£ã€éŸ³é¢‘ç­‰æ ¼å¼ï¼Œå•ä¸ªæ–‡ä»¶æœ€å¤§25MB"},[m("div",sn,[q(n(et),{class:"w-4 h-4"}),d.attachments.length>0?(y(),C("span",on,Q(d.attachments.length),1)):z("",!0)])]),m("button",{onClick:v[6]||(v[6]=c=>d.$emit("send")),disabled:!d.userInput.trim()||d.isDisabled,class:"w-8 h-8 bg-blue-500 text-white rounded-full hover:bg-blue-600 disabled:opacity-50 disabled:cursor-not-allowed transition-colors flex items-center justify-center pointer-events-auto"},[q(n(Ke),{class:"w-4 h-4"})],8,an)])],512),[[Ue,!d.isEditing]])],512))}});function un(){const p=ee(),l=D(),e=d=>{try{const v=ue(d,{breaks:!0,gfm:!0});return typeof v=="string"?v:String(v)}catch{return d}},s=d=>{try{if(/^#|^\*\*|^##|^\*|^-|\*\*.*\*\*|^1\.|```/.test(d)||d.includes("**")||d.includes("##")||d.includes("# ")||d.length>50){const c=ue(d,{breaks:!0,gfm:!0});return typeof c=="string"?c:String(c)}else return d.replace(/\n/g,"<br>")}catch{try{const c=ue(d,{breaks:!0,gfm:!0});return typeof c=="string"?c:String(c)}catch{return d.replace(/\n/g,"<br>")}}},r=()=>{V(()=>{l.value&&(l.value.scrollTop=l.value.scrollHeight)})};let a=-1;return{chatContainer:l,renderMarkdown:e,renderUserMessage:s,scrollToBottom:r,startStreamingMessage:()=>(p.isTyping=!1,p.addMessage("ai","",void 0),a=p.chatMessages.length-1,a),updateStreamingMessage:d=>{a>=0&&a<p.chatMessages.length&&(p.chatMessages[a].content=d)},simulateTyping:async(d,v=!1)=>{if(v){const c=p.chatMessages.length;p.addMessage("ai","",void 0);for(let f=0;f<=d.length;f++)p.chatMessages[c].content=d.substring(0,f),await new Promise(M=>setTimeout(M,Math.random()*30+10))}else p.isTyping=!0,await new Promise(c=>setTimeout(c,100+Math.random()*100)),p.isTyping=!1,p.addMessage("ai",d,void 0)}}}function cn(){const p=D(""),l=D(),e=D(!1);return{userInput:p,textareaRef:l,isComposing:e,adjustTextareaHeight:()=>{},handleCompositionStart:()=>{e.value=!0},handleCompositionEnd:()=>{e.value=!1},handleKeydown:(u,d)=>{if(u.key==="Enter"){if(u.shiftKey)return;if(e.value)return;u.preventDefault(),d()}},clearInput:()=>{p.value="";const u=l.value;u&&(u.style.height="80px")}}}function pn(){const p=se(),l=D([]),e=D(!1),s=D();return{currentAttachments:l,isGlobalDragging:e,fileInputRef:s,triggerFileSelect:()=>{s.value&&s.value.click()},handleFileSelect:async f=>{const M=f.target,I=Array.from(M.files||[]);if(I.length>0){try{const{processFiles:k}=await Me(async()=>{const{processFiles:o}=await import("./fileUtils-CvcPFew1.js");return{processFiles:o}},[]),h=await k(I);h.attachments.length>0&&l.value.push(...h.attachments),h.errors.length>0&&h.errors.forEach(o=>p.error(o))}catch{p.error("æ–‡ä»¶å¤„ç†å¤±è´¥")}M.value=""}},removeAttachment:f=>{const M=l.value.findIndex(I=>I.id===f);M!==-1&&l.value.splice(M,1)},clearAttachments:()=>{l.value=[]},handleGlobalDragEnter:f=>{var M;if(f.preventDefault(),(M=f.dataTransfer)!=null&&M.items){for(let I=0;I<f.dataTransfer.items.length;I++)if(f.dataTransfer.items[I].kind==="file"){e.value=!0;break}}},handleGlobalDragOver:f=>{f.preventDefault(),e.value=!0},handleGlobalDragLeave:f=>{f.preventDefault();const I=f.currentTarget.getBoundingClientRect(),k=f.clientX,h=f.clientY;(k<I.left||k>I.right||h<I.top||h>I.bottom)&&(e.value=!1)},handleGlobalDrop:async f=>{var I;f.preventDefault(),e.value=!1;const M=Array.from(((I=f.dataTransfer)==null?void 0:I.files)||[]);if(M.length>0)try{const{processFiles:k}=await Me(async()=>{const{processFiles:o}=await import("./fileUtils-CvcPFew1.js");return{processFiles:o}},[]),h=await k(M);h.attachments.length>0&&l.value.push(...h.attachments),h.errors.length>0&&h.errors.forEach(o=>p.error(o))}catch{p.error("æ–‡ä»¶å¤„ç†å¤±è´¥")}}}}function dn(){const p=me(),l=D(!0),e=()=>{const t=p.currentProvider,i=p.currentModel;return{provider:t,model:i}},s=()=>{const{provider:t,model:i}=e();return!t||!i?"æœªé€‰æ‹©æ¨¡å‹":`${t.name} - ${i.name}`},r=()=>{l.value=!l.value,localStorage.setItem("yprompt_stream_mode",JSON.stringify(l.value))},a=()=>{const t=localStorage.getItem("yprompt_stream_mode");if(t!==null)try{l.value=JSON.parse(t)}catch{l.value=!0}};return oe(()=>{a()}),{isStreamMode:l,getCurrentChatModel:e,getChatModelDisplay:s,toggleStreamMode:r,loadSettings:a}}function mn(p){const l=ee(),e=D(!1),s=D(),r=W(()=>{const d=l.chatMessages.length,v=["è¯·ä½¿ç”¨ç›¸å…³æœ€ä½³å®è·µçš„æ¨èå»ºè®®"];if(d>=6){const f=!!l.promptData.requirementReport?"é‡æ–°ç”Ÿæˆéœ€æ±‚æŠ¥å‘Š":"å¼ºåˆ¶ç”Ÿæˆéœ€æ±‚æŠ¥å‘Š";return[...v,f]}return v}),a=W(()=>l.chatMessages.length>=2&&e.value),t=d=>["å¼ºåˆ¶ç”Ÿæˆéœ€æ±‚æŠ¥å‘Š","é‡æ–°ç”Ÿæˆéœ€æ±‚æŠ¥å‘Š"].some(c=>d.includes(c)),i=(d,v)=>{v(d),e.value=!1},u=d=>{var c,f;const v=d.target;(c=p.value)!=null&&c.contains(v)||(f=s.value)!=null&&f.contains(v)||(e.value=!1)};return oe(()=>{setTimeout(()=>{document.addEventListener("mousedown",u)},100)}),Be(()=>{document.removeEventListener("mousedown",u)}),{showQuickReplies:e,quickReplies:r,quickRepliesContainer:s,shouldShowQuickReplies:a,checkForceGenerate:t,selectQuickReply:i}}function gn(p){const l=ee(),e=se(),s=D({}),r=D({}),a=D({}),t=W(()=>Object.keys(s.value).length>0),i=(k,h)=>{h&&(r.value[k]=h)},u=k=>{k.el&&(a.value[k.messageId]=k.el)},d=k=>{const h=l.chatMessages.find(o=>o.id===k);h&&(s.value[k]=h.content,l.startEditMessage(k),V(()=>{const o=r.value[k];if(o){o.focus();const g=o.value.length;o.setSelectionRange(g,g)}}))},v=k=>{const h=s.value[k];h!==void 0&&h.trim()?(l.saveEditMessage(k,h),delete s.value[k],delete r.value[k]):e.warning("æ¶ˆæ¯å†…å®¹ä¸èƒ½ä¸ºç©º")},c=k=>{l.cancelEditMessage(k),delete s.value[k],delete r.value[k]};return{editingContent:s,editTextareaRefs:r,messageRefs:a,isEditing:t,setEditTextareaRef:i,setMessageRef:u,startEdit:d,saveEdit:v,cancelEdit:c,deleteMessage:k=>{confirm("ç¡®å®šè¦åˆ é™¤è¿™æ¡æ¶ˆæ¯å—ï¼Ÿåˆ é™¤åè¯¥æ¶ˆæ¯å°†ä¸ä¼šåœ¨åç»­çš„AIå¯¹è¯ä¸­è¢«è€ƒè™‘ã€‚")&&(l.deleteMessage(k),e.success("æ¶ˆæ¯å·²åˆ é™¤"))},copyMessage:async k=>{try{await Te(k),e.success("å·²å¤åˆ¶åˆ°å‰ªè´´æ¿")}catch{const o=document.createElement("textarea");o.value=k,document.body.appendChild(o),o.select();try{document.execCommand("copy"),e.success("å·²å¤åˆ¶åˆ°å‰ªè´´æ¿")}catch{e.error("å¤åˆ¶å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨é€‰æ‹©å¤åˆ¶")}document.body.removeChild(o)}},handleEditKeydown:(k,h)=>{k.key==="Enter"&&k.ctrlKey?(k.preventDefault(),v(h)):k.key==="Escape"&&(k.preventDefault(),c(h))}}}const ae=class ae{constructor(){be(this,"aiService");this.aiService=Y.getInstance()}getStreamMode(){try{const l=localStorage.getItem("yprompt_stream_mode");return l?JSON.parse(l):!0}catch{return!0}}static getInstance(){return ae.instance||(ae.instance=new ae),ae.instance}interruptCurrentRequest(){this.aiService.abortCurrentRequest()}async generateSimpleResponse(l,e,s,r,a=!1){const t=this.buildSimpleConversationMessages(l,e),i=await this.aiService.callAI(t,s,r,a);if(!i||i.trim()==="")throw new Error("AI APIè¿”å›äº†ç©ºå“åº”");return i}buildSimpleConversationMessages(l,e){const s={role:"system",content:xe.getUserGuidedPromptRules()},r=e.map(t=>({role:t.type==="user"?"user":"assistant",content:t.content,attachments:t.attachments||[]})),a=[s,...r];return l.trim()&&a.push({role:"user",content:l}),a}getStepInfo(l){const e=[{id:"taskDefinition",title:"ä»»åŠ¡å®šä¹‰",description:"æ˜ç¡®AIåŠ©æ‰‹çš„æ ¸å¿ƒä»»åŠ¡å’Œä¸»è¦åŠŸèƒ½",focus:"é‡ç‚¹äº†è§£ç”¨æˆ·å¸Œæœ›AIå®Œæˆä»€ä¹ˆæ ·çš„å·¥ä½œ"},{id:"context",title:"ä½¿ç”¨åœºæ™¯",description:"äº†è§£AIçš„ä½¿ç”¨ç¯å¢ƒå’Œç›®æ ‡ç”¨æˆ·",focus:"é‡ç‚¹äº†è§£åœ¨ä»€ä¹ˆæƒ…å†µä¸‹ä½¿ç”¨ã€é¢å‘ä»€ä¹ˆæ ·çš„ç”¨æˆ·"},{id:"outputFormat",title:"è¾“å‡ºæ ¼å¼",description:"å®šä¹‰AIå›ç­”çš„ç»“æ„ã€æ ¼å¼å’Œé£æ ¼",focus:"é‡ç‚¹äº†è§£å¸Œæœ›AIå¦‚ä½•ç»„ç»‡å’Œå‘ˆç°ç­”æ¡ˆ"},{id:"qualityCriteria",title:"è´¨é‡è¦æ±‚",description:"ç¡®å®šæˆåŠŸæ ‡å‡†å’Œè´¨é‡æœŸæœ›",focus:"é‡ç‚¹äº†è§£å¯¹å‡†ç¡®æ€§ã€å®Œæ•´æ€§ç­‰æ–¹é¢çš„è¦æ±‚"},{id:"executionParams",title:"å·¥ä½œæ–¹å¼",description:"è®¾å®šAIçš„æ€è€ƒæ–¹å¼å’Œäº’åŠ¨é£æ ¼",focus:"é‡ç‚¹äº†è§£å¸Œæœ›AIé‡‡ç”¨ä»€ä¹ˆæ ·çš„å·¥ä½œæ–¹å¼å’Œè¯­è°ƒ"},{id:"optimization",title:"æœ€ç»ˆç¡®è®¤",description:"ç¡®è®¤ä¿¡æ¯å®Œæ•´æ€§å¹¶ç”Ÿæˆæç¤ºè¯",focus:"æ±‡æ€»æ‰€æœ‰ä¿¡æ¯å¹¶ç”Ÿæˆæœ€ç»ˆæç¤ºè¯"}];return e.find(s=>s.id===l)||e[0]}async getInitialQuestion(l,e,s,r=!1){if(!e||!s)throw new Error("éœ€è¦é…ç½®AIæä¾›å•†å’Œæ¨¡å‹");return await this.generateInitialQuestionWithAI(l,e,s,r)}async generateInitialQuestionWithAI(l,e,s,r=!1){const a=this.getStepInfo(l),t={role:"system",content:xe.getUserGuidedPromptRules()},i={role:"user",content:`è¯·ä¸º"${a.title}"æ­¥éª¤ç”Ÿæˆä¸€ä¸ªåˆé€‚çš„å¼€åœºé—®é¢˜ã€‚è¿™ä¸ªæ­¥éª¤çš„ç›®æ ‡æ˜¯ï¼š${a.description}`};return await this.aiService.callAI([t,i],e,s,r)}async generateRequirementReportFromConversation(l,e,s,r){if(!e||!s)throw new Error("éœ€è¦é…ç½®AIæä¾›å•†å’Œæ¨¡å‹");return await this.generateReportFromConversationWithAI(l,e,s,r)}async generateReportFromConversationWithAI(l,e,s,r){const a={role:"system",content:xe.getRequirementReportRules()},i={role:"user",content:`åŸºäºä»¥ä¸‹å¯¹è¯å†å²ç”Ÿæˆéœ€æ±‚æ€»ç»“æŠ¥å‘Šï¼š

**å¯¹è¯å†å²ï¼š**
${l.map(v=>{let c=`${v.type==="user"?"User":"AI"}: ${v.content}`;if(v.attachments&&v.attachments.length>0){const f=v.attachments.map(M=>`[é™„ä»¶: ${M.name} (${M.type}, ${M.size} bytes)]`).join(", ");c+=`
é™„ä»¶: ${f}`}return c}).join(`

`)}

è¯·ç”Ÿæˆå®Œæ•´çš„éœ€æ±‚æ€»ç»“æŠ¥å‘Šï¼Œç¡®ä¿æ‰€æœ‰5ä¸ªéƒ¨åˆ†éƒ½æœ‰å…·ä½“å†…å®¹ã€‚`},u=this.getStreamMode();r&&u&&this.aiService.setStreamUpdateCallback(v=>{r(v)});const d=await this.aiService.callAI([a,i],e,s,u);return r&&u&&this.aiService.clearStreamUpdateCallback(),d}};be(ae,"instance");let fe=ae;const vn={welcomeMessage:"æ‚¨å¥½ï¼æˆ‘æ˜¯æç¤ºè¯å·¥ç¨‹ä¸“å®¶ï¼Œå°†é€šè¿‡å‡ ä¸ªé—®é¢˜å¸®æ‚¨æ„å»ºä¸€ä¸ªé«˜è´¨é‡çš„AIæç¤ºè¯ã€‚è¯·å…ˆå‘Šè¯‰æˆ‘ï¼šæ‚¨å¸Œæœ›ç”¨AIæ¥è§£å†³ä»€ä¹ˆé—®é¢˜æˆ–å®Œæˆä»€ä¹ˆä»»åŠ¡ï¼Ÿ",quickReplies:["è¯·ä½¿ç”¨ç›¸å…³æœ€ä½³å®è·µçš„æ¨èå»ºè®®","å¼ºåˆ¶ç”Ÿæˆéœ€æ±‚æŠ¥å‘Š"],maxConversationTurns:5,typingDelay:50};function fn(p){return{...vn,...p}}function hn(p,l,e,s,r){const a=fn(),t=ee(),i=me(),u=se(),d=fe.getInstance(),v=b=>b instanceof DOMException&&b.name==="AbortError"||(b==null?void 0:b.name)==="AbortError",c=W(()=>{let b=345,w=0;return s.currentAttachments.value.length>0&&(w=115),`calc(100vh - ${b+w}px)`});_(()=>t.chatMessages.length,p.scrollToBottom),_(()=>t.isTyping,p.scrollToBottom);const f=async()=>{t.chatMessages.length===0&&!t.isInitialized&&(t.isInitialized=!0,await p.simulateTyping(a.welcomeMessage,!1))},M=()=>{t.clearChat(),r.showQuickReplies.value=!1,s.clearAttachments(),setTimeout(async()=>{await p.simulateTyping(a.welcomeMessage,!1),t.isInitialized=!0},500)},I=async b=>{if(!b.trim()){s.currentAttachments.value.length>0&&u.warning("è¯·è¾“å…¥æ¶ˆæ¯å†…å®¹ï¼Œä¸èƒ½åªå‘é€é™„ä»¶");return}const{provider:w,model:R}=l.getCurrentChatModel();if(!w||!R){u.warning("è¯·å…ˆåœ¨å³ä¸Šè§’è®¾ç½®ä¸­é…ç½®AIæ¨¡å‹å’ŒAPIå¯†é’¥");return}t.clearProgressMessages();const A=b,T=[...s.currentAttachments.value],E=r.checkForceGenerate(A);if(t.addMessage("user",A,T),e.clearInput(),s.clearAttachments(),r.showQuickReplies.value=!1,E){await p.simulateTyping("å¥½çš„,æˆ‘å°†ç«‹å³ä¸ºæ‚¨ç”Ÿæˆéœ€æ±‚æŠ¥å‘Šã€‚",!1),setTimeout(async()=>{const S=i.currentProvider,x=i.currentModel;S&&x&&await k(S,x.id)},800);return}t.isTyping=!0,t.isGenerating=!0;try{const S=l.isStreamMode.value;if(S){const x=Y.getInstance();let P="",$=-1;x.setStreamUpdateCallback(F=>{$===-1&&($=p.startStreamingMessage()),P+=F;const N=J(P);p.updateStreamingMessage(N),p.scrollToBottom()});const L=t.getValidMessages().map(F=>({type:F.type,content:F.content,attachments:F.attachments||[]})),B=await d.generateSimpleResponse("",L,w,R.id,S);if(x.clearStreamUpdateCallback(),S&&$===-1){$=p.startStreamingMessage();const F=J(B);p.updateStreamingMessage(F)}else if(S&&P.trim()===""){const F=J(B);p.updateStreamingMessage(F)}const U=ve(B);t.isTyping=!1,t.isGenerating=!1,(U||B.includes("åŸºäºæˆ‘ä»¬çš„å¯¹è¯ï¼Œæˆ‘ç°åœ¨ä¸ºæ‚¨ç”Ÿæˆéœ€æ±‚æŠ¥å‘Šï¼š"))&&setTimeout(async()=>{const F=i.currentProvider,N=i.currentModel;F&&N&&await k(F,N.id)},800)}else{const P=t.getValidMessages().map(L=>({type:L.type,content:L.content,attachments:L.attachments||[]})),$=await d.generateSimpleResponse("",P,w,R.id,S);if(ve($)||$.includes("åŸºäºæˆ‘ä»¬çš„å¯¹è¯ï¼Œæˆ‘ç°åœ¨ä¸ºæ‚¨ç”Ÿæˆéœ€æ±‚æŠ¥å‘Šï¼š")){const L=J($);await p.simulateTyping(L,!1),t.isGenerating=!1,setTimeout(async()=>{const B=i.currentProvider,U=i.currentModel;B&&U&&await k(B,U.id)},800)}else{const L=J($);await p.simulateTyping(L,!1),t.isGenerating=!1}}}catch(S){if(t.isTyping=!1,t.isGenerating=!1,v(S)){l.isStreamMode.value&&Y.getInstance().clearStreamUpdateCallback();return}const x=S instanceof Error?S.message:String(S);u.error(`å‘ç”Ÿé”™è¯¯: ${x}`),l.isStreamMode.value&&Y.getInstance().clearStreamUpdateCallback()}},k=async(b,w)=>{try{t.clearProgressMessages();const A=t.getValidMessages().map(S=>({type:S.type,content:S.content,attachments:S.attachments||[]}));t.isGenerating=!0,t.currentExecutionStep="report",t.addOrUpdateProgressMessage("ğŸ”„ æ­£åœ¨åŸºäºå¯¹è¯ç”Ÿæˆéœ€æ±‚æŠ¥å‘Š...","progress"),t.promptData.requirementReport="";const T=S=>{t.promptData.requirementReport+=S},E=await d.generateRequirementReportFromConversation(A,b,w,i.streamMode?T:void 0);if(i.streamMode||(t.promptData.requirementReport=E),t.showPreview=!0,t.isAutoMode){t.addOrUpdateProgressMessage("âœ… éœ€æ±‚æŠ¥å‘Šå·²ç”Ÿæˆï¼æ­£åœ¨è‡ªåŠ¨æ‰§è¡Œå®Œæ•´çš„æç¤ºè¯ç”Ÿæˆæµç¨‹...","progress");const S=te.getInstance();t.currentExecutionStep="thinking",t.addOrUpdateProgressMessage("ğŸ”„ æ­¥éª¤ 1/4: æ­£åœ¨åˆ†æéœ€æ±‚å¹¶ç”Ÿæˆå…³é”®æŒ‡ä»¤...","progress");let x="";const P=X=>{x+=X;const ne=x.split(`
`).map(ye=>ye.replace(/^[*-]\s*/,"").trim()).filter(Boolean);ne.length>0&&(t.promptData.thinkingPoints=ne)},$=await S.getSystemPromptThinkingPoints(t.promptData.requirementReport||E,w,"zh",[],b,i.streamMode?P:void 0);i.streamMode||(t.promptData.thinkingPoints=$),t.currentExecutionStep="initial",t.addOrUpdateProgressMessage("ğŸ”„ æ­¥éª¤ 2/4: æ­£åœ¨åŸºäºå…³é”®æŒ‡ä»¤ç”Ÿæˆåˆå§‹æç¤ºè¯...","progress"),t.promptData.initialPrompt="";const G=X=>{t.promptData.initialPrompt+=X},L=await S.generateSystemPrompt(t.promptData.requirementReport||E,w,"zh",[],t.promptData.thinkingPoints||$,b,i.streamMode?G:void 0);i.streamMode||(t.promptData.initialPrompt=L),t.currentExecutionStep="advice",t.addOrUpdateProgressMessage("ğŸ”„ æ­¥éª¤ 3/4: æ­£åœ¨åˆ†ææç¤ºè¯å¹¶ç”Ÿæˆä¼˜åŒ–å»ºè®®...","progress");let B="";const U=X=>{B+=X;const ne=B.split(`
`).map(ye=>ye.replace(/^[*-]\s*/,"").trim()).filter(Boolean);ne.length>0&&(t.promptData.advice=ne)},F=await S.getOptimizationAdvice(t.promptData.initialPrompt||L,"system",w,"zh",[],b,i.streamMode?U:void 0);i.streamMode||(t.promptData.advice=F),t.currentExecutionStep="final",t.addOrUpdateProgressMessage("ğŸ”„ æ­¥éª¤ 4/4: æ­£åœ¨åº”ç”¨ä¼˜åŒ–å»ºè®®ï¼Œç”Ÿæˆæœ€ç»ˆæç¤ºè¯...","progress"),t.promptData.generatedPrompt="";const N=X=>{t.promptData.generatedPrompt+=X},H=await S.applyOptimizationAdvice(t.promptData.initialPrompt||L,t.promptData.advice||F,"system",w,"zh",[],b,i.streamMode?N:void 0);i.streamMode||(t.promptData.generatedPrompt=H),t.addOrUpdateProgressMessage("âœ… å·²ä¸ºæ‚¨ç”Ÿæˆé«˜è´¨é‡çš„AIæç¤ºè¯ï¼å³ä¾§å¯æŸ¥çœ‹å®Œæ•´çš„ç”Ÿæˆè¿‡ç¨‹å’Œæœ€ç»ˆç»“æœã€‚","progress")}else t.addOrUpdateProgressMessage("âœ… éœ€æ±‚æŠ¥å‘Šå·²ç”Ÿæˆï¼è¯·åœ¨å³ä¾§é¢„è§ˆé¢æ¿ä¸­æŸ¥çœ‹ï¼Œæ‚¨å¯ä»¥æ‰‹åŠ¨æ‰§è¡Œæ¯ä¸ªæ­¥éª¤ã€‚","progress");t.isGenerating=!1,t.currentExecutionStep=null}catch(R){if(t.isGenerating=!1,t.currentExecutionStep=null,v(R)){u.info("ç”Ÿæˆå·²ä¸­æ–­");return}const A=R instanceof Error?R.message:String(R);u.error(`æç¤ºè¯ç”Ÿæˆå¤±è´¥: ${A}ã€‚è¯·æ£€æŸ¥ç½‘ç»œè¿æ¥å’ŒAPIé…ç½®åé‡è¯•`)}};return{chatContainerMaxHeight:c,initializeChat:f,clearChat:M,sendMessage:I,generatePrompt:k,regenerateMessage:async(b,w,R,A)=>{const T=t.chatMessages.find(E=>E.id===b);if(!(!T||T.type!=="ai")){if(!R||!A){u.warning("è¯·å…ˆåœ¨å³ä¸Šè§’è®¾ç½®ä¸­é…ç½®AIæ¨¡å‹å’ŒAPIå¯†é’¥");return}try{t.clearProgressMessages();const S=t.getValidMessages().slice(0,w).map(x=>({type:x.type,content:x.content,attachments:x.attachments||[]}));if(t.isTyping=!0,l.isStreamMode.value){const x=Y.getInstance();let P="";x.setStreamUpdateCallback(L=>{P+=L;const B=J(P);t.updateMessage(b,B),p.scrollToBottom()});const $=await d.generateSimpleResponse("",S,R,A.id,!0);x.clearStreamUpdateCallback();const G=J($);t.updateMessage(b,G)}else{const x=await d.generateSimpleResponse("",S,R,A.id,!1),P=J(x);t.updateMessage(b,P)}t.isTyping=!1,u.success("æ¶ˆæ¯å·²é‡æ–°ç”Ÿæˆ")}catch(E){if(t.isTyping=!1,v(E)){l.isStreamMode.value&&Y.getInstance().clearStreamUpdateCallback();return}const S=E instanceof Error?E.message:String(E);u.error(`é‡æ–°ç”Ÿæˆå¤±è´¥: ${S}`),l.isStreamMode.value&&Y.getInstance().clearStreamUpdateCallback()}}},resendUserMessage:async(b,w,R,A)=>{const T=t.chatMessages.find(E=>E.id===b);if(!(!T||T.type!=="user")){if(!R||!A){u.warning("è¯·å…ˆåœ¨å³ä¸Šè§’è®¾ç½®ä¸­é…ç½®AIæ¨¡å‹å’ŒAPIå¯†é’¥");return}try{if(t.clearProgressMessages(),w!==-1)for(let S=w+1;S<t.chatMessages.length;S++){const x=t.chatMessages[S];x&&!x.isProgress&&t.deleteMessage(x.id)}t.isTyping=!0;const E=l.isStreamMode.value;if(E){const S=Y.getInstance();let x="",P=-1;S.setStreamUpdateCallback(U=>{P===-1&&(P=p.startStreamingMessage()),x+=U;const F=J(x);p.updateStreamingMessage(F),p.scrollToBottom()});const G=t.getValidMessages().map(U=>({type:U.type,content:U.content,attachments:U.attachments||[]})),L=await d.generateSimpleResponse("",G,R,A.id,E);S.clearStreamUpdateCallback();const B=ve(L);t.isTyping=!1,(B||L.includes("åŸºäºæˆ‘ä»¬çš„å¯¹è¯ï¼Œæˆ‘ç°åœ¨ä¸ºæ‚¨ç”Ÿæˆéœ€æ±‚æŠ¥å‘Šï¼š"))&&setTimeout(async()=>{const U=i.currentProvider,F=i.currentModel;U&&F&&await k(U,F.id)},800)}else{const x=t.getValidMessages().map(G=>({type:G.type,content:G.content,attachments:G.attachments||[]})),P=await d.generateSimpleResponse("",x,R,A.id,E);if(ve(P)||P.includes("åŸºäºæˆ‘ä»¬çš„å¯¹è¯ï¼Œæˆ‘ç°åœ¨ä¸ºæ‚¨ç”Ÿæˆéœ€æ±‚æŠ¥å‘Šï¼š")){const G=J(P);await p.simulateTyping(G,!1),t.isTyping=!1,setTimeout(async()=>{const L=i.currentProvider,B=i.currentModel;L&&B&&await k(L,B.id)},800)}else{const G=J(P);await p.simulateTyping(G,!1),t.isTyping=!1}}}catch(E){if(t.isTyping=!1,t.isGenerating=!1,v(E)){l.isStreamMode.value&&Y.getInstance().clearStreamUpdateCallback();return}const S=E instanceof Error?E.message:String(E);u.error(`é‡æ–°å‘é€å¤±è´¥: ${S}`),l.isStreamMode.value&&Y.getInstance().clearStreamUpdateCallback()}}},interruptGeneration:()=>{d.interruptCurrentRequest(),t.isTyping=!1,t.isGenerating=!1,t.currentExecutionStep=null}}}const yn={key:0,class:"absolute inset-0 bg-blue-50 bg-opacity-90 flex items-center justify-center z-50 border-2 border-dashed border-blue-400 rounded-lg"},bn={class:"text-center"},xn=K({__name:"ChatInterface",emits:["toggle"],setup(p){const l=ee(),e=D(),s=un(),r=cn(),a=pn(),t=dn(),i=mn(e),u=gn(s.chatContainer),d=hn(s,t,r,a,i),v=h=>{r.handleKeydown(h,c)},c=()=>{d.sendMessage(r.userInput.value)},f=h=>{i.selectQuickReply(h,o=>{r.userInput.value=o,c()})},M=h=>{const{provider:o,model:g}=t.getCurrentChatModel();d.regenerateMessage(h.messageId,h.messageIndex,o,g)},I=h=>{const o=l.chatMessages.find(g=>g.id===h.messageId);if(o&&o.type==="user"){u.saveEdit(h.messageId);const{provider:g,model:b}=t.getCurrentChatModel();d.resendUserMessage(h.messageId,h.messageIndex,g,b)}},k=h=>{const{provider:o,model:g}=t.getCurrentChatModel();d.resendUserMessage(h.messageId,h.messageIndex,o,g)};return oe(()=>{d.initializeChat()}),(h,o)=>(y(),C("div",{class:"bg-white rounded-lg shadow-sm flex flex-col h-full max-h-full overflow-hidden relative",onDragover:o[3]||(o[3]=ge((...g)=>n(a).handleGlobalDragOver&&n(a).handleGlobalDragOver(...g),["prevent"])),onDragenter:o[4]||(o[4]=ge((...g)=>n(a).handleGlobalDragEnter&&n(a).handleGlobalDragEnter(...g),["prevent"])),onDragleave:o[5]||(o[5]=ge((...g)=>n(a).handleGlobalDragLeave&&n(a).handleGlobalDragLeave(...g),["prevent"])),onDrop:o[6]||(o[6]=ge((...g)=>n(a).handleGlobalDrop&&n(a).handleGlobalDrop(...g),["prevent"]))},[q(lt,{"is-stream-mode":n(t).isStreamMode.value,"is-generating":n(l).isGenerating,"is-typing":n(l).isTyping,onToggleStream:n(t).toggleStreamMode,onClearChat:n(d).clearChat,onInterrupt:n(d).interruptGeneration},null,8,["is-stream-mode","is-generating","is-typing","onToggleStream","onClearChat","onInterrupt"]),q(It,{"chat-container":n(s).chatContainer,"chat-container-max-height":n(d).chatContainerMaxHeight.value,"editing-content":n(u).editingContent.value,onStartEdit:n(u).startEdit,onSaveEdit:n(u).saveEdit,onCancelEdit:n(u).cancelEdit,onDelete:n(u).deleteMessage,onCopy:n(u).copyMessage,onRegenerate:M,onResend:I,onResendUser:k,onEditKeydown:n(u).handleEditKeydown,onSetEditRef:o[0]||(o[0]=g=>n(u).setEditTextareaRef(g.messageId,g.el)),onSetMessageRef:n(u).setMessageRef},null,8,["chat-container","chat-container-max-height","editing-content","onStartEdit","onSaveEdit","onCancelEdit","onDelete","onCopy","onEditKeydown","onSetMessageRef"]),q(Gt,{show:n(i).shouldShowQuickReplies.value,replies:n(i).quickReplies.value,"quick-replies-container":n(i).quickRepliesContainer,"input-container-ref":e.value,onSelect:f},null,8,["show","replies","quick-replies-container","input-container-ref"]),q(ln,{"is-editing":n(u).isEditing.value,"user-input":n(r).userInput.value,"onUpdate:userInput":o[1]||(o[1]=g=>n(r).userInput.value=g),attachments:n(a).currentAttachments.value,placeholder:n(i).shouldShowQuickReplies.value?"è¾“å…¥æˆ–ç‚¹å‡»ä¸Šæ–¹å¿«é€Ÿå›å¤...":"Shift+Enteræ¢è¡Œ","is-disabled":n(l).isTyping||n(l).isGenerating,"textarea-ref":n(r).textareaRef.value,"input-container":e.value,"show-quick-replies":n(i).shouldShowQuickReplies.value,"quick-replies":n(i).quickReplies.value,"quick-replies-container":n(i).quickRepliesContainer,onKeydown:v,onCompositionStart:n(r).handleCompositionStart,onCompositionEnd:n(r).handleCompositionEnd,onFocus:o[2]||(o[2]=g=>n(i).showQuickReplies.value=!0),onSend:c,onFileSelect:n(a).handleFileSelect,onRemoveAttachment:n(a).removeAttachment,onClearAttachments:n(a).clearAttachments,onQuickReplySelect:f},null,8,["is-editing","user-input","attachments","placeholder","is-disabled","textarea-ref","input-container","show-quick-replies","quick-replies","quick-replies-container","onCompositionStart","onCompositionEnd","onFileSelect","onRemoveAttachment","onClearAttachments"]),n(a).isGlobalDragging.value?(y(),C("div",yn,[m("div",bn,[q(n(nt),{class:"w-12 h-12 mx-auto mb-4 text-blue-500"}),o[7]||(o[7]=m("div",{class:"text-lg font-medium text-blue-700 mb-2"}," é‡Šæ”¾æ–‡ä»¶ä»¥ä¸Šä¼  ",-1)),o[8]||(o[8]=m("div",{class:"text-sm text-blue-600"}," æ”¯æŒå›¾ç‰‡ã€æ–‡æ¡£ã€éŸ³é¢‘ç­‰æ ¼å¼ ",-1))])])):z("",!0)],32))}}),kn={class:"p-4 border-b border-gray-200 flex items-center justify-between"},wn={class:"flex items-center space-x-3"},Sn={key:0,class:"flex items-center px-2 py-1 bg-blue-50 text-blue-700 rounded-full text-xs border border-blue-200"},Cn={class:"flex items-center space-x-3"},Pn={class:"flex items-center space-x-2"},Mn={class:"flex items-center cursor-pointer"},Rn=["checked"],$n={class:"text-sm text-gray-600"},Dn=K({__name:"PreviewHeader",props:{isAutoMode:{type:Boolean},currentExecutionStep:{},isGenerating:{type:Boolean}},emits:["update:isAutoMode"],setup(p){const l=e=>({report:"ç”Ÿæˆéœ€æ±‚æŠ¥å‘Š",thinking:"ç”Ÿæˆå…³é”®æŒ‡ä»¤",initial:"ç”Ÿæˆåˆå§‹æç¤ºè¯",advice:"ç”Ÿæˆä¼˜åŒ–å»ºè®®",final:"ç”Ÿæˆæœ€ç»ˆæç¤ºè¯"})[e]||e;return(e,s)=>(y(),C("div",kn,[m("div",wn,[s[1]||(s[1]=m("h4",{class:"font-semibold text-gray-800"},"ç”Ÿæˆé¢„è§ˆ",-1)),e.currentExecutionStep||e.isGenerating&&!e.currentExecutionStep?(y(),C("div",Sn,[q(n(Z),{class:"w-3 h-3 animate-spin mr-1"}),m("span",null,Q(e.currentExecutionStep?l(e.currentExecutionStep):"ç”Ÿæˆéœ€æ±‚æŠ¥å‘Š"),1)])):z("",!0)]),m("div",Cn,[m("div",Pn,[m("label",Mn,[m("input",{checked:e.isAutoMode,onChange:s[0]||(s[0]=r=>e.$emit("update:isAutoMode",r.target.checked)),type:"checkbox",class:"sr-only peer"},null,40,Rn),m("span",$n,Q(e.isAutoMode?"è‡ªåŠ¨ï¼š":"æ‰‹åŠ¨ï¼š"),1),s[2]||(s[2]=m("div",{class:"relative w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600"},null,-1))])])])]))}}),En={class:"p-6 text-center"},Tn=K({__name:"LoadingState",setup(p){return(l,e)=>(y(),C("div",En,[q(n(Z),{class:"w-8 h-8 text-blue-500 animate-spin mx-auto mb-3"}),e[0]||(e[0]=m("p",{class:"text-gray-600"},"æ­£åœ¨ç”Ÿæˆæç¤ºè¯...",-1))]))}}),In={class:"border rounded-lg overflow-hidden flex flex-col flex-1"},An={class:"bg-orange-50 px-3 py-2 text-sm font-medium text-orange-700 flex items-center justify-between flex-shrink-0"},zn={class:"flex items-center space-x-2"},Gn=["disabled"],qn={class:"p-3 bg-white flex-1 flex flex-col overflow-hidden"},Un=["value","placeholder"],Bn={class:"mt-4 flex justify-end flex-shrink-0"},Ln={key:0},Fn=["disabled"],jn={key:1},On=["disabled"],Hn=K({__name:"ReportTab",props:{requirementReport:{},hasConversationData:{type:Boolean},isAutoMode:{type:Boolean},isExecuting:{type:Boolean},isGenerating:{type:Boolean},currentExecutionStep:{},isCopied:{type:Boolean}},emits:["update:requirementReport","regenerate","copy","execute-full","execute-thinking","scroll-mounted"],setup(p,{emit:l}){const e=p,s=l,r=D(),{setScrollContainer:a}=Se(()=>e.requirementReport,()=>e.isGenerating);return oe(()=>{r.value&&(a(r.value),s("scroll-mounted",r.value))}),(t,i)=>(y(),C("div",In,[m("div",An,[i[5]||(i[5]=m("span",null,"éœ€æ±‚æè¿°",-1)),m("div",zn,[m("button",{onClick:i[0]||(i[0]=u=>t.$emit("regenerate")),disabled:t.isExecuting||t.isGenerating,class:"text-orange-500 hover:text-orange-600 disabled:opacity-50 disabled:cursor-not-allowed",title:"é‡æ–°ç”Ÿæˆéœ€æ±‚æè¿°"},[q(n(Z),{class:O(["w-4 h-4",t.isExecuting&&t.currentExecutionStep==="report"&&"animate-spin"])},null,8,["class"])],8,Gn),m("button",{onClick:i[1]||(i[1]=u=>t.$emit("copy")),class:"text-orange-500 hover:text-orange-600",title:"å¤åˆ¶åˆ°å‰ªè´´æ¿"},[t.isCopied?(y(),j(n(Ce),{key:0,class:"w-4 h-4"})):(y(),j(n(he),{key:1,class:"w-4 h-4"}))])])]),m("div",qn,[m("textarea",{ref_key:"textareaRef",ref:r,value:t.requirementReport,onInput:i[2]||(i[2]=u=>t.$emit("update:requirementReport",u.target.value)),placeholder:t.hasConversationData?"åŸºäºå¯¹è¯ç”Ÿæˆçš„éœ€æ±‚æè¿°...":"è¯·ç›´æ¥æè¿°æ‚¨çš„éœ€æ±‚ï¼Œä¾‹å¦‚ï¼šæˆ‘éœ€è¦ä¸€ä¸ªä¸“ä¸šçš„ä»£ç å®¡æŸ¥åŠ©æ‰‹ï¼Œèƒ½å¤Ÿåˆ†æä»£ç è´¨é‡ã€å‘ç°æ½œåœ¨é—®é¢˜å¹¶æä¾›æ”¹è¿›å»ºè®®...",class:"w-full flex-1 px-3 py-2 text-sm border border-gray-300 rounded-lg focus:outline-none focus:border-gray-300 focus:ring-0 resize-none"},null,40,Un),m("div",Bn,[t.isAutoMode?(y(),C("div",Ln,[m("button",{onClick:i[3]||(i[3]=u=>t.$emit("execute-full")),disabled:!t.requirementReport.trim()||t.isExecuting||t.isGenerating,class:"px-4 py-2 bg-green-500 text-white rounded hover:bg-green-600 disabled:opacity-50 disabled:cursor-not-allowed transition-colors flex items-center space-x-2"},[t.isExecuting||t.isGenerating?(y(),j(n(Z),{key:0,class:"w-4 h-4 animate-spin"})):z("",!0),m("span",null,Q(t.isExecuting||t.isGenerating?"è‡ªåŠ¨ç”Ÿæˆä¸­...":"è‡ªåŠ¨ç”Ÿæˆæç¤ºè¯"),1)],8,Fn)])):z("",!0),t.isAutoMode?z("",!0):(y(),C("div",jn,[m("button",{onClick:i[4]||(i[4]=u=>t.$emit("execute-thinking")),disabled:!t.requirementReport.trim()||t.isExecuting,class:"px-4 py-2 bg-orange-500 text-white rounded hover:bg-orange-600 disabled:opacity-50 disabled:cursor-not-allowed transition-colors flex items-center space-x-2"},[t.isExecuting&&t.currentExecutionStep==="thinking"?(y(),j(n(Z),{key:0,class:"w-4 h-4 animate-spin"})):z("",!0),m("span",null,Q(t.isExecuting&&t.currentExecutionStep==="thinking"?"æ‰§è¡Œä¸­...":"ç”Ÿæˆå…³é”®æŒ‡ä»¤"),1)],8,On)]))])])]))}}),_n={class:"border rounded-lg overflow-hidden flex flex-col flex-1 min-h-0"},Qn={class:"bg-purple-50 px-3 py-2 text-sm font-medium text-purple-700 flex items-center justify-between flex-shrink-0"},Kn={class:"flex items-center space-x-2"},Nn=["disabled"],Xn={class:"bg-white flex flex-col p-3 flex-1"},Vn=["value","onInput"],Wn=["onClick"],Jn={class:"p-3 pt-4 flex justify-between flex-shrink-0 border-t border-gray-100 bg-white"},Yn={key:0},Zn=["disabled"],er=K({__name:"ThinkingTab",props:{thinkingPoints:{},isAutoMode:{type:Boolean},isExecuting:{type:Boolean},isGenerating:{type:Boolean},currentExecutionStep:{},isCopied:{type:Boolean}},emits:["regenerate","copy","add-point","remove-point","update-point","execute-initial","scroll-mounted"],setup(p,{emit:l}){const e=p,s=l,r=D(),{setScrollContainer:a}=Se(()=>e.thinkingPoints,()=>e.isGenerating);return oe(()=>{r.value&&(a(r.value),s("scroll-mounted",r.value))}),(t,i)=>(y(),C("div",_n,[m("div",Qn,[i[5]||(i[5]=m("span",null,"å…³é”®æŒ‡ä»¤",-1)),m("div",Kn,[m("button",{onClick:i[0]||(i[0]=u=>t.$emit("regenerate")),disabled:t.isExecuting||t.isGenerating,class:"text-purple-500 hover:text-purple-600 disabled:opacity-50 disabled:cursor-not-allowed",title:"é‡æ–°ç”Ÿæˆå…³é”®æŒ‡ä»¤"},[q(n(Z),{class:O(["w-4 h-4",t.isExecuting&&t.currentExecutionStep==="thinking"&&"animate-spin"])},null,8,["class"])],8,Nn),m("button",{onClick:i[1]||(i[1]=u=>t.$emit("copy")),class:"text-purple-500 hover:text-purple-600",title:"å¤åˆ¶åˆ°å‰ªè´´æ¿"},[t.isCopied?(y(),j(n(Ce),{key:0,class:"w-4 h-4"})):(y(),j(n(he),{key:1,class:"w-4 h-4"}))])])]),m("div",Xn,[m("div",{ref_key:"scrollContainer",ref:r,class:"space-y-2 overflow-y-auto flex-1",style:{"max-height":"calc(100vh - 400px)"}},[(y(!0),C(re,null,ce(t.thinkingPoints,(u,d)=>(y(),C("div",{key:d,class:"flex items-start"},[i[6]||(i[6]=m("span",{class:"text-purple-500 mr-2 mt-2"},"â€¢",-1)),m("input",{value:u,onInput:v=>t.$emit("update-point",d,v.target.value),onFocus:i[2]||(i[2]=v=>v.target.setSelectionRange(v.target.value.length,v.target.value.length)),class:"flex-1 px-3 py-1 text-sm border border-gray-300 rounded focus:ring-2 focus:ring-purple-500 focus:border-transparent"},null,40,Vn),m("button",{onClick:v=>t.$emit("remove-point",d),class:"ml-2 px-2 py-1 text-red-500 hover:text-red-700 text-sm",title:"åˆ é™¤è¿™æ¡æŒ‡ä»¤"}," Ã— ",8,Wn)]))),128))],512),m("div",Jn,[m("button",{onClick:i[3]||(i[3]=u=>t.$emit("add-point")),class:"px-3 py-1 text-purple-600 hover:text-purple-800 text-sm"}," + æ·»åŠ æŒ‡ä»¤ "),t.isAutoMode?z("",!0):(y(),C("div",Yn,[m("button",{onClick:i[4]||(i[4]=u=>t.$emit("execute-initial")),disabled:!t.thinkingPoints||t.thinkingPoints.length===0||t.isExecuting,class:"px-4 py-2 bg-purple-500 text-white rounded hover:bg-purple-600 disabled:opacity-50 disabled:cursor-not-allowed transition-colors flex items-center space-x-2"},[t.isExecuting&&t.currentExecutionStep==="initial"?(y(),j(n(Z),{key:0,class:"w-4 h-4 animate-spin"})):z("",!0),m("span",null,Q(t.isExecuting&&t.currentExecutionStep==="initial"?"æ‰§è¡Œä¸­...":"ç”Ÿæˆåˆå§‹æç¤ºè¯"),1)],8,Zn)]))])])]))}}),tr={class:"border rounded-lg overflow-hidden flex flex-col flex-1"},nr={class:"bg-green-50 px-3 py-2 text-sm font-medium text-green-700 flex items-center justify-between flex-shrink-0"},rr={class:"flex items-center space-x-2"},sr=["disabled"],or={class:"p-3 bg-white flex-1 flex flex-col overflow-hidden"},ir=["value"],ar={key:0,class:"mt-4 flex justify-end flex-shrink-0"},lr=["disabled"],ur=K({__name:"InitialTab",props:{initialPrompt:{},isAutoMode:{type:Boolean},isExecuting:{type:Boolean},isGenerating:{type:Boolean},currentExecutionStep:{},isCopied:{type:Boolean}},emits:["update:initialPrompt","regenerate","copy","execute-advice","scroll-mounted"],setup(p,{emit:l}){const e=p,s=l,r=D(),{setScrollContainer:a}=Se(()=>e.initialPrompt,()=>e.isGenerating);return oe(()=>{r.value&&(a(r.value),s("scroll-mounted",r.value))}),(t,i)=>(y(),C("div",tr,[m("div",nr,[i[4]||(i[4]=m("span",null,"åˆå§‹æç¤ºè¯",-1)),m("div",rr,[m("button",{onClick:i[0]||(i[0]=u=>t.$emit("regenerate")),disabled:t.isExecuting||t.isGenerating,class:"text-green-500 hover:text-green-600 disabled:opacity-50 disabled:cursor-not-allowed",title:"é‡æ–°ç”Ÿæˆåˆå§‹æç¤ºè¯"},[q(n(Z),{class:O(["w-4 h-4",t.isExecuting&&t.currentExecutionStep==="initial"&&"animate-spin"])},null,8,["class"])],8,sr),m("button",{onClick:i[1]||(i[1]=u=>t.$emit("copy")),class:"text-green-500 hover:text-green-600",title:"å¤åˆ¶åˆ°å‰ªè´´æ¿"},[t.isCopied?(y(),j(n(Ce),{key:0,class:"w-4 h-4"})):(y(),j(n(he),{key:1,class:"w-4 h-4"}))])])]),m("div",or,[m("textarea",{ref_key:"textareaRef",ref:r,value:t.initialPrompt,onInput:i[2]||(i[2]=u=>t.$emit("update:initialPrompt",u.target.value)),class:"w-full flex-1 px-3 py-2 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent resize-none"},null,40,ir),t.isAutoMode?z("",!0):(y(),C("div",ar,[m("button",{onClick:i[3]||(i[3]=u=>t.$emit("execute-advice")),disabled:!t.initialPrompt||t.isExecuting,class:"px-4 py-2 bg-green-500 text-white rounded hover:bg-green-600 disabled:opacity-50 disabled:cursor-not-allowed transition-colors flex items-center space-x-2"},[t.isExecuting&&t.currentExecutionStep==="advice"?(y(),j(n(Z),{key:0,class:"w-4 h-4 animate-spin"})):z("",!0),m("span",null,Q(t.isExecuting&&t.currentExecutionStep==="advice"?"æ‰§è¡Œä¸­...":"ç”Ÿæˆä¼˜åŒ–å»ºè®®"),1)],8,lr)]))])]))}});function cr(){const p=D("report"),l=D(new Set),e=D({}),s=u=>{e.value={...e.value,...u}},r=u=>{l.value.delete(u)},a=u=>{const v={report:e.value.reportTab,thinking:e.value.thinkingTab,initial:e.value.initialTab,advice:e.value.adviceTab,zh:e.value.zhTab}[u],c=e.value.tabContainer;if(v&&c){const f=c.getBoundingClientRect(),M=v.getBoundingClientRect(),I=M.left-f.left+c.scrollLeft,k=I+M.width,h=f.width,o=c.scrollLeft,g=o+h;I<o?c.scrollTo({left:I-20,behavior:"smooth"}):k>g&&c.scrollTo({left:I-h+M.width+20,behavior:"smooth"})}};return{activeTab:p,newContentTabs:l,setTabRefs:s,markTabAsViewed:r,scrollToActiveTab:a,switchToTabWithScroll:u=>{p.value=u,V(()=>{a(u)})},handleTabChange:u=>{p.value=u,r(u),V(()=>{a(u)})}}}function pr(p,l){const e=ee(),s=me(),r=se(),a=D(!1),t=D(null);return{isExecuting:a,executeFullWorkflow:async()=>{if(!e.promptData.requirementReport.trim()){r.warning("è¯·å…ˆè¾“å…¥éœ€æ±‚æè¿°");return}try{a.value=!0,t.value=new AbortController;const o=s.currentProvider,g=s.currentModel;if(!o||!g){r.error("è¯·å…ˆé…ç½®AIæ¨¡å‹");return}const b=te.getInstance(),w=e.promptData.requirementReport;e.currentExecutionStep="thinking";let R="",A=!1;const T=H=>{R+=H,!A&&H.trim()&&(A=!0,e.promptData.thinkingPoints=["æ­£åœ¨ç”Ÿæˆ..."],p("thinking"));const X=R.split(`
`).map(ne=>ne.replace(/^[*-]\s*/,"").trim()).filter(Boolean);X.length>0&&(e.promptData.thinkingPoints=X,l())},E=await b.getSystemPromptThinkingPoints(w,g.id,"zh",[],o,T);e.promptData.thinkingPoints=E,e.currentExecutionStep="initial";let S=!1;const x=H=>{!S&&H.trim()&&(S=!0,e.promptData.initialPrompt="æ­£åœ¨ç”Ÿæˆ...",p("initial")),S&&(e.promptData.initialPrompt==="æ­£åœ¨ç”Ÿæˆ..."?e.promptData.initialPrompt=H:e.promptData.initialPrompt+=H,l())},P=await b.generateSystemPrompt(w,g.id,"zh",[],E,o,x);e.promptData.initialPrompt=P,e.currentExecutionStep="advice";let $="",G=!1;const L=H=>{$+=H,!G&&H.trim()&&(G=!0,e.promptData.advice=["æ­£åœ¨ç”Ÿæˆ..."],p("advice"));const X=$.split(`
`).map(ne=>ne.replace(/^[*-]\s*/,"").trim()).filter(Boolean);X.length>0&&(e.promptData.advice=X,l())},B=await b.getOptimizationAdvice(P,"system",g.id,"zh",[],o,L);e.promptData.advice=B,e.currentExecutionStep="final";let U=!1;const F=H=>{!U&&H.trim()&&(U=!0,e.promptData.generatedPrompt="æ­£åœ¨ç”Ÿæˆ...",p("zh")),U&&(e.promptData.generatedPrompt==="æ­£åœ¨ç”Ÿæˆ..."?e.promptData.generatedPrompt=H:e.promptData.generatedPrompt+=H,l())},N=await b.applyOptimizationAdvice(P,B,"system",g.id,"zh",[],o,F);e.promptData.generatedPrompt=ie(N),p("zh")}catch{r.error("è‡ªåŠ¨ç”Ÿæˆæç¤ºè¯å¤±è´¥ï¼Œè¯·é‡è¯•")}finally{a.value=!1,e.currentExecutionStep=null,t.value=null}},executeThinkingPoints:async()=>{if(!e.promptData.requirementReport.trim()){r.warning("è¯·å…ˆè¾“å…¥éœ€æ±‚æŠ¥å‘Š");return}try{a.value=!0,t.value=new AbortController,e.currentExecutionStep="thinking";const o=s.currentProvider,g=s.currentModel;if(!o||!g){r.error("è¯·å…ˆé…ç½®AIæ¨¡å‹");return}const b=te.getInstance();let w="",R=!1;const A=E=>{w+=E,!R&&E.trim()&&(R=!0,e.promptData.thinkingPoints=["æ­£åœ¨ç”Ÿæˆ..."],p("thinking"));const S=w.split(`
`).map(x=>x.replace(/^[*-]\s*/,"").trim()).filter(Boolean);S.length>0&&(e.promptData.thinkingPoints=S,l())},T=await b.getSystemPromptThinkingPoints(e.promptData.requirementReport,g.id,"zh",[],o,A);e.promptData.thinkingPoints=T}catch{r.error("ç”Ÿæˆå…³é”®æŒ‡ä»¤å¤±è´¥ï¼Œè¯·é‡è¯•")}finally{a.value=!1,e.currentExecutionStep=null,t.value=null}},executeInitialPrompt:async()=>{if(!e.promptData.thinkingPoints||e.promptData.thinkingPoints.length===0){r.warning("è¯·å…ˆç”Ÿæˆå…³é”®æŒ‡ä»¤");return}try{a.value=!0,t.value=new AbortController,e.currentExecutionStep="initial";const o=s.currentProvider,g=s.currentModel;if(!o||!g){r.error("è¯·å…ˆé…ç½®AIæ¨¡å‹");return}const b=te.getInstance();let w=!1;const R=T=>{!w&&T.trim()&&(w=!0,e.promptData.initialPrompt="æ­£åœ¨ç”Ÿæˆ...",p("initial")),w&&(e.promptData.initialPrompt==="æ­£åœ¨ç”Ÿæˆ..."?e.promptData.initialPrompt=T:e.promptData.initialPrompt+=T)},A=await b.generateSystemPrompt(e.promptData.requirementReport,g.id,"zh",[],e.promptData.thinkingPoints,o,R);e.promptData.initialPrompt=ie(A)}catch{r.error("ç”Ÿæˆåˆå§‹æç¤ºè¯å¤±è´¥ï¼Œè¯·é‡è¯•")}finally{a.value=!1,e.currentExecutionStep=null,t.value=null}},executeAdvice:async()=>{if(!e.promptData.initialPrompt){r.error("è¯·å…ˆç”Ÿæˆåˆå§‹æç¤ºè¯");return}try{a.value=!0,t.value=new AbortController,e.currentExecutionStep="advice";const o=s.currentProvider,g=s.currentModel;if(!o||!g){r.error("è¯·å…ˆé…ç½®AIæ¨¡å‹");return}const b=te.getInstance();let w="",R=!1;const A=E=>{w+=E,!R&&E.trim()&&(R=!0,e.promptData.advice=["æ­£åœ¨ç”Ÿæˆ..."],p("advice"));const S=w.split(`
`).map(x=>x.replace(/^[*-]\s*/,"").trim()).filter(Boolean);S.length>0&&(e.promptData.advice=S)},T=await b.getOptimizationAdvice(e.promptData.initialPrompt,"system",g.id,"zh",[],o,A);e.promptData.advice=T}catch{r.error("ç”Ÿæˆä¼˜åŒ–å»ºè®®å¤±è´¥ï¼Œè¯·é‡è¯•")}finally{a.value=!1,e.currentExecutionStep=null,t.value=null}},executeFinalPrompt:async()=>{if(!e.promptData.initialPrompt||!e.promptData.advice){r.error("è¯·å…ˆå®Œæˆå‰é¢çš„æ­¥éª¤");return}try{a.value=!0,t.value=new AbortController,e.currentExecutionStep="final";const o=s.currentProvider,g=s.currentModel;if(!o||!g){r.error("è¯·å…ˆé…ç½®AIæ¨¡å‹");return}const b=te.getInstance();let w=!1;const R=T=>{!w&&T.trim()&&(w=!0,e.promptData.generatedPrompt="æ­£åœ¨ç”Ÿæˆ...",p("zh")),w&&(e.promptData.generatedPrompt==="æ­£åœ¨ç”Ÿæˆ..."?e.promptData.generatedPrompt=T:e.promptData.generatedPrompt+=T)},A=await b.applyOptimizationAdvice(e.promptData.initialPrompt,e.promptData.advice,"system",g.id,"zh",[],o,R);e.promptData.generatedPrompt=ie(A)}catch{r.error("ç”Ÿæˆæœ€ç»ˆæç¤ºè¯å¤±è´¥ï¼Œè¯·é‡è¯•")}finally{a.value=!1,e.currentExecutionStep=null,t.value=null}},regenerateRequirementReport:async()=>{if(!(e.chatMessages&&e.chatMessages.length>0)){r.warning("éœ€è¦å…ˆä¸AIåŠ©æ‰‹å¯¹è¯æ‰èƒ½é‡æ–°ç”Ÿæˆéœ€æ±‚æè¿°");return}try{a.value=!0,e.currentExecutionStep="report";const g=s.currentProvider,b=s.currentModel;if(!g||!b){r.error("è¯·å…ˆé…ç½®AIæ¨¡å‹");return}const w=fe.getInstance(),A=e.getValidMessages().map(x=>({type:x.type,content:x.content}));let T="";const E=x=>{T+=x,e.promptData.requirementReport=T,l()},S=await w.generateRequirementReportFromConversation(A,g,b.id,E);e.promptData.requirementReport=S,r.success("éœ€æ±‚æè¿°å·²é‡æ–°ç”Ÿæˆ")}catch{r.error("é‡æ–°ç”Ÿæˆéœ€æ±‚æè¿°å¤±è´¥ï¼Œè¯·é‡è¯•")}finally{a.value=!1,e.currentExecutionStep=null,t.value=null}},regenerateThinkingPoints:async()=>{if(!e.promptData.requirementReport.trim()){r.warning("è¯·å…ˆè¾“å…¥éœ€æ±‚æè¿°");return}try{a.value=!0,t.value=new AbortController,e.currentExecutionStep="thinking";const o=s.currentProvider,g=s.currentModel;if(!o||!g){r.error("è¯·å…ˆé…ç½®AIæ¨¡å‹");return}const b=te.getInstance();let w="",R=!1;const A=E=>{w+=E,!R&&E.trim()&&(R=!0,e.promptData.thinkingPoints=["æ­£åœ¨ç”Ÿæˆ..."],p("thinking"));const S=w.split(`
`).map(x=>x.replace(/^[*-]\s*/,"").trim()).filter(Boolean);S.length>0&&(e.promptData.thinkingPoints=S,l())},T=await b.getSystemPromptThinkingPoints(e.promptData.requirementReport,g.id,"zh",[],o,A);e.promptData.thinkingPoints=T,r.success("å…³é”®æŒ‡ä»¤å·²é‡æ–°ç”Ÿæˆ")}catch{r.error("é‡æ–°ç”Ÿæˆå…³é”®æŒ‡ä»¤å¤±è´¥ï¼Œè¯·é‡è¯•")}finally{a.value=!1,e.currentExecutionStep=null,t.value=null}},regenerateInitialPrompt:async()=>{if(!e.promptData.thinkingPoints||e.promptData.thinkingPoints.length===0){r.warning("è¯·å…ˆç”Ÿæˆå…³é”®æŒ‡ä»¤");return}try{a.value=!0,t.value=new AbortController,e.currentExecutionStep="initial";const o=s.currentProvider,g=s.currentModel;if(!o||!g){r.error("è¯·å…ˆé…ç½®AIæ¨¡å‹");return}const b=te.getInstance();let w=!1;const R=T=>{!w&&T.trim()&&(w=!0,e.promptData.initialPrompt="æ­£åœ¨ç”Ÿæˆ...",p("initial")),w&&(e.promptData.initialPrompt==="æ­£åœ¨ç”Ÿæˆ..."?e.promptData.initialPrompt=T:e.promptData.initialPrompt+=T,l())},A=await b.generateSystemPrompt(e.promptData.requirementReport,g.id,"zh",[],e.promptData.thinkingPoints,o,R);e.promptData.initialPrompt=ie(A),r.success("åˆå§‹æç¤ºè¯å·²é‡æ–°ç”Ÿæˆ")}catch{r.error("é‡æ–°ç”Ÿæˆåˆå§‹æç¤ºè¯å¤±è´¥ï¼Œè¯·é‡è¯•")}finally{a.value=!1,e.currentExecutionStep=null,t.value=null}},regenerateAdvice:async()=>{if(!e.promptData.initialPrompt){r.error("è¯·å…ˆç”Ÿæˆåˆå§‹æç¤ºè¯");return}try{a.value=!0,t.value=new AbortController,e.currentExecutionStep="advice";const o=s.currentProvider,g=s.currentModel;if(!o||!g){r.error("è¯·å…ˆé…ç½®AIæ¨¡å‹");return}const b=te.getInstance();let w="",R=!1;const A=E=>{w+=E,!R&&E.trim()&&(R=!0,e.promptData.advice=["æ­£åœ¨ç”Ÿæˆ..."],p("advice"));const S=w.split(`
`).map(x=>x.replace(/^[*-]\s*/,"").trim()).filter(Boolean);S.length>0&&(e.promptData.advice=S,l())},T=await b.getOptimizationAdvice(e.promptData.initialPrompt,"system",g.id,"zh",[],o,A);e.promptData.advice=T,r.success("ä¼˜åŒ–å»ºè®®å·²é‡æ–°ç”Ÿæˆ")}catch{r.error("é‡æ–°ç”Ÿæˆä¼˜åŒ–å»ºè®®å¤±è´¥ï¼Œè¯·é‡è¯•")}finally{a.value=!1,e.currentExecutionStep=null,t.value=null}},regenerateFinalPrompt:async()=>{if(!e.promptData.initialPrompt||!e.promptData.advice){r.error("è¯·å…ˆå®Œæˆå‰é¢çš„æ­¥éª¤");return}try{a.value=!0,t.value=new AbortController,e.currentExecutionStep="final";const o=s.currentProvider,g=s.currentModel;if(!o||!g){r.error("è¯·å…ˆé…ç½®AIæ¨¡å‹");return}const b=te.getInstance();let w=!1;const R=T=>{!w&&T.trim()&&(w=!0,e.promptData.generatedPrompt="æ­£åœ¨ç”Ÿæˆ...",p("zh")),w&&(e.promptData.generatedPrompt==="æ­£åœ¨ç”Ÿæˆ..."?e.promptData.generatedPrompt=T:e.promptData.generatedPrompt+=T,l())},A=await b.applyOptimizationAdvice(e.promptData.initialPrompt,e.promptData.advice,"system",g.id,"zh",[],o,R);e.promptData.generatedPrompt=ie(A),r.success("æœ€ç»ˆæç¤ºè¯å·²é‡æ–°ç”Ÿæˆ")}catch{r.error("é‡æ–°ç”Ÿæˆæœ€ç»ˆæç¤ºè¯å¤±è´¥ï¼Œè¯·é‡è¯•")}finally{a.value=!1,e.currentExecutionStep=null,t.value=null}}}}function dr(){const p=ee(),l=Ee(),e=se(),s=Y.getInstance(),r=D(!1),a=D(!1),t=D("markdown"),i=D("zh"),u=W({get:()=>{const c=p.promptData.generatedPrompt;if(typeof c=="string")return c;if("markdown"in c&&"xml"in c){const f=t.value;return i.value==="zh"?c[f].zh:c[f].en}return i.value==="zh"?c.zh:c.en},set:c=>{const f=p.promptData.generatedPrompt;if(typeof f=="string"){p.promptData.generatedPrompt=c;return}if("markdown"in f&&"xml"in f){const M=t.value;i.value==="zh"?f[M].zh=c:f[M].en=c;return}i.value==="zh"?f.zh=c:f.en=c}});return{isConvertingFormat:r,isConvertingLanguage:a,formatState:t,languageState:i,currentGeneratedPrompt:u,toggleFormat:async()=>{if(!u.value||r.value||a.value)return;const c=t.value==="markdown"?"xml":"markdown",f=p.promptData.generatedPrompt;if(typeof f!="string"&&"markdown"in f&&"xml"in f&&(i.value==="zh"?f[c].zh:f[c].en)){t.value=c,e.success(`å·²åˆ‡æ¢ä¸º${c==="xml"?"XML":"Markdown"}æ ¼å¼`);return}const M=l.getCurrentProvider(),I=l.getCurrentModel();if(!M||!I){e.error("è¯·å…ˆé…ç½®AIæ¨¡å‹");return}try{r.value=!0;const k=t.value==="markdown"?"XML":"Markdown",h=t.value==="markdown"?"Markdown":"XML",o=Re(u.value),g=[{role:"system",content:`ä½ æ˜¯ä¸€ä¸ªä¸“ä¸šçš„æç¤ºè¯æ ¼å¼è½¬æ¢åŠ©æ‰‹ã€‚ä½ çš„ä»»åŠ¡æ˜¯å°†æç¤ºè¯ä»${h}æ ¼å¼è½¬æ¢ä¸º${k}æ ¼å¼ï¼Œä¿æŒå†…å®¹å®Œå…¨ä¸€è‡´ï¼Œåªæ”¹å˜æ ¼å¼æ ·å¼ã€‚

**é‡è¦è§„åˆ™**ï¼š
1. **ç»å¯¹ä¸èƒ½æ·»åŠ ã€åˆ é™¤æˆ–ä¿®æ”¹ä»»ä½•å®è´¨æ€§å†…å®¹**
2. **åªèƒ½æ”¹å˜æ ¼å¼æ ‡è®°ï¼ˆå¦‚ Markdown çš„ # æ ‡é¢˜æ”¹ä¸º XML çš„ <section> æ ‡ç­¾ï¼‰**
3. **å¿…é¡»ä¿ç•™åŸæ–‡çš„æ‰€æœ‰ä¿¡æ¯å’Œè¯­ä¹‰**
4. **ä¸è¦æ·»åŠ ä»»ä½•è§£é‡Šã€è¯´æ˜æˆ–é¢å¤–çš„æ–‡å­—**
5. **ç›´æ¥è¾“å‡ºè½¬æ¢åçš„ç»“æœï¼Œä¸è¦åŒ…å«ä»»ä½•å‰è¨€æˆ–åè®°**

${k==="XML"?"ä½¿ç”¨ <prompt>, <section>, <rule>, <example> ç­‰ XML æ ‡ç­¾ç»„ç»‡å†…å®¹ã€‚":"ä½¿ç”¨ Markdown è¯­æ³•ï¼š# æ ‡é¢˜ï¼Œ- åˆ—è¡¨ï¼Œ**ç²—ä½“** ç­‰ç»„ç»‡å†…å®¹ã€‚"}`},{role:"user",content:`è¯·å°†ä»¥ä¸‹æç¤ºè¯ä»${h}æ ¼å¼è½¬æ¢ä¸º${k}æ ¼å¼ï¼š

${o}`}],b=await s.callAI(g,M,I.id,!1);if(b&&b.trim()){const w=ie(b);if(typeof f=="string"){const R=i.value;p.promptData.generatedPrompt={markdown:{zh:t.value==="markdown"&&R==="zh"?f:"",en:t.value==="markdown"&&R==="en"?f:""},xml:{zh:t.value==="xml"&&R==="zh"?f:"",en:t.value==="xml"&&R==="en"?f:""}},i.value==="zh"?p.promptData.generatedPrompt[c].zh=w:p.promptData.generatedPrompt[c].en=w}else"markdown"in f?i.value==="zh"?f[c].zh=w:f[c].en=w:(p.promptData.generatedPrompt={markdown:{zh:t.value==="markdown"?f.zh:"",en:t.value==="markdown"?f.en:""},xml:{zh:t.value==="xml"?f.zh:"",en:t.value==="xml"?f.en:""}},i.value==="zh"?p.promptData.generatedPrompt[c].zh=w:p.promptData.generatedPrompt[c].en=w);t.value=c,e.success(`å·²è½¬æ¢ä¸º${k}æ ¼å¼`)}else e.error("æ ¼å¼è½¬æ¢å¤±è´¥ï¼šè¿”å›å†…å®¹ä¸ºç©º")}catch{e.error("æ ¼å¼è½¬æ¢å¤±è´¥ï¼Œè¯·é‡è¯•")}finally{r.value=!1}},toggleLanguage:async()=>{if(!u.value||r.value||a.value)return;const c=i.value==="zh"?"en":"zh",f=p.promptData.generatedPrompt;if(typeof f!="string"&&"markdown"in f&&"xml"in f&&f[t.value][c]){i.value=c,e.success(`å·²åˆ‡æ¢ä¸º${c==="zh"?"ä¸­æ–‡":"è‹±æ–‡"}ç‰ˆæœ¬`);return}if(typeof f!="string"&&!("markdown"in f)){if(c==="zh"&&f.zh){i.value="zh",e.success("å·²åˆ‡æ¢ä¸ºä¸­æ–‡ç‰ˆæœ¬");return}if(c==="en"&&f.en){i.value="en",e.success("å·²åˆ‡æ¢ä¸ºè‹±æ–‡ç‰ˆæœ¬");return}}const M=l.getCurrentProvider(),I=l.getCurrentModel();if(!M||!I){e.error("è¯·å…ˆé…ç½®AIæ¨¡å‹");return}try{a.value=!0;const k=c==="zh"?"ä¸­æ–‡":"è‹±æ–‡",h=Re(u.value),o=[{role:"system",content:`ä½ æ˜¯ä¸€ä¸ªä¸“ä¸šçš„AIæç¤ºè¯ç¿»è¯‘åŠ©æ‰‹ã€‚ä½ çš„ä»»åŠ¡æ˜¯å°†æç¤ºè¯ç¿»è¯‘ä¸º${k}ï¼ŒåŒæ—¶ä¿æŒæç¤ºè¯çš„ä¸“ä¸šæ€§ã€å‡†ç¡®æ€§å’Œå®Œæ•´æ€§ã€‚

**é‡è¦è§„åˆ™**ï¼š
1. **å¿…é¡»ä¿ç•™æ‰€æœ‰åŸæœ‰çš„æ ¼å¼æ ‡è®°**ï¼ˆå¦‚ Markdown çš„ #ã€- æˆ– XML çš„æ ‡ç­¾ï¼‰
2. **ç¿»è¯‘å¿…é¡»å‡†ç¡®ä¼ è¾¾åŸæ„**ï¼Œç‰¹åˆ«æ˜¯æŠ€æœ¯æœ¯è¯­å’ŒæŒ‡ä»¤
3. **ä¿æŒæç¤ºè¯çš„ä¸“ä¸šè¯­æ°”å’Œç»“æ„**
4. **ä¸è¦æ·»åŠ ä»»ä½•é¢å¤–çš„è§£é‡Šæˆ–è¯´æ˜**
5. **ç›´æ¥è¾“å‡ºç¿»è¯‘ç»“æœï¼Œä¸è¦åŒ…å«ä»»ä½•å‰è¨€æˆ–åè®°**
6. **å¯¹äºä¸“æœ‰åè¯ã€æŠ€æœ¯æœ¯è¯­ï¼Œè¦ä½¿ç”¨è¡Œä¸šæ ‡å‡†è¯‘æ³•**`},{role:"user",content:`è¯·å°†ä»¥ä¸‹AIæç¤ºè¯ç¿»è¯‘ä¸º${k}ï¼š

${h}`}],g=await s.callAI(o,M,I.id,!1);if(g&&g.trim()){const b=ie(g);if(typeof f=="string"){const w=i.value;p.promptData.generatedPrompt={markdown:{zh:t.value==="markdown"&&w==="zh"?f:t.value==="markdown"&&c==="zh"?b:"",en:t.value==="markdown"&&w==="en"?f:t.value==="markdown"&&c==="en"?b:""},xml:{zh:t.value==="xml"&&w==="zh"?f:t.value==="xml"&&c==="zh"?b:"",en:t.value==="xml"&&w==="en"?f:t.value==="xml"&&c==="en"?b:""}}}else"markdown"in f?f[t.value][c]=b:p.promptData.generatedPrompt={markdown:{zh:t.value==="markdown"?f.zh||(c==="zh"?b:""):"",en:t.value==="markdown"?f.en||(c==="en"?b:""):""},xml:{zh:t.value==="xml"?f.zh||(c==="zh"?b:""):"",en:t.value==="xml"?f.en||(c==="en"?b:""):""}};i.value=c,e.success(`å·²ç¿»è¯‘ä¸º${k}ç‰ˆæœ¬`)}else e.error("è¯­è¨€è½¬æ¢å¤±è´¥ï¼šè¿”å›å†…å®¹ä¸ºç©º")}catch{e.error("è¯­è¨€è½¬æ¢å¤±è´¥ï¼Œè¯·é‡è¯•")}finally{a.value=!1}}}}function mr(){const p=D({}),l=u=>{p.value=u},e=()=>{V(()=>{[p.value.reportScrollContainer,p.value.thinkingScrollContainer,p.value.initialScrollContainer,p.value.adviceScrollContainer,p.value.finalScrollContainer].forEach(d=>{d&&(d.scrollTop=d.scrollHeight)})})},s=u=>{V(()=>{const d=p.value[u];d&&(d.scrollTop=d.scrollHeight)})},r=u=>{V(()=>{const d=p.value[u];d&&(d.scrollTop=0)})},a=u=>{V(()=>{const d=p.value[u];d&&d.scrollTo({top:d.scrollHeight,behavior:"smooth"})})},t=u=>{const d=p.value[u];return d?Math.abs(d.scrollHeight-d.scrollTop-d.clientHeight)<5:!1};return{setScrollContainerRefs:l,scrollToBottomOfContent:e,scrollContainerToBottom:s,scrollContainerToTop:r,smoothScrollToBottom:a,isScrolledToBottom:t,autoScrollIfAtBottom:u=>{t(u)&&s(u)}}}function gr(){const p=se(),l=D({report:!1,thinking:!1,initial:!1,advice:!1,final:!1});return{copyStatus:l,copyToClipboard:async(s,r)=>{if(!s||s.trim()===""){p.warning("å†…å®¹ä¸ºç©ºï¼Œæ— æ³•å¤åˆ¶");return}try{await Te(s),l.value[r]=!0,p.success("å·²å¤åˆ¶åˆ°å‰ªè´´æ¿"),setTimeout(()=>{l.value[r]=!1},2e3)}catch{p.error("å¤åˆ¶å¤±è´¥ï¼Œè¯·é‡è¯•")}}}}function vr(){const p=ee();return{addThinkingPoint:()=>{p.promptData.thinkingPoints||(p.promptData.thinkingPoints=[]),p.promptData.thinkingPoints.push("")},removeThinkingPoint:a=>{p.promptData.thinkingPoints&&a>=0&&a<p.promptData.thinkingPoints.length&&p.promptData.thinkingPoints.splice(a,1)},addAdviceItem:()=>{p.promptData.advice||(p.promptData.advice=[]),p.promptData.advice.push("")},removeAdviceItem:a=>{p.promptData.advice&&a>=0&&a<p.promptData.advice.length&&p.promptData.advice.splice(a,1)}}}function fr(){const p=ee(),l=W(()=>!0),e=W(()=>p.chatMessages&&p.chatMessages.length>0);return{hasAnyContent:l,hasConversationData:e,getStepDisplayName:r=>({report:"ç”Ÿæˆéœ€æ±‚æŠ¥å‘Š",thinking:"æå–å…³é”®æŒ‡ä»¤",initial:"ç”Ÿæˆåˆå§‹æç¤ºè¯",advice:"åˆ†æä¼˜åŒ–å»ºè®®",final:"åˆæˆæœ€ç»ˆæç¤ºè¯"})[r]||"ç”Ÿæˆ"}}const hr={class:"bg-white rounded-lg shadow-sm flex flex-col h-full"},yr={key:1,class:"flex-1 flex flex-col overflow-hidden p-4"},br=K({__name:"PreviewPanel",emits:["toggle"],setup(p){const l=se(),e=ee(),s="https://api.prompt-ui.xiechengqi.top",r=D(!1),a=D(!1),t=D(""),i=cr(),u=mr(),d=dr(),v=gr(),c=vr(),f=fr(),M=pr(i.switchToTabWithScroll,u.scrollToBottomOfContent),I=()=>{let h;const o=e.promptData.generatedPrompt;if(typeof o=="string"?h=o:"markdown"in o&&"xml"in o?h=o.markdown.zh||o.markdown.en||o.xml.zh||o.xml.en:h=o.zh||o.en,!h||!h.trim()){l.warning("æ²¡æœ‰å¯ä¿å­˜çš„æç¤ºè¯å†…å®¹",2e3);return}t.value=h,a.value=!0},k=async h=>{try{r.value=!0;const o=localStorage.getItem("yprompt_token");if(!o)throw new Error("è¯·å…ˆç™»å½•");const g={title:h.title,description:h.description,final_prompt:t.value,language:"zh",format:"markdown",prompt_type:h.promptType,tags:h.tags,is_public:h.isPublic?1:0},b=await fetch(`${s}/api/prompts/`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${o}`},body:JSON.stringify(g)});if(!b.ok){const R=await b.text();throw new Error(`HTTP ${b.status}: ${R}`)}const w=await b.json();if(w.code===200)l.success("æç¤ºè¯ä¿å­˜æˆåŠŸï¼",2e3),a.value=!1;else throw new Error(w.message||"ä¿å­˜å¤±è´¥")}catch(o){console.error("ä¿å­˜æç¤ºè¯å¤±è´¥:",o),l.error(`ä¿å­˜å¤±è´¥: ${o.message}`,3e3)}finally{r.value=!1}};return _(()=>e.chatMessages.length,h=>{h===0&&(i.switchToTabWithScroll("report"),i.newContentTabs.value.clear())}),_(()=>e.promptData.requirementReport,h=>{h&&h.trim().length>0&&(i.newContentTabs.value.add("report"),i.switchToTabWithScroll("report"))}),_(()=>e.promptData.thinkingPoints,h=>{h&&h.length>0&&(i.newContentTabs.value.add("thinking"),i.switchToTabWithScroll("thinking"))}),_(()=>e.promptData.initialPrompt,h=>{h&&h.trim().length>0&&(i.newContentTabs.value.add("initial"),i.switchToTabWithScroll("initial"))}),_(()=>e.promptData.advice,h=>{h&&h.length>0&&(i.newContentTabs.value.add("advice"),i.switchToTabWithScroll("advice"))}),_(()=>e.promptData.generatedPrompt,h=>{if(h){let o=!1;typeof h=="string"?o=h.trim().length>0:"markdown"in h&&"xml"in h?o=!!(h.markdown.zh&&h.markdown.zh.trim().length>0||h.markdown.en&&h.markdown.en.trim().length>0||h.xml.zh&&h.xml.zh.trim().length>0||h.xml.en&&h.xml.en.trim().length>0):typeof h=="object"&&(o=!!(h.zh&&h.zh.trim().length>0||h.en&&h.en.trim().length>0)),o&&(i.newContentTabs.value.add("zh"),i.switchToTabWithScroll("zh"))}}),_(()=>e.promptData.requirementReport,()=>{e.isGenerating&&i.activeTab.value==="report"&&V(()=>{u.scrollContainerToBottom("reportScrollContainer")})},{flush:"post"}),_(()=>e.promptData.thinkingPoints,()=>{e.isGenerating&&i.activeTab.value==="thinking"&&V(()=>{u.scrollContainerToBottom("thinkingScrollContainer")})},{flush:"post"}),_(()=>e.promptData.initialPrompt,()=>{e.isGenerating&&i.activeTab.value==="initial"&&V(()=>{u.scrollContainerToBottom("initialScrollContainer")})},{flush:"post"}),_(()=>e.promptData.advice,()=>{e.isGenerating&&i.activeTab.value==="advice"&&V(()=>{u.scrollContainerToBottom("adviceScrollContainer")})},{flush:"post"}),_(()=>e.promptData.generatedPrompt,()=>{e.isGenerating&&i.activeTab.value==="zh"&&V(()=>{u.scrollContainerToBottom("finalScrollContainer")})},{flush:"post"}),(h,o)=>(y(),C("div",hr,[q(Dn,{"is-auto-mode":n(e).isAutoMode,"current-execution-step":n(e).currentExecutionStep,"is-generating":n(e).isGenerating,"onUpdate:isAutoMode":o[0]||(o[0]=g=>n(e).isAutoMode=g)},null,8,["is-auto-mode","current-execution-step","is-generating"]),n(e).isGenerating&&!n(f).hasAnyContent.value?(y(),j(Tn,{key:0})):z("",!0),n(f).hasAnyContent.value?(y(),C("div",yr,[q(Ve,{"is-generating":n(e).isGenerating,onMounted:o[11]||(o[11]=g=>n(i).setTabRefs({tabContainer:g}))},{default:le(()=>[q(de,{"is-active":n(i).activeTab.value==="report","active-class":"bg-orange-500 text-white",onClick:o[1]||(o[1]=g=>n(i).handleTabChange("report")),onMounted:o[2]||(o[2]=g=>n(i).setTabRefs({reportTab:g}))},{default:le(()=>[...o[28]||(o[28]=[pe(" éœ€æ±‚æè¿° ",-1)])]),_:1},8,["is-active"]),n(e).promptData.thinkingPoints?(y(),j(de,{key:0,"is-active":n(i).activeTab.value==="thinking","active-class":"bg-purple-500 text-white",onClick:o[3]||(o[3]=g=>n(i).handleTabChange("thinking")),onMounted:o[4]||(o[4]=g=>n(i).setTabRefs({thinkingTab:g}))},{default:le(()=>[...o[29]||(o[29]=[pe(" å…³é”®æŒ‡ä»¤ ",-1)])]),_:1},8,["is-active"])):z("",!0),n(e).promptData.initialPrompt?(y(),j(de,{key:1,"is-active":n(i).activeTab.value==="initial","active-class":"bg-green-500 text-white",onClick:o[5]||(o[5]=g=>n(i).handleTabChange("initial")),onMounted:o[6]||(o[6]=g=>n(i).setTabRefs({initialTab:g}))},{default:le(()=>[...o[30]||(o[30]=[pe(" åˆå§‹æç¤ºè¯ ",-1)])]),_:1},8,["is-active"])):z("",!0),n(e).promptData.advice?(y(),j(de,{key:2,"is-active":n(i).activeTab.value==="advice","active-class":"bg-yellow-500 text-white",onClick:o[7]||(o[7]=g=>n(i).handleTabChange("advice")),onMounted:o[8]||(o[8]=g=>n(i).setTabRefs({adviceTab:g}))},{default:le(()=>[...o[31]||(o[31]=[pe(" ä¼˜åŒ–å»ºè®® ",-1)])]),_:1},8,["is-active"])):z("",!0),n(d).currentGeneratedPrompt.value?(y(),j(de,{key:3,"is-active":n(i).activeTab.value==="zh","active-class":"bg-blue-500 text-white",onClick:o[9]||(o[9]=g=>n(i).handleTabChange("zh")),onMounted:o[10]||(o[10]=g=>n(i).setTabRefs({zhTab:g}))},{default:le(()=>[...o[32]||(o[32]=[pe(" æœ€ç»ˆæç¤ºè¯ ",-1)])]),_:1},8,["is-active"])):z("",!0)]),_:1},8,["is-generating"]),n(i).activeTab.value==="report"?(y(),j(Hn,{key:0,"requirement-report":n(e).promptData.requirementReport,"onUpdate:requirementReport":o[12]||(o[12]=g=>n(e).promptData.requirementReport=g),"has-conversation-data":n(f).hasConversationData.value,"is-auto-mode":n(e).isAutoMode,"is-executing":n(M).isExecuting.value,"is-generating":n(e).isGenerating,"current-execution-step":n(e).currentExecutionStep,"is-copied":n(v).copyStatus.value.report,onRegenerate:n(M).regenerateRequirementReport,onCopy:o[13]||(o[13]=g=>n(v).copyToClipboard(n(e).promptData.requirementReport,"report")),onExecuteFull:n(M).executeFullWorkflow,onExecuteThinking:n(M).executeThinkingPoints,onScrollMounted:o[14]||(o[14]=g=>n(u).setScrollContainerRefs({reportScrollContainer:g}))},null,8,["requirement-report","has-conversation-data","is-auto-mode","is-executing","is-generating","current-execution-step","is-copied","onRegenerate","onExecuteFull","onExecuteThinking"])):z("",!0),n(i).activeTab.value==="thinking"?(y(),j(er,{key:1,"thinking-points":n(e).promptData.thinkingPoints||[],"is-auto-mode":n(e).isAutoMode,"is-executing":n(M).isExecuting.value,"is-generating":n(e).isGenerating,"current-execution-step":n(e).currentExecutionStep,"is-copied":n(v).copyStatus.value.thinking,onRegenerate:n(M).regenerateThinkingPoints,onCopy:o[15]||(o[15]=g=>{var b;return n(v).copyToClipboard(((b=n(e).promptData.thinkingPoints)==null?void 0:b.join(`
`))||"","thinking")}),onAddPoint:n(c).addThinkingPoint,onRemovePoint:n(c).removeThinkingPoint,onUpdatePoint:o[16]||(o[16]=(g,b)=>{n(e).promptData.thinkingPoints&&(n(e).promptData.thinkingPoints[g]=b)}),onExecuteInitial:n(M).executeInitialPrompt,onScrollMounted:o[17]||(o[17]=g=>n(u).setScrollContainerRefs({thinkingScrollContainer:g}))},null,8,["thinking-points","is-auto-mode","is-executing","is-generating","current-execution-step","is-copied","onRegenerate","onAddPoint","onRemovePoint","onExecuteInitial"])):z("",!0),n(i).activeTab.value==="initial"?(y(),j(ur,{key:2,"initial-prompt":n(e).promptData.initialPrompt,"onUpdate:initialPrompt":o[18]||(o[18]=g=>n(e).promptData.initialPrompt=g),"is-auto-mode":n(e).isAutoMode,"is-executing":n(M).isExecuting.value,"is-generating":n(e).isGenerating,"current-execution-step":n(e).currentExecutionStep,"is-copied":n(v).copyStatus.value.initial,onRegenerate:n(M).regenerateInitialPrompt,onCopy:o[19]||(o[19]=g=>n(v).copyToClipboard(n(e).promptData.initialPrompt||"","initial")),onExecuteAdvice:n(M).executeAdvice,onScrollMounted:o[20]||(o[20]=g=>n(u).setScrollContainerRefs({initialScrollContainer:g}))},null,8,["initial-prompt","is-auto-mode","is-executing","is-generating","current-execution-step","is-copied","onRegenerate","onExecuteAdvice"])):z("",!0),n(i).activeTab.value==="advice"?(y(),j(We,{key:3,advice:n(e).promptData.advice||[],"is-auto-mode":n(e).isAutoMode,"is-executing":n(M).isExecuting.value,"is-generating":n(e).isGenerating,"current-execution-step":n(e).currentExecutionStep,"is-copied":n(v).copyStatus.value.advice,onRegenerate:n(M).regenerateAdvice,onCopy:o[21]||(o[21]=g=>{var b;return n(v).copyToClipboard(((b=n(e).promptData.advice)==null?void 0:b.join(`
`))||"","advice")}),onAddItem:n(c).addAdviceItem,onRemoveItem:n(c).removeAdviceItem,onUpdateItem:o[22]||(o[22]=(g,b)=>{n(e).promptData.advice&&(n(e).promptData.advice[g]=b)}),onExecuteFinal:n(M).executeFinalPrompt,onScrollMounted:o[23]||(o[23]=g=>n(u).setScrollContainerRefs({adviceScrollContainer:g}))},null,8,["advice","is-auto-mode","is-executing","is-generating","current-execution-step","is-copied","onRegenerate","onAddItem","onRemoveItem","onExecuteFinal"])):z("",!0),n(i).activeTab.value==="zh"?(y(),j(Je,{key:4,"generated-prompt":n(d).currentGeneratedPrompt.value,"onUpdate:generatedPrompt":o[24]||(o[24]=g=>n(d).currentGeneratedPrompt.value=g),"is-executing":n(M).isExecuting.value,"is-generating":n(e).isGenerating,"current-execution-step":n(e).currentExecutionStep,"is-copied":n(v).copyStatus.value.final,"is-converting-format":n(d).isConvertingFormat.value,"is-converting-language":n(d).isConvertingLanguage.value,"is-saving":r.value,"format-state":n(d).formatState.value,"language-state":n(d).languageState.value,onRegenerate:n(M).regenerateFinalPrompt,onCopy:o[25]||(o[25]=g=>n(v).copyToClipboard(n(d).currentGeneratedPrompt.value,"final")),onToggleFormat:n(d).toggleFormat,onToggleLanguage:n(d).toggleLanguage,onSavePrompt:I,onScrollMounted:o[26]||(o[26]=g=>n(u).setScrollContainerRefs({finalScrollContainer:g}))},null,8,["generated-prompt","is-executing","is-generating","current-execution-step","is-copied","is-converting-format","is-converting-language","is-saving","format-state","language-state","onRegenerate","onToggleFormat","onToggleLanguage"])):z("",!0)])):z("",!0),!n(f).hasAnyContent.value&&!n(e).isGenerating?(y(),j(Ye,{key:2})):z("",!0),q(Ze,{"is-open":a.value,"prompt-content":t.value,"is-saving":r.value,onSave:k,onCancel:o[27]||(o[27]=g=>a.value=!1)},null,8,["is-open","prompt-content","is-saving"])]))}}),xr={key:0,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4"},kr={class:"bg-white rounded-lg max-w-4xl w-full h-[90vh] flex flex-col overflow-hidden"},wr={class:"flex items-center justify-between p-6 border-b flex-shrink-0"},Sr={class:"flex items-center space-x-4"},Cr={class:"flex space-x-1"},Pr={class:"flex-1 overflow-y-auto p-6"},Mr={class:"flex justify-end space-x-3 p-4 border-t bg-gray-50 flex-shrink-0"},Rr=K({__name:"GenerateSettingsModal",setup(p){const l=me(),e=Ee(),s=se(),r=D("providers"),a=Le(),t=async()=>{try{await l.refreshSettings(),s.success("é…ç½®å·²åˆ·æ–°")}catch(i){console.error("åˆ·æ–°é…ç½®å¤±è´¥:",i),s.error(`åˆ·æ–°é…ç½®å¤±è´¥: ${i.message||"æœªçŸ¥é”™è¯¯"}`)}};return oe(()=>{l.initialize(),e.loadSettings()}),(i,u)=>(y(),C(re,null,[q(Fe,{onOpen:u[0]||(u[0]=d=>n(e).showSettings=!0)}),n(e).showSettings?(y(),C("div",xr,[m("div",kr,[m("div",wr,[m("div",Sr,[u[7]||(u[7]=m("h4",{class:"text-xl font-semibold"},"è®¾ç½®",-1)),m("div",Cr,[m("button",{onClick:u[1]||(u[1]=d=>r.value="providers"),class:O(["px-3 py-1 rounded text-sm font-medium transition-colors",r.value==="providers"?"bg-blue-100 text-blue-700":"text-gray-600 hover:text-gray-800"])}," AIæ¨¡å‹ ",2),m("button",{onClick:u[2]||(u[2]=d=>r.value="params"),class:O(["px-3 py-1 rounded text-sm font-medium transition-colors",r.value==="params"?"bg-blue-100 text-blue-700":"text-gray-600 hover:text-gray-800"])}," æ¨¡å‹å‚æ•° ",2),m("button",{onClick:u[3]||(u[3]=d=>r.value="prompts"),class:O(["px-3 py-1 rounded text-sm font-medium transition-colors",r.value==="prompts"?"bg-blue-100 text-blue-700":"text-gray-600 hover:text-gray-800"])}," æç¤ºè¯è§„åˆ™ ",2)])]),m("button",{onClick:u[4]||(u[4]=d=>n(e).showSettings=!1),class:"p-1 hover:bg-gray-100 rounded"},[q(n(we),{class:"w-5 h-5"})])]),m("div",Pr,[r.value==="providers"?(y(),j(je,{key:0,providers:n(l).allProviders,"last-refreshed-at":n(l).lastRefreshedAt,"is-loading":n(l).isLoading,onRefreshConfig:t},null,8,["providers","last-refreshed-at","is-loading"])):z("",!0),r.value==="params"?(y(),j(Oe,{key:1})):z("",!0),r.value==="prompts"?(y(),j(He,{key:2,onResetSystem:n(a).resetSystemPromptRules,onResetUser:n(a).resetUserPromptRules,onResetRequirement:n(a).resetRequirementReportRules,onResetQualityAnalysisSystem:n(a).resetQualityAnalysisSystemPrompt,onResetThinking:n(a).resetThinkingPointsExtractionPrompt,onResetGeneration:n(a).resetSystemPromptGenerationPrompt,onResetAdvice:n(a).resetOptimizationAdvicePrompt,onResetApplication:n(a).resetOptimizationApplicationPrompt,onToggleSlimRules:n(a).handleSlimRulesToggle,onResetUserPromptQualityAnalysis:n(a).resetUserPromptQualityAnalysis,onResetUserPromptQuickOptimization:n(a).resetUserPromptQuickOptimization},null,8,["onResetSystem","onResetUser","onResetRequirement","onResetQualityAnalysisSystem","onResetThinking","onResetGeneration","onResetAdvice","onResetApplication","onToggleSlimRules","onResetUserPromptQualityAnalysis","onResetUserPromptQuickOptimization"])):z("",!0)]),m("div",Mr,[m("button",{onClick:u[5]||(u[5]=d=>n(e).showSettings=!1),class:"px-4 py-2 text-gray-600 border border-gray-300 rounded-md hover:bg-gray-50 transition-colors"}," å–æ¶ˆ "),m("button",{onClick:u[6]||(u[6]=(...d)=>n(a).saveAndClose&&n(a).saveAndClose(...d)),class:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition-colors"}," ä¿å­˜è®¾ç½® ")])])])):z("",!0)],64))}}),$r={class:"w-full h-full flex flex-col overflow-hidden p-2"},Dr={class:"w-full h-full flex flex-col overflow-hidden"},Er={class:"flex flex-row flex-1 min-h-0 gap-4 overflow-hidden"},Tr={class:"flex flex-col flex-1 min-h-0"},Ir={class:"flex flex-col flex-1 min-h-0"},Lr=K({__name:"GenerateModule",setup(p){const l=me();return oe(async()=>{l.isInitialized||await l.initialize(),l.enabledProviders.length>0||setTimeout(()=>{},1e3)}),(e,s)=>(y(),C("div",$r,[q(Rr),m("div",Dr,[s[0]||(s[0]=De('<div class="bg-white rounded-lg shadow-sm p-4 mb-4 flex-shrink-0"><div class="flex items-center justify-between"><div class="min-w-0"><h2 class="text-xl lg:text-2xl font-bold text-gray-800 mb-1">æ™ºèƒ½æç¤ºè¯åˆ›å»º</h2><p class="text-sm lg:text-base text-gray-600">AIå¼•å¯¼å¼å¯¹è¯ï¼Œå¸®æ‚¨æ„å»ºä¸“ä¸šçš„æç¤ºè¯</p></div></div></div>',1)),m("div",Er,[m("div",Tr,[q(xn)]),m("div",Ir,[q(br)])])]),q(_e)]))}});export{Lr as default};
