var ReactGrabGemini=(function(exports){'use strict';var A=5e3,v="react-grab:agent-sessions",C=e=>{let t="",n="";for(let o of e.split(`
`))o.startsWith("event:")?t=o.slice(6).trim():o.startsWith("data:")&&(n=o.slice(5).trim());return {eventType:t,data:n}},T=async function*(e,t){let n=e.getReader(),o=new TextDecoder,r="",s=false,a=()=>{s=true,n.cancel().catch(()=>{});};t.addEventListener("abort",a);try{if(t.aborted)throw new DOMException("Aborted","AbortError");for(;;){let d=await n.read();if(s||t.aborted)throw new DOMException("Aborted","AbortError");let{done:i,value:l}=d;l&&(r+=o.decode(l,{stream:!0}));let c;for(;(c=r.indexOf(`

`))!==-1;){let{eventType:f,data:p}=C(r.slice(0,c));if(r=r.slice(c+2),f==="done")return;if(f==="error")throw new Error(p||"Agent error");p&&(yield p);}if(i)break}}finally{t.removeEventListener("abort",a);try{n.releaseLock();}catch{}}},g=e=>typeof e=="object"&&e!==null,E=(e,t,n=v)=>{let o=e.getItem(n);if(!o)throw new Error("No sessions to resume");let r;try{r=JSON.parse(o);}catch{throw new Error("Failed to parse stored sessions")}if(!g(r))throw new Error("Invalid stored sessions");let s=r[t];if(!g(s))throw new Error(`Session ${t} not found`);let a=s.context;if(!g(a))throw new Error(`Session ${t} is invalid`);let d=a.content,i=a.prompt;if(typeof d!="string"||typeof i!="string")throw new Error(`Session ${t} is invalid`);let l=a.options,c=a.sessionId;return {content:d,prompt:i,options:l,sessionId:typeof c=="string"?c:void 0}},h=async function*(e,t,n){let o=Date.now(),r=t.sessionId,s=e.pollIntervalMs??100,a=`${e.serverUrl}${e.agentPath??"/agent"}`,d=()=>{if(!r)return;let i=e.abortPath?.(r)??`/abort/${r}`;fetch(`${e.serverUrl}${i}`,{method:"POST"}).catch(()=>{});};n.addEventListener("abort",d);try{let i=await fetch(a,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t),signal:n});if(!i.ok)throw new Error(`Server error: ${i.status}`);if(!i.body)throw new Error("No response body");let l=T(i.body,n)[Symbol.asyncIterator](),c=!1,f=l.next(),p=null;for(;!c;){let S=await Promise.race([f.then(u=>({type:"status",iteratorResult:u})),new Promise(u=>setTimeout(()=>u({type:"timeout"}),s))]),m=(Date.now()-o)/1e3;if(S.type==="status"){let u=S.iteratorResult;c=u.done??!1,!c&&u.value&&(p=u.value,f=l.next());}p===e.completedStatus?yield `Completed in ${m.toFixed(1)}s`:p?yield `${p} ${m.toFixed(1)}s`:yield `Working\u2026 ${m.toFixed(1)}s`;}}finally{n.removeEventListener("abort",d);}},b=(e,t=A)=>{let n=null;return async()=>{let o=Date.now();if(n&&o-n.timestamp<t)return n.result;try{let r=await e();return n={result:r,timestamp:o},r}catch{return n={result:false,timestamp:o},false}}};var y="Completed successfully";var x="https://gemini-react-grab.xiechengqi.top",w=e=>typeof e=="object"&&e!==null&&"setAgent"in e,O=(e={})=>{let{serverUrl:t=x,getOptions:n}=e,o=s=>({...n?.()??{},...s??{}}),r=b(async()=>(await fetch(`${t}/health`,{method:"GET"})).ok,A);return {send:async function*(s,a){let d={...s,options:o(s.options)};yield*h({serverUrl:t,completedStatus:y},d,a);},resume:async function*(s,a,d){let i=E(d,s),l={content:i.content,prompt:i.prompt,options:i.options,sessionId:i.sessionId??s},c={...l,options:o(l.options)};yield "Resuming...",yield*h({serverUrl:t,completedStatus:y},c,a);},supportsResume:true,supportsFollowUp:true,checkConnection:r,abort:async s=>{try{await fetch(`${t}/abort/${s}`,{method:"POST"});}catch{}},undo:async()=>{try{await fetch(`${t}/undo`,{method:"POST"});}catch{}}}},_=async()=>{if(typeof window>"u")return;let e=O(),t=r=>{r.setAgent({provider:e,storage:sessionStorage});},n=window.__REACT_GRAB__;if(w(n)){t(n);return}window.addEventListener("react-grab:init",r=>{r instanceof CustomEvent&&w(r.detail)&&t(r.detail);},{once:true});let o=window.__REACT_GRAB__;w(o)&&t(o);};_();
exports.attachAgent=_;exports.createGeminiAgentProvider=O;return exports;})({});